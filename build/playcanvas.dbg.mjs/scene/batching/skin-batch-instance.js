import { SkinInstance } from '../skin-instance.js';

// Class derived from SkinInstance with changes to make it suitable for batching
class SkinBatchInstance extends SkinInstance {
  constructor(device, nodes, rootNode) {
    super();
    const numBones = nodes.length;
    this.init(device, numBones);
    this.device = device;
    this.rootNode = rootNode;

    // Unique bones per clone
    this.bones = nodes;
  }
  updateMatrices(rootNode, skinUpdateIndex) {}
  updateMatrixPalette(rootNode, skinUpdateIndex) {
    const mp = this.matrixPalette;
    const count = this.bones.length;
    for (let i = 0; i < count; i++) {
      const pe = this.bones[i].getWorldTransform().data;

      // Copy the matrix into the palette, ready to be sent to the vertex shader, transpose matrix from 4x4 to 4x3 format as well
      const base = i * 12;
      mp[base] = pe[0];
      mp[base + 1] = pe[4];
      mp[base + 2] = pe[8];
      mp[base + 3] = pe[12];
      mp[base + 4] = pe[1];
      mp[base + 5] = pe[5];
      mp[base + 6] = pe[9];
      mp[base + 7] = pe[13];
      mp[base + 8] = pe[2];
      mp[base + 9] = pe[6];
      mp[base + 10] = pe[10];
      mp[base + 11] = pe[14];
    }
    this.uploadBones(this.device);
  }
}

export { SkinBatchInstance };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tpbi1iYXRjaC1pbnN0YW5jZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3NjZW5lL2JhdGNoaW5nL3NraW4tYmF0Y2gtaW5zdGFuY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2tpbkluc3RhbmNlIH0gZnJvbSAnLi4vc2tpbi1pbnN0YW5jZS5qcyc7XG5cbi8vIENsYXNzIGRlcml2ZWQgZnJvbSBTa2luSW5zdGFuY2Ugd2l0aCBjaGFuZ2VzIHRvIG1ha2UgaXQgc3VpdGFibGUgZm9yIGJhdGNoaW5nXG5jbGFzcyBTa2luQmF0Y2hJbnN0YW5jZSBleHRlbmRzIFNraW5JbnN0YW5jZSB7XG4gICAgY29uc3RydWN0b3IoZGV2aWNlLCBub2Rlcywgcm9vdE5vZGUpIHtcblxuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIGNvbnN0IG51bUJvbmVzID0gbm9kZXMubGVuZ3RoO1xuICAgICAgICB0aGlzLmluaXQoZGV2aWNlLCBudW1Cb25lcyk7XG5cbiAgICAgICAgdGhpcy5kZXZpY2UgPSBkZXZpY2U7XG4gICAgICAgIHRoaXMucm9vdE5vZGUgPSByb290Tm9kZTtcblxuICAgICAgICAvLyBVbmlxdWUgYm9uZXMgcGVyIGNsb25lXG4gICAgICAgIHRoaXMuYm9uZXMgPSBub2RlcztcbiAgICB9XG5cbiAgICB1cGRhdGVNYXRyaWNlcyhyb290Tm9kZSwgc2tpblVwZGF0ZUluZGV4KSB7XG4gICAgfVxuXG4gICAgdXBkYXRlTWF0cml4UGFsZXR0ZShyb290Tm9kZSwgc2tpblVwZGF0ZUluZGV4KSB7XG4gICAgICAgIGNvbnN0IG1wID0gdGhpcy5tYXRyaXhQYWxldHRlO1xuXG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5ib25lcy5sZW5ndGg7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgcGUgPSB0aGlzLmJvbmVzW2ldLmdldFdvcmxkVHJhbnNmb3JtKCkuZGF0YTtcblxuICAgICAgICAgICAgLy8gQ29weSB0aGUgbWF0cml4IGludG8gdGhlIHBhbGV0dGUsIHJlYWR5IHRvIGJlIHNlbnQgdG8gdGhlIHZlcnRleCBzaGFkZXIsIHRyYW5zcG9zZSBtYXRyaXggZnJvbSA0eDQgdG8gNHgzIGZvcm1hdCBhcyB3ZWxsXG4gICAgICAgICAgICBjb25zdCBiYXNlID0gaSAqIDEyO1xuICAgICAgICAgICAgbXBbYmFzZV0gPSBwZVswXTtcbiAgICAgICAgICAgIG1wW2Jhc2UgKyAxXSA9IHBlWzRdO1xuICAgICAgICAgICAgbXBbYmFzZSArIDJdID0gcGVbOF07XG4gICAgICAgICAgICBtcFtiYXNlICsgM10gPSBwZVsxMl07XG4gICAgICAgICAgICBtcFtiYXNlICsgNF0gPSBwZVsxXTtcbiAgICAgICAgICAgIG1wW2Jhc2UgKyA1XSA9IHBlWzVdO1xuICAgICAgICAgICAgbXBbYmFzZSArIDZdID0gcGVbOV07XG4gICAgICAgICAgICBtcFtiYXNlICsgN10gPSBwZVsxM107XG4gICAgICAgICAgICBtcFtiYXNlICsgOF0gPSBwZVsyXTtcbiAgICAgICAgICAgIG1wW2Jhc2UgKyA5XSA9IHBlWzZdO1xuICAgICAgICAgICAgbXBbYmFzZSArIDEwXSA9IHBlWzEwXTtcbiAgICAgICAgICAgIG1wW2Jhc2UgKyAxMV0gPSBwZVsxNF07XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnVwbG9hZEJvbmVzKHRoaXMuZGV2aWNlKTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFNraW5CYXRjaEluc3RhbmNlIH07XG4iXSwibmFtZXMiOlsiU2tpbkJhdGNoSW5zdGFuY2UiLCJTa2luSW5zdGFuY2UiLCJjb25zdHJ1Y3RvciIsImRldmljZSIsIm5vZGVzIiwicm9vdE5vZGUiLCJudW1Cb25lcyIsImxlbmd0aCIsImluaXQiLCJib25lcyIsInVwZGF0ZU1hdHJpY2VzIiwic2tpblVwZGF0ZUluZGV4IiwidXBkYXRlTWF0cml4UGFsZXR0ZSIsIm1wIiwibWF0cml4UGFsZXR0ZSIsImNvdW50IiwiaSIsInBlIiwiZ2V0V29ybGRUcmFuc2Zvcm0iLCJkYXRhIiwiYmFzZSIsInVwbG9hZEJvbmVzIl0sIm1hcHBpbmdzIjoiOztBQUVBO0FBQ0EsTUFBTUEsaUJBQWlCLFNBQVNDLFlBQVksQ0FBQztBQUN6Q0MsRUFBQUEsV0FBV0EsQ0FBQ0MsTUFBTSxFQUFFQyxLQUFLLEVBQUVDLFFBQVEsRUFBRTtBQUVqQyxJQUFBLEtBQUssRUFBRSxDQUFBO0FBRVAsSUFBQSxNQUFNQyxRQUFRLEdBQUdGLEtBQUssQ0FBQ0csTUFBTSxDQUFBO0FBQzdCLElBQUEsSUFBSSxDQUFDQyxJQUFJLENBQUNMLE1BQU0sRUFBRUcsUUFBUSxDQUFDLENBQUE7SUFFM0IsSUFBSSxDQUFDSCxNQUFNLEdBQUdBLE1BQU0sQ0FBQTtJQUNwQixJQUFJLENBQUNFLFFBQVEsR0FBR0EsUUFBUSxDQUFBOztBQUV4QjtJQUNBLElBQUksQ0FBQ0ksS0FBSyxHQUFHTCxLQUFLLENBQUE7QUFDdEIsR0FBQTtBQUVBTSxFQUFBQSxjQUFjQSxDQUFDTCxRQUFRLEVBQUVNLGVBQWUsRUFBRSxFQUMxQztBQUVBQyxFQUFBQSxtQkFBbUJBLENBQUNQLFFBQVEsRUFBRU0sZUFBZSxFQUFFO0FBQzNDLElBQUEsTUFBTUUsRUFBRSxHQUFHLElBQUksQ0FBQ0MsYUFBYSxDQUFBO0FBRTdCLElBQUEsTUFBTUMsS0FBSyxHQUFHLElBQUksQ0FBQ04sS0FBSyxDQUFDRixNQUFNLENBQUE7SUFDL0IsS0FBSyxJQUFJUyxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUdELEtBQUssRUFBRUMsQ0FBQyxFQUFFLEVBQUU7QUFDNUIsTUFBQSxNQUFNQyxFQUFFLEdBQUcsSUFBSSxDQUFDUixLQUFLLENBQUNPLENBQUMsQ0FBQyxDQUFDRSxpQkFBaUIsRUFBRSxDQUFDQyxJQUFJLENBQUE7O0FBRWpEO0FBQ0EsTUFBQSxNQUFNQyxJQUFJLEdBQUdKLENBQUMsR0FBRyxFQUFFLENBQUE7QUFDbkJILE1BQUFBLEVBQUUsQ0FBQ08sSUFBSSxDQUFDLEdBQUdILEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtNQUNoQkosRUFBRSxDQUFDTyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUdILEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtNQUNwQkosRUFBRSxDQUFDTyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUdILEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtNQUNwQkosRUFBRSxDQUFDTyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUdILEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQTtNQUNyQkosRUFBRSxDQUFDTyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUdILEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtNQUNwQkosRUFBRSxDQUFDTyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUdILEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtNQUNwQkosRUFBRSxDQUFDTyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUdILEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtNQUNwQkosRUFBRSxDQUFDTyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUdILEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQTtNQUNyQkosRUFBRSxDQUFDTyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUdILEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtNQUNwQkosRUFBRSxDQUFDTyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUdILEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtNQUNwQkosRUFBRSxDQUFDTyxJQUFJLEdBQUcsRUFBRSxDQUFDLEdBQUdILEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQTtNQUN0QkosRUFBRSxDQUFDTyxJQUFJLEdBQUcsRUFBRSxDQUFDLEdBQUdILEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQTtBQUMxQixLQUFBO0FBRUEsSUFBQSxJQUFJLENBQUNJLFdBQVcsQ0FBQyxJQUFJLENBQUNsQixNQUFNLENBQUMsQ0FBQTtBQUNqQyxHQUFBO0FBQ0o7Ozs7In0=
