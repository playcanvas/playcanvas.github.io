/**
 * @license
 * PlayCanvas Engine v1.62.0 revision 818511d2b (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../../core/debug.js';
import { CULLFACE_NONE, CULLFACE_BACK, CULLFACE_FRONT, CULLFACE_FRONTANDBACK, FUNC_NEVER, FUNC_LESS, FUNC_EQUAL, FUNC_LESSEQUAL, FUNC_GREATER, FUNC_NOTEQUAL, FUNC_GREATEREQUAL, FUNC_ALWAYS } from '../../platform/graphics/constants.js';
import { Texture } from '../../platform/graphics/texture.js';
import { SPECOCC_NONE, SPECOCC_AO, SPECOCC_GLOSSDEPENDENT, BLEND_SUBTRACTIVE, BLEND_ADDITIVE, BLEND_NORMAL, BLEND_NONE, BLEND_PREMULTIPLIED, BLEND_MULTIPLICATIVE, BLEND_ADDITIVEALPHA, BLEND_MULTIPLICATIVE2X, BLEND_SCREEN, BLEND_MIN, BLEND_MAX, SPECULAR_PHONG, SPECULAR_BLINN } from '../constants.js';
import { standardMaterialParameterTypes, standardMaterialRemovedParameters } from './standard-material-parameters.js';

class StandardMaterialValidator {
  constructor() {
    this.removeInvalid = true;
    this.valid = true; // start off valid

    this.enumValidators = {
      occludeSpecular: this._createEnumValidator([SPECOCC_NONE, SPECOCC_AO, SPECOCC_GLOSSDEPENDENT]),
      cull: this._createEnumValidator([CULLFACE_NONE, CULLFACE_BACK, CULLFACE_FRONT, CULLFACE_FRONTANDBACK]),
      blendType: this._createEnumValidator([BLEND_SUBTRACTIVE, BLEND_ADDITIVE, BLEND_NORMAL, BLEND_NONE, BLEND_PREMULTIPLIED, BLEND_MULTIPLICATIVE, BLEND_ADDITIVEALPHA, BLEND_MULTIPLICATIVE2X, BLEND_SCREEN, BLEND_MIN, BLEND_MAX]),
      depthFunc: this._createEnumValidator([FUNC_NEVER, FUNC_LESS, FUNC_EQUAL, FUNC_LESSEQUAL, FUNC_GREATER, FUNC_NOTEQUAL, FUNC_GREATEREQUAL, FUNC_ALWAYS]),
      shadingModel: this._createEnumValidator([SPECULAR_PHONG, SPECULAR_BLINN])
    };
  }
  setInvalid(key, data) {
    this.valid = false;
    Debug.warn(`Ignoring invalid StandardMaterial property: ${key}`, data[key]);
    if (this.removeInvalid) {
      delete data[key];
    }
  }
  validate(data) {
    // validate input data against defined standard-material properties and types\
    // if removeInvalid flag is set to true then remove invalid properties from data

    const TYPES = standardMaterialParameterTypes;
    const REMOVED = standardMaterialRemovedParameters;
    const pathMapping = data.mappingFormat === 'path';
    for (const key in data) {
      const type = TYPES[key];
      if (!type) {
        if (REMOVED[key]) {
          delete data[key];
        } else {
          Debug.warnOnce(`Ignoring unsupported input property to standard material: ${key}`);
          this.valid = false;
        }
        continue;
      }
      if (type.startsWith('enum')) {
        const enumType = type.split(':')[1];
        if (this.enumValidators[enumType]) {
          if (!this.enumValidators[enumType](data[key])) {
            this.setInvalid(key, data);
          }
        }
      } else if (type === 'number') {
        if (typeof data[key] !== 'number') {
          this.setInvalid(key, data);
        }
      } else if (type === 'boolean') {
        if (typeof data[key] !== 'boolean') {
          this.setInvalid(key, data);
        }
      } else if (type === 'string') {
        if (typeof data[key] !== 'string') {
          this.setInvalid(key, data);
        }
      } else if (type === 'vec2') {
        if (!(data[key] instanceof Array && data[key].length === 2)) {
          this.setInvalid(key, data);
        }
      } else if (type === 'rgb') {
        if (!(data[key] instanceof Array && data[key].length === 3)) {
          this.setInvalid(key, data);
        }
      } else if (type === 'texture') {
        if (!pathMapping) {
          if (!(typeof data[key] === 'number' || data[key] === null)) {
            if (!(data[key] instanceof Texture)) {
              this.setInvalid(key, data);
            }
          }
          // OTHERWISE: materials are often initialized with the asset id of textures which are assigned later
          // this counts as a valid input
          // null texture reference is also valid
        } else {
          if (!(typeof data[key] === 'string' || data[key] === null)) {
            if (!(data[key] instanceof Texture)) {
              this.setInvalid(key, data);
            }
          }
          // OTHERWISE: fpr path mapped we expect a string not an asset id
        }
      } else if (type === 'boundingbox') {
        if (!(data[key].center && data[key].center instanceof Array && data[key].center.length === 3)) {
          this.setInvalid(key, data);
        }
        if (!(data[key].halfExtents && data[key].halfExtents instanceof Array && data[key].halfExtents.length === 3)) {
          this.setInvalid(key, data);
        }
      } else if (type === 'cubemap') {
        if (!(typeof data[key] === 'number' || data[key] === null || data[key] === undefined)) {
          if (!(data[key] instanceof Texture && data[key].cubemap)) {
            this.setInvalid(key, data);
          }
        }
        // OTHERWISE: materials are often initialized with the asset id of textures which are assigned later
        // this counts as a valid input
        // null texture reference is also valid
      } else if (type === 'chunks') {
        const chunkNames = Object.keys(data[key]);
        for (let i = 0; i < chunkNames.length; i++) {
          if (typeof data[key][chunkNames[i]] !== 'string') {
            this.setInvalid(chunkNames[i], data[key]);
          }
        }
      } else {
        console.error('Unknown material type: ' + type);
      }
    }

    // mark data as validated so we don't validate twice
    data.validated = true;
    return this.valid;
  }
  _createEnumValidator(values) {
    return function (value) {
      return values.indexOf(value) >= 0;
    };
  }
}

export { StandardMaterialValidator };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhbmRhcmQtbWF0ZXJpYWwtdmFsaWRhdG9yLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvc2NlbmUvbWF0ZXJpYWxzL3N0YW5kYXJkLW1hdGVyaWFsLXZhbGlkYXRvci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uLy4uL2NvcmUvZGVidWcuanMnO1xuaW1wb3J0IHtcbiAgICBDVUxMRkFDRV9CQUNLLCBDVUxMRkFDRV9GUk9OVCwgQ1VMTEZBQ0VfRlJPTlRBTkRCQUNLLCBDVUxMRkFDRV9OT05FLFxuICAgIEZVTkNfTkVWRVIsIEZVTkNfTEVTUywgRlVOQ19FUVVBTCwgRlVOQ19MRVNTRVFVQUwsIEZVTkNfR1JFQVRFUiwgRlVOQ19OT1RFUVVBTCxcbiAgICBGVU5DX0dSRUFURVJFUVVBTCwgRlVOQ19BTFdBWVNcbn0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IFRleHR1cmUgfSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy90ZXh0dXJlLmpzJztcblxuaW1wb3J0IHtcbiAgICBTUEVDT0NDX0FPLCBTUEVDT0NDX0dMT1NTREVQRU5ERU5ULCBTUEVDT0NDX05PTkUsXG4gICAgQkxFTkRfU1VCVFJBQ1RJVkUsIEJMRU5EX0FERElUSVZFLCBCTEVORF9OT1JNQUwsIEJMRU5EX05PTkUsIEJMRU5EX1BSRU1VTFRJUExJRUQsXG4gICAgQkxFTkRfTVVMVElQTElDQVRJVkUsIEJMRU5EX0FERElUSVZFQUxQSEEsIEJMRU5EX01VTFRJUExJQ0FUSVZFMlgsIEJMRU5EX1NDUkVFTixcbiAgICBCTEVORF9NSU4sIEJMRU5EX01BWCxcbiAgICBTUEVDVUxBUl9CTElOTiwgU1BFQ1VMQVJfUEhPTkdcbn0gZnJvbSAnLi4vY29uc3RhbnRzLmpzJztcblxuaW1wb3J0IHsgc3RhbmRhcmRNYXRlcmlhbFBhcmFtZXRlclR5cGVzLCBzdGFuZGFyZE1hdGVyaWFsUmVtb3ZlZFBhcmFtZXRlcnMgfSBmcm9tICcuL3N0YW5kYXJkLW1hdGVyaWFsLXBhcmFtZXRlcnMuanMnO1xuXG5jbGFzcyBTdGFuZGFyZE1hdGVyaWFsVmFsaWRhdG9yIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVJbnZhbGlkID0gdHJ1ZTtcblxuICAgICAgICB0aGlzLnZhbGlkID0gdHJ1ZTsgLy8gc3RhcnQgb2ZmIHZhbGlkXG5cbiAgICAgICAgdGhpcy5lbnVtVmFsaWRhdG9ycyA9IHtcbiAgICAgICAgICAgIG9jY2x1ZGVTcGVjdWxhcjogdGhpcy5fY3JlYXRlRW51bVZhbGlkYXRvcihbXG4gICAgICAgICAgICAgICAgU1BFQ09DQ19OT05FLFxuICAgICAgICAgICAgICAgIFNQRUNPQ0NfQU8sXG4gICAgICAgICAgICAgICAgU1BFQ09DQ19HTE9TU0RFUEVOREVOVFxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICBjdWxsOiB0aGlzLl9jcmVhdGVFbnVtVmFsaWRhdG9yKFtcbiAgICAgICAgICAgICAgICBDVUxMRkFDRV9OT05FLFxuICAgICAgICAgICAgICAgIENVTExGQUNFX0JBQ0ssXG4gICAgICAgICAgICAgICAgQ1VMTEZBQ0VfRlJPTlQsXG4gICAgICAgICAgICAgICAgQ1VMTEZBQ0VfRlJPTlRBTkRCQUNLXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIGJsZW5kVHlwZTogdGhpcy5fY3JlYXRlRW51bVZhbGlkYXRvcihbXG4gICAgICAgICAgICAgICAgQkxFTkRfU1VCVFJBQ1RJVkUsXG4gICAgICAgICAgICAgICAgQkxFTkRfQURESVRJVkUsXG4gICAgICAgICAgICAgICAgQkxFTkRfTk9STUFMLFxuICAgICAgICAgICAgICAgIEJMRU5EX05PTkUsXG4gICAgICAgICAgICAgICAgQkxFTkRfUFJFTVVMVElQTElFRCxcbiAgICAgICAgICAgICAgICBCTEVORF9NVUxUSVBMSUNBVElWRSxcbiAgICAgICAgICAgICAgICBCTEVORF9BRERJVElWRUFMUEhBLFxuICAgICAgICAgICAgICAgIEJMRU5EX01VTFRJUExJQ0FUSVZFMlgsXG4gICAgICAgICAgICAgICAgQkxFTkRfU0NSRUVOLFxuICAgICAgICAgICAgICAgIEJMRU5EX01JTixcbiAgICAgICAgICAgICAgICBCTEVORF9NQVhcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgZGVwdGhGdW5jOiB0aGlzLl9jcmVhdGVFbnVtVmFsaWRhdG9yKFtcbiAgICAgICAgICAgICAgICBGVU5DX05FVkVSLFxuICAgICAgICAgICAgICAgIEZVTkNfTEVTUyxcbiAgICAgICAgICAgICAgICBGVU5DX0VRVUFMLFxuICAgICAgICAgICAgICAgIEZVTkNfTEVTU0VRVUFMLFxuICAgICAgICAgICAgICAgIEZVTkNfR1JFQVRFUixcbiAgICAgICAgICAgICAgICBGVU5DX05PVEVRVUFMLFxuICAgICAgICAgICAgICAgIEZVTkNfR1JFQVRFUkVRVUFMLFxuICAgICAgICAgICAgICAgIEZVTkNfQUxXQVlTXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIHNoYWRpbmdNb2RlbDogdGhpcy5fY3JlYXRlRW51bVZhbGlkYXRvcihbXG4gICAgICAgICAgICAgICAgU1BFQ1VMQVJfUEhPTkcsXG4gICAgICAgICAgICAgICAgU1BFQ1VMQVJfQkxJTk5cbiAgICAgICAgICAgIF0pXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgc2V0SW52YWxpZChrZXksIGRhdGEpIHtcbiAgICAgICAgdGhpcy52YWxpZCA9IGZhbHNlO1xuXG4gICAgICAgIERlYnVnLndhcm4oYElnbm9yaW5nIGludmFsaWQgU3RhbmRhcmRNYXRlcmlhbCBwcm9wZXJ0eTogJHtrZXl9YCwgZGF0YVtrZXldKTtcblxuICAgICAgICBpZiAodGhpcy5yZW1vdmVJbnZhbGlkKSB7XG4gICAgICAgICAgICBkZWxldGUgZGF0YVtrZXldO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdmFsaWRhdGUoZGF0YSkge1xuICAgICAgICAvLyB2YWxpZGF0ZSBpbnB1dCBkYXRhIGFnYWluc3QgZGVmaW5lZCBzdGFuZGFyZC1tYXRlcmlhbCBwcm9wZXJ0aWVzIGFuZCB0eXBlc1xcXG4gICAgICAgIC8vIGlmIHJlbW92ZUludmFsaWQgZmxhZyBpcyBzZXQgdG8gdHJ1ZSB0aGVuIHJlbW92ZSBpbnZhbGlkIHByb3BlcnRpZXMgZnJvbSBkYXRhXG5cbiAgICAgICAgY29uc3QgVFlQRVMgPSBzdGFuZGFyZE1hdGVyaWFsUGFyYW1ldGVyVHlwZXM7XG4gICAgICAgIGNvbnN0IFJFTU9WRUQgPSBzdGFuZGFyZE1hdGVyaWFsUmVtb3ZlZFBhcmFtZXRlcnM7XG5cbiAgICAgICAgY29uc3QgcGF0aE1hcHBpbmcgPSAoZGF0YS5tYXBwaW5nRm9ybWF0ID09PSAncGF0aCcpO1xuXG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBUWVBFU1trZXldO1xuXG4gICAgICAgICAgICBpZiAoIXR5cGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoUkVNT1ZFRFtrZXldKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBkYXRhW2tleV07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgRGVidWcud2Fybk9uY2UoYElnbm9yaW5nIHVuc3VwcG9ydGVkIGlucHV0IHByb3BlcnR5IHRvIHN0YW5kYXJkIG1hdGVyaWFsOiAke2tleX1gKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHR5cGUuc3RhcnRzV2l0aCgnZW51bScpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZW51bVR5cGUgPSB0eXBlLnNwbGl0KCc6JylbMV07XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZW51bVZhbGlkYXRvcnNbZW51bVR5cGVdKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5lbnVtVmFsaWRhdG9yc1tlbnVtVHlwZV0oZGF0YVtrZXldKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRJbnZhbGlkKGtleSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGFba2V5XSAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRJbnZhbGlkKGtleSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGFba2V5XSAhPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0SW52YWxpZChrZXksIGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGFba2V5XSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRJbnZhbGlkKGtleSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAndmVjMicpIHtcbiAgICAgICAgICAgICAgICBpZiAoIShkYXRhW2tleV0gaW5zdGFuY2VvZiBBcnJheSAmJiBkYXRhW2tleV0ubGVuZ3RoID09PSAyKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEludmFsaWQoa2V5LCBkYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdyZ2InKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEoZGF0YVtrZXldIGluc3RhbmNlb2YgQXJyYXkgJiYgZGF0YVtrZXldLmxlbmd0aCA9PT0gMykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRJbnZhbGlkKGtleSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAndGV4dHVyZScpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXBhdGhNYXBwaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHR5cGVvZiBkYXRhW2tleV0gPT09ICdudW1iZXInIHx8IGRhdGFba2V5XSA9PT0gbnVsbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKGRhdGFba2V5XSBpbnN0YW5jZW9mIFRleHR1cmUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRJbnZhbGlkKGtleSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gT1RIRVJXSVNFOiBtYXRlcmlhbHMgYXJlIG9mdGVuIGluaXRpYWxpemVkIHdpdGggdGhlIGFzc2V0IGlkIG9mIHRleHR1cmVzIHdoaWNoIGFyZSBhc3NpZ25lZCBsYXRlclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGNvdW50cyBhcyBhIHZhbGlkIGlucHV0XG4gICAgICAgICAgICAgICAgICAgIC8vIG51bGwgdGV4dHVyZSByZWZlcmVuY2UgaXMgYWxzbyB2YWxpZFxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHR5cGVvZiBkYXRhW2tleV0gPT09ICdzdHJpbmcnIHx8IGRhdGFba2V5XSA9PT0gbnVsbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKGRhdGFba2V5XSBpbnN0YW5jZW9mIFRleHR1cmUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRJbnZhbGlkKGtleSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gT1RIRVJXSVNFOiBmcHIgcGF0aCBtYXBwZWQgd2UgZXhwZWN0IGEgc3RyaW5nIG5vdCBhbiBhc3NldCBpZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2JvdW5kaW5nYm94Jykge1xuICAgICAgICAgICAgICAgIGlmICghKGRhdGFba2V5XS5jZW50ZXIgJiYgZGF0YVtrZXldLmNlbnRlciBpbnN0YW5jZW9mIEFycmF5ICYmIGRhdGFba2V5XS5jZW50ZXIubGVuZ3RoID09PSAzKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEludmFsaWQoa2V5LCBkYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCEoZGF0YVtrZXldLmhhbGZFeHRlbnRzICYmIGRhdGFba2V5XS5oYWxmRXh0ZW50cyBpbnN0YW5jZW9mIEFycmF5ICYmIGRhdGFba2V5XS5oYWxmRXh0ZW50cy5sZW5ndGggPT09IDMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0SW52YWxpZChrZXksIGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2N1YmVtYXAnKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEodHlwZW9mIGRhdGFba2V5XSA9PT0gJ251bWJlcicgfHwgZGF0YVtrZXldID09PSBudWxsIHx8IGRhdGFba2V5XSA9PT0gdW5kZWZpbmVkKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghKGRhdGFba2V5XSBpbnN0YW5jZW9mIFRleHR1cmUgJiYgZGF0YVtrZXldLmN1YmVtYXApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEludmFsaWQoa2V5LCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBPVEhFUldJU0U6IG1hdGVyaWFscyBhcmUgb2Z0ZW4gaW5pdGlhbGl6ZWQgd2l0aCB0aGUgYXNzZXQgaWQgb2YgdGV4dHVyZXMgd2hpY2ggYXJlIGFzc2lnbmVkIGxhdGVyXG4gICAgICAgICAgICAgICAgLy8gdGhpcyBjb3VudHMgYXMgYSB2YWxpZCBpbnB1dFxuICAgICAgICAgICAgICAgIC8vIG51bGwgdGV4dHVyZSByZWZlcmVuY2UgaXMgYWxzbyB2YWxpZFxuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnY2h1bmtzJykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNodW5rTmFtZXMgPSBPYmplY3Qua2V5cyhkYXRhW2tleV0pO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2h1bmtOYW1lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGFba2V5XVtjaHVua05hbWVzW2ldXSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0SW52YWxpZChjaHVua05hbWVzW2ldLCBkYXRhW2tleV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Vua25vd24gbWF0ZXJpYWwgdHlwZTogJyArIHR5cGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gbWFyayBkYXRhIGFzIHZhbGlkYXRlZCBzbyB3ZSBkb24ndCB2YWxpZGF0ZSB0d2ljZVxuICAgICAgICBkYXRhLnZhbGlkYXRlZCA9IHRydWU7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMudmFsaWQ7XG4gICAgfVxuXG4gICAgX2NyZWF0ZUVudW1WYWxpZGF0b3IodmFsdWVzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiAodmFsdWVzLmluZGV4T2YodmFsdWUpID49IDApO1xuICAgICAgICB9O1xuICAgIH1cbn1cblxuZXhwb3J0IHsgU3RhbmRhcmRNYXRlcmlhbFZhbGlkYXRvciB9O1xuIl0sIm5hbWVzIjpbIlN0YW5kYXJkTWF0ZXJpYWxWYWxpZGF0b3IiLCJjb25zdHJ1Y3RvciIsInJlbW92ZUludmFsaWQiLCJ2YWxpZCIsImVudW1WYWxpZGF0b3JzIiwib2NjbHVkZVNwZWN1bGFyIiwiX2NyZWF0ZUVudW1WYWxpZGF0b3IiLCJTUEVDT0NDX05PTkUiLCJTUEVDT0NDX0FPIiwiU1BFQ09DQ19HTE9TU0RFUEVOREVOVCIsImN1bGwiLCJDVUxMRkFDRV9OT05FIiwiQ1VMTEZBQ0VfQkFDSyIsIkNVTExGQUNFX0ZST05UIiwiQ1VMTEZBQ0VfRlJPTlRBTkRCQUNLIiwiYmxlbmRUeXBlIiwiQkxFTkRfU1VCVFJBQ1RJVkUiLCJCTEVORF9BRERJVElWRSIsIkJMRU5EX05PUk1BTCIsIkJMRU5EX05PTkUiLCJCTEVORF9QUkVNVUxUSVBMSUVEIiwiQkxFTkRfTVVMVElQTElDQVRJVkUiLCJCTEVORF9BRERJVElWRUFMUEhBIiwiQkxFTkRfTVVMVElQTElDQVRJVkUyWCIsIkJMRU5EX1NDUkVFTiIsIkJMRU5EX01JTiIsIkJMRU5EX01BWCIsImRlcHRoRnVuYyIsIkZVTkNfTkVWRVIiLCJGVU5DX0xFU1MiLCJGVU5DX0VRVUFMIiwiRlVOQ19MRVNTRVFVQUwiLCJGVU5DX0dSRUFURVIiLCJGVU5DX05PVEVRVUFMIiwiRlVOQ19HUkVBVEVSRVFVQUwiLCJGVU5DX0FMV0FZUyIsInNoYWRpbmdNb2RlbCIsIlNQRUNVTEFSX1BIT05HIiwiU1BFQ1VMQVJfQkxJTk4iLCJzZXRJbnZhbGlkIiwia2V5IiwiZGF0YSIsIkRlYnVnIiwid2FybiIsInZhbGlkYXRlIiwiVFlQRVMiLCJzdGFuZGFyZE1hdGVyaWFsUGFyYW1ldGVyVHlwZXMiLCJSRU1PVkVEIiwic3RhbmRhcmRNYXRlcmlhbFJlbW92ZWRQYXJhbWV0ZXJzIiwicGF0aE1hcHBpbmciLCJtYXBwaW5nRm9ybWF0IiwidHlwZSIsIndhcm5PbmNlIiwic3RhcnRzV2l0aCIsImVudW1UeXBlIiwic3BsaXQiLCJBcnJheSIsImxlbmd0aCIsIlRleHR1cmUiLCJjZW50ZXIiLCJoYWxmRXh0ZW50cyIsInVuZGVmaW5lZCIsImN1YmVtYXAiLCJjaHVua05hbWVzIiwiT2JqZWN0Iiwia2V5cyIsImkiLCJjb25zb2xlIiwiZXJyb3IiLCJ2YWxpZGF0ZWQiLCJ2YWx1ZXMiLCJ2YWx1ZSIsImluZGV4T2YiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBa0JBLE1BQU1BLHlCQUF5QixDQUFDO0FBQzVCQyxFQUFBQSxXQUFXLEdBQUc7SUFDVixJQUFJLENBQUNDLGFBQWEsR0FBRyxJQUFJLENBQUE7QUFFekIsSUFBQSxJQUFJLENBQUNDLEtBQUssR0FBRyxJQUFJLENBQUM7O0lBRWxCLElBQUksQ0FBQ0MsY0FBYyxHQUFHO0FBQ2xCQyxNQUFBQSxlQUFlLEVBQUUsSUFBSSxDQUFDQyxvQkFBb0IsQ0FBQyxDQUN2Q0MsWUFBWSxFQUNaQyxVQUFVLEVBQ1ZDLHNCQUFzQixDQUN6QixDQUFDO0FBQ0ZDLE1BQUFBLElBQUksRUFBRSxJQUFJLENBQUNKLG9CQUFvQixDQUFDLENBQzVCSyxhQUFhLEVBQ2JDLGFBQWEsRUFDYkMsY0FBYyxFQUNkQyxxQkFBcUIsQ0FDeEIsQ0FBQztBQUNGQyxNQUFBQSxTQUFTLEVBQUUsSUFBSSxDQUFDVCxvQkFBb0IsQ0FBQyxDQUNqQ1UsaUJBQWlCLEVBQ2pCQyxjQUFjLEVBQ2RDLFlBQVksRUFDWkMsVUFBVSxFQUNWQyxtQkFBbUIsRUFDbkJDLG9CQUFvQixFQUNwQkMsbUJBQW1CLEVBQ25CQyxzQkFBc0IsRUFDdEJDLFlBQVksRUFDWkMsU0FBUyxFQUNUQyxTQUFTLENBQ1osQ0FBQztNQUNGQyxT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
