/**
 * @license
 * PlayCanvas Engine v1.62.0 revision 818511d2b (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../../../core/debug.js';
import { AnimTrack } from '../evaluator/anim-track.js';
import { AnimBlendTree1D } from './anim-blend-tree-1d.js';
import { AnimBlendTreeCartesian2D } from './anim-blend-tree-2d-cartesian.js';
import { AnimBlendTreeDirectional2D } from './anim-blend-tree-2d-directional.js';
import { AnimBlendTreeDirect } from './anim-blend-tree-direct.js';
import { AnimNode } from './anim-node.js';
import { ANIM_BLEND_DIRECT, ANIM_BLEND_2D_DIRECTIONAL, ANIM_BLEND_2D_CARTESIAN, ANIM_BLEND_1D, ANIM_CONTROL_STATES } from './constants.js';

/**
 * Defines a single state that the controller can be in. Each state contains either a single
 * AnimNode or a AnimBlendTree of multiple AnimNodes, which will be used to animate the Entity
 * while the state is active. An AnimState will stay active and play as long as there is no
 * AnimTransition with its conditions met that has that AnimState as its source state.
 *
 * @ignore
 */
class AnimState {
  /** @private */

  /** @private */

  /**
   * Create a new AnimState instance.
   *
   * @param {AnimController} controller - The controller this AnimState is associated with.
   * @param {string} name - The name of the state. Used to find this state when the controller
   * transitions between states and links animations.
   * @param {number} [speed] - The speed animations in the state should play at. Individual
   * {@link AnimNodes} can override this value.
   * @param {boolean} [loop] - Determines whether animations in this state should loop.
   * @param {object|null} [blendTree] - If supplied, the AnimState will recursively build a
   * {@link AnimBlendTree} hierarchy, used to store, blend and play multiple animations.
   */
  constructor(controller, name, speed = 1, loop = true, blendTree) {
    this._animations = {};
    this._animationList = [];
    this._controller = controller;
    this._name = name;
    this._speed = speed;
    this._loop = loop;
    this._hasAnimations = false;
    const findParameter = this._controller.findParameter.bind(this._controller);
    if (blendTree) {
      this._blendTree = this._createTree(blendTree.type, this, null, name, 1.0, blendTree.parameter ? [blendTree.parameter] : blendTree.parameters, blendTree.children, blendTree.syncAnimations, this._createTree, findParameter);
    } else {
      this._blendTree = new AnimNode(this, null, name, 1.0, speed);
    }
  }
  _createTree(type, state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter) {
    switch (type) {
      case ANIM_BLEND_1D:
        return new AnimBlendTree1D(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter);
      case ANIM_BLEND_2D_CARTESIAN:
        return new AnimBlendTreeCartesian2D(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter);
      case ANIM_BLEND_2D_DIRECTIONAL:
        return new AnimBlendTreeDirectional2D(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter);
      case ANIM_BLEND_DIRECT:
        return new AnimBlendTreeDirect(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter);
    }
    Debug.error(`Invalid anim blend type: ${type}`);
    return undefined;
  }
  _getNodeFromPath(path) {
    let currNode = this._blendTree;
    for (let i = 1; i < path.length; i++) {
      currNode = currNode.getChild(path[i]);
    }
    return currNode;
  }
  addAnimation(path, animTrack) {
    const pathString = path.join('.');
    const indexOfAnimation = this._animationList.findIndex(function (animation) {
      return animation.path === pathString;
    });
    if (indexOfAnimation >= 0) {
      this._animationList[indexOfAnimation].animTrack = animTrack;
    } else {
      const node = this._getNodeFromPath(path);
      node.animTrack = animTrack;
      this._animationList.push(node);
    }
    this._updateHasAnimations();
  }
  _updateHasAnimations() {
    this._hasAnimations = this._animationList.length > 0 && this._animationList.every(animation => animation.animTrack && animation.animTrack !== AnimTrack.EMPTY);
  }
  get name() {
    return this._name;
  }
  set animations(value) {
    this._animationList = value;
    this._updateHasAnimations();
  }
  get animations() {
    return this._animationList;
  }
  get hasAnimations() {
    return this._hasAnimations;
  }
  set speed(value) {
    this._speed = value;
  }
  get speed() {
    return this._speed;
  }
  set loop(value) {
    this._loop = value;
  }
  get loop() {
    return this._loop;
  }
  get nodeCount() {
    if (!this._blendTree || this._blendTree.constructor === AnimNode) return 1;
    return this._blendTree.getNodeCount();
  }
  get playable() {
    return ANIM_CONTROL_STATES.indexOf(this.name) !== -1 || this.animations.length === this.nodeCount;
  }
  get looping() {
    if (this.animations.length > 0) {
      const trackClipName = this.name + '.' + this.animations[0].animTrack.name;
      const trackClip = this._controller.animEvaluator.findClip(trackClipName);
      if (trackClip) {
        return trackClip.loop;
      }
    }
    return false;
  }
  get totalWeight() {
    let sum = 0;
    for (let i = 0; i < this.animations.length; i++) {
      sum += this.animations[i].weight;
    }
    return sum;
  }
  get timelineDuration() {
    let duration = 0;
    for (let i = 0; i < this.animations.length; i++) {
      const animation = this.animations[i];
      if (animation.animTrack.duration > duration) {
        duration = animation.animTrack.duration;
      }
    }
    return duration;
  }
}

export { AnimState };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5pbS1zdGF0ZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay9hbmltL2NvbnRyb2xsZXIvYW5pbS1zdGF0ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uLy4uLy4uL2NvcmUvZGVidWcuanMnO1xuaW1wb3J0IHsgQW5pbVRyYWNrIH0gZnJvbSAnLi4vZXZhbHVhdG9yL2FuaW0tdHJhY2suanMnO1xuXG5pbXBvcnQgeyBBbmltQmxlbmRUcmVlMUQgfSBmcm9tICcuL2FuaW0tYmxlbmQtdHJlZS0xZC5qcyc7XG5pbXBvcnQgeyBBbmltQmxlbmRUcmVlQ2FydGVzaWFuMkQgfSBmcm9tICcuL2FuaW0tYmxlbmQtdHJlZS0yZC1jYXJ0ZXNpYW4uanMnO1xuaW1wb3J0IHsgQW5pbUJsZW5kVHJlZURpcmVjdGlvbmFsMkQgfSBmcm9tICcuL2FuaW0tYmxlbmQtdHJlZS0yZC1kaXJlY3Rpb25hbC5qcyc7XG5pbXBvcnQgeyBBbmltQmxlbmRUcmVlRGlyZWN0IH0gZnJvbSAnLi9hbmltLWJsZW5kLXRyZWUtZGlyZWN0LmpzJztcbmltcG9ydCB7IEFuaW1Ob2RlIH0gZnJvbSAnLi9hbmltLW5vZGUuanMnO1xuaW1wb3J0IHtcbiAgICBBTklNX0JMRU5EXzFELCBBTklNX0JMRU5EXzJEX0NBUlRFU0lBTiwgQU5JTV9CTEVORF8yRF9ESVJFQ1RJT05BTCwgQU5JTV9CTEVORF9ESVJFQ1QsIEFOSU1fQ09OVFJPTF9TVEFURVNcbn0gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuXG4vKipcbiAqIERlZmluZXMgYSBzaW5nbGUgc3RhdGUgdGhhdCB0aGUgY29udHJvbGxlciBjYW4gYmUgaW4uIEVhY2ggc3RhdGUgY29udGFpbnMgZWl0aGVyIGEgc2luZ2xlXG4gKiBBbmltTm9kZSBvciBhIEFuaW1CbGVuZFRyZWUgb2YgbXVsdGlwbGUgQW5pbU5vZGVzLCB3aGljaCB3aWxsIGJlIHVzZWQgdG8gYW5pbWF0ZSB0aGUgRW50aXR5XG4gKiB3aGlsZSB0aGUgc3RhdGUgaXMgYWN0aXZlLiBBbiBBbmltU3RhdGUgd2lsbCBzdGF5IGFjdGl2ZSBhbmQgcGxheSBhcyBsb25nIGFzIHRoZXJlIGlzIG5vXG4gKiBBbmltVHJhbnNpdGlvbiB3aXRoIGl0cyBjb25kaXRpb25zIG1ldCB0aGF0IGhhcyB0aGF0IEFuaW1TdGF0ZSBhcyBpdHMgc291cmNlIHN0YXRlLlxuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgQW5pbVN0YXRlIHtcbiAgICAvKiogQHByaXZhdGUgKi9cbiAgICBfYW5pbWF0aW9ucyA9IHt9O1xuXG4gICAgLyoqIEBwcml2YXRlICovXG4gICAgX2FuaW1hdGlvbkxpc3QgPSBbXTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBBbmltU3RhdGUgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0FuaW1Db250cm9sbGVyfSBjb250cm9sbGVyIC0gVGhlIGNvbnRyb2xsZXIgdGhpcyBBbmltU3RhdGUgaXMgYXNzb2NpYXRlZCB3aXRoLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHN0YXRlLiBVc2VkIHRvIGZpbmQgdGhpcyBzdGF0ZSB3aGVuIHRoZSBjb250cm9sbGVyXG4gICAgICogdHJhbnNpdGlvbnMgYmV0d2VlbiBzdGF0ZXMgYW5kIGxpbmtzIGFuaW1hdGlvbnMuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtzcGVlZF0gLSBUaGUgc3BlZWQgYW5pbWF0aW9ucyBpbiB0aGUgc3RhdGUgc2hvdWxkIHBsYXkgYXQuIEluZGl2aWR1YWxcbiAgICAgKiB7QGxpbmsgQW5pbU5vZGVzfSBjYW4gb3ZlcnJpZGUgdGhpcyB2YWx1ZS5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtsb29wXSAtIERldGVybWluZXMgd2hldGhlciBhbmltYXRpb25zIGluIHRoaXMgc3RhdGUgc2hvdWxkIGxvb3AuXG4gICAgICogQHBhcmFtIHtvYmplY3R8bnVsbH0gW2JsZW5kVHJlZV0gLSBJZiBzdXBwbGllZCwgdGhlIEFuaW1TdGF0ZSB3aWxsIHJlY3Vyc2l2ZWx5IGJ1aWxkIGFcbiAgICAgKiB7QGxpbmsgQW5pbUJsZW5kVHJlZX0gaGllcmFyY2h5LCB1c2VkIHRvIHN0b3JlLCBibGVuZCBhbmQgcGxheSBtdWx0aXBsZSBhbmltYXRpb25zLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGNvbnRyb2xsZXIsIG5hbWUsIHNwZWVkID0gMSwgbG9vcCA9IHRydWUsIGJsZW5kVHJlZSkge1xuICAgICAgICB0aGlzLl9jb250cm9sbGVyID0gY29udHJvbGxlcjtcbiAgICAgICAgdGhpcy5fbmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuX3NwZWVkID0gc3BlZWQ7XG4gICAgICAgIHRoaXMuX2xvb3AgPSBsb29wO1xuICAgICAgICB0aGlzLl9oYXNBbmltYXRpb25zID0gZmFsc2U7XG4gICAgICAgIGNvbnN0IGZpbmRQYXJhbWV0ZXIgPSB0aGlzLl9jb250cm9sbGVyLmZpbmRQYXJhbWV0ZXIuYmluZCh0aGlzLl9jb250cm9sbGVyKTtcbiAgICAgICAgaWYgKGJsZW5kVHJlZSkge1xuICAgICAgICAgICAgdGhpcy5fYmxlbmRUcmVlID0gdGhpcy5fY3JlYXRlVHJlZShcbiAgICAgICAgICAgICAgICBibGVuZFRyZWUudHlwZSxcbiAgICAgICAgICAgICAgICB0aGlzLFxuICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAxLjAsXG4gICAgICAgICAgICAgICAgYmxlbmRUcmVlLnBhcmFtZXRlciA/IFtibGVuZFRyZWUucGFyYW1ldGVyXSA6IGJsZW5kVHJlZS5wYXJhbWV0ZXJzLFxuICAgICAgICAgICAgICAgIGJsZW5kVHJlZS5jaGlsZHJlbixcbiAgICAgICAgICAgICAgICBibGVuZFRyZWUuc3luY0FuaW1hdGlvbnMsXG4gICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlVHJlZSxcbiAgICAgICAgICAgICAgICBmaW5kUGFyYW1ldGVyXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fYmxlbmRUcmVlID0gbmV3IEFuaW1Ob2RlKHRoaXMsIG51bGwsIG5hbWUsIDEuMCwgc3BlZWQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2NyZWF0ZVRyZWUodHlwZSwgc3RhdGUsIHBhcmVudCwgbmFtZSwgcG9pbnQsIHBhcmFtZXRlcnMsIGNoaWxkcmVuLCBzeW5jQW5pbWF0aW9ucywgY3JlYXRlVHJlZSwgZmluZFBhcmFtZXRlcikge1xuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgQU5JTV9CTEVORF8xRDpcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEFuaW1CbGVuZFRyZWUxRChzdGF0ZSwgcGFyZW50LCBuYW1lLCBwb2ludCwgcGFyYW1ldGVycywgY2hpbGRyZW4sIHN5bmNBbmltYXRpb25zLCBjcmVhdGVUcmVlLCBmaW5kUGFyYW1ldGVyKTtcbiAgICAgICAgICAgIGNhc2UgQU5JTV9CTEVORF8yRF9DQVJURVNJQU46XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBBbmltQmxlbmRUcmVlQ2FydGVzaWFuMkQoc3RhdGUsIHBhcmVudCwgbmFtZSwgcG9pbnQsIHBhcmFtZXRlcnMsIGNoaWxkcmVuLCBzeW5jQW5pbWF0aW9ucywgY3JlYXRlVHJlZSwgZmluZFBhcmFtZXRlcik7XG4gICAgICAgICAgICBjYXNlIEFOSU1fQkxFTkRfMkRfRElSRUNUSU9OQUw6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBBbmltQmxlbmRUcmVlRGlyZWN0aW9uYWwyRChzdGF0ZSwgcGFyZW50LCBuYW1lLCBwb2ludCwgcGFyYW1ldGVycywgY2hpbGRyZW4sIHN5bmNBbmltYXRpb25zLCBjcmVhdGVUcmVlLCBmaW5kUGFyYW1ldGVyKTtcbiAgICAgICAgICAgIGNhc2UgQU5JTV9CTEVORF9ESVJFQ1Q6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBBbmltQmxlbmRUcmVlRGlyZWN0KHN0YXRlLCBwYXJlbnQsIG5hbWUsIHBvaW50LCBwYXJhbWV0ZXJzLCBjaGlsZHJlbiwgc3luY0FuaW1hdGlvbnMsIGNyZWF0ZVRyZWUsIGZpbmRQYXJhbWV0ZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgRGVidWcuZXJyb3IoYEludmFsaWQgYW5pbSBibGVuZCB0eXBlOiAke3R5cGV9YCk7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgX2dldE5vZGVGcm9tUGF0aChwYXRoKSB7XG4gICAgICAgIGxldCBjdXJyTm9kZSA9IHRoaXMuX2JsZW5kVHJlZTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjdXJyTm9kZSA9IGN1cnJOb2RlLmdldENoaWxkKHBhdGhbaV0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjdXJyTm9kZTtcbiAgICB9XG5cbiAgICBhZGRBbmltYXRpb24ocGF0aCwgYW5pbVRyYWNrKSB7XG4gICAgICAgIGNvbnN0IHBhdGhTdHJpbmcgPSBwYXRoLmpvaW4oJy4nKTtcbiAgICAgICAgY29uc3QgaW5kZXhPZkFuaW1hdGlvbiA9IHRoaXMuX2FuaW1hdGlvbkxpc3QuZmluZEluZGV4KGZ1bmN0aW9uIChhbmltYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBhbmltYXRpb24ucGF0aCA9PT0gcGF0aFN0cmluZztcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChpbmRleE9mQW5pbWF0aW9uID49IDApIHtcbiAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbkxpc3RbaW5kZXhPZkFuaW1hdGlvbl0uYW5pbVRyYWNrID0gYW5pbVRyYWNrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMuX2dldE5vZGVGcm9tUGF0aChwYXRoKTtcbiAgICAgICAgICAgIG5vZGUuYW5pbVRyYWNrID0gYW5pbVRyYWNrO1xuICAgICAgICAgICAgdGhpcy5fYW5pbWF0aW9uTGlzdC5wdXNoKG5vZGUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3VwZGF0ZUhhc0FuaW1hdGlvbnMoKTtcbiAgICB9XG5cbiAgICBfdXBkYXRlSGFzQW5pbWF0aW9ucygpIHtcbiAgICAgICAgdGhpcy5faGFzQW5pbWF0aW9ucyA9IHRoaXMuX2FuaW1hdGlvbkxpc3QubGVuZ3RoID4gMCAmJiB0aGlzLl9hbmltYXRpb25MaXN0LmV2ZXJ5KGFuaW1hdGlvbiA9PiBhbmltYXRpb24uYW5pbVRyYWNrICYmIGFuaW1hdGlvbi5hbmltVHJhY2sgIT09IEFuaW1UcmFjay5FTVBUWSk7XG4gICAgfVxuXG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9uYW1lO1xuICAgIH1cblxuICAgIHNldCBhbmltYXRpb25zKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX2FuaW1hdGlvbkxpc3QgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5fdXBkYXRlSGFzQW5pbWF0aW9ucygpO1xuICAgIH1cblxuICAgIGdldCBhbmltYXRpb25zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYW5pbWF0aW9uTGlzdDtcbiAgICB9XG5cbiAgICBnZXQgaGFzQW5pbWF0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hhc0FuaW1hdGlvbnM7XG4gICAgfVxuXG4gICAgc2V0IHNwZWVkKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3NwZWVkID0gdmFsdWU7XG4gICAgfVxuXG4gICAgZ2V0IHNwZWVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3BlZWQ7XG4gICAgfVxuXG4gICAgc2V0IGxvb3AodmFsdWUpIHtcbiAgICAgICAgdGhpcy5fbG9vcCA9IHZhbHVlO1xuICAgIH1cblxuICAgIGdldCBsb29wKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbG9vcDtcbiAgICB9XG5cbiAgICBnZXQgbm9kZUNvdW50KCkge1xuICAgICAgICBpZiAoIXRoaXMuX2JsZW5kVHJlZSB8fCAodGhpcy5fYmxlbmRUcmVlLmNvbnN0cnVjdG9yID09PSBBbmltTm9kZSkpIHJldHVybiAxO1xuICAgICAgICByZXR1cm4gdGhpcy5fYmxlbmRUcmVlLmdldE5vZGVDb3VudCgpO1xuICAgIH1cblxuICAgIGdldCBwbGF5YWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIChBTklNX0NPTlRST0xfU1RBVEVTLmluZGV4T2YodGhpcy5uYW1lKSAhPT0gLTEgfHwgdGhpcy5hbmltYXRpb25zLmxlbmd0aCA9PT0gdGhpcy5ub2RlQ291bnQpO1xuICAgIH1cblxuICAgIGdldCBsb29waW5nKCkge1xuICAgICAgICBpZiAodGhpcy5hbmltYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHRyYWNrQ2xpcE5hbWUgPSB0aGlzLm5hbWUgKyAnLicgKyB0aGlzLmFuaW1hdGlvbnNbMF0uYW5pbVRyYWNrLm5hbWU7XG4gICAgICAgICAgICBjb25zdCB0cmFja0NsaXAgPSB0aGlzLl9jb250cm9sbGVyLmFuaW1FdmFsdWF0b3IuZmluZENsaXAodHJhY2tDbGlwTmFtZSk7XG4gICAgICAgICAgICBpZiAodHJhY2tDbGlwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYWNrQ2xpcC5sb29wO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBnZXQgdG90YWxXZWlnaHQoKSB7XG4gICAgICAgIGxldCBzdW0gPSAwO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYW5pbWF0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgc3VtICs9IHRoaXMuYW5pbWF0aW9uc1tpXS53ZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1bTtcbiAgICB9XG5cbiAgICBnZXQgdGltZWxpbmVEdXJhdGlvbigpIHtcbiAgICAgICAgbGV0IGR1cmF0aW9uID0gMDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmFuaW1hdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGFuaW1hdGlvbiA9IHRoaXMuYW5pbWF0aW9uc1tpXTtcbiAgICAgICAgICAgIGlmIChhbmltYXRpb24uYW5pbVRyYWNrLmR1cmF0aW9uID4gZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IGFuaW1hdGlvbi5hbmltVHJhY2suZHVyYXRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGR1cmF0aW9uO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgQW5pbVN0YXRlIH07XG4iXSwibmFtZXMiOlsiQW5pbVN0YXRlIiwiY29uc3RydWN0b3IiLCJjb250cm9sbGVyIiwibmFtZSIsInNwZWVkIiwibG9vcCIsImJsZW5kVHJlZSIsIl9hbmltYXRpb25zIiwiX2FuaW1hdGlvbkxpc3QiLCJfY29udHJvbGxlciIsIl9uYW1lIiwiX3NwZWVkIiwiX2xvb3AiLCJfaGFzQW5pbWF0aW9ucyIsImZpbmRQYXJhbWV0ZXIiLCJiaW5kIiwiX2JsZW5kVHJlZSIsIl9jcmVhdGVUcmVlIiwidHlwZSIsInBhcmFtZXRlciIsInBhcmFtZXRlcnMiLCJjaGlsZHJlbiIsInN5bmNBbmltYXRpb25zIiwiQW5pbU5vZGUiLCJzdGF0ZSIsInBhcmVudCIsInBvaW50IiwiY3JlYXRlVHJlZSIsIkFOSU1fQkxFTkRfMUQiLCJBbmltQmxlbmRUcmVlMUQiLCJBTklNX0JMRU5EXzJEX0NBUlRFU0lBTiIsIkFuaW1CbGVuZFRyZWVDYXJ0ZXNpYW4yRCIsIkFOSU1fQkxFTkRfMkRfRElSRUNUSU9OQUwiLCJBbmltQmxlbmRUcmVlRGlyZWN0aW9uYWwyRCIsIkFOSU1fQkxFTkRfRElSRUNUIiwiQW5pbUJsZW5kVHJlZURpcmVjdCIsIkRlYnVnIiwiZXJyb3IiLCJ1bmRlZmluZWQiLCJfZ2V0Tm9kZUZyb21QYXRoIiwicGF0aCIsImN1cnJOb2RlIiwiaSIsImxlbmd0aCIsImdldENoaWxkIiwiYWRkQW5pbWF0aW9uIiwiYW5pbVRyYWNrIiwicGF0aFN0cmluZyIsImpvaW4iLCJpbmRleE9mQW5pbWF0aW9uIiwiZmluZEluZGV4IiwiYW5pbWF0aW9uIiwibm9kZSIsInB1c2giLCJfdXBkYXRlSGFzQW5pbWF0aW9ucyIsImV2ZXJ5IiwiQW5pbVRyYWNrIiwiRU1QVFkiLCJhbmltYXRpb25zIiwidmFsdWUiLCJoYXNBbmltYXRpb25zIiwibm9kZUNvdW50IiwiZ2V0Tm9kZUNvdW50IiwicGxheWFibGUiLCJBTklNX0NPTlRST0xfU1RBVEVTIiwiaW5kZXhPZiIsImxvb3BpbmciLCJ0cmFja0NsaXBOYW1lIiwidHJhY2tDbGlwIiwiYW5pbUV2YWx1YXRvciIsImZpbmRDbGlwIiwidG90YWxXZWlnaHQiLCJzdW0iLCJ3ZWlnaHQiLCJ0aW1lbGluZUR1cmF0aW9uIiwiZHVyYXRpb24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1BLFNBQVMsQ0FBQztBQUNaOztBQUdBOztBQUdBO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNJQyxFQUFBQSxXQUFXLENBQUNDLFVBQVUsRUFBRUMsSUFBSSxFQUFFQyxLQUFLLEdBQUcsQ0FBQyxFQUFFQyxJQUFJLEdBQUcsSUFBSSxFQUFFQyxTQUFTLEVBQUU7SUFBQSxJQWpCakVDLENBQUFBLFdBQVcsR0FBRyxFQUFFLENBQUE7SUFBQSxJQUdoQkMsQ0FBQUEsY0FBYyxHQUFHLEVBQUUsQ0FBQTtJQWVmLElBQUksQ0FBQ0MsV0FBVyxHQUFHUCxVQUFVLENBQUE7SUFDN0IsSUFBSSxDQUFDUSxLQUFLLEdBQUdQLElBQUksQ0FBQTtJQUNqQixJQUFJLENBQUNRLE1BQU0sR0FBR1AsS0FBSyxDQUFBO0lBQ25CLElBQUksQ0FBQ1EsS0FBSyxHQUFHUCxJQUFJLENBQUE7SUFDakIsSUFB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
