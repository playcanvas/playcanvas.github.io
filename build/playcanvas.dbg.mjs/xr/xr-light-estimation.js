/**
 * @license
 * PlayCanvas Engine v1.57.1 revision 256dd83c2 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { EventHandler } from '../core/event-handler.js';
import { Color } from '../math/color.js';
import { Mat4 } from '../math/mat4.js';
import { Quat } from '../math/quat.js';
import { Vec3 } from '../math/vec3.js';
import { XRTYPE_AR } from './constants.js';

const vec3A = new Vec3();
const vec3B = new Vec3();
const mat4A = new Mat4();
const mat4B = new Mat4();

class XrLightEstimation extends EventHandler {
  constructor(manager) {
    super();
    this._manager = void 0;
    this._supported = false;
    this._available = false;
    this._lightProbeRequested = false;
    this._lightProbe = null;
    this._intensity = 0;
    this._rotation = new Quat();
    this._color = new Color();
    this._sphericalHarmonics = new Float32Array(27);
    this._manager = manager;

    this._manager.on('start', this._onSessionStart, this);

    this._manager.on('end', this._onSessionEnd, this);
  }

  _onSessionStart() {
    const supported = !!this._manager.session.requestLightProbe;
    if (!supported) return;
    this._supported = true;
  }

  _onSessionEnd() {
    this._supported = false;
    this._available = false;
    this._lightProbeRequested = false;
    this._lightProbe = null;
  }

  start() {
    let err;
    if (!this._manager.session) err = new Error('XR session is not running');
    if (!err && this._manager.type !== XRTYPE_AR) err = new Error('XR session type is not AR');
    if (!err && !this._supported) err = new Error('light-estimation is not supported');
    if (!err && this._lightProbe || this._lightProbeRequested) err = new Error('light estimation is already requested');

    if (err) {
      this.fire('error', err);
      return;
    }

    this._lightProbeRequested = true;

    this._manager.session.requestLightProbe().then(lightProbe => {
      const wasRequested = this._lightProbeRequested;
      this._lightProbeRequested = false;

      if (this._manager.active) {
        if (wasRequested) {
          this._lightProbe = lightProbe;
        }
      } else {
        this.fire('error', new Error('XR session is not active'));
      }
    }).catch(ex => {
      this._lightProbeRequested = false;
      this.fire('error', ex);
    });
  }

  end() {
    this._lightProbeRequested = false;
    this._lightProbe = null;
    this._available = false;
  }

  update(frame) {
    if (!this._lightProbe) return;
    const lightEstimate = frame.getLightEstimate(this._lightProbe);
    if (!lightEstimate) return;

    if (!this._available) {
      this._available = true;
      this.fire('available');
    }

    const pli = lightEstimate.primaryLightIntensity;
    this._intensity = Math.max(1.0, Math.max(pli.x, Math.max(pli.y, pli.z)));
    vec3A.copy(pli).mulScalar(1 / this._intensity);

    this._color.set(vec3A.x, vec3A.y, vec3A.z);

    vec3A.set(0, 0, 0);
    vec3B.copy(lightEstimate.primaryLightDirection);
    mat4A.setLookAt(vec3B, vec3A, Vec3.UP);
    mat4B.setFromAxisAngle(Vec3.RIGHT, 90);
    mat4A.mul(mat4B);

    this._rotation.setFromMat4(mat4A);

    this._sphericalHarmonics.set(lightEstimate.sphericalHarmonicsCoefficients);
  }

  get supported() {
    return this._supported;
  }

  get available() {
    return this._available;
  }

  get intensity() {
    return this._available ? this._intensity : null;
  }

  get color() {
    return this._available ? this._color : null;
  }

  get rotation() {
    return this._available ? this._rotation : null;
  }

  get sphericalHarmonics() {
    return this._available ? this._sphericalHarmonics : null;
  }

}

export { XrLightEstimation };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieHItbGlnaHQtZXN0aW1hdGlvbi5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3hyL3hyLWxpZ2h0LWVzdGltYXRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRIYW5kbGVyIH0gZnJvbSAnLi4vY29yZS9ldmVudC1oYW5kbGVyLmpzJztcblxuaW1wb3J0IHsgQ29sb3IgfSBmcm9tICcuLi9tYXRoL2NvbG9yLmpzJztcbmltcG9ydCB7IE1hdDQgfSBmcm9tICcuLi9tYXRoL21hdDQuanMnO1xuaW1wb3J0IHsgUXVhdCB9IGZyb20gJy4uL21hdGgvcXVhdC5qcyc7XG5pbXBvcnQgeyBWZWMzIH0gZnJvbSAnLi4vbWF0aC92ZWMzLmpzJztcblxuaW1wb3J0IHsgWFJUWVBFX0FSIH0gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi94ci1tYW5hZ2VyLmpzJykuWHJNYW5hZ2VyfSBYck1hbmFnZXIgKi9cblxuY29uc3QgdmVjM0EgPSBuZXcgVmVjMygpO1xuY29uc3QgdmVjM0IgPSBuZXcgVmVjMygpO1xuY29uc3QgbWF0NEEgPSBuZXcgTWF0NCgpO1xuY29uc3QgbWF0NEIgPSBuZXcgTWF0NCgpO1xuXG4vKipcbiAqIExpZ2h0IEVzdGltYXRpb24gcHJvdmlkZXMgaWxsdW1pbmF0aW9uIGRhdGEgZnJvbSB0aGUgcmVhbCB3b3JsZCwgd2hpY2ggaXMgZXN0aW1hdGVkIGJ5IHRoZVxuICogdW5kZXJseWluZyBBUiBzeXN0ZW0uIEl0IHByb3ZpZGVzIGEgcmVmbGVjdGlvbiBDdWJlIE1hcCwgdGhhdCByZXByZXNlbnRzIHRoZSByZWZsZWN0aW9uXG4gKiBlc3RpbWF0aW9uIGZyb20gdGhlIHZpZXdlciBwb3NpdGlvbi4gQSBtb3JlIHNpbXBsaWZpZWQgYXBwcm94aW1hdGlvbiBvZiBsaWdodCBpcyBwcm92aWRlZCBieSBMMlxuICogU3BoZXJpY2FsIEhhcm1vbmljcyBkYXRhLiBBbmQgdGhlIG1vc3Qgc2ltcGxlIGxldmVsIG9mIGxpZ2h0IGVzdGltYXRpb24gaXMgdGhlIG1vc3QgcHJvbWluZW50XG4gKiBkaXJlY3Rpb25hbCBsaWdodCwgaXRzIHJvdGF0aW9uLCBpbnRlbnNpdHkgYW5kIGNvbG9yLlxuICpcbiAqIEBhdWdtZW50cyBFdmVudEhhbmRsZXJcbiAqL1xuY2xhc3MgWHJMaWdodEVzdGltYXRpb24gZXh0ZW5kcyBFdmVudEhhbmRsZXIge1xuICAgIC8qKlxuICAgICAqIEB0eXBlIHtYck1hbmFnZXJ9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfbWFuYWdlcjtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3N1cHBvcnRlZCA9IGZhbHNlO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfYXZhaWxhYmxlID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9saWdodFByb2JlUmVxdWVzdGVkID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7WFJMaWdodFByb2JlfG51bGx9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfbGlnaHRQcm9iZSA9IG51bGw7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2ludGVuc2l0eSA9IDA7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7UXVhdH1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9yb3RhdGlvbiA9IG5ldyBRdWF0KCk7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7Q29sb3J9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfY29sb3IgPSBuZXcgQ29sb3IoKTtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtGbG9hdDMyQXJyYXl9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc3BoZXJpY2FsSGFybW9uaWNzID0gbmV3IEZsb2F0MzJBcnJheSgyNyk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgWHJMaWdodEVzdGltYXRpb24gaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1hyTWFuYWdlcn0gbWFuYWdlciAtIFdlYlhSIE1hbmFnZXIuXG4gICAgICogQGhpZGVjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKG1hbmFnZXIpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLl9tYW5hZ2VyID0gbWFuYWdlcjtcblxuICAgICAgICB0aGlzLl9tYW5hZ2VyLm9uKCdzdGFydCcsIHRoaXMuX29uU2Vzc2lvblN0YXJ0LCB0aGlzKTtcbiAgICAgICAgdGhpcy5fbWFuYWdlci5vbignZW5kJywgdGhpcy5fb25TZXNzaW9uRW5kLCB0aGlzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIGxpZ2h0IGVzdGltYXRpb24gZGF0YSBiZWNvbWVzIGF2YWlsYWJsZS5cbiAgICAgKlxuICAgICAqIEBldmVudCBYckxpZ2h0RXN0aW1hdGlvbiNhdmFpbGFibGVcbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gbGlnaHQgZXN0aW1hdGlvbiBoYXMgZmFpbGVkIHRvIHN0YXJ0LlxuICAgICAqXG4gICAgICogQGV2ZW50IFhyTGlnaHRFc3RpbWF0aW9uI2Vycm9yXG4gICAgICogQHBhcmFtIHtFcnJvcn0gZXJyb3IgLSBFcnJvciBvYmplY3QgcmVsYXRlZCB0byBmYWlsdXJlIG9mIGxpZ2h0IGVzdGltYXRpb24gc3RhcnQuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBhcHAueHIubGlnaHRFc3RpbWF0aW9uLm9uKCdlcnJvcicsIGZ1bmN0aW9uIChleCkge1xuICAgICAqICAgICAvLyBoYXMgZmFpbGVkIHRvIHN0YXJ0XG4gICAgICogfSk7XG4gICAgICovXG5cbiAgICAvKiogQHByaXZhdGUgKi9cbiAgICBfb25TZXNzaW9uU3RhcnQoKSB7XG4gICAgICAgIGNvbnN0IHN1cHBvcnRlZCA9ICEhdGhpcy5fbWFuYWdlci5zZXNzaW9uLnJlcXVlc3RMaWdodFByb2JlO1xuICAgICAgICBpZiAoIXN1cHBvcnRlZCkgcmV0dXJuO1xuICAgICAgICB0aGlzLl9zdXBwb3J0ZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIC8qKiBAcHJpdmF0ZSAqL1xuICAgIF9vblNlc3Npb25FbmQoKSB7XG4gICAgICAgIHRoaXMuX3N1cHBvcnRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9hdmFpbGFibGUgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLl9saWdodFByb2JlUmVxdWVzdGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2xpZ2h0UHJvYmUgPSBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFN0YXJ0IGVzdGltYXRpb24gb2YgaWxsdW1pbmF0aW9uIGRhdGEuIEF2YWlsYWJpbGl0eSBvZiBzdWNoIGRhdGEgd2lsbCBjb21lIGxhdGVyIGFuZCBhblxuICAgICAqIGBhdmFpbGFibGVgIGV2ZW50IHdpbGwgYmUgZmlyZWQuIElmIGl0IGZhaWxlZCB0byBzdGFydCBlc3RpbWF0aW9uLCBhbiBgZXJyb3JgIGV2ZW50IHdpbGwgYmVcbiAgICAgKiBmaXJlZC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYXBwLnhyLm9uKCdzdGFydCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgKiAgICAgaWYgKGFwcC54ci5saWdodEVzdGltYXRpb24uc3VwcG9ydGVkKSB7XG4gICAgICogICAgICAgICBhcHAueHIubGlnaHRFc3RpbWF0aW9uLnN0YXJ0KCk7XG4gICAgICogICAgIH1cbiAgICAgKiB9KTtcbiAgICAgKi9cbiAgICBzdGFydCgpIHtcbiAgICAgICAgbGV0IGVycjtcblxuICAgICAgICBpZiAoIXRoaXMuX21hbmFnZXIuc2Vzc2lvbilcbiAgICAgICAgICAgIGVyciA9IG5ldyBFcnJvcignWFIgc2Vzc2lvbiBpcyBub3QgcnVubmluZycpO1xuXG4gICAgICAgIGlmICghZXJyICYmIHRoaXMuX21hbmFnZXIudHlwZSAhPT0gWFJUWVBFX0FSKVxuICAgICAgICAgICAgZXJyID0gbmV3IEVycm9yKCdYUiBzZXNzaW9uIHR5cGUgaXMgbm90IEFSJyk7XG5cbiAgICAgICAgaWYgKCFlcnIgJiYgIXRoaXMuX3N1cHBvcnRlZClcbiAgICAgICAgICAgIGVyciA9IG5ldyBFcnJvcignbGlnaHQtZXN0aW1hdGlvbiBpcyBub3Qgc3VwcG9ydGVkJyk7XG5cbiAgICAgICAgaWYgKCFlcnIgJiYgdGhpcy5fbGlnaHRQcm9iZSB8fCB0aGlzLl9saWdodFByb2JlUmVxdWVzdGVkKVxuICAgICAgICAgICAgZXJyID0gbmV3IEVycm9yKCdsaWdodCBlc3RpbWF0aW9uIGlzIGFscmVhZHkgcmVxdWVzdGVkJyk7XG5cbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgdGhpcy5maXJlKCdlcnJvcicsIGVycik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9saWdodFByb2JlUmVxdWVzdGVkID0gdHJ1ZTtcblxuICAgICAgICB0aGlzLl9tYW5hZ2VyLnNlc3Npb24ucmVxdWVzdExpZ2h0UHJvYmUoXG4gICAgICAgICkudGhlbigobGlnaHRQcm9iZSkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgd2FzUmVxdWVzdGVkID0gdGhpcy5fbGlnaHRQcm9iZVJlcXVlc3RlZDtcbiAgICAgICAgICAgIHRoaXMuX2xpZ2h0UHJvYmVSZXF1ZXN0ZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuX21hbmFnZXIuYWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdhc1JlcXVlc3RlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9saWdodFByb2JlID0gbGlnaHRQcm9iZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyZSgnZXJyb3InLCBuZXcgRXJyb3IoJ1hSIHNlc3Npb24gaXMgbm90IGFjdGl2ZScpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkuY2F0Y2goKGV4KSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9saWdodFByb2JlUmVxdWVzdGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ2Vycm9yJywgZXgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFbmQgZXN0aW1hdGlvbiBvZiBpbGx1bWluYXRpb24gZGF0YS5cbiAgICAgKi9cbiAgICBlbmQoKSB7XG4gICAgICAgIHRoaXMuX2xpZ2h0UHJvYmVSZXF1ZXN0ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fbGlnaHRQcm9iZSA9IG51bGw7XG4gICAgICAgIHRoaXMuX2F2YWlsYWJsZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7Kn0gZnJhbWUgLSBYUkZyYW1lIGZyb20gcmVxdWVzdEFuaW1hdGlvbkZyYW1lIGNhbGxiYWNrLlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICB1cGRhdGUoZnJhbWUpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9saWdodFByb2JlKSByZXR1cm47XG5cbiAgICAgICAgY29uc3QgbGlnaHRFc3RpbWF0ZSA9IGZyYW1lLmdldExpZ2h0RXN0aW1hdGUodGhpcy5fbGlnaHRQcm9iZSk7XG4gICAgICAgIGlmICghbGlnaHRFc3RpbWF0ZSkgcmV0dXJuO1xuXG4gICAgICAgIGlmICghdGhpcy5fYXZhaWxhYmxlKSB7XG4gICAgICAgICAgICB0aGlzLl9hdmFpbGFibGUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5maXJlKCdhdmFpbGFibGUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGludGVuc2l0eVxuICAgICAgICBjb25zdCBwbGkgPSBsaWdodEVzdGltYXRlLnByaW1hcnlMaWdodEludGVuc2l0eTtcbiAgICAgICAgdGhpcy5faW50ZW5zaXR5ID0gTWF0aC5tYXgoMS4wLCBNYXRoLm1heChwbGkueCwgTWF0aC5tYXgocGxpLnksIHBsaS56KSkpO1xuXG4gICAgICAgIC8vIGNvbG9yXG4gICAgICAgIHZlYzNBLmNvcHkocGxpKS5tdWxTY2FsYXIoMSAvIHRoaXMuX2ludGVuc2l0eSk7XG4gICAgICAgIHRoaXMuX2NvbG9yLnNldCh2ZWMzQS54LCB2ZWMzQS55LCB2ZWMzQS56KTtcblxuICAgICAgICAvLyByb3RhdGlvblxuICAgICAgICB2ZWMzQS5zZXQoMCwgMCwgMCk7XG4gICAgICAgIHZlYzNCLmNvcHkobGlnaHRFc3RpbWF0ZS5wcmltYXJ5TGlnaHREaXJlY3Rpb24pO1xuICAgICAgICBtYXQ0QS5zZXRMb29rQXQodmVjM0IsIHZlYzNBLCBWZWMzLlVQKTtcbiAgICAgICAgbWF0NEIuc2V0RnJvbUF4aXNBbmdsZShWZWMzLlJJR0hULCA5MCk7IC8vIGRpcmVjdGlvbmFsIGxpZ2h0IGlzIGxvb2tpbmcgZG93blxuICAgICAgICBtYXQ0QS5tdWwobWF0NEIpO1xuICAgICAgICB0aGlzLl9yb3RhdGlvbi5zZXRGcm9tTWF0NChtYXQ0QSk7XG5cbiAgICAgICAgLy8gc3BoZXJpY2FsIGhhcm1vbmljc1xuICAgICAgICB0aGlzLl9zcGhlcmljYWxIYXJtb25pY3Muc2V0KGxpZ2h0RXN0aW1hdGUuc3BoZXJpY2FsSGFybW9uaWNzQ29lZmZpY2llbnRzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcnVlIGlmIExpZ2h0IEVzdGltYXRpb24gaXMgc3VwcG9ydGVkLiBUaGlzIGluZm9ybWF0aW9uIGlzIGF2YWlsYWJsZSBvbmx5IGR1cmluZyBhbiBhY3RpdmUgQVJcbiAgICAgKiBzZXNzaW9uLlxuICAgICAqXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICovXG4gICAgZ2V0IHN1cHBvcnRlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N1cHBvcnRlZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcnVlIGlmIGVzdGltYXRlZCBsaWdodCBpbmZvcm1hdGlvbiBpcyBhdmFpbGFibGUuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGlmIChhcHAueHIubGlnaHRFc3RpbWF0aW9uLmF2YWlsYWJsZSkge1xuICAgICAqICAgICBlbnRpdHkubGlnaHQuaW50ZW5zaXR5ID0gYXBwLnhyLmxpZ2h0RXN0aW1hdGlvbi5pbnRlbnNpdHk7XG4gICAgICogfVxuICAgICAqL1xuICAgIGdldCBhdmFpbGFibGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9hdmFpbGFibGU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW50ZW5zaXR5IG9mIHdoYXQgaXMgZXN0aW1hdGVkIHRvIGJlIHRoZSBtb3N0IHByb21pbmVudCBkaXJlY3Rpb25hbCBsaWdodC4gT3IgbnVsbCBpZiBkYXRhXG4gICAgICogaXMgbm90IGF2YWlsYWJsZS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtudW1iZXJ8bnVsbH1cbiAgICAgKi9cbiAgICBnZXQgaW50ZW5zaXR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXZhaWxhYmxlID8gdGhpcy5faW50ZW5zaXR5IDogbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb2xvciBvZiB3aGF0IGlzIGVzdGltYXRlZCB0byBiZSB0aGUgbW9zdCBwcm9taW5lbnQgZGlyZWN0aW9uYWwgbGlnaHQuIE9yIG51bGwgaWYgZGF0YSBpc1xuICAgICAqIG5vdCBhdmFpbGFibGUuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7Q29sb3J8bnVsbH1cbiAgICAgKi9cbiAgICBnZXQgY29sb3IoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9hdmFpbGFibGUgPyB0aGlzLl9jb2xvciA6IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUm90YXRpb24gb2Ygd2hhdCBpcyBlc3RpbWF0ZWQgdG8gYmUgdGhlIG1vc3QgcHJvbWluZW50IGRpcmVjdGlvbmFsIGxpZ2h0LiBPciBudWxsIGlmIGRhdGEgaXNcbiAgICAgKiBub3QgYXZhaWxhYmxlLlxuICAgICAqXG4gICAgICogQHR5cGUge1F1YXR8bnVsbH1cbiAgICAgKi9cbiAgICBnZXQgcm90YXRpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9hdmFpbGFibGUgPyB0aGlzLl9yb3RhdGlvbiA6IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU3BoZXJpY2FsIGhhcm1vbmljcyBjb2VmZmljaWVudHMgb2Ygd2hhdCBpcyBlc3RpbWF0ZWQgdG8gYmUgdGhlIG1vc3QgcHJvbWluZW50IGRpcmVjdGlvbmFsXG4gICAgICogbGlnaHQuIE9yIG51bGwgaWYgZGF0YSBpcyBub3QgYXZhaWxhYmxlLlxuICAgICAqXG4gICAgICogQHR5cGUge0Zsb2F0MzJBcnJheXxudWxsfVxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBnZXQgc3BoZXJpY2FsSGFybW9uaWNzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXZhaWxhYmxlID8gdGhpcy5fc3BoZXJpY2FsSGFybW9uaWNzIDogbnVsbDtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFhyTGlnaHRFc3RpbWF0aW9uIH07XG4iXSwibmFtZXMiOlsidmVjM0EiLCJWZWMzIiwidmVjM0IiLCJtYXQ0QSIsIk1hdDQiLCJtYXQ0QiIsIlhyTGlnaHRFc3RpbWF0aW9uIiwiRXZlbnRIYW5kbGVyIiwiY29uc3RydWN0b3IiLCJtYW5hZ2VyIiwiX21hbmFnZXIiLCJfc3VwcG9ydGVkIiwiX2F2YWlsYWJsZSIsIl9saWdodFByb2JlUmVxdWVzdGVkIiwiX2xpZ2h0UHJvYmUiLCJfaW50ZW5zaXR5IiwiX3JvdGF0aW9uIiwiUXVhdCIsIl9jb2xvciIsIkNvbG9yIiwiX3NwaGVyaWNhbEhhcm1vbmljcyIsIkZsb2F0MzJBcnJheSIsIm9uIiwiX29uU2Vzc2lvblN0YXJ0IiwiX29uU2Vzc2lvbkVuZCIsInN1cHBvcnRlZCIsInNlc3Npb24iLCJyZXF1ZXN0TGlnaHRQcm9iZSIsInN0YXJ0IiwiZXJyIiwiRXJyb3IiLCJ0eXBlIiwiWFJUWVBFX0FSIiwiZmlyZSIsInRoZW4iLCJsaWdodFByb2JlIiwid2FzUmVxdWVzdGVkIiwiYWN0aXZlIiwiY2F0Y2giLCJleCIsImVuZCIsInVwZGF0ZSIsImZyYW1lIiwibGlnaHRFc3RpbWF0ZSIsImdldExpZ2h0RXN0aW1hdGUiLCJwbGkiLCJwcmltYXJ5TGlnaHRJbnRlbnNpdHkiLCJNYXRoIiwibWF4IiwieCIsInkiLCJ6IiwiY29weSIsIm11bFNjYWxhciIsInNldCIsInByaW1hcnlMaWdodERpcmVjdGlvbiIsInNldExvb2tBdCIsIlVQIiwic2V0RnJvbUF4aXNBbmdsZSIsIlJJR0hUIiwibXVsIiwic2V0RnJvbU1hdDQiLCJzcGhlcmljYWxIYXJtb25pY3NDb2VmZmljaWVudHMiLCJhdmFpbGFibGUiLCJpbnRlbnNpdHkiLCJjb2xvciIsInJvdGF0aW9uIiwic3BoZXJpY2FsSGFybW9uaWNzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFXQSxNQUFNQSxLQUFLLEdBQUcsSUFBSUMsSUFBSixFQUFkLENBQUE7QUFDQSxNQUFNQyxLQUFLLEdBQUcsSUFBSUQsSUFBSixFQUFkLENBQUE7QUFDQSxNQUFNRSxLQUFLLEdBQUcsSUFBSUMsSUFBSixFQUFkLENBQUE7QUFDQSxNQUFNQyxLQUFLLEdBQUcsSUFBSUQsSUFBSixFQUFkLENBQUE7O0FBV0EsTUFBTUUsaUJBQU4sU0FBZ0NDLFlBQWhDLENBQTZDO0VBNkR6Q0MsV0FBVyxDQUFDQyxPQUFELEVBQVU7QUFDakIsSUFBQSxLQUFBLEVBQUEsQ0FBQTtBQURpQixJQUFBLElBQUEsQ0F4RHJCQyxRQXdEcUIsR0FBQSxLQUFBLENBQUEsQ0FBQTtJQUFBLElBbERyQkMsQ0FBQUEsVUFrRHFCLEdBbERSLEtBa0RRLENBQUE7SUFB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
