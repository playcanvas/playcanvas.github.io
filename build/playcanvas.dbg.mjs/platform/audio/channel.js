/**
 * @license
 * PlayCanvas Engine v1.62.0 revision 818511d2b (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { math } from '../../core/math/math.js';
import { hasAudioContext } from './capabilities.js';

/**
 * A channel is created when the {@link SoundManager} begins playback of a {@link Sound}. Usually
 * created internally by {@link SoundManager#playSound} or {@link SoundManager#playSound3d}.
 * Developers usually won't have to create Channels manually.
 *
 * @ignore
 */
class Channel {
  /**
   * Create a new Channel instance.
   *
   * @param {import('../sound/manager.js').SoundManager} manager - The SoundManager instance.
   * @param {import('../sound/sound.js').Sound} sound - The sound to playback.
   * @param {object} [options] - Optional options object.
   * @param {number} [options.volume=1] - The playback volume, between 0 and 1.
   * @param {number} [options.pitch=1] - The relative pitch, default of 1, plays at normal pitch.
   * @param {boolean} [options.loop=false] - Whether the sound should loop when it reaches the
   * end or not.
   */
  constructor(manager, sound, options = {}) {
    var _options$volume, _options$loop, _options$pitch;
    this.volume = (_options$volume = options.volume) != null ? _options$volume : 1;
    this.loop = (_options$loop = options.loop) != null ? _options$loop : false;
    this.pitch = (_options$pitch = options.pitch) != null ? _options$pitch : 1;
    this.sound = sound;
    this.paused = false;
    this.suspended = false;
    this.manager = manager;
    this.source = null;
    if (hasAudioContext()) {
      this.startTime = 0;
      this.startOffset = 0;
      const context = manager.context;
      this.gain = context.createGain();
    } else if (sound.audio) {
      // handle the case where sound was
      this.source = sound.audio.cloneNode(false);
      this.source.pause(); // not initially playing
    }
  }

  /**
   * Get the current value for the volume. Between 0 and 1.
   *
   * @returns {number} The volume of the channel.
   */
  getVolume() {
    return this.volume;
  }

  /**
   * Get the current looping state of the Channel.
   *
   * @returns {boolean} The loop property for the channel.
   */
  getLoop() {
    return this.loop;
  }

  /**
   * Enable/disable the loop property to make the sound restart from the beginning when it
   * reaches the end.
   *
   * @param {boolean} loop - True to loop the sound, false otherwise.
   */
  setLoop(loop) {
    this.loop = loop;
    if (this.source) {
      this.source.loop = loop;
    }
  }

  /**
   * Get the current pitch of the Channel.
   *
   * @returns {number} The pitch of the channel.
   */
  getPitch() {
    return this.pitch;
  }

  /**
   * Handle the manager's 'volumechange' event.
   */
  onManagerVolumeChange() {
    this.setVolume(this.getVolume());
  }

  /**
   * Handle the manager's 'suspend' event.
   */
  onManagerSuspend() {
    if (this.isPlaying() && !this.suspended) {
      this.suspended = true;
      this.pause();
    }
  }

  /**
   * Handle the manager's 'resume' event.
   */
  onManagerResume() {
    if (this.suspended) {
      this.suspended = false;
      this.unpause();
    }
  }

  /**
   * Begin playback of sound.
   */
  play() {
    if (this.source) {
      throw new Error('Call stop() before calling play()');
    }
    this._createSource();
    if (!this.source) {
      return;
    }
    this.startTime = this.manager.context.currentTime;
    this.source.start(0, this.startOffset % this.source.buffer.duration);

    // Initialize volume and loop - note moved to be after start() because of Chrome bug
    this.setVolume(this.volume);
    this.setLoop(this.loop);
    this.setPitch(this.pitch);
    this.manager.on('volumechange', this.onManagerVolumeChange, this);
    this.manager.on('suspend', this.onManagerSuspend, this);
    this.manager.on('resume', this.onManagerResume, this);

    // suspend immediately if manager is suspended
    if (this.manager.suspended) this.onManagerSuspend();
  }

  /**
   * Pause playback of sound. Call unpause() to resume playback from the same position.
   */
  pause() {
    if (this.source) {
      this.paused = true;
      this.startOffset += this.manager.context.currentTime - this.startTime;
      this.source.stop(0);
      this.source = null;
    }
  }

  /**
   * Resume playback of the sound. Playback resumes at the point that the audio was paused.
   */
  unpause() {
    if (this.source || !this.paused) {
      console.warn('Call pause() before unpausing.');
      return;
    }
    this._createSource();
    if (!this.source) {
      return;
    }
    this.startTime = this.manager.context.currentTime;
    this.source.start(0, this.startOffset % this.source.buffer.duration);

    // Initialize parameters
    this.setVolume(this.volume);
    this.setLoop(this.loop);
    this.setPitch(this.pitch);
    this.paused = false;
  }

  /**
   * Stop playback of sound. Calling play() again will restart playback from the beginning of the
   * sound.
   */
  stop() {
    if (this.source) {
      this.source.stop(0);
      this.source = null;
    }
    this.manager.off('volumechange', this.onManagerVolumeChange, this);
    this.manager.off('suspend', this.onManagerSuspend, this);
    this.manager.off('resume', this.onManagerResume, this);
  }

  /**
   * Set the volume of playback between 0 and 1.
   *
   * @param {number} volume - The volume of the sound. Will be clamped between 0 and 1.
   */
  setVolume(volume) {
    volume = math.clamp(volume, 0, 1);
    this.volume = volume;
    if (this.gain) {
      this.gain.gain.value = volume * this.manager.volume;
    }
  }
  setPitch(pitch) {
    this.pitch = pitch;
    if (this.source) {
      this.source.playbackRate.value = pitch;
    }
  }
  isPlaying() {
    return !this.paused && this.source.playbackState === this.source.PLAYING_STATE;
  }
  getDuration() {
    return this.source ? this.source.buffer.duration : 0;
  }
  _createSource() {
    const context = this.manager.context;
    if (this.sound.buffer) {
      this.source = context.createBufferSource();
      this.source.buffer = this.sound.buffer;

      // Connect up the nodes
      this.source.connect(this.gain);
      this.gain.connect(context.destination);
      if (!this.loop) {
        // mark source as paused when it ends
        this.source.onended = this.pause.bind(this);
      }
    }
  }
}
if (!hasAudioContext()) {
  Object.assign(Channel.prototype, {
    play: function () {
      if (this.source) {
        this.paused = false;
        this.setVolume(this.volume);
        this.setLoop(this.loop);
        this.setPitch(this.pitch);
        this.source.play();
      }
      this.manager.on('volumechange', this.onManagerVolumeChange, this);
      this.manager.on('suspend', this.onManagerSuspend, this);
      this.manager.on('resume', this.onManagerResume, this);

      // suspend immediately if manager is suspended
      if (this.manager.suspended) this.onManagerSuspend();
    },
    pause: function () {
      if (this.source) {
        this.paused = true;
        this.source.pause();
      }
    },
    unpause: function () {
      if (this.source) {
        this.paused = false;
        this.source.play();
      }
    },
    stop: function () {
      if (this.source) {
        this.source.pause();
      }
      this.manager.off('volumechange', this.onManagerVolumeChange, this);
      this.manager.off('suspend', this.onManagerSuspend, this);
      this.manager.off('resume', this.onManagerResume, this);
    },
    setVolume: function (volume) {
      volume = math.clamp(volume, 0, 1);
      this.volume = volume;
      if (this.source) {
        this.source.volume = volume * this.manager.volume;
      }
    },
    setPitch: function (pitch) {
      this.pitch = pitch;
      if (this.source) {
        this.source.playbackRate = pitch;
      }
    },
    getDuration: function () {
      return this.source && !isNaN(this.source.duration) ? this.source.duration : 0;
    },
    isPlaying: function () {
      return !this.source.paused;
    }
  });
}

export { Channel };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhbm5lbC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3BsYXRmb3JtL2F1ZGlvL2NoYW5uZWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbWF0aCB9IGZyb20gJy4uLy4uL2NvcmUvbWF0aC9tYXRoLmpzJztcblxuaW1wb3J0IHsgaGFzQXVkaW9Db250ZXh0IH0gZnJvbSAnLi9jYXBhYmlsaXRpZXMuanMnO1xuXG4vKipcbiAqIEEgY2hhbm5lbCBpcyBjcmVhdGVkIHdoZW4gdGhlIHtAbGluayBTb3VuZE1hbmFnZXJ9IGJlZ2lucyBwbGF5YmFjayBvZiBhIHtAbGluayBTb3VuZH0uIFVzdWFsbHlcbiAqIGNyZWF0ZWQgaW50ZXJuYWxseSBieSB7QGxpbmsgU291bmRNYW5hZ2VyI3BsYXlTb3VuZH0gb3Ige0BsaW5rIFNvdW5kTWFuYWdlciNwbGF5U291bmQzZH0uXG4gKiBEZXZlbG9wZXJzIHVzdWFsbHkgd29uJ3QgaGF2ZSB0byBjcmVhdGUgQ2hhbm5lbHMgbWFudWFsbHkuXG4gKlxuICogQGlnbm9yZVxuICovXG5jbGFzcyBDaGFubmVsIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgQ2hhbm5lbCBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi9zb3VuZC9tYW5hZ2VyLmpzJykuU291bmRNYW5hZ2VyfSBtYW5hZ2VyIC0gVGhlIFNvdW5kTWFuYWdlciBpbnN0YW5jZS5cbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vc291bmQvc291bmQuanMnKS5Tb3VuZH0gc291bmQgLSBUaGUgc291bmQgdG8gcGxheWJhY2suXG4gICAgICogQHBhcmFtIHtvYmplY3R9IFtvcHRpb25zXSAtIE9wdGlvbmFsIG9wdGlvbnMgb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy52b2x1bWU9MV0gLSBUaGUgcGxheWJhY2sgdm9sdW1lLCBiZXR3ZWVuIDAgYW5kIDEuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLnBpdGNoPTFdIC0gVGhlIHJlbGF0aXZlIHBpdGNoLCBkZWZhdWx0IG9mIDEsIHBsYXlzIGF0IG5vcm1hbCBwaXRjaC5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLmxvb3A9ZmFsc2VdIC0gV2hldGhlciB0aGUgc291bmQgc2hvdWxkIGxvb3Agd2hlbiBpdCByZWFjaGVzIHRoZVxuICAgICAqIGVuZCBvciBub3QuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IobWFuYWdlciwgc291bmQsIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICB0aGlzLnZvbHVtZSA9IG9wdGlvbnMudm9sdW1lID8/IDE7XG4gICAgICAgIHRoaXMubG9vcCA9IG9wdGlvbnMubG9vcCA/PyBmYWxzZTtcbiAgICAgICAgdGhpcy5waXRjaCA9IG9wdGlvbnMucGl0Y2ggPz8gMTtcblxuICAgICAgICB0aGlzLnNvdW5kID0gc291bmQ7XG5cbiAgICAgICAgdGhpcy5wYXVzZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdXNwZW5kZWQgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLm1hbmFnZXIgPSBtYW5hZ2VyO1xuXG4gICAgICAgIHRoaXMuc291cmNlID0gbnVsbDtcblxuICAgICAgICBpZiAoaGFzQXVkaW9Db250ZXh0KCkpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRUaW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRPZmZzZXQgPSAwO1xuXG4gICAgICAgICAgICBjb25zdCBjb250ZXh0ID0gbWFuYWdlci5jb250ZXh0O1xuICAgICAgICAgICAgdGhpcy5nYWluID0gY29udGV4dC5jcmVhdGVHYWluKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoc291bmQuYXVkaW8pIHtcbiAgICAgICAgICAgIC8vIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSBzb3VuZCB3YXNcbiAgICAgICAgICAgIHRoaXMuc291cmNlID0gc291bmQuYXVkaW8uY2xvbmVOb2RlKGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuc291cmNlLnBhdXNlKCk7IC8vIG5vdCBpbml0aWFsbHkgcGxheWluZ1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBjdXJyZW50IHZhbHVlIGZvciB0aGUgdm9sdW1lLiBCZXR3ZWVuIDAgYW5kIDEuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgdm9sdW1lIG9mIHRoZSBjaGFubmVsLlxuICAgICAqL1xuICAgIGdldFZvbHVtZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudm9sdW1lO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgY3VycmVudCBsb29waW5nIHN0YXRlIG9mIHRoZSBDaGFubmVsLlxuICAgICAqXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFRoZSBsb29wIHByb3BlcnR5IGZvciB0aGUgY2hhbm5lbC5cbiAgICAgKi9cbiAgICBnZXRMb29wKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sb29wO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVuYWJsZS9kaXNhYmxlIHRoZSBsb29wIHByb3BlcnR5IHRvIG1ha2UgdGhlIHNvdW5kIHJlc3RhcnQgZnJvbSB0aGUgYmVnaW5uaW5nIHdoZW4gaXRcbiAgICAgKiByZWFjaGVzIHRoZSBlbmQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGxvb3AgLSBUcnVlIHRvIGxvb3AgdGhlIHNvdW5kLCBmYWxzZSBvdGhlcndpc2UuXG4gICAgICovXG4gICAgc2V0TG9vcChsb29wKSB7XG4gICAgICAgIHRoaXMubG9vcCA9IGxvb3A7XG4gICAgICAgIGlmICh0aGlzLnNvdXJjZSkge1xuICAgICAgICAgICAgdGhpcy5zb3VyY2UubG9vcCA9IGxvb3A7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcGl0Y2ggb2YgdGhlIENoYW5uZWwuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgcGl0Y2ggb2YgdGhlIGNoYW5uZWwuXG4gICAgICovXG4gICAgZ2V0UGl0Y2goKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBpdGNoO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSB0aGUgbWFuYWdlcidzICd2b2x1bWVjaGFuZ2UnIGV2ZW50LlxuICAgICAqL1xuICAgIG9uTWFuYWdlclZvbHVtZUNoYW5nZSgpIHtcbiAgICAgICAgdGhpcy5zZXRWb2x1bWUodGhpcy5nZXRWb2x1bWUoKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIHRoZSBtYW5hZ2VyJ3MgJ3N1c3BlbmQnIGV2ZW50LlxuICAgICAqL1xuICAgIG9uTWFuYWdlclN1c3BlbmQoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzUGxheWluZygpICYmICF0aGlzLnN1c3BlbmRlZCkge1xuICAgICAgICAgICAgdGhpcy5zdXNwZW5kZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5wYXVzZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIHRoZSBtYW5hZ2VyJ3MgJ3Jlc3VtZScgZXZlbnQuXG4gICAgICovXG4gICAgb25NYW5hZ2VyUmVzdW1lKCkge1xuICAgICAgICBpZiAodGhpcy5zdXNwZW5kZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc3VzcGVuZGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnVucGF1c2UoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJlZ2luIHBsYXliYWNrIG9mIHNvdW5kLlxuICAgICAqL1xuICAgIHBsYXkoKSB7XG4gICAgICAgIGlmICh0aGlzLnNvdXJjZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYWxsIHN0b3AoKSBiZWZvcmUgY2FsbGluZyBwbGF5KCknKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2NyZWF0ZVNvdXJjZSgpO1xuICAgICAgICBpZiAoIXRoaXMuc291cmNlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuXG4gICAgICAgIHRoaXMuc3RhcnRUaW1lID0gdGhpcy5tYW5hZ2VyLmNvbnRleHQuY3VycmVudFRpbWU7XG4gICAgICAgIHRoaXMuc291cmNlLnN0YXJ0KDAsIHRoaXMuc3RhcnRPZmZzZXQgJSB0aGlzLnNvdXJjZS5idWZmZXIuZHVyYXRpb24pO1xuXG4gICAgICAgIC8vIEluaXRpYWxpemUgdm9sdW1lIGFuZCBsb29wIC0gbm90ZSBtb3ZlZCB0byBiZSBhZnRlciBzdGFydCgpIGJlY2F1c2Ugb2YgQ2hyb21lIGJ1Z1xuICAgICAgICB0aGlzLnNldFZvbHVtZSh0aGlzLnZvbHVtZSk7XG4gICAgICAgIHRoaXMuc2V0TG9vcCh0aGlzLmxvb3ApO1xuICAgICAgICB0aGlzLnNldFBpdGNoKHRoaXMucGl0Y2gpO1xuXG4gICAgICAgIHRoaXMubWFuYWdlci5vbigndm9sdW1lY2hhbmdlJywgdGhpcy5vbk1hbmFnZXJWb2x1bWVDaGFuZ2UsIHRoaXMpO1xuICAgICAgICB0aGlzLm1hbmFnZXIub24oJ3N1c3BlbmQnLCB0aGlzLm9uTWFuYWdlclN1c3BlbmQsIHRoaXMpO1xuICAgICAgICB0aGlzLm1hbmFnZXIub24oJ3Jlc3VtZScsIHRoaXMub25NYW5hZ2VyUmVzdW1lLCB0aGlzKTtcblxuICAgICAgICAvLyBzdXNwZW5kIGltbWVkaWF0ZWx5IGlmIG1hbmFnZXIgaXMgc3VzcGVuZGVkXG4gICAgICAgIGlmICh0aGlzLm1hbmFnZXIuc3VzcGVuZGVkKVxuICAgICAgICAgICAgdGhpcy5vbk1hbmFnZXJTdXNwZW5kKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUGF1c2UgcGxheWJhY2sgb2Ygc291bmQuIENhbGwgdW5wYXVzZSgpIHRvIHJlc3VtZSBwbGF5YmFjayBmcm9tIHRoZSBzYW1lIHBvc2l0aW9uLlxuICAgICAqL1xuICAgIHBhdXNlKCkge1xuICAgICAgICBpZiAodGhpcy5zb3VyY2UpIHtcbiAgICAgICAgICAgIHRoaXMucGF1c2VkID0gdHJ1ZTtcblxuICAgICAgICAgICAgdGhpcy5zdGFydE9mZnNldCArPSB0aGlzLm1hbmFnZXIuY29udGV4dC5jdXJyZW50VGltZSAtIHRoaXMuc3RhcnRUaW1lO1xuICAgICAgICAgICAgdGhpcy5zb3VyY2Uuc3RvcCgwKTtcbiAgICAgICAgICAgIHRoaXMuc291cmNlID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc3VtZSBwbGF5YmFjayBvZiB0aGUgc291bmQuIFBsYXliYWNrIHJlc3VtZXMgYXQgdGhlIHBvaW50IHRoYXQgdGhlIGF1ZGlvIHdhcyBwYXVzZWQuXG4gICAgICovXG4gICAgdW5wYXVzZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuc291cmNlIHx8ICF0aGlzLnBhdXNlZCkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdDYWxsIHBhdXNlKCkgYmVmb3JlIHVucGF1c2luZy4nKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2NyZWF0ZVNvdXJjZSgpO1xuICAgICAgICBpZiAoIXRoaXMuc291cmNlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IHRoaXMubWFuYWdlci5jb250ZXh0LmN1cnJlbnRUaW1lO1xuICAgICAgICB0aGlzLnNvdXJjZS5zdGFydCgwLCB0aGlzLnN0YXJ0T2Zmc2V0ICUgdGhpcy5zb3VyY2UuYnVmZmVyLmR1cmF0aW9uKTtcblxuICAgICAgICAvLyBJbml0aWFsaXplIHBhcmFtZXRlcnNcbiAgICAgICAgdGhpcy5zZXRWb2x1bWUodGhpcy52b2x1bWUpO1xuICAgICAgICB0aGlzLnNldExvb3AodGhpcy5sb29wKTtcbiAgICAgICAgdGhpcy5zZXRQaXRjaCh0aGlzLnBpdGNoKTtcblxuICAgICAgICB0aGlzLnBhdXNlZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFN0b3AgcGxheWJhY2sgb2Ygc291bmQuIENhbGxpbmcgcGxheSgpIGFnYWluIHdpbGwgcmVzdGFydCBwbGF5YmFjayBmcm9tIHRoZSBiZWdpbm5pbmcgb2YgdGhlXG4gICAgICogc291bmQuXG4gICAgICovXG4gICAgc3RvcCgpIHtcbiAgICAgICAgaWYgKHRoaXMuc291cmNlKSB7XG4gICAgICAgICAgICB0aGlzLnNvdXJjZS5zdG9wKDApO1xuICAgICAgICAgICAgdGhpcy5zb3VyY2UgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tYW5hZ2VyLm9mZigndm9sdW1lY2hhbmdlJywgdGhpcy5vbk1hbmFnZXJWb2x1bWVDaGFuZ2UsIHRoaXMpO1xuICAgICAgICB0aGlzLm1hbmFnZXIub2ZmKCdzdXNwZW5kJywgdGhpcy5vbk1hbmFnZXJTdXNwZW5kLCB0aGlzKTtcbiAgICAgICAgdGhpcy5tYW5hZ2VyLm9mZigncmVzdW1lJywgdGhpcy5vbk1hbmFnZXJSZXN1bWUsIHRoaXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgdm9sdW1lIG9mIHBsYXliYWNrIGJldHdlZW4gMCBhbmQgMS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB2b2x1bWUgLSBUaGUgdm9sdW1lIG9mIHRoZSBzb3VuZC4gV2lsbCBiZSBjbGFtcGVkIGJldHdlZW4gMCBhbmQgMS5cbiAgICAgKi9cbiAgICBzZXRWb2x1bWUodm9sdW1lKSB7XG4gICAgICAgIHZvbHVtZSA9IG1hdGguY2xhbXAodm9sdW1lLCAwLCAxKTtcbiAgICAgICAgdGhpcy52b2x1bWUgPSB2b2x1bWU7XG4gICAgICAgIGlmICh0aGlzLmdhaW4pIHtcbiAgICAgICAgICAgIHRoaXMuZ2Fpbi5nYWluLnZhbHVlID0gdm9sdW1lICogdGhpcy5tYW5hZ2VyLnZvbHVtZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNldFBpdGNoKHBpdGNoKSB7XG4gICAgICAgIHRoaXMucGl0Y2ggPSBwaXRjaDtcbiAgICAgICAgaWYgKHRoaXMuc291cmNlKSB7XG4gICAgICAgICAgICB0aGlzLnNvdXJjZS5wbGF5YmFja1JhdGUudmFsdWUgPSBwaXRjaDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlzUGxheWluZygpIHtcbiAgICAgICAgcmV0dXJuICghdGhpcy5wYXVzZWQgJiYgKHRoaXMuc291cmNlLnBsYXliYWNrU3RhdGUgPT09IHRoaXMuc291cmNlLlBMQVlJTkdfU1RBVEUpKTtcbiAgICB9XG5cbiAgICBnZXREdXJhdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlID8gdGhpcy5zb3VyY2UuYnVmZmVyLmR1cmF0aW9uIDogMDtcbiAgICB9XG5cbiAgICBfY3JlYXRlU291cmNlKCkge1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gdGhpcy5tYW5hZ2VyLmNvbnRleHQ7XG5cbiAgICAgICAgaWYgKHRoaXMuc291bmQuYnVmZmVyKSB7XG4gICAgICAgICAgICB0aGlzLnNvdXJjZSA9IGNvbnRleHQuY3JlYXRlQnVmZmVyU291cmNlKCk7XG4gICAgICAgICAgICB0aGlzLnNvdXJjZS5idWZmZXIgPSB0aGlzLnNvdW5kLmJ1ZmZlcjtcblxuICAgICAgICAgICAgLy8gQ29ubmVjdCB1cCB0aGUgbm9kZXNcbiAgICAgICAgICAgIHRoaXMuc291cmNlLmNvbm5lY3QodGhpcy5nYWluKTtcbiAgICAgICAgICAgIHRoaXMuZ2Fpbi5jb25uZWN0KGNvbnRleHQuZGVzdGluYXRpb24pO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMubG9vcCkge1xuICAgICAgICAgICAgICAgIC8vIG1hcmsgc291cmNlIGFzIHBhdXNlZCB3aGVuIGl0IGVuZHNcbiAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZS5vbmVuZGVkID0gdGhpcy5wYXVzZS5iaW5kKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5pZiAoIWhhc0F1ZGlvQ29udGV4dCgpKSB7XG4gICAgT2JqZWN0LmFzc2lnbihDaGFubmVsLnByb3RvdHlwZSwge1xuICAgICAgICBwbGF5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zb3VyY2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhdXNlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0Vm9sdW1lKHRoaXMudm9sdW1lKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldExvb3AodGhpcy5sb29wKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFBpdGNoKHRoaXMucGl0Y2gpO1xuICAgICAgICAgICAgICAgIHRoaXMuc291cmNlLnBsYXkoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLm9uKCd2b2x1bWVjaGFuZ2UnLCB0aGlzLm9uTWFuYWdlclZvbHVtZUNoYW5nZSwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLm1hbmFnZXIub24oJ3N1c3BlbmQnLCB0aGlzLm9uTWFuYWdlclN1c3BlbmQsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLm9uKCdyZXN1bWUnLCB0aGlzLm9uTWFuYWdlclJlc3VtZSwgdGhpcyk7XG5cbiAgICAgICAgICAgIC8vIHN1c3BlbmQgaW1tZWRpYXRlbHkgaWYgbWFuYWdlciBpcyBzdXNwZW5kZWRcbiAgICAgICAgICAgIGlmICh0aGlzLm1hbmFnZXIuc3VzcGVuZGVkKVxuICAgICAgICAgICAgICAgIHRoaXMub25NYW5hZ2VyU3VzcGVuZCgpO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgcGF1c2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNvdXJjZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGF1c2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZS5wYXVzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHVucGF1c2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNvdXJjZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGF1c2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5zb3VyY2UucGxheSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHN0b3A6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNvdXJjZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc291cmNlLnBhdXNlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMubWFuYWdlci5vZmYoJ3ZvbHVtZWNoYW5nZScsIHRoaXMub25NYW5hZ2VyVm9sdW1lQ2hhbmdlLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMubWFuYWdlci5vZmYoJ3N1c3BlbmQnLCB0aGlzLm9uTWFuYWdlclN1c3BlbmQsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLm9mZigncmVzdW1lJywgdGhpcy5vbk1hbmFnZXJSZXN1bWUsIHRoaXMpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldFZvbHVtZTogZnVuY3Rpb24gKHZvbHVtZSkge1xuICAgICAgICAgICAgdm9sdW1lID0gbWF0aC5jbGFtcCh2b2x1bWUsIDAsIDEpO1xuICAgICAgICAgICAgdGhpcy52b2x1bWUgPSB2b2x1bWU7XG4gICAgICAgICAgICBpZiAodGhpcy5zb3VyY2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZS52b2x1bWUgPSB2b2x1bWUgKiB0aGlzLm1hbmFnZXIudm9sdW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldFBpdGNoOiBmdW5jdGlvbiAocGl0Y2gpIHtcbiAgICAgICAgICAgIHRoaXMucGl0Y2ggPSBwaXRjaDtcbiAgICAgICAgICAgIGlmICh0aGlzLnNvdXJjZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc291cmNlLnBsYXliYWNrUmF0ZSA9IHBpdGNoO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zb3VyY2UgJiYgIWlzTmFOKHRoaXMuc291cmNlLmR1cmF0aW9uKSA/IHRoaXMuc291cmNlLmR1cmF0aW9uIDogMDtcbiAgICAgICAgfSxcblxuICAgICAgICBpc1BsYXlpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiAhdGhpcy5zb3VyY2UucGF1c2VkO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbmV4cG9ydCB7IENoYW5uZWwgfTtcbiJdLCJuYW1lcyI6WyJDaGFubmVsIiwiY29uc3RydWN0b3IiLCJtYW5hZ2VyIiwic291bmQiLCJvcHRpb25zIiwidm9sdW1lIiwibG9vcCIsInBpdGNoIiwicGF1c2VkIiwic3VzcGVuZGVkIiwic291cmNlIiwiaGFzQXVkaW9Db250ZXh0Iiwic3RhcnRUaW1lIiwic3RhcnRPZmZzZXQiLCJjb250ZXh0IiwiZ2FpbiIsImNyZWF0ZUdhaW4iLCJhdWRpbyIsImNsb25lTm9kZSIsInBhdXNlIiwiZ2V0Vm9sdW1lIiwiZ2V0TG9vcCIsInNldExvb3AiLCJnZXRQaXRjaCIsIm9uTWFuYWdlclZvbHVtZUNoYW5nZSIsInNldFZvbHVtZSIsIm9uTWFuYWdlclN1c3BlbmQiLCJpc1BsYXlpbmciLCJvbk1hbmFnZXJSZXN1bWUiLCJ1bnBhdXNlIiwicGxheSIsIkVycm9yIiwiX2NyZWF0ZVNvdXJjZSIsImN1cnJlbnRUaW1lIiwic3RhcnQiLCJidWZmZXIiLCJkdXJhdGlvbiIsInNldFBpdGNoIiwib24iLCJzdG9wIiwiY29uc29sZSIsIndhcm4iLCJvZmYiLCJtYXRoIiwiY2xhbXAiLCJ2YWx1ZSIsInBsYXliYWNrUmF0ZSIsInBsYXliYWNrU3RhdGUiLCJQTEFZSU5HX1NUQVRFIiwiZ2V0RHVyYXRpb24iLCJjcmVhdGVCdWZmZXJTb3VyY2UiLCJjb25uZWN0IiwiZGVzdGluYXRpb24iLCJvbmVuZGVkIiwiYmluZCIsIk9iamVjdCIsImFzc2lnbiIsInByb3RvdHlwZSIsImlzTmFOIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsT0FBTyxDQUFDO0FBQ1Y7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNJQyxXQUFXLENBQUNDLE9BQU8sRUFBRUMsS0FBSyxFQUFFQyxPQUFPLEdBQUcsRUFBRSxFQUFFO0FBQUEsSUFBQSxJQUFBLGVBQUEsRUFBQSxhQUFBLEVBQUEsY0FBQSxDQUFBO0FBQ3RDLElBQUEsSUFBSSxDQUFDQyxNQUFNLEdBQUEsQ0FBQSxlQUFBLEdBQUdELE9BQU8sQ0FBQ0MsTUFBTSw4QkFBSSxDQUFDLENBQUE7QUFDakMsSUFBQSxJQUFJLENBQUNDLElBQUksR0FBQSxDQUFBLGFBQUEsR0FBR0YsT0FBTyxDQUFDRSxJQUFJLDRCQUFJLEtBQUssQ0FBQTtBQUNqQyxJQUFBLElBQUksQ0FBQ0MsS0FBSyxHQUFBLENBQUEsY0FBQSxHQUFHSCxPQUFPLENBQUNHLEtBQUssNkJBQUksQ0FBQyxDQUFBO0lBRS9CLElBQUksQ0FBQ0osS0FBSyxHQUFHQSxLQUFLLENBQUE7SUFFbEIsSUFBSSxDQUFDSyxNQUFNLEdBQUcsS0FBSyxDQUFBO0lBQ25CLElBQUksQ0FBQ0MsU0FBUyxHQUFHLEtBQUssQ0FBQTtJQUV0QixJQUFJLENBQUNQLE9BQU8sR0FBR0EsT0FBTyxDQUFBO0lBRXRCLElBQUksQ0FBQ1EsTUFBTSxHQUFHLElBQUksQ0FBQTtJQUVsQixJQUFJQyxlQUFlLEVBQUUsRUFBRTtNQUNuQixJQUFJLENBQUNDLFNBQVMsR0FBRyxDQUFDLENBQUE7TUFDbEIsSUFBSSxDQUFDQyxXQUFXLEdBQUcsQ0FBQyxDQUFBO0FBRXBCLE1BQUEsTUFBTUMsT0FBTyxHQUFHWixPQUFPLENBQUNZLE9BQU8sQ0FBQTtBQUMvQixNQUFBLElBQUksQ0FBQ0MsSUFBSSxHQUFHRCxPQUFPLENBQUNFLFVBQVUsRUFBRSxDQUFBO0FBQ3BDLEtBQUMsTUFBTSxJQUFJYixLQUFLLENBQUNjLEtBQUssRUFBRTtBQUNwQjtNQUNBLElBQUksQ0FBQ1AsTUFBTSxHQUFHUCxLQUFLLENBQUNjLEtBQUssQ0FBQ0MsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFBO0FBQzFDLE1BQUEsSUFBSSxDQUFDUixNQUFNLENBQUNTLEtBQUssRUFBRSxDQUFDO0FBQ3hCLEtBQUE7QUFDSixHQUFBOztBQUVBO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDSUMsRUFBQUEsU0FBUyxHQUFHO0lBQ1IsT0FBTyxJQUFJLENBQUNmLE1BQU0sQ0FBQTtBQUN0QixHQUFBOztBQUVBO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDSWdCLEVBQUFBLE9BQU8sR0FBRztJQUNOLE9BQU8sSUFBSSxDQUFDZixJQUFJLENBQUE7QUFDcEIsR0FBQTs7QUFFQTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDSWdCLE9BQU8sQ0FBQ2hCLElBQUksRUFBRTtJQUNWLElBQUksQ0FBQ0EsSUFBSSxHQUFHQSxJQUFJLENBQUE7SUFDaEIsSUFBSSxJQUFJLENBQUNJLE1BQU0sRUFBRTtBQUNiLE1BQUEsSUFBSSxDQUFDQSxNQUFNLENBQUNKLElBQUksR0FBR0EsSUFBSSxDQUFBO0FBQzNCLEtBQUE7QUFDSixHQUFBOztBQUVBO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDSWlCLEVBQUFBLFFBQVEsR0FBRztJQUNQLE9BQU8sSUFBSSxDQUFDaEIsS0FBSyxDQUFBO0FBQ3JCLEdBQUE7O0FBRUE7QUFDSjtBQUNBO0FBQ0lpQixFQUFBQSxxQkFBcUIsR0FBRztBQUNwQixJQUFBLElBQUksQ0FBQ0MsU0FBUyxDQUFDLElBQUksQ0FBQ0wsU0FBUyxFQUFFLENBQUMsQ0FBQTtBQUNwQyxHQUFBOztBQUVBO0FBQ0o7QUFDQTtBQUNJTSxFQUFBQSxnQkFBZ0IsR0FBRztJQUNmLElBQUksSUFBSSxDQUFDQyxTQUFTLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQ2xCLFNBQVMsRUFBRTtNQUNyQyxJQUFJLENBQUNBLFNBQVMsR0FBRyxJQUFJLENBQUE7TUFDckIsSUFBSSxDQUFDVSxLQUFLLEVBQUUsQ0FBQTtBQUNoQixLQUFBO0FBQ0osR0FBQTs7QUFFQTtBQUNKO0FBQ0E7QUFDSVMsRUFBQUEsZUFBZSxHQUFHO0lBQ2QsSUFBSSxJQUFJLENBQUNuQixTQUFTLEVBQUU7TUFDaEIsSUFBSSxDQUFDQSxTQUFTLEdBQUcsS0FBSyxDQUFBO01BQ3RCLElBQUksQ0FBQ29CLE9BQU8sRUFBRSxDQUFBO0FBQ2xCLEtBQUE7QUFDSixHQUFBOztBQUVBO0FBQ0o7QUFDQTtBQUNJQyxFQUFBQSxJQUFJLEdBQUc7SUFDSCxJQUFJLElBQUksQ0FBQ3BCLE1BQU0sRUFBRTtBQUNiLE1BQUEsTUFBTSxJQUFJcUIsS0FBSyxDQUFDLG1DQUFtQyxDQUFDLENBQUE7QUFDeEQsS0FBQTtJQUVBLElBQUksQ0FBQ0MsYUFBYSxFQUFFLENBQUE7QUFDcEIsSUFBQSxJQUFJLENBQUMsSUFBSSxDQUFDdEIsTUFBTSxFQUFFO0FBQ2QsTUFBQSxPQUFBO0FBQ0osS0FBQTtJQUdBLElBQUksQ0FBQ0UsU0FBUyxHQUFHLElBQUksQ0FBQ1YsT0FBTyxDQUFDWSxPQUFPLENBQUNtQixXQUFXLENBQUE7QUFDakQsSUFBQSxJQUFJLENBQUN2QixNQUFNLENBQUN3QixLQUFLLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQ3JCLFdBQVcsR0FBRyxJQUFJLENBQUNILE1BQU0sQ0FBQ3lCLE1BQU0sQ0FBQ0MsUUFBUSxDQUFDLENBQUE7O0FBRXBFO0FBQ0EsSUFBQSxJQUFJLENBQUNYLFNBQVMsQ0FBQyxJQUFJLENBQUNwQixNQUFNLENBQUMsQ0FBQTtBQUMzQixJQUFBLElBQUksQ0FBQ2lCLE9BQU8sQ0FBQyxJQUFJLENBQUNoQixJQUFJLENBQUMsQ0FBQTtBQUN2QixJQUFBLElBQUksQ0FBQytCLFFBQVEsQ0FBQyxJQUFJLENBQUM5QixLQUFLLENBQUMsQ0FBQTtBQUV6QixJQUFBLElBQUksQ0FBQ0wsT0FBTyxDQUFDb0MsRUFBRSxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUNkLHFCQUFxQixFQUFFLElBQUksQ0FBQyxDQUFBO0FBQ2pFLElBQUEsSUFBSSxDQUFDdEIsT0FBTyxDQUFDb0MsRUFBRSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUNaLGdCQUFnQixFQUFFLElBQUksQ0FBQyxDQUFBO0FBQ3ZELElBQUEsSUFBSSxDQUFDeEIsT0FBTyxDQUFDb0MsRUFBRSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUNWLGVBQWUsRUFBRSxJQUFJLENBQUMsQ0FBQTs7QUFFckQ7SUFDQSxJQUFJLElBQUksQ0FBQzFCLE9BQU8sQ0FBQ08sU0FBUyxFQUN0QixJQUFJLENBQUNpQixnQkFBZ0IsRUFBRSxDQUFBO0FBQy9CLEdBQUE7O0FBRUE7QUFDSjtBQUNBO0FBQ0lQLEVBQUFBLEtBQUssR0FBRztJQUNKLElBQUksSUFBSSxDQUFDVCxNQUFNLEVBQUU7TUFDYixJQUFJLENBQUNGLE1BQU0sR0FBRyxJQUFJLENBQUE7QUFFbEIsTUFBQSxJQUFJLENBQUNLLFdBQVcsSUFBSSxJQUFJLENBQUNYLE9BQU8sQ0FBQ1ksT0FBTyxDQUFDbUIsV0FBVyxHQUFHLElBQUksQ0FBQ3JCLFNBQVMsQ0FBQTtBQUNyRSxNQUFBLElBQUksQ0FBQ0YsTUFBTSxDQUFDNkIsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBO01BQ25CLElBQUksQ0FBQzdCLE1BQU0sR0FBRyxJQUFJLENBQUE7QUFDdEIsS0FBQTtBQUNKLEdBQUE7O0FBRUE7QUFDSjtBQUNBO0FBQ0ltQixFQUFBQSxPQUFPLEdBQUc7SUFDTixJQUFJLElBQUksQ0FBQ25CLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQ0YsTUFBTSxFQUFFO0FBQzdCZ0MsTUFBQUEsT0FBTyxDQUFDQyxJQUFJLENBQUMsZ0NBQWdDLENBQUMsQ0FBQTtBQUM5QyxNQUFBLE9BQUE7QUFDSixLQUFBO0lBRUEsSUFBSSxDQUFDVCxhQUFhLEVBQUUsQ0FBQTtBQUNwQixJQUFBLElBQUksQ0FBQyxJQUFJLENBQUN0QixNQUFNLEVBQUU7QUFDZCxNQUFBLE9BQUE7QUFDSixLQUFBO0lBRUEsSUFBSSxDQUFDRSxTQUFTLEdBQUcsSUFBSSxDQUFDVixPQUFPLENBQUNZLE9BQU8sQ0FBQ21CLFdBQVcsQ0FBQTtBQUNqRCxJQUFBLElBQUksQ0FBQ3ZCLE1BQU0sQ0FBQ3dCLEtBQUssQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDckIsV0FBVyxHQUFHLElBQUksQ0FBQ0gsTUFBTSxDQUFDeUIsTUFBTSxDQUFDQyxRQUFRLENBQUMsQ0FBQTs7QUFFcEU7QUFDQSxJQUFBLElBQUksQ0FBQ1gsU0FBUyxDQUFDLElBQUksQ0FBQ3BCLE1BQU0sQ0FBQyxDQUFBO0FBQzNCLElBQUEsSUFBSSxDQUFDaUIsT0FBTyxDQUFDLElBQUksQ0FBQ2hCLElBQUksQ0FBQyxDQUFBO0FBQ3ZCLElBQUEsSUFBSSxDQUFDK0IsUUFBUSxDQUFDLElBQUksQ0FBQzlCLEtBQUssQ0FBQyxDQUFBO0lBRXpCLElBQUksQ0FBQ0MsTUFBTSxHQUFHLEtBQUssQ0FBQTtBQUN2QixHQUFBOztBQUVBO0FBQ0o7QUFDQTtBQUNBO0FBQ0krQixFQUFBQSxJQUFJLEdBQUc7SUFDSCxJQUFJLElBQUksQ0FBQzdCLE1BQU0sRUFBRTtBQUNiLE1BQUEsSUFBSSxDQUFDQSxNQUFNLENBQUM2QixJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7TUFDbkIsSUFBSSxDQUFDN0IsTUFBTSxHQUFHLElBQUksQ0FBQTtBQUN0QixLQUFBO0FBRUEsSUFBQSxJQUFJLENBQUNSLE9BQU8sQ0FBQ3dDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDbEIscUJBQXFCLEVBQUUsSUFBSSxDQUFDLENBQUE7QUFDbEUsSUFBQSxJQUFJLENBQUN0QixPQUFPLENBQUN3QyxHQUFHLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQ2hCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxDQUFBO0FBQ3hELElBQUEsSUFBSSxDQUFDeEIsT0FBTyxDQUFDd0MsR0FBRyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUNkLGVBQWUsRUFBRSxJQUFJLENBQUMsQ0FBQTtBQUMxRCxHQUFBOztBQUVBO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7RUFDSUgsU0FBUyxDQUFDcEIsTUFBTSxFQUFFO0lBQ2RBLE1BQU0sR0FBR3NDLElBQUksQ0FBQ0MsS0FBSyxDQUFDdkMsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUNqQyxJQUFJLENBQUNBLE1BQU0sR0FBR0EsTUFBTSxDQUFBO0lBQ3BCLElBQUksSUFBSSxDQUFDVSxJQUFJLEVBQUU7QUFDWCxNQUFBLElBQUksQ0FBQ0EsSUFBSSxDQUFDQSxJQUFJLENBQUM4QixLQUFLLEdBQUd4QyxNQUFNLEdBQUcsSUFBSSxDQUFDSCxPQUFPLENBQUNHLE1BQU0sQ0FBQTtBQUN2RCxLQUFBO0FBQ0osR0FBQTtFQUVBZ0MsUUFBUSxDQUFDOUIsS0FBSyxFQUFFO0lBQ1osSUFBSSxDQUFDQSxLQUFLLEdBQUdBLEtBQUssQ0FBQTtJQUNsQixJQUFJLElBQUksQ0FBQ0csTUFBTSxFQUFFO0FBQ2IsTUFBQSxJQUFJLENBQUNBLE1BQU0sQ0FBQ29DLFlBQVksQ0FBQ0QsS0FBSyxHQUFHdEMsS0FBSyxDQUFBO0FBQzFDLEtBQUE7QUFDSixHQUFBO0FBRUFvQixFQUFBQSxTQUFTLEdBQUc7QUFDUixJQUFBLE9BQVEsQ0FBQyxJQUFJLENBQUNuQixNQUFNLElBQUssSUFBSSxDQUFDRSxNQUFNLENBQUNxQyxhQUFhLEtBQUssSUFBSSxDQUFDckMsTUFBTSxDQUFDc0MsYUFBYyxDQUFBO0FBQ3JGLEdBQUE7QUFFQUMsRUFBQUEsV0FBVyxHQUFHO0FBQ1YsSUFBQSxPQUFPLElBQUksQ0FBQ3ZDLE1BQU0sR0FBRyxJQUFJLENBQUNBLE1BQU0sQ0FBQ3lCLE1BQU0sQ0FBQ0MsUUFBUSxHQUFHLENBQUMsQ0FBQTtBQUN4RCxHQUFBO0FBRUFKLEVBQUFBLGFBQWEsR0FBRztBQUNaLElBQUEsTUFBTWxCLE9BQU8sR0FBRyxJQUFJLENBQUNaLE9BQU8sQ0FBQ1ksT0FBTyxDQUFBO0FBRXBDLElBQUEsSUFBSSxJQUFJLENBQUNYLEtBQUssQ0FBQ2dDLE1BQU0sRUFBRTtBQUNuQixNQUFBLElBQUksQ0FBQ3pCLE1BQU0sR0FBR0ksT0FBTyxDQUFDb0Msa0JBQWtCLEVBQUUsQ0FBQTtNQUMxQyxJQUFJLENBQUN4QyxNQUFNLENBQUN5QixNQUFNLEdBQUcsSUFBSSxDQUFDaEMsS0FBSyxDQUFDZ0MsTUFBTSxDQUFBOztBQUV0QztNQUNBLElBQUksQ0FBQ3pCLE1BQU0sQ0FBQ3lDLE9BQU8sQ0FBQyxJQUFJLENBQUNwQyxJQUFJLENBQUMsQ0FBQTtNQUM5QixJQUFJLENBQUNBLElBQUksQ0FBQ29DLE9BQU8sQ0FBQ3JDLE9BQU8sQ0FBQ3NDLFdBQVcsQ0FBQyxDQUFBO0FBRXRDLE1BQUEsSUFBSSxDQUFDLElBQUksQ0FBQzlDLElBQUksRUFBRTtBQUNaO0FBQ0EsUUFBQSxJQUFJLENBQUNJLE1BQU0sQ0FBQzJDLE9BQU8sR0FBRyxJQUFJLENBQUNsQyxLQUFLLENBQUNtQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7QUFDL0MsT0FBQTtBQUNKLEtBQUE7QUFDSixHQUFBO0FBQ0osQ0FBQTtBQUVBLElBQUksQ0FBQzNDLGVBQWUsRUFBRSxFQUFFO0FBQ3BCNEMsRUFBQUEsTUFBTSxDQUFDQyxNQUFNLENBQUN4RCxPQUFPLENBQUN5RCxTQUFTLEVBQUU7QUFDN0IzQixJQUFBQSxJQUFJLEVBQUUsWUFBWTtNQUNkLElBQUksSUFBSSxDQUFDcEIsTUFBTSxFQUFFO1FBQ2IsSUFBSSxDQUFDRixNQUFNLEdBQUcsS0FBSyxDQUFBO0FBQ25CLFFBQUEsSUFBSSxDQUFDaUIsU0FBUyxDQUFDLElBQUksQ0FBQ3BCLE1BQU0sQ0FBQyxDQUFBO0FBQzNCLFFBQUEsSUFBSSxDQUFDaUIsT0FBTyxDQUFDLElBQUksQ0FBQ2hCLElBQUksQ0FBQyxDQUFBO0FBQ3ZCLFFBQUEsSUFBSSxDQUFDK0IsUUFBUSxDQUFDLElBQUksQ0FBQzlCLEtBQUssQ0FBQyxDQUFBO0FBQ3pCLFFBQUEsSUFBSSxDQUFDRyxNQUFNLENBQUNvQixJQUFJLEVBQUUsQ0FBQTtBQUN0QixPQUFBO0FBRUEsTUFBQSxJQUFJLENBQUM1QixPQUFPLENBQUNvQyxFQUFFLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQ2QscUJBQXFCLEVBQUUsSUFBSSxDQUFDLENBQUE7QUFDakUsTUFBQSxJQUFJLENBQUN0QixPQUFPLENBQUNvQyxFQUFFLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQ1osZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLENBQUE7QUFDdkQsTUFBQSxJQUFJLENBQUN4QixPQUFPLENBQUNvQyxFQUFFLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQ1YsZUFBZSxFQUFFLElBQUksQ0FBQyxDQUFBOztBQUVyRDtNQUNBLElBQUksSUFBSSxDQUFDMUIsT0FBTyxDQUFDTyxTQUFTLEVBQ3RCLElBQUksQ0FBQ2lCLGdCQUFnQixFQUFFLENBQUE7S0FFOUI7QUFFRFAsSUFBQUEsS0FBSyxFQUFFLFlBQVk7TUFDZixJQUFJLElBQUksQ0FBQ1QsTUFBTSxFQUFFO1FBQ2IsSUFBSSxDQUFDRixNQUFNLEdBQUcsSUFBSSxDQUFBO0FBQ2xCLFFBQUEsSUFBSSxDQUFDRSxNQUFNLENBQUNTLEtBQUssRUFBRSxDQUFBO0FBQ3ZCLE9BQUE7S0FDSDtBQUVEVSxJQUFBQSxPQUFPLEVBQUUsWUFBWTtNQUNqQixJQUFJLElBQUksQ0FBQ25CLE1BQU0sRUFBRTtRQUNiLElBQUksQ0FBQ0YsTUFBTSxHQUFHLEtBQUssQ0FBQTtBQUNuQixRQUFBLElBQUksQ0FBQ0UsTUFBTSxDQUFDb0IsSUFBSSxFQUFFLENBQUE7QUFDdEIsT0FBQTtLQUNIO0FBRURTLElBQUFBLElBQUksRUFBRSxZQUFZO01BQ2QsSUFBSSxJQUFJLENBQUM3QixNQUFNLEVBQUU7QUFDYixRQUFBLElBQUksQ0FBQ0EsTUFBTSxDQUFDUyxLQUFLLEVBQUUsQ0FBQTtBQUN2QixPQUFBO0FBRUEsTUFBQSxJQUFJLENBQUNqQixPQUFPLENBQUN3QyxHQUFHLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQ2xCLHFCQUFxQixFQUFFLElBQUksQ0FBQyxDQUFBO0FBQ2xFLE1BQUEsSUFBSSxDQUFDdEIsT0FBTyxDQUFDd0MsR0FBRyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUNoQixnQkFBZ0IsRUFBRSxJQUFJLENBQUMsQ0FBQTtBQUN4RCxNQUFBLElBQUksQ0FBQ3hCLE9BQU8sQ0FBQ3dDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDZCxlQUFlLEVBQUUsSUFBSSxDQUFDLENBQUE7S0FDekQ7SUFFREgsU0FBUyxFQUFFLFVBQVVwQixNQUFNLEVBQUU7TUFDekJBLE1BQU0sR0FBR3NDLElBQUksQ0FBQ0MsS0FBSyxDQUFDdkMsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtNQUNqQyxJQUFJLENBQUNBLE1BQU0sR0FBR0EsTUFBTSxDQUFBO01BQ3BCLElBQUksSUFBSSxDQUFDSyxNQUFNLEVBQUU7UUFDYixJQUFJLENBQUNBLE1BQU0sQ0FBQ0wsTUFBTSxHQUFHQSxNQUFNLEdBQUcsSUFBSSxDQUFDSCxPQUFPLENBQUNHLE1BQU0sQ0FBQTtBQUNyRCxPQUFBO0tBQ0g7SUFFRGdDLFFBQVEsRUFBRSxVQUFVOUIsS0FBSyxFQUFFO01BQ3ZCLElBQUksQ0FBQ0EsS0FBSyxHQUFHQSxLQUFLLENBQUE7TUFDbEIsSUFBSSxJQUFJLENBQUNHLE1BQU0sRUFBRTtBQUNiLFFBQUEsSUFBSSxDQUFDQSxNQUFNLENBQUNvQyxZQUFZLEdBQUd2QyxLQUFLLENBQUE7QUFDcEMsT0FBQTtLQUNIO0FBRUQwQyxJQUFBQSxXQUFXLEVBQUUsWUFBWTtNQUNyQixPQUFPLElBQUksQ0FBQ3ZDLE1BQU0sSUFBSSxDQUFDZ0QsS0FBSyxDQUFDLElBQUksQ0FBQ2hELE1BQU0sQ0FBQzBCLFFBQVEsQ0FBQyxHQUFHLElBQUksQ0FBQzFCLE1BQU0sQ0FBQzBCLFFBQVEsR0FBRyxDQUFDLENBQUE7S0FDaEY7QUFFRFQsSUFBQUEsU0FBUyxFQUFFLFlBQVk7QUFDbkIsTUFBQSxPQUFPLENBQUMsSUFBSSxDQUFDakIsTUFBTSxDQUFDRixNQUFNLENBQUE7QUFDOUIsS0FBQTtBQUNKLEdBQUMsQ0FBQyxDQUFBO0FBQ047Ozs7In0=
