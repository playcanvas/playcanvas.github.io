/**
 * @license
 * PlayCanvas Engine v1.58.0-preview revision 1fec26519 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Asset } from '../../asset/asset.js';
import { Component } from '../component.js';

class CollisionComponent extends Component {
  constructor(system, entity) {
    super(system, entity);

    this._compoundParent = null;
    this.entity.on('insert', this._onInsert, this);
    this.on('set_type', this.onSetType, this);
    this.on('set_halfExtents', this.onSetHalfExtents, this);
    this.on('set_radius', this.onSetRadius, this);
    this.on('set_height', this.onSetHeight, this);
    this.on('set_axis', this.onSetAxis, this);
    this.on('set_asset', this.onSetAsset, this);
    this.on('set_renderAsset', this.onSetRenderAsset, this);
    this.on('set_model', this.onSetModel, this);
    this.on('set_render', this.onSetRender, this);
  }

  onSetType(name, oldValue, newValue) {
    if (oldValue !== newValue) {
      this.system.changeType(this, oldValue, newValue);
    }
  }

  onSetHalfExtents(name, oldValue, newValue) {
    const t = this.data.type;
    if (this.data.initialized && t === 'box') {
      this.system.recreatePhysicalShapes(this);
    }
  }

  onSetRadius(name, oldValue, newValue) {
    const t = this.data.type;
    if (this.data.initialized && (t === 'sphere' || t === 'capsule' || t === 'cylinder' || t === 'cone')) {
      this.system.recreatePhysicalShapes(this);
    }
  }

  onSetHeight(name, oldValue, newValue) {
    const t = this.data.type;
    if (this.data.initialized && (t === 'capsule' || t === 'cylinder' || t === 'cone')) {
      this.system.recreatePhysicalShapes(this);
    }
  }

  onSetAxis(name, oldValue, newValue) {
    const t = this.data.type;
    if (this.data.initialized && (t === 'capsule' || t === 'cylinder' || t === 'cone')) {
      this.system.recreatePhysicalShapes(this);
    }
  }

  onSetAsset(name, oldValue, newValue) {
    const assets = this.system.app.assets;
    if (oldValue) {
      const asset = assets.get(oldValue);
      if (asset) {
        asset.off('remove', this.onAssetRemoved, this);
      }
    }
    if (newValue) {
      if (newValue instanceof Asset) {
        this.data.asset = newValue.id;
      }
      const asset = assets.get(this.data.asset);
      if (asset) {
        asset.off('remove', this.onAssetRemoved, this);
        asset.on('remove', this.onAssetRemoved, this);
      }
    }
    if (this.data.initialized && this.data.type === 'mesh') {
      if (!newValue) {
        this.data.model = null;
      }
      this.system.recreatePhysicalShapes(this);
    }
  }

  onSetRenderAsset(name, oldValue, newValue) {
    const assets = this.system.app.assets;
    if (oldValue) {
      const asset = assets.get(oldValue);
      if (asset) {
        asset.off('remove', this.onRenderAssetRemoved, this);
      }
    }
    if (newValue) {
      if (newValue instanceof Asset) {
        this.data.renderAsset = newValue.id;
      }
      const asset = assets.get(this.data.renderAsset);
      if (asset) {
        asset.off('remove', this.onRenderAssetRemoved, this);
        asset.on('remove', this.onRenderAssetRemoved, this);
      }
    }
    if (this.data.initialized && this.data.type === 'mesh') {
      if (!newValue) {
        this.data.render = null;
      }
      this.system.recreatePhysicalShapes(this);
    }
  }

  onSetModel(name, oldValue, newValue) {
    if (this.data.initialized && this.data.type === 'mesh') {
      this.system.implementations.mesh.doRecreatePhysicalShape(this);
    }
  }

  onSetRender(name, oldValue, newValue) {
    this.onSetModel(name, oldValue, newValue);
  }

  onAssetRemoved(asset) {
    asset.off('remove', this.onAssetRemoved, this);
    if (this.data.asset === asset.id) {
      this.asset = null;
    }
  }

  onRenderAssetRemoved(asset) {
    asset.off('remove', this.onRenderAssetRemoved, this);
    if (this.data.renderAsset === asset.id) {
      this.renderAsset = null;
    }
  }

  _getCompoundChildShapeIndex(shape) {
    const compound = this.data.shape;
    const shapes = compound.getNumChildShapes();
    for (let i = 0; i < shapes; i++) {
      const childShape = compound.getChildShape(i);
      if (childShape.ptr === shape.ptr) {
        return i;
      }
    }
    return null;
  }

  _onInsert(parent) {

    if (typeof Ammo === 'undefined') return;
    if (this._compoundParent) {
      this.system.recreatePhysicalShapes(this);
    } else if (!this.entity.rigidbody) {
      let ancestor = this.entity.parent;
      while (ancestor) {
        if (ancestor.collision && ancestor.collision.type === 'compound') {
          if (ancestor.collision.shape.getNumChildShapes() === 0) {
            this.system.recreatePhysicalShapes(ancestor.collision);
          } else {
            this.system.recreatePhysicalShapes(this);
          }
          break;
        }
        ancestor = ancestor.parent;
      }
    }
  }

  _updateCompound() {
    const entity = this.entity;
    if (entity._dirtyWorld) {
      let dirty = entity._dirtyLocal;
      let parent = entity;
      while (parent && !dirty) {
        if (parent.collision && parent.collision === this._compoundParent) break;
        if (parent._dirtyLocal) dirty = true;
        parent = parent.parent;
      }
      if (dirty) {
        entity.forEach(this.system.implementations.compound._updateEachDescendantTransform, entity);
        const bodyComponent = this._compoundParent.entity.rigidbody;
        if (bodyComponent) bodyComponent.activate();
      }
    }
  }

  onEnable() {
    if (this.data.type === 'mesh' && (this.data.asset || this.data.renderAsset) && this.data.initialized) {
      const asset = this.system.app.assets.get(this.data.asset || this.data.renderAsset);
      if (asset && (!asset.resource || !this.data.shape)) {
        this.system.recreatePhysicalShapes(this);
        return;
      }
    }
    if (this.entity.rigidbody) {
      if (this.entity.rigidbody.enabled) {
        this.entity.rigidbody.enableSimulation();
      }
    } else if (this._compoundParent && this !== this._compoundParent) {
      if (this._compoundParent.shape.getNumChildShapes() === 0) {
        this.system.recreatePhysicalShapes(this._compoundParent);
      } else {
        const transform = this.system._getNodeTransform(this.entity, this._compoundParent.entity);
        this._compoundParent.shape.addChildShape(transform, this.data.shape);
        Ammo.destroy(transform);
        if (this._compoundParent.entity.rigidbody) this._compoundParent.entity.rigidbody.activate();
      }
    } else if (this.entity.trigger) {
      this.entity.trigger.enable();
    }
  }

  onDisable() {
    if (this.entity.rigidbody) {
      this.entity.rigidbody.disableSimulation();
    } else if (this._compoundParent && this !== this._compoundParent) {
      if (!this._compoundParent.entity._destroying) {
        this.system._removeCompoundChild(this._compoundParent, this.data.shape);
        if (this._compoundParent.entity.rigidbody) this._compoundParent.entity.rigidbody.activate();
      }
    } else if (this.entity.trigger) {
      this.entity.trigger.disable();
    }
  }

  onBeforeRemove() {
    if (this.asset) {
      this.asset = null;
    }
    if (this.renderAsset) {
      this.renderAsset = null;
    }
    this.entity.off('insert', this._onInsert, this);
    this.off();
  }
}

export { CollisionComponent };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2NvbXBvbmVudHMvY29sbGlzaW9uL2NvbXBvbmVudC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBc3NldCB9IGZyb20gJy4uLy4uL2Fzc2V0L2Fzc2V0LmpzJztcblxuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnLi4vY29tcG9uZW50LmpzJztcblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uLy4uLy4uL2NvcmUvbWF0aC92ZWMzLmpzJykuVmVjM30gVmVjMyAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uLy4uLy4uL3NjZW5lL21vZGVsLmpzJykuTW9kZWx9IE1vZGVsICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi4vLi4vZW50aXR5LmpzJykuRW50aXR5fSBFbnRpdHkgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL3N5c3RlbS5qcycpLkNvbGxpc2lvbkNvbXBvbmVudFN5c3RlbX0gQ29sbGlzaW9uQ29tcG9uZW50U3lzdGVtICovXG5cbi8qKlxuICogQSBjb2xsaXNpb24gdm9sdW1lLiBVc2UgdGhpcyBpbiBjb25qdW5jdGlvbiB3aXRoIGEge0BsaW5rIFJpZ2lkQm9keUNvbXBvbmVudH0gdG8gbWFrZSBhXG4gKiBjb2xsaXNpb24gdm9sdW1lIHRoYXQgY2FuIGJlIHNpbXVsYXRlZCB1c2luZyB0aGUgcGh5c2ljcyBlbmdpbmUuXG4gKlxuICogSWYgdGhlIHtAbGluayBFbnRpdHl9IGRvZXMgbm90IGhhdmUgYSB7QGxpbmsgUmlnaWRCb2R5Q29tcG9uZW50fSB0aGVuIHRoaXMgY29sbGlzaW9uIHZvbHVtZSB3aWxsXG4gKiBhY3QgYXMgYSB0cmlnZ2VyIHZvbHVtZS4gV2hlbiBhbiBlbnRpdHkgd2l0aCBhIGR5bmFtaWMgb3Iga2luZW1hdGljIGJvZHkgZW50ZXJzIG9yIGxlYXZlcyBhblxuICogZW50aXR5IHdpdGggYSB0cmlnZ2VyIHZvbHVtZSwgYm90aCBlbnRpdGllcyB3aWxsIHJlY2VpdmUgdHJpZ2dlciBldmVudHMuXG4gKlxuICogVGhlIGZvbGxvd2luZyB0YWJsZSBzaG93cyBhbGwgdGhlIGV2ZW50cyB0aGF0IGNhbiBiZSBmaXJlZCBiZXR3ZWVuIHR3byBFbnRpdGllczpcbiAqXG4gKiB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBSaWdpZCBCb2R5IChTdGF0aWMpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBSaWdpZCBCb2R5IChEeW5hbWljIG9yIEtpbmVtYXRpYykgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBUcmlnZ2VyIFZvbHVtZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogfCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIHwgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIHwgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIHwgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIHxcbiAqIHwgKipSaWdpZCBCb2R5IChTdGF0aWMpKiogICAgICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IDx1bD48bGk+Y29udGFjdDwvbGk+PGxpPmNvbGxpc2lvbnN0YXJ0PC9saT48bGk+Y29sbGlzaW9uZW5kPC9saT48L3VsPiB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiB8ICoqUmlnaWQgQm9keSAoRHluYW1pYyBvciBLaW5lbWF0aWMpKiogfCA8dWw+PGxpPmNvbnRhY3Q8L2xpPjxsaT5jb2xsaXNpb25zdGFydDwvbGk+PGxpPmNvbGxpc2lvbmVuZDwvbGk+PC91bD4gfCA8dWw+PGxpPmNvbnRhY3Q8L2xpPjxsaT5jb2xsaXNpb25zdGFydDwvbGk+PGxpPmNvbGxpc2lvbmVuZDwvbGk+PC91bD4gfCA8dWw+PGxpPnRyaWdnZXJlbnRlcjwvbGk+PGxpPnRyaWdnZXJsZWF2ZTwvbGk+PC91bD4gfFxuICogfCAqKlRyaWdnZXIgVm9sdW1lKiogICAgICAgICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgPHVsPjxsaT50cmlnZ2VyZW50ZXI8L2xpPjxsaT50cmlnZ2VybGVhdmU8L2xpPjwvdWw+ICAgICAgICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqXG4gKiBAcHJvcGVydHkge3N0cmluZ30gdHlwZSBUaGUgdHlwZSBvZiB0aGUgY29sbGlzaW9uIHZvbHVtZS4gQ2FuIGJlOlxuICpcbiAqIC0gXCJib3hcIjogQSBib3gtc2hhcGVkIGNvbGxpc2lvbiB2b2x1bWUuXG4gKiAtIFwiY2Fwc3VsZVwiOiBBIGNhcHN1bGUtc2hhcGVkIGNvbGxpc2lvbiB2b2x1bWUuXG4gKiAtIFwiY29tcG91bmRcIjogQSBjb21wb3VuZCBzaGFwZS4gQW55IGRlc2NlbmRhbnQgZW50aXRpZXMgd2l0aCBhIGNvbGxpc2lvbiBjb21wb25lbnRcbiAqIG9mIHR5cGUgYm94LCBjYXBzdWxlLCBjb25lLCBjeWxpbmRlciBvciBzcGhlcmUgd2lsbCBiZSBjb21iaW5lZCBpbnRvIGEgc2luZ2xlLCByaWdpZFxuICogc2hhcGUuXG4gKiAtIFwiY29uZVwiOiBBIGNvbmUtc2hhcGVkIGNvbGxpc2lvbiB2b2x1bWUuXG4gKiAtIFwiY3lsaW5kZXJcIjogQSBjeWxpbmRlci1zaGFwZWQgY29sbGlzaW9uIHZvbHVtZS5cbiAqIC0gXCJtZXNoXCI6IEEgY29sbGlzaW9uIHZvbHVtZSB0aGF0IHVzZXMgYSBtb2RlbCBhc3NldCBhcyBpdHMgc2hhcGUuXG4gKiAtIFwic3BoZXJlXCI6IEEgc3BoZXJlLXNoYXBlZCBjb2xsaXNpb24gdm9sdW1lLlxuICpcbiAqIERlZmF1bHRzIHRvIFwiYm94XCIuXG4gKiBAcHJvcGVydHkge1ZlYzN9IGhhbGZFeHRlbnRzIFRoZSBoYWxmLWV4dGVudHMgb2YgdGhlIGJveC1zaGFwZWQgY29sbGlzaW9uIHZvbHVtZSBpbiB0aGUgeCwgeSBhbmRcbiAqIHogYXhlcy4gRGVmYXVsdHMgdG8gWzAuNSwgMC41LCAwLjVdLlxuICogQHByb3BlcnR5IHtudW1iZXJ9IHJhZGl1cyBUaGUgcmFkaXVzIG9mIHRoZSBzcGhlcmUsIGNhcHN1bGUsIGN5bGluZGVyIG9yIGNvbmUtc2hhcGVkIGNvbGxpc2lvblxuICogdm9sdW1lcy4gRGVmYXVsdHMgdG8gMC41LlxuICogQHByb3BlcnR5IHtudW1iZXJ9IGF4aXMgVGhlIGxvY2FsIHNwYWNlIGF4aXMgd2l0aCB3aGljaCB0aGUgY2Fwc3VsZSwgY3lsaW5kZXIgb3IgY29uZS1zaGFwZWRcbiAqIGNvbGxpc2lvbiB2b2x1bWUncyBsZW5ndGggaXMgYWxpZ25lZC4gMCBmb3IgWCwgMSBmb3IgWSBhbmQgMiBmb3IgWi4gRGVmYXVsdHMgdG8gMSAoWS1heGlzKS5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBoZWlnaHQgVGhlIHRvdGFsIGhlaWdodCBvZiB0aGUgY2Fwc3VsZSwgY3lsaW5kZXIgb3IgY29uZS1zaGFwZWQgY29sbGlzaW9uXG4gKiB2b2x1bWUgZnJvbSB0aXAgdG8gdGlwLiBEZWZhdWx0cyB0byAyLlxuICogQHByb3BlcnR5IHtBc3NldHxudW1iZXJ9IGFzc2V0IFRoZSBhc3NldCBmb3IgdGhlIG1vZGVsIG9mIHRoZSBtZXNoIGNvbGxpc2lvbiB2b2x1bWUgLSBjYW4gYWxzb1xuICogYmUgYW4gYXNzZXQgaWQuIERlZmF1bHRzIHRvIG51bGwuXG4gKiBAcHJvcGVydHkge0Fzc2V0fG51bWJlcn0gcmVuZGVyQXNzZXQgVGhlIHJlbmRlciBhc3NldCBvZiB0aGUgbWVzaCBjb2xsaXNpb24gdm9sdW1lIC0gY2FuIGFsc28gYmVcbiAqIGFuIGFzc2V0IGlkLiBEZWZhdWx0cyB0byBudWxsLiBJZiBub3Qgc2V0IHRoZW4gdGhlIGFzc2V0IHByb3BlcnR5IHdpbGwgYmUgY2hlY2tlZCBpbnN0ZWFkLlxuICogQHByb3BlcnR5IHtNb2RlbH0gbW9kZWwgVGhlIG1vZGVsIHRoYXQgaXMgYWRkZWQgdG8gdGhlIHNjZW5lIGdyYXBoIGZvciB0aGUgbWVzaCBjb2xsaXNpb25cbiAqIHZvbHVtZS5cbiAqIEBhdWdtZW50cyBDb21wb25lbnRcbiAqL1xuY2xhc3MgQ29sbGlzaW9uQ29tcG9uZW50IGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgQ29sbGlzaW9uQ29tcG9uZW50LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtDb2xsaXNpb25Db21wb25lbnRTeXN0ZW19IHN5c3RlbSAtIFRoZSBDb21wb25lbnRTeXN0ZW0gdGhhdCBjcmVhdGVkIHRoaXMgQ29tcG9uZW50LlxuICAgICAqIEBwYXJhbSB7RW50aXR5fSBlbnRpdHkgLSBUaGUgRW50aXR5IHRoYXQgdGhpcyBDb21wb25lbnQgaXMgYXR0YWNoZWQgdG8uXG4gICAgICovXG4gICAgY29uc3RydWN0b3Ioc3lzdGVtLCBlbnRpdHkpIHtcbiAgICAgICAgc3VwZXIoc3lzdGVtLCBlbnRpdHkpO1xuXG4gICAgICAgIC8qKiBAcHJpdmF0ZSAqL1xuICAgICAgICB0aGlzLl9jb21wb3VuZFBhcmVudCA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5lbnRpdHkub24oJ2luc2VydCcsIHRoaXMuX29uSW5zZXJ0LCB0aGlzKTtcblxuICAgICAgICB0aGlzLm9uKCdzZXRfdHlwZScsIHRoaXMub25TZXRUeXBlLCB0aGlzKTtcbiAgICAgICAgdGhpcy5vbignc2V0X2hhbGZFeHRlbnRzJywgdGhpcy5vblNldEhhbGZFeHRlbnRzLCB0aGlzKTtcbiAgICAgICAgdGhpcy5vbignc2V0X3JhZGl1cycsIHRoaXMub25TZXRSYWRpdXMsIHRoaXMpO1xuICAgICAgICB0aGlzLm9uKCdzZXRfaGVpZ2h0JywgdGhpcy5vblNldEhlaWdodCwgdGhpcyk7XG4gICAgICAgIHRoaXMub24oJ3NldF9heGlzJywgdGhpcy5vblNldEF4aXMsIHRoaXMpO1xuICAgICAgICB0aGlzLm9uKCdzZXRfYXNzZXQnLCB0aGlzLm9uU2V0QXNzZXQsIHRoaXMpO1xuICAgICAgICB0aGlzLm9uKCdzZXRfcmVuZGVyQXNzZXQnLCB0aGlzLm9uU2V0UmVuZGVyQXNzZXQsIHRoaXMpO1xuICAgICAgICB0aGlzLm9uKCdzZXRfbW9kZWwnLCB0aGlzLm9uU2V0TW9kZWwsIHRoaXMpO1xuICAgICAgICB0aGlzLm9uKCdzZXRfcmVuZGVyJywgdGhpcy5vblNldFJlbmRlciwgdGhpcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlICdjb250YWN0JyBldmVudCBpcyBmaXJlZCB3aGVuIGEgY29udGFjdCBvY2N1cnMgYmV0d2VlbiB0d28gcmlnaWQgYm9kaWVzLlxuICAgICAqXG4gICAgICogQGV2ZW50IENvbGxpc2lvbkNvbXBvbmVudCNjb250YWN0XG4gICAgICogQHBhcmFtIHtDb250YWN0UmVzdWx0fSByZXN1bHQgLSBEZXRhaWxzIG9mIHRoZSBjb250YWN0IGJldHdlZW4gdGhlIHR3byByaWdpZCBib2RpZXMuXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIHR3byByaWdpZCBib2RpZXMgc3RhcnQgdG91Y2hpbmcuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgQ29sbGlzaW9uQ29tcG9uZW50I2NvbGxpc2lvbnN0YXJ0XG4gICAgICogQHBhcmFtIHtDb250YWN0UmVzdWx0fSByZXN1bHQgLSBEZXRhaWxzIG9mIHRoZSBjb250YWN0IGJldHdlZW4gdGhlIHR3byBFbnRpdGllcy5cbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHR3byByaWdpZC1ib2RpZXMgc3RvcCB0b3VjaGluZy5cbiAgICAgKlxuICAgICAqIEBldmVudCBDb2xsaXNpb25Db21wb25lbnQjY29sbGlzaW9uZW5kXG4gICAgICogQHBhcmFtIHtFbnRpdHl9IG90aGVyIC0gVGhlIHtAbGluayBFbnRpdHl9IHRoYXQgc3RvcHBlZCB0b3VjaGluZyB0aGlzIGNvbGxpc2lvbiB2b2x1bWUuXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIGEgcmlnaWQgYm9keSBlbnRlcnMgYSB0cmlnZ2VyIHZvbHVtZS5cbiAgICAgKlxuICAgICAqIEBldmVudCBDb2xsaXNpb25Db21wb25lbnQjdHJpZ2dlcmVudGVyXG4gICAgICogQHBhcmFtIHtFbnRpdHl9IG90aGVyIC0gVGhlIHtAbGluayBFbnRpdHl9IHRoYXQgZW50ZXJlZCB0aGlzIGNvbGxpc2lvbiB2b2x1bWUuXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIGEgcmlnaWQgYm9keSBleGl0cyBhIHRyaWdnZXIgdm9sdW1lLlxuICAgICAqXG4gICAgICogQGV2ZW50IENvbGxpc2lvbkNvbXBvbmVudCN0cmlnZ2VybGVhdmVcbiAgICAgKiBAcGFyYW0ge0VudGl0eX0gb3RoZXIgLSBUaGUge0BsaW5rIEVudGl0eX0gdGhhdCBleGl0ZWQgdGhpcyBjb2xsaXNpb24gdm9sdW1lLlxuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBQcm9wZXJ0eSBuYW1lLlxuICAgICAqIEBwYXJhbSB7Kn0gb2xkVmFsdWUgLSBQcmV2aW91cyB2YWx1ZSBvZiB0aGUgcHJvcGVydHkuXG4gICAgICogQHBhcmFtIHsqfSBuZXdWYWx1ZSAtIE5ldyB2YWx1ZSBvZiB0aGUgcHJvcGVydHkuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBvblNldFR5cGUobmFtZSwgb2xkVmFsdWUsIG5ld1ZhbHVlKSB7XG4gICAgICAgIGlmIChvbGRWYWx1ZSAhPT0gbmV3VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuc3lzdGVtLmNoYW5nZVR5cGUodGhpcywgb2xkVmFsdWUsIG5ld1ZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gUHJvcGVydHkgbmFtZS5cbiAgICAgKiBAcGFyYW0geyp9IG9sZFZhbHVlIC0gUHJldmlvdXMgdmFsdWUgb2YgdGhlIHByb3BlcnR5LlxuICAgICAqIEBwYXJhbSB7Kn0gbmV3VmFsdWUgLSBOZXcgdmFsdWUgb2YgdGhlIHByb3BlcnR5LlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgb25TZXRIYWxmRXh0ZW50cyhuYW1lLCBvbGRWYWx1ZSwgbmV3VmFsdWUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZGF0YS50eXBlO1xuICAgICAgICBpZiAodGhpcy5kYXRhLmluaXRpYWxpemVkICYmIHQgPT09ICdib3gnKSB7XG4gICAgICAgICAgICB0aGlzLnN5c3RlbS5yZWNyZWF0ZVBoeXNpY2FsU2hhcGVzKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBQcm9wZXJ0eSBuYW1lLlxuICAgICAqIEBwYXJhbSB7Kn0gb2xkVmFsdWUgLSBQcmV2aW91cyB2YWx1ZSBvZiB0aGUgcHJvcGVydHkuXG4gICAgICogQHBhcmFtIHsqfSBuZXdWYWx1ZSAtIE5ldyB2YWx1ZSBvZiB0aGUgcHJvcGVydHkuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBvblNldFJhZGl1cyhuYW1lLCBvbGRWYWx1ZSwgbmV3VmFsdWUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZGF0YS50eXBlO1xuICAgICAgICBpZiAodGhpcy5kYXRhLmluaXRpYWxpemVkICYmICh0ID09PSAnc3BoZXJlJyB8fCB0ID09PSAnY2Fwc3VsZScgfHwgdCA9PT0gJ2N5bGluZGVyJyB8fCB0ID09PSAnY29uZScpKSB7XG4gICAgICAgICAgICB0aGlzLnN5c3RlbS5yZWNyZWF0ZVBoeXNpY2FsU2hhcGVzKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBQcm9wZXJ0eSBuYW1lLlxuICAgICAqIEBwYXJhbSB7Kn0gb2xkVmFsdWUgLSBQcmV2aW91cyB2YWx1ZSBvZiB0aGUgcHJvcGVydHkuXG4gICAgICogQHBhcmFtIHsqfSBuZXdWYWx1ZSAtIE5ldyB2YWx1ZSBvZiB0aGUgcHJvcGVydHkuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBvblNldEhlaWdodChuYW1lLCBvbGRWYWx1ZSwgbmV3VmFsdWUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZGF0YS50eXBlO1xuICAgICAgICBpZiAodGhpcy5kYXRhLmluaXRpYWxpemVkICYmICh0ID09PSAnY2Fwc3VsZScgfHwgdCA9PT0gJ2N5bGluZGVyJyB8fCB0ID09PSAnY29uZScpKSB7XG4gICAgICAgICAgICB0aGlzLnN5c3RlbS5yZWNyZWF0ZVBoeXNpY2FsU2hhcGVzKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBQcm9wZXJ0eSBuYW1lLlxuICAgICAqIEBwYXJhbSB7Kn0gb2xkVmFsdWUgLSBQcmV2aW91cyB2YWx1ZSBvZiB0aGUgcHJvcGVydHkuXG4gICAgICogQHBhcmFtIHsqfSBuZXdWYWx1ZSAtIE5ldyB2YWx1ZSBvZiB0aGUgcHJvcGVydHkuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBvblNldEF4aXMobmFtZSwgb2xkVmFsdWUsIG5ld1ZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmRhdGEudHlwZTtcbiAgICAgICAgaWYgKHRoaXMuZGF0YS5pbml0aWFsaXplZCAmJiAodCA9PT0gJ2NhcHN1bGUnIHx8IHQgPT09ICdjeWxpbmRlcicgfHwgdCA9PT0gJ2NvbmUnKSkge1xuICAgICAgICAgICAgdGhpcy5zeXN0ZW0ucmVjcmVhdGVQaHlzaWNhbFNoYXBlcyh0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gUHJvcGVydHkgbmFtZS5cbiAgICAgKiBAcGFyYW0geyp9IG9sZFZhbHVlIC0gUHJldmlvdXMgdmFsdWUgb2YgdGhlIHByb3BlcnR5LlxuICAgICAqIEBwYXJhbSB7Kn0gbmV3VmFsdWUgLSBOZXcgdmFsdWUgb2YgdGhlIHByb3BlcnR5LlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgb25TZXRBc3NldChuYW1lLCBvbGRWYWx1ZSwgbmV3VmFsdWUpIHtcbiAgICAgICAgY29uc3QgYXNzZXRzID0gdGhpcy5zeXN0ZW0uYXBwLmFzc2V0cztcblxuICAgICAgICBpZiAob2xkVmFsdWUpIHtcbiAgICAgICAgICAgIC8vIFJlbW92ZSBvbGQgbGlzdGVuZXJzXG4gICAgICAgICAgICBjb25zdCBhc3NldCA9IGFzc2V0cy5nZXQob2xkVmFsdWUpO1xuICAgICAgICAgICAgaWYgKGFzc2V0KSB7XG4gICAgICAgICAgICAgICAgYXNzZXQub2ZmKCdyZW1vdmUnLCB0aGlzLm9uQXNzZXRSZW1vdmVkLCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuZXdWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKG5ld1ZhbHVlIGluc3RhbmNlb2YgQXNzZXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEuYXNzZXQgPSBuZXdWYWx1ZS5pZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgYXNzZXQgPSBhc3NldHMuZ2V0KHRoaXMuZGF0YS5hc3NldCk7XG4gICAgICAgICAgICBpZiAoYXNzZXQpIHtcbiAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgd2UgZG9uJ3Qgc3Vic2NyaWJlIHR3aWNlXG4gICAgICAgICAgICAgICAgYXNzZXQub2ZmKCdyZW1vdmUnLCB0aGlzLm9uQXNzZXRSZW1vdmVkLCB0aGlzKTtcbiAgICAgICAgICAgICAgICBhc3NldC5vbigncmVtb3ZlJywgdGhpcy5vbkFzc2V0UmVtb3ZlZCwgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5kYXRhLmluaXRpYWxpemVkICYmIHRoaXMuZGF0YS50eXBlID09PSAnbWVzaCcpIHtcbiAgICAgICAgICAgIGlmICghbmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAvLyBpZiBhc3NldCBpcyBudWxsIHNldCBtb2RlbCB0byBudWxsXG4gICAgICAgICAgICAgICAgLy8gc28gdGhhdCBpdCdzIGdvaW5nIHRvIGJlIHJlbW92ZWQgZnJvbSB0aGUgc2ltdWxhdGlvblxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5tb2RlbCA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnN5c3RlbS5yZWNyZWF0ZVBoeXNpY2FsU2hhcGVzKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBQcm9wZXJ0eSBuYW1lLlxuICAgICAqIEBwYXJhbSB7Kn0gb2xkVmFsdWUgLSBQcmV2aW91cyB2YWx1ZSBvZiB0aGUgcHJvcGVydHkuXG4gICAgICogQHBhcmFtIHsqfSBuZXdWYWx1ZSAtIE5ldyB2YWx1ZSBvZiB0aGUgcHJvcGVydHkuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBvblNldFJlbmRlckFzc2V0KG5hbWUsIG9sZFZhbHVlLCBuZXdWYWx1ZSkge1xuICAgICAgICBjb25zdCBhc3NldHMgPSB0aGlzLnN5c3RlbS5hcHAuYXNzZXRzO1xuXG4gICAgICAgIGlmIChvbGRWYWx1ZSkge1xuICAgICAgICAgICAgLy8gUmVtb3ZlIG9sZCBsaXN0ZW5lcnNcbiAgICAgICAgICAgIGNvbnN0IGFzc2V0ID0gYXNzZXRzLmdldChvbGRWYWx1ZSk7XG4gICAgICAgICAgICBpZiAoYXNzZXQpIHtcbiAgICAgICAgICAgICAgICBhc3NldC5vZmYoJ3JlbW92ZScsIHRoaXMub25SZW5kZXJBc3NldFJlbW92ZWQsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICBpZiAobmV3VmFsdWUgaW5zdGFuY2VvZiBBc3NldCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5yZW5kZXJBc3NldCA9IG5ld1ZhbHVlLmlkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBhc3NldCA9IGFzc2V0cy5nZXQodGhpcy5kYXRhLnJlbmRlckFzc2V0KTtcbiAgICAgICAgICAgIGlmIChhc3NldCkge1xuICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSBkb24ndCBzdWJzY3JpYmUgdHdpY2VcbiAgICAgICAgICAgICAgICBhc3NldC5vZmYoJ3JlbW92ZScsIHRoaXMub25SZW5kZXJBc3NldFJlbW92ZWQsIHRoaXMpO1xuICAgICAgICAgICAgICAgIGFzc2V0Lm9uKCdyZW1vdmUnLCB0aGlzLm9uUmVuZGVyQXNzZXRSZW1vdmVkLCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmRhdGEuaW5pdGlhbGl6ZWQgJiYgdGhpcy5kYXRhLnR5cGUgPT09ICdtZXNoJykge1xuICAgICAgICAgICAgaWYgKCFuZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgIC8vIGlmIHJlbmRlciBhc3NldCBpcyBudWxsIHNldCByZW5kZXIgdG8gbnVsbFxuICAgICAgICAgICAgICAgIC8vIHNvIHRoYXQgaXQncyBnb2luZyB0byBiZSByZW1vdmVkIGZyb20gdGhlIHNpbXVsYXRpb25cbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEucmVuZGVyID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc3lzdGVtLnJlY3JlYXRlUGh5c2ljYWxTaGFwZXModGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFByb3BlcnR5IG5hbWUuXG4gICAgICogQHBhcmFtIHsqfSBvbGRWYWx1ZSAtIFByZXZpb3VzIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eS5cbiAgICAgKiBAcGFyYW0geyp9IG5ld1ZhbHVlIC0gTmV3IHZhbHVlIG9mIHRoZSBwcm9wZXJ0eS5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIG9uU2V0TW9kZWwobmFtZSwgb2xkVmFsdWUsIG5ld1ZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLmRhdGEuaW5pdGlhbGl6ZWQgJiYgdGhpcy5kYXRhLnR5cGUgPT09ICdtZXNoJykge1xuICAgICAgICAgICAgLy8gcmVjcmVhdGUgcGh5c2ljYWwgc2hhcGVzIHNraXBwaW5nIGxvYWRpbmcgdGhlIG1vZGVsXG4gICAgICAgICAgICAvLyBmcm9tIHRoZSAnYXNzZXQnIGFzIHRoZSBtb2RlbCBwYXNzZWQgaW4gbmV3VmFsdWUgbWlnaHRcbiAgICAgICAgICAgIC8vIGhhdmUgYmVlbiBjcmVhdGVkIHByb2NlZHVyYWxseVxuICAgICAgICAgICAgdGhpcy5zeXN0ZW0uaW1wbGVtZW50YXRpb25zLm1lc2guZG9SZWNyZWF0ZVBoeXNpY2FsU2hhcGUodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFByb3BlcnR5IG5hbWUuXG4gICAgICogQHBhcmFtIHsqfSBvbGRWYWx1ZSAtIFByZXZpb3VzIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eS5cbiAgICAgKiBAcGFyYW0geyp9IG5ld1ZhbHVlIC0gTmV3IHZhbHVlIG9mIHRoZSBwcm9wZXJ0eS5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIG9uU2V0UmVuZGVyKG5hbWUsIG9sZFZhbHVlLCBuZXdWYWx1ZSkge1xuICAgICAgICB0aGlzLm9uU2V0TW9kZWwobmFtZSwgb2xkVmFsdWUsIG5ld1ZhbHVlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0Fzc2V0fSBhc3NldCAtIEFzc2V0IHRoYXQgd2FzIHJlbW92ZWQuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBvbkFzc2V0UmVtb3ZlZChhc3NldCkge1xuICAgICAgICBhc3NldC5vZmYoJ3JlbW92ZScsIHRoaXMub25Bc3NldFJlbW92ZWQsIHRoaXMpO1xuICAgICAgICBpZiAodGhpcy5kYXRhLmFzc2V0ID09PSBhc3NldC5pZCkge1xuICAgICAgICAgICAgdGhpcy5hc3NldCA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0Fzc2V0fSBhc3NldCAtIEFzc2V0IHRoYXQgd2FzIHJlbW92ZWQuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBvblJlbmRlckFzc2V0UmVtb3ZlZChhc3NldCkge1xuICAgICAgICBhc3NldC5vZmYoJ3JlbW92ZScsIHRoaXMub25SZW5kZXJBc3NldFJlbW92ZWQsIHRoaXMpO1xuICAgICAgICBpZiAodGhpcy5kYXRhLnJlbmRlckFzc2V0ID09PSBhc3NldC5pZCkge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJBc3NldCA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0geyp9IHNoYXBlIC0gQW1tbyBzaGFwZS5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfG51bGx9IFRoZSBzaGFwZSdzIGluZGV4IGluIHRoZSBjaGlsZCBhcnJheSBvZiB0aGUgY29tcG91bmQgc2hhcGUuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZ2V0Q29tcG91bmRDaGlsZFNoYXBlSW5kZXgoc2hhcGUpIHtcbiAgICAgICAgY29uc3QgY29tcG91bmQgPSB0aGlzLmRhdGEuc2hhcGU7XG4gICAgICAgIGNvbnN0IHNoYXBlcyA9IGNvbXBvdW5kLmdldE51bUNoaWxkU2hhcGVzKCk7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGFwZXM7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgY2hpbGRTaGFwZSA9IGNvbXBvdW5kLmdldENoaWxkU2hhcGUoaSk7XG4gICAgICAgICAgICBpZiAoY2hpbGRTaGFwZS5wdHIgPT09IHNoYXBlLnB0cikge1xuICAgICAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtHcmFwaE5vZGV9IHBhcmVudCAtIFRoZSBwYXJlbnQgbm9kZS5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9vbkluc2VydChwYXJlbnQpIHtcbiAgICAgICAgLy8gVE9ET1xuICAgICAgICAvLyBpZiBpcyBjaGlsZCBvZiBjb21wb3VuZCBzaGFwZVxuICAgICAgICAvLyBhbmQgdGhlcmUgaXMgbm8gY2hhbmdlIG9mIGNvbXBvdW5kUGFyZW50LCB0aGVuIHVwZGF0ZSBjaGlsZCB0cmFuc2Zvcm1cbiAgICAgICAgLy8gb25jZSB1cGRhdGVDaGlsZFRyYW5zZm9ybSBpcyBleHBvc2VkIGluIGFtbW8uanNcblxuICAgICAgICBpZiAodHlwZW9mIEFtbW8gPT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIGlmICh0aGlzLl9jb21wb3VuZFBhcmVudCkge1xuICAgICAgICAgICAgdGhpcy5zeXN0ZW0ucmVjcmVhdGVQaHlzaWNhbFNoYXBlcyh0aGlzKTtcbiAgICAgICAgfSBlbHNlIGlmICghdGhpcy5lbnRpdHkucmlnaWRib2R5KSB7XG4gICAgICAgICAgICBsZXQgYW5jZXN0b3IgPSB0aGlzLmVudGl0eS5wYXJlbnQ7XG4gICAgICAgICAgICB3aGlsZSAoYW5jZXN0b3IpIHtcbiAgICAgICAgICAgICAgICBpZiAoYW5jZXN0b3IuY29sbGlzaW9uICYmIGFuY2VzdG9yLmNvbGxpc2lvbi50eXBlID09PSAnY29tcG91bmQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhbmNlc3Rvci5jb2xsaXNpb24uc2hhcGUuZ2V0TnVtQ2hpbGRTaGFwZXMoKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zeXN0ZW0ucmVjcmVhdGVQaHlzaWNhbFNoYXBlcyhhbmNlc3Rvci5jb2xsaXNpb24pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zeXN0ZW0ucmVjcmVhdGVQaHlzaWNhbFNoYXBlcyh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYW5jZXN0b3IgPSBhbmNlc3Rvci5wYXJlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogQHByaXZhdGUgKi9cbiAgICBfdXBkYXRlQ29tcG91bmQoKSB7XG4gICAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuZW50aXR5O1xuICAgICAgICBpZiAoZW50aXR5Ll9kaXJ0eVdvcmxkKSB7XG4gICAgICAgICAgICBsZXQgZGlydHkgPSBlbnRpdHkuX2RpcnR5TG9jYWw7XG4gICAgICAgICAgICBsZXQgcGFyZW50ID0gZW50aXR5O1xuICAgICAgICAgICAgd2hpbGUgKHBhcmVudCAmJiAhZGlydHkpIHtcbiAgICAgICAgICAgICAgICBpZiAocGFyZW50LmNvbGxpc2lvbiAmJiBwYXJlbnQuY29sbGlzaW9uID09PSB0aGlzLl9jb21wb3VuZFBhcmVudClcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBpZiAocGFyZW50Ll9kaXJ0eUxvY2FsKVxuICAgICAgICAgICAgICAgICAgICBkaXJ0eSA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZGlydHkpIHtcbiAgICAgICAgICAgICAgICBlbnRpdHkuZm9yRWFjaCh0aGlzLnN5c3RlbS5pbXBsZW1lbnRhdGlvbnMuY29tcG91bmQuX3VwZGF0ZUVhY2hEZXNjZW5kYW50VHJhbnNmb3JtLCBlbnRpdHkpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgYm9keUNvbXBvbmVudCA9IHRoaXMuX2NvbXBvdW5kUGFyZW50LmVudGl0eS5yaWdpZGJvZHk7XG4gICAgICAgICAgICAgICAgaWYgKGJvZHlDb21wb25lbnQpXG4gICAgICAgICAgICAgICAgICAgIGJvZHlDb21wb25lbnQuYWN0aXZhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBAcHJpdmF0ZSAqL1xuICAgIG9uRW5hYmxlKCkge1xuICAgICAgICBpZiAodGhpcy5kYXRhLnR5cGUgPT09ICdtZXNoJyAmJiAodGhpcy5kYXRhLmFzc2V0IHx8IHRoaXMuZGF0YS5yZW5kZXJBc3NldCkgJiYgdGhpcy5kYXRhLmluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICBjb25zdCBhc3NldCA9IHRoaXMuc3lzdGVtLmFwcC5hc3NldHMuZ2V0KHRoaXMuZGF0YS5hc3NldCB8fCB0aGlzLmRhdGEucmVuZGVyQXNzZXQpO1xuICAgICAgICAgICAgLy8gcmVjcmVhdGUgdGhlIGNvbGxpc2lvbiBzaGFwZSBpZiB0aGUgbW9kZWwgYXNzZXQgaXMgbm90IGxvYWRlZFxuICAgICAgICAgICAgLy8gb3IgdGhlIHNoYXBlIGRvZXMgbm90IGV4aXN0XG4gICAgICAgICAgICBpZiAoYXNzZXQgJiYgKCFhc3NldC5yZXNvdXJjZSB8fCAhdGhpcy5kYXRhLnNoYXBlKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3lzdGVtLnJlY3JlYXRlUGh5c2ljYWxTaGFwZXModGhpcyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZW50aXR5LnJpZ2lkYm9keSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZW50aXR5LnJpZ2lkYm9keS5lbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbnRpdHkucmlnaWRib2R5LmVuYWJsZVNpbXVsYXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9jb21wb3VuZFBhcmVudCAmJiB0aGlzICE9PSB0aGlzLl9jb21wb3VuZFBhcmVudCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbXBvdW5kUGFyZW50LnNoYXBlLmdldE51bUNoaWxkU2hhcGVzKCkgPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN5c3RlbS5yZWNyZWF0ZVBoeXNpY2FsU2hhcGVzKHRoaXMuX2NvbXBvdW5kUGFyZW50KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdHJhbnNmb3JtID0gdGhpcy5zeXN0ZW0uX2dldE5vZGVUcmFuc2Zvcm0odGhpcy5lbnRpdHksIHRoaXMuX2NvbXBvdW5kUGFyZW50LmVudGl0eSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29tcG91bmRQYXJlbnQuc2hhcGUuYWRkQ2hpbGRTaGFwZSh0cmFuc2Zvcm0sIHRoaXMuZGF0YS5zaGFwZSk7XG4gICAgICAgICAgICAgICAgQW1tby5kZXN0cm95KHRyYW5zZm9ybSk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY29tcG91bmRQYXJlbnQuZW50aXR5LnJpZ2lkYm9keSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29tcG91bmRQYXJlbnQuZW50aXR5LnJpZ2lkYm9keS5hY3RpdmF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZW50aXR5LnRyaWdnZXIpIHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5LnRyaWdnZXIuZW5hYmxlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogQHByaXZhdGUgKi9cbiAgICBvbkRpc2FibGUoKSB7XG4gICAgICAgIGlmICh0aGlzLmVudGl0eS5yaWdpZGJvZHkpIHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5LnJpZ2lkYm9keS5kaXNhYmxlU2ltdWxhdGlvbigpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2NvbXBvdW5kUGFyZW50ICYmIHRoaXMgIT09IHRoaXMuX2NvbXBvdW5kUGFyZW50KSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2NvbXBvdW5kUGFyZW50LmVudGl0eS5fZGVzdHJveWluZykge1xuICAgICAgICAgICAgICAgIHRoaXMuc3lzdGVtLl9yZW1vdmVDb21wb3VuZENoaWxkKHRoaXMuX2NvbXBvdW5kUGFyZW50LCB0aGlzLmRhdGEuc2hhcGUpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbXBvdW5kUGFyZW50LmVudGl0eS5yaWdpZGJvZHkpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NvbXBvdW5kUGFyZW50LmVudGl0eS5yaWdpZGJvZHkuYWN0aXZhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVudGl0eS50cmlnZ2VyKSB7XG4gICAgICAgICAgICB0aGlzLmVudGl0eS50cmlnZ2VyLmRpc2FibGUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBAcHJpdmF0ZSAqL1xuICAgIG9uQmVmb3JlUmVtb3ZlKCkge1xuICAgICAgICBpZiAodGhpcy5hc3NldCkge1xuICAgICAgICAgICAgdGhpcy5hc3NldCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucmVuZGVyQXNzZXQpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyQXNzZXQgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lbnRpdHkub2ZmKCdpbnNlcnQnLCB0aGlzLl9vbkluc2VydCwgdGhpcyk7XG5cbiAgICAgICAgdGhpcy5vZmYoKTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IENvbGxpc2lvbkNvbXBvbmVudCB9O1xuIl0sIm5hbWVzIjpbIkNvbGxpc2lvbkNvbXBvbmVudCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwic3lzdGVtIiwiZW50aXR5IiwiX2NvbXBvdW5kUGFyZW50Iiwib24iLCJfb25JbnNlcnQiLCJvblNldFR5cGUiLCJvblNldEhhbGZFeHRlbnRzIiwib25TZXRSYWRpdXMiLCJvblNldEhlaWdodCIsIm9uU2V0QXhpcyIsIm9uU2V0QXNzZXQiLCJvblNldFJlbmRlckFzc2V0Iiwib25TZXRNb2RlbCIsIm9uU2V0UmVuZGVyIiwibmFtZSIsIm9sZFZhbHVlIiwibmV3VmFsdWUiLCJjaGFuZ2VUeXBlIiwidCIsImRhdGEiLCJ0eXBlIiwiaW5pdGlhbGl6ZWQiLCJyZWNyZWF0ZVBoeXNpY2FsU2hhcGVzIiwiYXNzZXRzIiwiYXBwIiwiYXNzZXQiLCJnZXQiLCJvZmYiLCJvbkFzc2V0UmVtb3ZlZCIsIkFzc2V0IiwiaWQiLCJtb2RlbCIsIm9uUmVuZGVyQXNzZXRSZW1vdmVkIiwicmVuZGVyQXNzZXQiLCJyZW5kZXIiLCJpbXBsZW1lbnRhdGlvbnMiLCJtZXNoIiwiZG9SZWNyZWF0ZVBoeXNpY2FsU2hhcGUiLCJfZ2V0Q29tcG91bmRDaGlsZFNoYXBlSW5kZXgiLCJzaGFwZSIsImNvbXBvdW5kIiwic2hhcGVzIiwiZ2V0TnVtQ2hpbGRTaGFwZXMiLCJpIiwiY2hpbGRTaGFwZSIsImdldENoaWxkU2hhcGUiLCJwdHIiLCJwYXJlbnQiLCJBbW1vIiwicmlnaWRib2R5IiwiYW5jZXN0b3IiLCJjb2xsaXNpb24iLCJfdXBkYXRlQ29tcG91bmQiLCJfZGlydHlXb3JsZCIsImRpcnR5IiwiX2RpcnR5TG9jYWwiLCJmb3JFYWNoIiwiX3VwZGF0ZUVhY2hEZXNjZW5kYW50VHJhbnNmb3JtIiwiYm9keUNvbXBvbmVudCIsImFjdGl2YXRlIiwib25FbmFibGUiLCJyZXNvdXJjZSIsImVuYWJsZWQiLCJlbmFibGVTaW11bGF0aW9uIiwidHJhbnNmb3JtIiwiX2dldE5vZGVUcmFuc2Zvcm0iLCJhZGRDaGlsZFNoYXBlIiwiZGVzdHJveSIsInRyaWdnZXIiLCJlbmFibGUiLCJvbkRpc2FibGUiLCJkaXNhYmxlU2ltdWxhdGlvbiIsIl9kZXN0cm95aW5nIiwiX3JlbW92ZUNvbXBvdW5kQ2hpbGQiLCJkaXNhYmxlIiwib25CZWZvcmVSZW1vdmUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBc0RBLE1BQU1BLGtCQUFrQixTQUFTQyxTQUFTLENBQUM7QUFPdkNDLEVBQUFBLFdBQVcsQ0FBQ0MsTUFBTSxFQUFFQyxNQUFNLEVBQUU7QUFDeEIsSUFBQSxLQUFLLENBQUNELE1BQU0sRUFBRUMsTUFBTSxDQUFDLENBQUE7O0lBR3JCLElBQUksQ0FBQ0MsZUFBZSxHQUFHLElBQUksQ0FBQTtBQUUzQixJQUFBLElBQUksQ0FBQ0QsTUFBTSxDQUFDRSxFQUFFLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQ0MsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFBO0lBRTlDLElBQUksQ0FBQ0QsRUFBRSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUNFLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUN6QyxJQUFJLENBQUNGLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxJQUFJLENBQUNHLGdCQUFnQixFQUFFLElBQUksQ0FBQyxDQUFBO0lBQ3ZELElBQUksQ0FBQ0gsRUFBRSxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUNJLFdBQVcsRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUM3QyxJQUFJLENBQUNKLEVBQUUsQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDSyxXQUFXLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFDN0MsSUFBSSxDQUFDTCxFQUFFLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQ00sU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFBO0lBQ3pDLElBQUks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
