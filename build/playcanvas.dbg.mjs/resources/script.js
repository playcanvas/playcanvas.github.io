/**
 * @license
 * PlayCanvas Engine v1.58.0-dev revision e102f2b2a (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { script } from '../framework/script.js';

class ScriptHandler {
  constructor(app) {
    this.handlerType = "script";
    this._app = app;
    this._scripts = {};
    this._cache = {};
  }

  static _push(Type) {
    if (script.legacy && ScriptHandler._types.length > 0) {
      console.assert('Script Ordering Error. Contact support@playcanvas.com');
    } else {
      ScriptHandler._types.push(Type);
    }
  }

  load(url, callback) {
    if (typeof url === 'string') {
      url = {
        load: url,
        original: url
      };
    }

    const self = this;
    script.app = this._app;

    this._loadScript(url.load, (err, url, extra) => {
      if (!err) {
        if (script.legacy) {
          let Type = null;

          if (ScriptHandler._types.length) {
            Type = ScriptHandler._types.pop();
          }

          if (Type) {
            this._scripts[url] = Type;
          } else {
            Type = null;
          }

          callback(null, Type, extra);
        } else {
          const obj = {};

          for (let i = 0; i < ScriptHandler._types.length; i++) obj[ScriptHandler._types[i].name] = ScriptHandler._types[i];

          ScriptHandler._types.length = 0;
          callback(null, obj, extra);
          delete self._loader._cache[url + 'script'];
        }
      } else {
        callback(err);
      }
    });
  }

  open(url, data) {
    return data;
  }

  patch(asset, assets) {}

  _loadScript(url, callback) {
    const head = document.head;
    const element = document.createElement('script');
    this._cache[url] = element;
    element.async = false;
    element.addEventListener('error', function (e) {
      callback(`Script: ${e.target.src} failed to load`);
    }, false);
    let done = false;

    element.onload = element.onreadystatechange = function () {
      if (!done && (!this.readyState || this.readyState === 'loaded' || this.readyState === 'complete')) {
        done = true;
        callback(null, url, element);
      }
    };

    element.src = url;
    head.appendChild(element);
  }

}

ScriptHandler._types = [];

export { ScriptHandler };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcmVzb3VyY2VzL3NjcmlwdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzY3JpcHQgfSBmcm9tICcuLi9mcmFtZXdvcmsvc2NyaXB0LmpzJztcblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uL2ZyYW1ld29yay9hcHAtYmFzZS5qcycpLkFwcEJhc2V9IEFwcEJhc2UgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2hhbmRsZXIuanMnKS5SZXNvdXJjZUhhbmRsZXJ9IFJlc291cmNlSGFuZGxlciAqL1xuXG4vKipcbiAqIFJlc291cmNlIGhhbmRsZXIgZm9yIGxvYWRpbmcgSmF2YVNjcmlwdCBmaWxlcyBkeW5hbWljYWxseS4gIFR3byB0eXBlcyBvZiBKYXZhU2NyaXB0IGZpbGVzIGNhbiBiZVxuICogbG9hZGVkLCBQbGF5Q2FudmFzIHNjcmlwdHMgd2hpY2ggY29udGFpbiBjYWxscyB0byB7QGxpbmsgY3JlYXRlU2NyaXB0fSwgb3IgcmVndWxhciBKYXZhU2NyaXB0XG4gKiBmaWxlcywgc3VjaCBhcyB0aGlyZC1wYXJ0eSBsaWJyYXJpZXMuXG4gKlxuICogQGltcGxlbWVudHMge1Jlc291cmNlSGFuZGxlcn1cbiAqL1xuY2xhc3MgU2NyaXB0SGFuZGxlciB7XG4gICAgLyoqXG4gICAgICogVHlwZSBvZiB0aGUgcmVzb3VyY2UgdGhlIGhhbmRsZXIgaGFuZGxlcy5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICovXG4gICAgaGFuZGxlclR5cGUgPSBcInNjcmlwdFwiO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IFNjcmlwdEhhbmRsZXIgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0FwcEJhc2V9IGFwcCAtIFRoZSBydW5uaW5nIHtAbGluayBBcHBCYXNlfS5cbiAgICAgKiBAaGlkZWNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoYXBwKSB7XG4gICAgICAgIHRoaXMuX2FwcCA9IGFwcDtcbiAgICAgICAgdGhpcy5fc2NyaXB0cyA9IHsgfTtcbiAgICAgICAgdGhpcy5fY2FjaGUgPSB7IH07XG4gICAgfVxuXG4gICAgc3RhdGljIF90eXBlcyA9IFtdO1xuXG4gICAgc3RhdGljIF9wdXNoKFR5cGUpIHtcbiAgICAgICAgaWYgKHNjcmlwdC5sZWdhY3kgJiYgU2NyaXB0SGFuZGxlci5fdHlwZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc29sZS5hc3NlcnQoJ1NjcmlwdCBPcmRlcmluZyBFcnJvci4gQ29udGFjdCBzdXBwb3J0QHBsYXljYW52YXMuY29tJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBTY3JpcHRIYW5kbGVyLl90eXBlcy5wdXNoKFR5cGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbG9hZCh1cmwsIGNhbGxiYWNrKSB7XG4gICAgICAgIC8vIFNjcmlwdHMgZG9uJ3Qgc3VwcG9ydCBidW5kbGluZyBzaW5jZSB3ZSBjb25jYXRlbmF0ZSB0aGVtLiBCZWxvdyBpcyBmb3IgY29uc2lzdGVuY3kuXG4gICAgICAgIGlmICh0eXBlb2YgdXJsID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdXJsID0ge1xuICAgICAgICAgICAgICAgIGxvYWQ6IHVybCxcbiAgICAgICAgICAgICAgICBvcmlnaW5hbDogdXJsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIHNjcmlwdC5hcHAgPSB0aGlzLl9hcHA7XG5cbiAgICAgICAgdGhpcy5fbG9hZFNjcmlwdCh1cmwubG9hZCwgKGVyciwgdXJsLCBleHRyYSkgPT4ge1xuICAgICAgICAgICAgaWYgKCFlcnIpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2NyaXB0LmxlZ2FjeSkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgVHlwZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIC8vIHBvcCB0aGUgdHlwZSBmcm9tIHRoZSBsb2FkaW5nIHN0YWNrXG4gICAgICAgICAgICAgICAgICAgIGlmIChTY3JpcHRIYW5kbGVyLl90eXBlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFR5cGUgPSBTY3JpcHRIYW5kbGVyLl90eXBlcy5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzdG9yZSBpbmRleGVkIGJ5IFVSTFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2NyaXB0c1t1cmxdID0gVHlwZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFR5cGUgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIHRoZSByZXNvdXJjZVxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBUeXBlLCBleHRyYSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqID0geyB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgU2NyaXB0SGFuZGxlci5fdHlwZXMubGVuZ3RoOyBpKyspXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbU2NyaXB0SGFuZGxlci5fdHlwZXNbaV0ubmFtZV0gPSBTY3JpcHRIYW5kbGVyLl90eXBlc1tpXTtcblxuICAgICAgICAgICAgICAgICAgICBTY3JpcHRIYW5kbGVyLl90eXBlcy5sZW5ndGggPSAwO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIG9iaiwgZXh0cmEpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIG5vIGNhY2hlIGZvciBzY3JpcHRzXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBzZWxmLl9sb2FkZXIuX2NhY2hlW3VybCArICdzY3JpcHQnXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG9wZW4odXJsLCBkYXRhKSB7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cblxuICAgIHBhdGNoKGFzc2V0LCBhc3NldHMpIHsgfVxuXG4gICAgX2xvYWRTY3JpcHQodXJsLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBoZWFkID0gZG9jdW1lbnQuaGVhZDtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgICAgICB0aGlzLl9jYWNoZVt1cmxdID0gZWxlbWVudDtcblxuICAgICAgICAvLyB1c2UgYXN5bmM9ZmFsc2UgdG8gZm9yY2Ugc2NyaXB0cyB0byBleGVjdXRlIGluIG9yZGVyXG4gICAgICAgIGVsZW1lbnQuYXN5bmMgPSBmYWxzZTtcblxuICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKGBTY3JpcHQ6ICR7ZS50YXJnZXQuc3JjfSBmYWlsZWQgdG8gbG9hZGApO1xuICAgICAgICB9LCBmYWxzZSk7XG5cbiAgICAgICAgbGV0IGRvbmUgPSBmYWxzZTtcbiAgICAgICAgZWxlbWVudC5vbmxvYWQgPSBlbGVtZW50Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghZG9uZSAmJiAoIXRoaXMucmVhZHlTdGF0ZSB8fCAodGhpcy5yZWFkeVN0YXRlID09PSAnbG9hZGVkJyB8fCB0aGlzLnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpKSkge1xuICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOyAvLyBwcmV2ZW50IGRvdWJsZSBldmVudCBmaXJpbmdcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCB1cmwsIGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvLyBzZXQgdGhlIHNyYyBhdHRyaWJ1dGUgYWZ0ZXIgdGhlIG9ubG9hZCBjYWxsYmFjayBpcyBzZXQsIHRvIGF2b2lkIGFuIGluc3RhbnQgbG9hZGluZyBmYWlsaW5nIHRvIGZpcmUgdGhlIGNhbGxiYWNrXG4gICAgICAgIGVsZW1lbnQuc3JjID0gdXJsO1xuXG4gICAgICAgIGhlYWQuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgfVxufVxuXG5leHBvcnQgeyBTY3JpcHRIYW5kbGVyIH07XG4iXSwibmFtZXMiOlsiU2NyaXB0SGFuZGxlciIsImNvbnN0cnVjdG9yIiwiYXBwIiwiaGFuZGxlclR5cGUiLCJfYXBwIiwiX3NjcmlwdHMiLCJfY2FjaGUiLCJfcHVzaCIsIlR5cGUiLCJzY3JpcHQiLCJsZWdhY3kiLCJfdHlwZXMiLCJsZW5ndGgiLCJjb25zb2xlIiwiYXNzZXJ0IiwicHVzaCIsImxvYWQiLCJ1cmwiLCJjYWxsYmFjayIsIm9yaWdpbmFsIiwic2VsZiIsIl9sb2FkU2NyaXB0IiwiZXJyIiwiZXh0cmEiLCJwb3AiLCJvYmoiLCJpIiwibmFtZSIsIl9sb2FkZXIiLCJvcGVuIiwiZGF0YSIsInBhdGNoIiwiYXNzZXQiLCJhc3NldHMiLCJoZWFkIiwiZG9jdW1lbnQiLCJlbGVtZW50IiwiY3JlYXRlRWxlbWVudCIsImFzeW5jIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJ0YXJnZXQiLCJzcmMiLCJkb25lIiwib25sb2FkIiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlTdGF0ZSIsImFwcGVuZENoaWxkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBWUEsTUFBTUEsYUFBTixDQUFvQjtFQWNoQkMsV0FBVyxDQUFDQyxHQUFELEVBQU07SUFBQSxJQVJqQkMsQ0FBQUEs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
