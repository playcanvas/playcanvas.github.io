import { Debug } from '../../core/debug.js';
import { EventHandler } from '../../core/event-handler.js';
import { script } from '../script.js';
import { AppBase } from '../app-base.js';
import { ScriptAttributes } from './script-attributes.js';
import { ScriptType } from './script-type.js';
import { ScriptTypes } from './script-types.js';

const reservedScriptNames = new Set(['system', 'entity', 'create', 'destroy', 'swap', 'move', 'data', 'scripts', '_scripts', '_scriptsIndex', '_scriptsData', 'enabled', '_oldState', 'onEnable', 'onDisable', 'onPostStateChange', '_onSetEnabled', '_checkState', '_onBeforeRemove', '_onInitializeAttributes', '_onInitialize', '_onPostInitialize', '_onUpdate', '_onPostUpdate', '_callbacks', 'has', 'get', 'on', 'off', 'fire', 'once', 'hasEvent']);
function getReservedScriptNames() {
  return reservedScriptNames;
}

/**
 * Create and register a new {@link ScriptType}. It returns new class type (constructor function),
 * which is auto-registered to {@link ScriptRegistry} using its name. This is the main interface to
 * create Script Types, to define custom logic using JavaScript, that is used to create interaction
 * for entities.
 *
 * @param {string} name - Unique Name of a Script Type. If a Script Type with the same name has
 * already been registered and the new one has a `swap` method defined in its prototype, then it
 * will perform hot swapping of existing Script Instances on entities using this new Script Type.
 * Note: There is a reserved list of names that cannot be used, such as list below as well as some
 * starting from `_` (underscore): system, entity, create, destroy, swap, move, scripts, onEnable,
 * onDisable, onPostStateChange, has, on, off, fire, once, hasEvent.
 * @param {AppBase} [app] - Optional application handler, to choose which {@link ScriptRegistry}
 * to add a script to. By default it will use `Application.getApplication()` to get current
 * {@link AppBase}.
 * @returns {Class<ScriptType>|null} A class type (constructor function) that inherits {@link ScriptType},
 * which the developer is meant to further extend by adding attributes and prototype methods.
 * Returns null if there was an error.
 * @example
 * var Turning = pc.createScript('turn');
 *
 * // define 'speed' attribute that is available in Editor UI
 * Turning.attributes.add('speed', {
 *     type: 'number',
 *     default: 180,
 *     placeholder: 'deg/s'
 * });
 *
 * // runs every tick
 * Turning.prototype.update = function (dt) {
 *     this.entity.rotate(0, this.speed * dt, 0);
 * };
 */
function createScript(name, app) {
  if (script.legacy) {
    Debug.error('This project is using the legacy script system. You cannot call pc.createScript().');
    return null;
  }
  if (reservedScriptNames.has(name)) throw new Error(`Script name '${name}' is reserved, please rename the script`);
  const scriptType = function scriptType(args) {
    EventHandler.prototype.initEventHandler.call(this);
    ScriptType.prototype.initScriptType.call(this, args);
  };
  scriptType.prototype = Object.create(ScriptType.prototype);
  scriptType.prototype.constructor = scriptType;
  scriptType.extend = ScriptType.extend;
  scriptType.attributes = new ScriptAttributes(scriptType);
  registerScript(scriptType, name, app);
  return scriptType;
}

// Editor uses this - migrate to ScriptAttributes.reservedNames and delete this
const reservedAttributes = {};
ScriptAttributes.reservedNames.forEach((value, value2, set) => {
  reservedAttributes[value] = 1;
});
createScript.reservedAttributes = reservedAttributes;

/* eslint-disable jsdoc/check-examples */
/**
 * Register a existing class type as a Script Type to {@link ScriptRegistry}. Useful when defining
 * a ES6 script class that extends {@link ScriptType} (see example).
 *
 * @param {Class<ScriptType>} script - The existing class type (constructor function) to be
 * registered as a Script Type. Class must extend {@link ScriptType} (see example). Please note: A
 * class created using {@link createScript} is auto-registered, and should therefore not be pass
 * into {@link registerScript} (which would result in swapping out all related script instances).
 * @param {string} [name] - Optional unique name of the Script Type. By default it will use the
 * same name as the existing class. If a Script Type with the same name has already been registered
 * and the new one has a `swap` method defined in its prototype, then it will perform hot swapping
 * of existing Script Instances on entities using this new Script Type. Note: There is a reserved
 * list of names that cannot be used, such as list below as well as some starting from `_`
 * (underscore): system, entity, create, destroy, swap, move, scripts, onEnable, onDisable,
 * onPostStateChange, has, on, off, fire, once, hasEvent.
 * @param {AppBase} [app] - Optional application handler, to choose which {@link ScriptRegistry}
 * to register the script type to. By default it will use `Application.getApplication()` to get
 * current {@link AppBase}.
 * @example
 * // define a ES6 script class
 * class PlayerController extends pc.ScriptType {
 *
 *     initialize() {
 *         // called once on initialize
 *     }
 *
 *     update(dt) {
 *         // called each tick
 *     }
 * }
 *
 * // register the class as a script
 * pc.registerScript(PlayerController);
 *
 * // declare script attributes (Must be after pc.registerScript())
 * PlayerController.attributes.add('attribute1', {type: 'number'});
 */
function registerScript(script, name, app) {
  if (script.legacy) {
    Debug.error('This project is using the legacy script system. You cannot call pc.registerScript().');
    return;
  }
  if (typeof script !== 'function') throw new Error(`script class: '${script}' must be a constructor function (i.e. class).`);
  if (!(script.prototype instanceof ScriptType)) throw new Error(`script class: '${ScriptType.__getScriptName(script)}' does not extend pc.ScriptType.`);
  name = name || script.__name || ScriptType.__getScriptName(script);
  if (reservedScriptNames.has(name)) throw new Error(`script name: '${name}' is reserved, please change script name`);
  script.__name = name;

  // add to scripts registry
  const registry = app ? app.scripts : AppBase.getApplication().scripts;
  registry.add(script);
  ScriptTypes.push(script, script.legacy);
}

export { createScript, getReservedScriptNames, registerScript };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL3NjcmlwdC9zY3JpcHQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcgfSBmcm9tICcuLi8uLi9jb3JlL2RlYnVnLmpzJztcbmltcG9ydCB7IEV2ZW50SGFuZGxlciB9IGZyb20gJy4uLy4uL2NvcmUvZXZlbnQtaGFuZGxlci5qcyc7XG5cbmltcG9ydCB7IHNjcmlwdCB9IGZyb20gJy4uL3NjcmlwdC5qcyc7XG5pbXBvcnQgeyBBcHBCYXNlIH0gZnJvbSAnLi4vYXBwLWJhc2UuanMnO1xuXG5pbXBvcnQgeyBTY3JpcHRBdHRyaWJ1dGVzIH0gZnJvbSAnLi9zY3JpcHQtYXR0cmlidXRlcy5qcyc7XG5pbXBvcnQgeyBTY3JpcHRUeXBlIH0gZnJvbSAnLi9zY3JpcHQtdHlwZS5qcyc7XG5pbXBvcnQgeyBTY3JpcHRUeXBlcyB9IGZyb20gJy4vc2NyaXB0LXR5cGVzLmpzJztcblxuY29uc3QgcmVzZXJ2ZWRTY3JpcHROYW1lcyA9IG5ldyBTZXQoW1xuICAgICdzeXN0ZW0nLCAnZW50aXR5JywgJ2NyZWF0ZScsICdkZXN0cm95JywgJ3N3YXAnLCAnbW92ZScsICdkYXRhJyxcbiAgICAnc2NyaXB0cycsICdfc2NyaXB0cycsICdfc2NyaXB0c0luZGV4JywgJ19zY3JpcHRzRGF0YScsXG4gICAgJ2VuYWJsZWQnLCAnX29sZFN0YXRlJywgJ29uRW5hYmxlJywgJ29uRGlzYWJsZScsICdvblBvc3RTdGF0ZUNoYW5nZScsXG4gICAgJ19vblNldEVuYWJsZWQnLCAnX2NoZWNrU3RhdGUnLCAnX29uQmVmb3JlUmVtb3ZlJyxcbiAgICAnX29uSW5pdGlhbGl6ZUF0dHJpYnV0ZXMnLCAnX29uSW5pdGlhbGl6ZScsICdfb25Qb3N0SW5pdGlhbGl6ZScsXG4gICAgJ19vblVwZGF0ZScsICdfb25Qb3N0VXBkYXRlJyxcbiAgICAnX2NhbGxiYWNrcycsICdoYXMnLCAnZ2V0JywgJ29uJywgJ29mZicsICdmaXJlJywgJ29uY2UnLCAnaGFzRXZlbnQnXG5dKTtcblxuZnVuY3Rpb24gZ2V0UmVzZXJ2ZWRTY3JpcHROYW1lcygpIHtcbiAgICByZXR1cm4gcmVzZXJ2ZWRTY3JpcHROYW1lcztcbn1cblxuLyoqXG4gKiBDcmVhdGUgYW5kIHJlZ2lzdGVyIGEgbmV3IHtAbGluayBTY3JpcHRUeXBlfS4gSXQgcmV0dXJucyBuZXcgY2xhc3MgdHlwZSAoY29uc3RydWN0b3IgZnVuY3Rpb24pLFxuICogd2hpY2ggaXMgYXV0by1yZWdpc3RlcmVkIHRvIHtAbGluayBTY3JpcHRSZWdpc3RyeX0gdXNpbmcgaXRzIG5hbWUuIFRoaXMgaXMgdGhlIG1haW4gaW50ZXJmYWNlIHRvXG4gKiBjcmVhdGUgU2NyaXB0IFR5cGVzLCB0byBkZWZpbmUgY3VzdG9tIGxvZ2ljIHVzaW5nIEphdmFTY3JpcHQsIHRoYXQgaXMgdXNlZCB0byBjcmVhdGUgaW50ZXJhY3Rpb25cbiAqIGZvciBlbnRpdGllcy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFVuaXF1ZSBOYW1lIG9mIGEgU2NyaXB0IFR5cGUuIElmIGEgU2NyaXB0IFR5cGUgd2l0aCB0aGUgc2FtZSBuYW1lIGhhc1xuICogYWxyZWFkeSBiZWVuIHJlZ2lzdGVyZWQgYW5kIHRoZSBuZXcgb25lIGhhcyBhIGBzd2FwYCBtZXRob2QgZGVmaW5lZCBpbiBpdHMgcHJvdG90eXBlLCB0aGVuIGl0XG4gKiB3aWxsIHBlcmZvcm0gaG90IHN3YXBwaW5nIG9mIGV4aXN0aW5nIFNjcmlwdCBJbnN0YW5jZXMgb24gZW50aXRpZXMgdXNpbmcgdGhpcyBuZXcgU2NyaXB0IFR5cGUuXG4gKiBOb3RlOiBUaGVyZSBpcyBhIHJlc2VydmVkIGxpc3Qgb2YgbmFtZXMgdGhhdCBjYW5ub3QgYmUgdXNlZCwgc3VjaCBhcyBsaXN0IGJlbG93IGFzIHdlbGwgYXMgc29tZVxuICogc3RhcnRpbmcgZnJvbSBgX2AgKHVuZGVyc2NvcmUpOiBzeXN0ZW0sIGVudGl0eSwgY3JlYXRlLCBkZXN0cm95LCBzd2FwLCBtb3ZlLCBzY3JpcHRzLCBvbkVuYWJsZSxcbiAqIG9uRGlzYWJsZSwgb25Qb3N0U3RhdGVDaGFuZ2UsIGhhcywgb24sIG9mZiwgZmlyZSwgb25jZSwgaGFzRXZlbnQuXG4gKiBAcGFyYW0ge0FwcEJhc2V9IFthcHBdIC0gT3B0aW9uYWwgYXBwbGljYXRpb24gaGFuZGxlciwgdG8gY2hvb3NlIHdoaWNoIHtAbGluayBTY3JpcHRSZWdpc3RyeX1cbiAqIHRvIGFkZCBhIHNjcmlwdCB0by4gQnkgZGVmYXVsdCBpdCB3aWxsIHVzZSBgQXBwbGljYXRpb24uZ2V0QXBwbGljYXRpb24oKWAgdG8gZ2V0IGN1cnJlbnRcbiAqIHtAbGluayBBcHBCYXNlfS5cbiAqIEByZXR1cm5zIHtDbGFzczxTY3JpcHRUeXBlPnxudWxsfSBBIGNsYXNzIHR5cGUgKGNvbnN0cnVjdG9yIGZ1bmN0aW9uKSB0aGF0IGluaGVyaXRzIHtAbGluayBTY3JpcHRUeXBlfSxcbiAqIHdoaWNoIHRoZSBkZXZlbG9wZXIgaXMgbWVhbnQgdG8gZnVydGhlciBleHRlbmQgYnkgYWRkaW5nIGF0dHJpYnV0ZXMgYW5kIHByb3RvdHlwZSBtZXRob2RzLlxuICogUmV0dXJucyBudWxsIGlmIHRoZXJlIHdhcyBhbiBlcnJvci5cbiAqIEBleGFtcGxlXG4gKiB2YXIgVHVybmluZyA9IHBjLmNyZWF0ZVNjcmlwdCgndHVybicpO1xuICpcbiAqIC8vIGRlZmluZSAnc3BlZWQnIGF0dHJpYnV0ZSB0aGF0IGlzIGF2YWlsYWJsZSBpbiBFZGl0b3IgVUlcbiAqIFR1cm5pbmcuYXR0cmlidXRlcy5hZGQoJ3NwZWVkJywge1xuICogICAgIHR5cGU6ICdudW1iZXInLFxuICogICAgIGRlZmF1bHQ6IDE4MCxcbiAqICAgICBwbGFjZWhvbGRlcjogJ2RlZy9zJ1xuICogfSk7XG4gKlxuICogLy8gcnVucyBldmVyeSB0aWNrXG4gKiBUdXJuaW5nLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoZHQpIHtcbiAqICAgICB0aGlzLmVudGl0eS5yb3RhdGUoMCwgdGhpcy5zcGVlZCAqIGR0LCAwKTtcbiAqIH07XG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZVNjcmlwdChuYW1lLCBhcHApIHtcbiAgICBpZiAoc2NyaXB0LmxlZ2FjeSkge1xuICAgICAgICBEZWJ1Zy5lcnJvcignVGhpcyBwcm9qZWN0IGlzIHVzaW5nIHRoZSBsZWdhY3kgc2NyaXB0IHN5c3RlbS4gWW91IGNhbm5vdCBjYWxsIHBjLmNyZWF0ZVNjcmlwdCgpLicpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAocmVzZXJ2ZWRTY3JpcHROYW1lcy5oYXMobmFtZSkpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgU2NyaXB0IG5hbWUgJyR7bmFtZX0nIGlzIHJlc2VydmVkLCBwbGVhc2UgcmVuYW1lIHRoZSBzY3JpcHRgKTtcblxuICAgIGNvbnN0IHNjcmlwdFR5cGUgPSBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICBFdmVudEhhbmRsZXIucHJvdG90eXBlLmluaXRFdmVudEhhbmRsZXIuY2FsbCh0aGlzKTtcbiAgICAgICAgU2NyaXB0VHlwZS5wcm90b3R5cGUuaW5pdFNjcmlwdFR5cGUuY2FsbCh0aGlzLCBhcmdzKTtcbiAgICB9O1xuXG4gICAgc2NyaXB0VHlwZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFNjcmlwdFR5cGUucHJvdG90eXBlKTtcbiAgICBzY3JpcHRUeXBlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IHNjcmlwdFR5cGU7XG5cbiAgICBzY3JpcHRUeXBlLmV4dGVuZCA9IFNjcmlwdFR5cGUuZXh0ZW5kO1xuICAgIHNjcmlwdFR5cGUuYXR0cmlidXRlcyA9IG5ldyBTY3JpcHRBdHRyaWJ1dGVzKHNjcmlwdFR5cGUpO1xuXG4gICAgcmVnaXN0ZXJTY3JpcHQoc2NyaXB0VHlwZSwgbmFtZSwgYXBwKTtcbiAgICByZXR1cm4gc2NyaXB0VHlwZTtcbn1cblxuLy8gRWRpdG9yIHVzZXMgdGhpcyAtIG1pZ3JhdGUgdG8gU2NyaXB0QXR0cmlidXRlcy5yZXNlcnZlZE5hbWVzIGFuZCBkZWxldGUgdGhpc1xuY29uc3QgcmVzZXJ2ZWRBdHRyaWJ1dGVzID0ge307XG5TY3JpcHRBdHRyaWJ1dGVzLnJlc2VydmVkTmFtZXMuZm9yRWFjaCgodmFsdWUsIHZhbHVlMiwgc2V0KSA9PiB7XG4gICAgcmVzZXJ2ZWRBdHRyaWJ1dGVzW3ZhbHVlXSA9IDE7XG59KTtcbmNyZWF0ZVNjcmlwdC5yZXNlcnZlZEF0dHJpYnV0ZXMgPSByZXNlcnZlZEF0dHJpYnV0ZXM7XG5cbi8qIGVzbGludC1kaXNhYmxlIGpzZG9jL2NoZWNrLWV4YW1wbGVzICovXG4vKipcbiAqIFJlZ2lzdGVyIGEgZXhpc3RpbmcgY2xhc3MgdHlwZSBhcyBhIFNjcmlwdCBUeXBlIHRvIHtAbGluayBTY3JpcHRSZWdpc3RyeX0uIFVzZWZ1bCB3aGVuIGRlZmluaW5nXG4gKiBhIEVTNiBzY3JpcHQgY2xhc3MgdGhhdCBleHRlbmRzIHtAbGluayBTY3JpcHRUeXBlfSAoc2VlIGV4YW1wbGUpLlxuICpcbiAqIEBwYXJhbSB7Q2xhc3M8U2NyaXB0VHlwZT59IHNjcmlwdCAtIFRoZSBleGlzdGluZyBjbGFzcyB0eXBlIChjb25zdHJ1Y3RvciBmdW5jdGlvbikgdG8gYmVcbiAqIHJlZ2lzdGVyZWQgYXMgYSBTY3JpcHQgVHlwZS4gQ2xhc3MgbXVzdCBleHRlbmQge0BsaW5rIFNjcmlwdFR5cGV9IChzZWUgZXhhbXBsZSkuIFBsZWFzZSBub3RlOiBBXG4gKiBjbGFzcyBjcmVhdGVkIHVzaW5nIHtAbGluayBjcmVhdGVTY3JpcHR9IGlzIGF1dG8tcmVnaXN0ZXJlZCwgYW5kIHNob3VsZCB0aGVyZWZvcmUgbm90IGJlIHBhc3NcbiAqIGludG8ge0BsaW5rIHJlZ2lzdGVyU2NyaXB0fSAod2hpY2ggd291bGQgcmVzdWx0IGluIHN3YXBwaW5nIG91dCBhbGwgcmVsYXRlZCBzY3JpcHQgaW5zdGFuY2VzKS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBbbmFtZV0gLSBPcHRpb25hbCB1bmlxdWUgbmFtZSBvZiB0aGUgU2NyaXB0IFR5cGUuIEJ5IGRlZmF1bHQgaXQgd2lsbCB1c2UgdGhlXG4gKiBzYW1lIG5hbWUgYXMgdGhlIGV4aXN0aW5nIGNsYXNzLiBJZiBhIFNjcmlwdCBUeXBlIHdpdGggdGhlIHNhbWUgbmFtZSBoYXMgYWxyZWFkeSBiZWVuIHJlZ2lzdGVyZWRcbiAqIGFuZCB0aGUgbmV3IG9uZSBoYXMgYSBgc3dhcGAgbWV0aG9kIGRlZmluZWQgaW4gaXRzIHByb3RvdHlwZSwgdGhlbiBpdCB3aWxsIHBlcmZvcm0gaG90IHN3YXBwaW5nXG4gKiBvZiBleGlzdGluZyBTY3JpcHQgSW5zdGFuY2VzIG9uIGVudGl0aWVzIHVzaW5nIHRoaXMgbmV3IFNjcmlwdCBUeXBlLiBOb3RlOiBUaGVyZSBpcyBhIHJlc2VydmVkXG4gKiBsaXN0IG9mIG5hbWVzIHRoYXQgY2Fubm90IGJlIHVzZWQsIHN1Y2ggYXMgbGlzdCBiZWxvdyBhcyB3ZWxsIGFzIHNvbWUgc3RhcnRpbmcgZnJvbSBgX2BcbiAqICh1bmRlcnNjb3JlKTogc3lzdGVtLCBlbnRpdHksIGNyZWF0ZSwgZGVzdHJveSwgc3dhcCwgbW92ZSwgc2NyaXB0cywgb25FbmFibGUsIG9uRGlzYWJsZSxcbiAqIG9uUG9zdFN0YXRlQ2hhbmdlLCBoYXMsIG9uLCBvZmYsIGZpcmUsIG9uY2UsIGhhc0V2ZW50LlxuICogQHBhcmFtIHtBcHBCYXNlfSBbYXBwXSAtIE9wdGlvbmFsIGFwcGxpY2F0aW9uIGhhbmRsZXIsIHRvIGNob29zZSB3aGljaCB7QGxpbmsgU2NyaXB0UmVnaXN0cnl9XG4gKiB0byByZWdpc3RlciB0aGUgc2NyaXB0IHR5cGUgdG8uIEJ5IGRlZmF1bHQgaXQgd2lsbCB1c2UgYEFwcGxpY2F0aW9uLmdldEFwcGxpY2F0aW9uKClgIHRvIGdldFxuICogY3VycmVudCB7QGxpbmsgQXBwQmFzZX0uXG4gKiBAZXhhbXBsZVxuICogLy8gZGVmaW5lIGEgRVM2IHNjcmlwdCBjbGFzc1xuICogY2xhc3MgUGxheWVyQ29udHJvbGxlciBleHRlbmRzIHBjLlNjcmlwdFR5cGUge1xuICpcbiAqICAgICBpbml0aWFsaXplKCkge1xuICogICAgICAgICAvLyBjYWxsZWQgb25jZSBvbiBpbml0aWFsaXplXG4gKiAgICAgfVxuICpcbiAqICAgICB1cGRhdGUoZHQpIHtcbiAqICAgICAgICAgLy8gY2FsbGVkIGVhY2ggdGlja1xuICogICAgIH1cbiAqIH1cbiAqXG4gKiAvLyByZWdpc3RlciB0aGUgY2xhc3MgYXMgYSBzY3JpcHRcbiAqIHBjLnJlZ2lzdGVyU2NyaXB0KFBsYXllckNvbnRyb2xsZXIpO1xuICpcbiAqIC8vIGRlY2xhcmUgc2NyaXB0IGF0dHJpYnV0ZXMgKE11c3QgYmUgYWZ0ZXIgcGMucmVnaXN0ZXJTY3JpcHQoKSlcbiAqIFBsYXllckNvbnRyb2xsZXIuYXR0cmlidXRlcy5hZGQoJ2F0dHJpYnV0ZTEnLCB7dHlwZTogJ251bWJlcid9KTtcbiAqL1xuZnVuY3Rpb24gcmVnaXN0ZXJTY3JpcHQoc2NyaXB0LCBuYW1lLCBhcHApIHtcbiAgICBpZiAoc2NyaXB0LmxlZ2FjeSkge1xuICAgICAgICBEZWJ1Zy5lcnJvcignVGhpcyBwcm9qZWN0IGlzIHVzaW5nIHRoZSBsZWdhY3kgc2NyaXB0IHN5c3RlbS4gWW91IGNhbm5vdCBjYWxsIHBjLnJlZ2lzdGVyU2NyaXB0KCkuJyk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHNjcmlwdCAhPT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBzY3JpcHQgY2xhc3M6ICcke3NjcmlwdH0nIG11c3QgYmUgYSBjb25zdHJ1Y3RvciBmdW5jdGlvbiAoaS5lLiBjbGFzcykuYCk7XG5cbiAgICBpZiAoIShzY3JpcHQucHJvdG90eXBlIGluc3RhbmNlb2YgU2NyaXB0VHlwZSkpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgc2NyaXB0IGNsYXNzOiAnJHtTY3JpcHRUeXBlLl9fZ2V0U2NyaXB0TmFtZShzY3JpcHQpfScgZG9lcyBub3QgZXh0ZW5kIHBjLlNjcmlwdFR5cGUuYCk7XG5cbiAgICBuYW1lID0gbmFtZSB8fCBzY3JpcHQuX19uYW1lIHx8IFNjcmlwdFR5cGUuX19nZXRTY3JpcHROYW1lKHNjcmlwdCk7XG5cbiAgICBpZiAocmVzZXJ2ZWRTY3JpcHROYW1lcy5oYXMobmFtZSkpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgc2NyaXB0IG5hbWU6ICcke25hbWV9JyBpcyByZXNlcnZlZCwgcGxlYXNlIGNoYW5nZSBzY3JpcHQgbmFtZWApO1xuXG4gICAgc2NyaXB0Ll9fbmFtZSA9IG5hbWU7XG5cbiAgICAvLyBhZGQgdG8gc2NyaXB0cyByZWdpc3RyeVxuICAgIGNvbnN0IHJlZ2lzdHJ5ID0gYXBwID8gYXBwLnNjcmlwdHMgOiBBcHBCYXNlLmdldEFwcGxpY2F0aW9uKCkuc2NyaXB0cztcbiAgICByZWdpc3RyeS5hZGQoc2NyaXB0KTtcblxuICAgIFNjcmlwdFR5cGVzLnB1c2goc2NyaXB0LCBzY3JpcHQubGVnYWN5KTtcbn1cbi8qIGVzbGludC1lbmFibGUganNkb2MvY2hlY2stZXhhbXBsZXMgKi9cblxuZXhwb3J0IHsgY3JlYXRlU2NyaXB0LCByZWdpc3RlclNjcmlwdCwgZ2V0UmVzZXJ2ZWRTY3JpcHROYW1lcyB9O1xuIl0sIm5hbWVzIjpbInJlc2VydmVkU2NyaXB0TmFtZXMiLCJTZXQiLCJnZXRSZXNlcnZlZFNjcmlwdE5hbWVzIiwiY3JlYXRlU2NyaXB0IiwibmFtZSIsImFwcCIsInNjcmlwdCIsImxlZ2FjeSIsIkRlYnVnIiwiZXJyb3IiLCJoYXMiLCJFcnJvciIsInNjcmlwdFR5cGUiLCJhcmdzIiwiRXZlbnRIYW5kbGVyIiwicHJvdG90eXBlIiwiaW5pdEV2ZW50SGFuZGxlciIsImNhbGwiLCJTY3JpcHRUeXBlIiwiaW5pdFNjcmlwdFR5cGUiLCJPYmplY3QiLCJjcmVhdGUiLCJjb25zdHJ1Y3RvciIsImV4dGVuZCIsImF0dHJpYnV0ZXMiLCJTY3JpcHRBdHRyaWJ1dGVzIiwicmVnaXN0ZXJTY3JpcHQiLCJyZXNlcnZlZEF0dHJpYnV0ZXMiLCJyZXNlcnZlZE5hbWVzIiwiZm9yRWFjaCIsInZhbHVlIiwidmFsdWUyIiwic2V0IiwiX19nZXRTY3JpcHROYW1lIiwiX19uYW1lIiwicmVnaXN0cnkiLCJzY3JpcHRzIiwiQXBwQmFzZSIsImdldEFwcGxpY2F0aW9uIiwiYWRkIiwiU2NyaXB0VHlwZXMiLCJwdXNoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQVVBLE1BQU1BLG1CQUFtQixHQUFHLElBQUlDLEdBQUcsQ0FBQyxDQUNoQyxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQy9ELFNBQVMsRUFBRSxVQUFVLEVBQUUsZUFBZSxFQUFFLGNBQWMsRUFDdEQsU0FBUyxFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLG1CQUFtQixFQUNwRSxlQUFlLEVBQUUsYUFBYSxFQUFFLGlCQUFpQixFQUNqRCx5QkFBeUIsRUFBRSxlQUFlLEVBQUUsbUJBQW1CLEVBQy9ELFdBQVcsRUFBRSxlQUFlLEVBQzVCLFlBQVksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxVQUFVLENBQ3RFLENBQUMsQ0FBQTtBQUVGLFNBQVNDLHNCQUFzQkEsR0FBRztBQUM5QixFQUFBLE9BQU9GLG1CQUFtQixDQUFBO0FBQzlCLENBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBU0csWUFBWUEsQ0FBQ0MsSUFBSSxFQUFFQyxHQUFHLEVBQUU7RUFDN0IsSUFBSUMsTUFBTSxDQUFDQyxNQUFNLEVBQUU7QUFDZkMsSUFBQUEsS0FBSyxDQUFDQyxLQUFLLENBQUMs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
