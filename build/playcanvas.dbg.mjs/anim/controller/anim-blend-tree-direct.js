/**
 * @license
 * PlayCanvas Engine v1.57.0 revision f1998a31e (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { AnimBlendTree } from './anim-blend-tree.js';

class AnimBlendTreeDirect extends AnimBlendTree {
  calculateWeights() {
    if (this.updateParameterValues()) return;
    let weightSum = 0.0;
    let weightedDurationSum = 0.0;

    for (let i = 0; i < this._children.length; i++) {
      weightSum += Math.max(this._parameterValues[i], 0.0);

      if (this._syncAnimations) {
        const child = this._children[i];
        weightedDurationSum += child.animTrack.duration / child.absoluteSpeed * child.weight;
      }
    }

    for (let i = 0; i < this._children.length; i++) {
      const child = this._children[i];
      const weight = Math.max(this._parameterValues[i], 0.0);

      if (weightSum) {
        child.weight = weight / weightSum;

        if (this._syncAnimations) {
          child.weightedSpeed = child.animTrack.duration / child.absoluteSpeed / weightedDurationSum;
        }
      } else {
        child.weight = 0.0;

        if (this._syncAnimations) {
          child.weightedSpeed = 0;
        }
      }
    }
  }

}

export { AnimBlendTreeDirect };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5pbS1ibGVuZC10cmVlLWRpcmVjdC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2FuaW0vY29udHJvbGxlci9hbmltLWJsZW5kLXRyZWUtZGlyZWN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFuaW1CbGVuZFRyZWUgfSBmcm9tICcuL2FuaW0tYmxlbmQtdHJlZS5qcyc7XG5cbi8qKlxuICogQW4gQW5pbUJsZW5kVHJlZSB0aGF0IGNhbGN1bGF0ZXMgbm9ybWFsaXplZCB3ZWlnaHQgdmFsdWVzIGJhc2VkIG9uIHRoZSB0b3RhbCB3ZWlnaHQuXG4gKlxuICogQGlnbm9yZVxuICovXG5jbGFzcyBBbmltQmxlbmRUcmVlRGlyZWN0IGV4dGVuZHMgQW5pbUJsZW5kVHJlZSB7XG4gICAgY2FsY3VsYXRlV2VpZ2h0cygpIHtcbiAgICAgICAgaWYgKHRoaXMudXBkYXRlUGFyYW1ldGVyVmFsdWVzKCkpIHJldHVybjtcbiAgICAgICAgbGV0IHdlaWdodFN1bSA9IDAuMDtcbiAgICAgICAgbGV0IHdlaWdodGVkRHVyYXRpb25TdW0gPSAwLjA7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHdlaWdodFN1bSArPSBNYXRoLm1heCh0aGlzLl9wYXJhbWV0ZXJWYWx1ZXNbaV0sIDAuMCk7XG4gICAgICAgICAgICBpZiAodGhpcy5fc3luY0FuaW1hdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZCA9IHRoaXMuX2NoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgIHdlaWdodGVkRHVyYXRpb25TdW0gKz0gY2hpbGQuYW5pbVRyYWNrLmR1cmF0aW9uIC8gY2hpbGQuYWJzb2x1dGVTcGVlZCAqIGNoaWxkLndlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX2NoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBjaGlsZCA9IHRoaXMuX2NoaWxkcmVuW2ldO1xuICAgICAgICAgICAgY29uc3Qgd2VpZ2h0ID0gTWF0aC5tYXgodGhpcy5fcGFyYW1ldGVyVmFsdWVzW2ldLCAwLjApO1xuICAgICAgICAgICAgaWYgKHdlaWdodFN1bSkge1xuICAgICAgICAgICAgICAgIGNoaWxkLndlaWdodCA9IHdlaWdodCAvIHdlaWdodFN1bTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fc3luY0FuaW1hdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgY2hpbGQud2VpZ2h0ZWRTcGVlZCA9IGNoaWxkLmFuaW1UcmFjay5kdXJhdGlvbiAvIGNoaWxkLmFic29sdXRlU3BlZWQgLyB3ZWlnaHRlZER1cmF0aW9uU3VtO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY2hpbGQud2VpZ2h0ID0gMC4wO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zeW5jQW5pbWF0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBjaGlsZC53ZWlnaHRlZFNwZWVkID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCB7IEFuaW1CbGVuZFRyZWVEaXJlY3QgfTtcbiJdLCJuYW1lcyI6WyJBbmltQmxlbmRUcmVlRGlyZWN0IiwiQW5pbUJsZW5kVHJlZSIsImNhbGN1bGF0ZVdlaWdodHMiLCJ1cGRhdGVQYXJhbWV0ZXJWYWx1ZXMiLCJ3ZWlnaHRTdW0iLCJ3ZWlnaHRlZER1cmF0aW9uU3VtIiwiaSIsIl9jaGlsZHJlbiIsImxlbmd0aCIsIk1hdGgiLCJtYXgiLCJfcGFyYW1ldGVyVmFsdWVzIiwiX3N5bmNBbmltYXRpb25zIiwiY2hpbGQiLCJhbmltVHJhY2siLCJkdXJhdGlvbiIsImFic29sdXRlU3BlZWQiLCJ3ZWlnaHQiLCJ3ZWlnaHRlZFNwZWVkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBT0EsTUFBTUEsbUJBQU4sU0FBa0NDLGFBQWxDLENBQWdEO0FBQzVDQyxFQUFBQSxnQkFBZ0IsR0FBRztJQUNmLElBQUksSUFBQSxDQUFLQyxxQkFBTCxFQUFKLEVBQWtDLE9BQUE7SUFDbEMsSUFBSUMsU0FBUyxHQUFHLEdBQWhCLENBQUE7SUFDQSxJQUFJQyxtQkFBbUIsR0FBRyxHQUExQixDQUFBOztBQUNBLElBQUEsS0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHLElBQUtDLENBQUFBLFNBQUwsQ0FBZUMsTUFBbkMsRUFBMkNGLENBQUMsRUFBNUMsRUFBZ0Q7QUFDNUNGLE1BQUFBLFNBQVMsSUFBSUssSUFBSSxDQUFDQyxHQUFMLENBQVMsSUFBQSxDQUFLQyxnQkFBTCxDQUFzQkwsQ0FBdEIsQ0FBVCxFQUFtQyxHQUFuQyxDQUFiLENBQUE7O01BQ0EsSUFBSSxJQUFBLENBQUtNLGVBQVQsRUFBMEI7QUFDdEIsUUFBQSxNQUFNQyxLQUFLLEdBQUcsSUFBQSxDQUFLTixTQUFMLENBQWVELENBQWYsQ0FBZCxDQUFBO0FBQ0FELFFBQUFBLG1CQUFtQixJQUFJUSxLQUFLLENBQUNDLFNBQU4sQ0FBZ0JDLFFBQWhCLEdBQTJCRixLQUFLLENBQUNHLGFBQWpDLEdBQWlESCxLQUFLLENBQUNJLE1BQTlFLENBQUE7QUFDSCxPQUFBO0FBQ0osS0FBQTs7QUFDRCxJQUFBLEtBQUssSUFBSVgsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBRyxJQUFLQyxDQUFBQSxTQUFMLENBQWVDLE1BQW5DLEVBQTJDRixDQUFDLEVBQTVDLEVBQWdEO0FBQzVDLE1BQUEsTUFBTU8sS0FBSyxHQUFHLElBQUEsQ0FBS04sU0FBTCxDQUFlRCxDQUFmLENBQWQsQ0FBQTtBQUNBLE1BQUEsTUFBTVcsTUFBTSxHQUFHUixJQUFJLENBQUNDLEdBQUwsQ0FBUyxJQUFLQyxDQUFBQSxnQkFBTCxDQUFzQkwsQ0FBdEIsQ0FBVCxFQUFtQyxHQUFuQyxDQUFmLENBQUE7O0FBQ0EsTUFBQSxJQUFJRixTQUFKLEVBQWU7QUFDWFMsUUFBQUEsS0FBSyxDQUFDSSxNQUFOLEdBQWVBLE1BQU0sR0FBR2IsU0FBeEIsQ0FBQTs7UUFDQSxJQUFJLElBQUEsQ0FBS1EsZUFBVCxFQUEwQjtBQUN0QkMsVUFBQUEsS0FBSyxDQUFDSyxhQUFOLEdBQXNCTCxLQUFLLENBQUNDLFNBQU4sQ0FBZ0JDLFFBQWhCLEdBQTJCRixLQUFLLENBQUNHLGFBQWpDLEdBQWlEWCxtQkFBdkUsQ0FBQTtBQUNILFNBQUE7QUFDSixPQUxELE1BS087UUFDSFEsS0FBSyxDQUFDSSxNQUFOLEdBQWUsR0FBZixDQUFBOztRQUNBLElBQUksSUFBQSxDQUFLTCxlQUFULEVBQTBCO1VBQ3RCQyxLQUFLLENBQUNLLGFBQU4sR0FBc0IsQ0FBdEIsQ0FBQTtBQUNILFNBQUE7QUFDSixPQUFBO0FBQ0osS0FBQTtBQUNKLEdBQUE7O0FBM0IyQzs7OzsifQ==
