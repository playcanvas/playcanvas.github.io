/**
 * @license
 * PlayCanvas Engine v1.62.0 revision 818511d2b (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { semanticToLocation, TYPE_INT8, TYPE_UINT8, TYPE_INT16, TYPE_UINT16, TYPE_INT32, TYPE_UINT32, TYPE_FLOAT32 } from '../constants.js';

// map of TYPE_*** to GPUVertexFormat
const gpuVertexFormats = [];
gpuVertexFormats[TYPE_INT8] = 'sint8';
gpuVertexFormats[TYPE_UINT8] = 'uint8';
gpuVertexFormats[TYPE_INT16] = 'sint16';
gpuVertexFormats[TYPE_UINT16] = 'uint16';
gpuVertexFormats[TYPE_INT32] = 'sint32';
gpuVertexFormats[TYPE_UINT32] = 'uint32';
gpuVertexFormats[TYPE_FLOAT32] = 'float32';

/**
 * @ignore
 */
class WebgpuVertexBufferLayout {
  constructor() {
    this.cache = new Map();
  }
  /**
   * Obtain a vertex layout of one or two vertex formats.
   *
   * @param {import('../vertex-format.js').VertexFormat} vertexFormat0 - The first vertex format.
   * @param {import('../vertex-format.js').VertexFormat} [vertexFormat1] - The second vertex format.
   * @returns {any[]} - The vertex layout.
   */
  get(vertexFormat0, vertexFormat1 = null) {
    const key = this.getKey(vertexFormat0, vertexFormat1);
    let layout = this.cache.get(key);
    if (!layout) {
      layout = this.create(vertexFormat0, vertexFormat1);
      this.cache.set(key, layout);
    }
    return layout;
  }
  getKey(vertexFormat0, vertexFormat1 = null) {
    return `VB[${vertexFormat0 == null ? void 0 : vertexFormat0.renderingHashString}, ${vertexFormat1 == null ? void 0 : vertexFormat1.renderingHashString}]`;
  }

  /**
   * @param {import('../vertex-format.js').VertexFormat} vertexFormat0 - The first vertex format.
   * @param {import('../vertex-format.js').VertexFormat} vertexFormat1 - The second vertex format.
   * @returns {any[]} - The vertex buffer layout.
   */
  create(vertexFormat0, vertexFormat1) {
    // type  {GPUVertexBufferLayout[]}
    const layout = [];
    const addFormat = format => {
      const interleaved = format.interleaved;
      const stepMode = format.instancing ? 'instance' : 'vertex';
      let attributes = [];
      const elementCount = format.elements.length;
      for (let i = 0; i < elementCount; i++) {
        const element = format.elements[i];
        const location = semanticToLocation[element.name];
        attributes.push({
          shaderLocation: location,
          offset: interleaved ? element.offset : 0,
          format: `${gpuVertexFormats[element.dataType]}${element.numComponents > 1 ? 'x' + element.numComponents : ''}`
        });
        if (!interleaved || i === elementCount - 1) {
          layout.push({
            attributes: attributes,
            arrayStride: element.stride,
            stepMode: stepMode
          });
          attributes = [];
        }
      }
    };
    if (vertexFormat0) addFormat(vertexFormat0);
    if (vertexFormat1) addFormat(vertexFormat1);
    return layout;
  }
}

export { WebgpuVertexBufferLayout };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViZ3B1LXZlcnRleC1idWZmZXItbGF5b3V0LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvcGxhdGZvcm0vZ3JhcGhpY3Mvd2ViZ3B1L3dlYmdwdS12ZXJ0ZXgtYnVmZmVyLWxheW91dC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIHNlbWFudGljVG9Mb2NhdGlvbixcbiAgICBUWVBFX0lOVDgsIFRZUEVfVUlOVDgsIFRZUEVfSU5UMTYsIFRZUEVfVUlOVDE2LCBUWVBFX0lOVDMyLCBUWVBFX1VJTlQzMiwgVFlQRV9GTE9BVDMyXG59IGZyb20gJy4uL2NvbnN0YW50cy5qcyc7XG5cbi8vIG1hcCBvZiBUWVBFXyoqKiB0byBHUFVWZXJ0ZXhGb3JtYXRcbmNvbnN0IGdwdVZlcnRleEZvcm1hdHMgPSBbXTtcbmdwdVZlcnRleEZvcm1hdHNbVFlQRV9JTlQ4XSA9ICdzaW50OCc7XG5ncHVWZXJ0ZXhGb3JtYXRzW1RZUEVfVUlOVDhdID0gJ3VpbnQ4JztcbmdwdVZlcnRleEZvcm1hdHNbVFlQRV9JTlQxNl0gPSAnc2ludDE2JztcbmdwdVZlcnRleEZvcm1hdHNbVFlQRV9VSU5UMTZdID0gJ3VpbnQxNic7XG5ncHVWZXJ0ZXhGb3JtYXRzW1RZUEVfSU5UMzJdID0gJ3NpbnQzMic7XG5ncHVWZXJ0ZXhGb3JtYXRzW1RZUEVfVUlOVDMyXSA9ICd1aW50MzInO1xuZ3B1VmVydGV4Rm9ybWF0c1tUWVBFX0ZMT0FUMzJdID0gJ2Zsb2F0MzInO1xuXG4vKipcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgV2ViZ3B1VmVydGV4QnVmZmVyTGF5b3V0IHtcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7TWFwPHN0cmluZywgR1BVVmVydGV4QnVmZmVyTGF5b3V0W10+fVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgY2FjaGUgPSBuZXcgTWFwKCk7XG5cbiAgICAvKipcbiAgICAgKiBPYnRhaW4gYSB2ZXJ0ZXggbGF5b3V0IG9mIG9uZSBvciB0d28gdmVydGV4IGZvcm1hdHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vdmVydGV4LWZvcm1hdC5qcycpLlZlcnRleEZvcm1hdH0gdmVydGV4Rm9ybWF0MCAtIFRoZSBmaXJzdCB2ZXJ0ZXggZm9ybWF0LlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi92ZXJ0ZXgtZm9ybWF0LmpzJykuVmVydGV4Rm9ybWF0fSBbdmVydGV4Rm9ybWF0MV0gLSBUaGUgc2Vjb25kIHZlcnRleCBmb3JtYXQuXG4gICAgICogQHJldHVybnMge2FueVtdfSAtIFRoZSB2ZXJ0ZXggbGF5b3V0LlxuICAgICAqL1xuICAgIGdldCh2ZXJ0ZXhGb3JtYXQwLCB2ZXJ0ZXhGb3JtYXQxID0gbnVsbCkge1xuXG4gICAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KHZlcnRleEZvcm1hdDAsIHZlcnRleEZvcm1hdDEpO1xuICAgICAgICBsZXQgbGF5b3V0ID0gdGhpcy5jYWNoZS5nZXQoa2V5KTtcbiAgICAgICAgaWYgKCFsYXlvdXQpIHtcbiAgICAgICAgICAgIGxheW91dCA9IHRoaXMuY3JlYXRlKHZlcnRleEZvcm1hdDAsIHZlcnRleEZvcm1hdDEpO1xuICAgICAgICAgICAgdGhpcy5jYWNoZS5zZXQoa2V5LCBsYXlvdXQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsYXlvdXQ7XG4gICAgfVxuXG4gICAgZ2V0S2V5KHZlcnRleEZvcm1hdDAsIHZlcnRleEZvcm1hdDEgPSBudWxsKSB7XG4gICAgICAgIHJldHVybiBgVkJbJHt2ZXJ0ZXhGb3JtYXQwPy5yZW5kZXJpbmdIYXNoU3RyaW5nfSwgJHt2ZXJ0ZXhGb3JtYXQxPy5yZW5kZXJpbmdIYXNoU3RyaW5nfV1gO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi92ZXJ0ZXgtZm9ybWF0LmpzJykuVmVydGV4Rm9ybWF0fSB2ZXJ0ZXhGb3JtYXQwIC0gVGhlIGZpcnN0IHZlcnRleCBmb3JtYXQuXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uL3ZlcnRleC1mb3JtYXQuanMnKS5WZXJ0ZXhGb3JtYXR9IHZlcnRleEZvcm1hdDEgLSBUaGUgc2Vjb25kIHZlcnRleCBmb3JtYXQuXG4gICAgICogQHJldHVybnMge2FueVtdfSAtIFRoZSB2ZXJ0ZXggYnVmZmVyIGxheW91dC5cbiAgICAgKi9cbiAgICBjcmVhdGUodmVydGV4Rm9ybWF0MCwgdmVydGV4Rm9ybWF0MSkge1xuXG4gICAgICAgIC8vIHR5cGUgIHtHUFVWZXJ0ZXhCdWZmZXJMYXlvdXRbXX1cbiAgICAgICAgY29uc3QgbGF5b3V0ID0gW107XG5cbiAgICAgICAgY29uc3QgYWRkRm9ybWF0ID0gKGZvcm1hdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaW50ZXJsZWF2ZWQgPSBmb3JtYXQuaW50ZXJsZWF2ZWQ7XG4gICAgICAgICAgICBjb25zdCBzdGVwTW9kZSA9IGZvcm1hdC5pbnN0YW5jaW5nID8gJ2luc3RhbmNlJyA6ICd2ZXJ0ZXgnO1xuICAgICAgICAgICAgbGV0IGF0dHJpYnV0ZXMgPSBbXTtcbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRDb3VudCA9IGZvcm1hdC5lbGVtZW50cy5sZW5ndGg7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVsZW1lbnRDb3VudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGZvcm1hdC5lbGVtZW50c1tpXTtcbiAgICAgICAgICAgICAgICBjb25zdCBsb2NhdGlvbiA9IHNlbWFudGljVG9Mb2NhdGlvbltlbGVtZW50Lm5hbWVdO1xuXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgc2hhZGVyTG9jYXRpb246IGxvY2F0aW9uLFxuICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IGludGVybGVhdmVkID8gZWxlbWVudC5vZmZzZXQgOiAwLFxuICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IGAke2dwdVZlcnRleEZvcm1hdHNbZWxlbWVudC5kYXRhVHlwZV19JHtlbGVtZW50Lm51bUNvbXBvbmVudHMgPiAxID8gJ3gnICsgZWxlbWVudC5udW1Db21wb25lbnRzIDogJyd9YFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFpbnRlcmxlYXZlZCB8fCBpID09PSBlbGVtZW50Q291bnQgLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGxheW91dC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IGF0dHJpYnV0ZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnJheVN0cmlkZTogZWxlbWVudC5zdHJpZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGVwTW9kZTogc3RlcE1vZGVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMgPSBbXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHZlcnRleEZvcm1hdDApXG4gICAgICAgICAgICBhZGRGb3JtYXQodmVydGV4Rm9ybWF0MCk7XG5cbiAgICAgICAgaWYgKHZlcnRleEZvcm1hdDEpXG4gICAgICAgICAgICBhZGRGb3JtYXQodmVydGV4Rm9ybWF0MSk7XG5cbiAgICAgICAgcmV0dXJuIGxheW91dDtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFdlYmdwdVZlcnRleEJ1ZmZlckxheW91dCB9O1xuIl0sIm5hbWVzIjpbImdwdVZlcnRleEZvcm1hdHMiLCJUWVBFX0lOVDgiLCJUWVBFX1VJTlQ4IiwiVFlQRV9JTlQxNiIsIlRZUEVfVUlOVDE2IiwiVFlQRV9JTlQzMiIsIlRZUEVfVUlOVDMyIiwiVFlQRV9GTE9BVDMyIiwiV2ViZ3B1VmVydGV4QnVmZmVyTGF5b3V0IiwiY2FjaGUiLCJNYXAiLCJnZXQiLCJ2ZXJ0ZXhGb3JtYXQwIiwidmVydGV4Rm9ybWF0MSIsImtleSIsImdldEtleSIsImxheW91dCIsImNyZWF0ZSIsInNldCIsInJlbmRlcmluZ0hhc2hTdHJpbmciLCJhZGRGb3JtYXQiLCJmb3JtYXQiLCJpbnRlcmxlYXZlZCIsInN0ZXBNb2RlIiwiaW5zdGFuY2luZyIsImF0dHJpYnV0ZXMiLCJlbGVtZW50Q291bnQiLCJlbGVtZW50cyIsImxlbmd0aCIsImkiLCJlbGVtZW50IiwibG9jYXRpb24iLCJzZW1hbnRpY1RvTG9jYXRpb24iLCJuYW1lIiwicHVzaCIsInNoYWRlckxvY2F0aW9uIiwib2Zmc2V0IiwiZGF0YVR5cGUiLCJudW1Db21wb25lbnRzIiwiYXJyYXlTdHJpZGUiLCJzdHJpZGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFLQTtBQUNBLE1BQU1BLGdCQUFnQixHQUFHLEVBQUUsQ0FBQTtBQUMzQkEsZ0JBQWdCLENBQUNDLFNBQVMsQ0FBQyxHQUFHLE9BQU8sQ0FBQTtBQUNyQ0QsZ0JBQWdCLENBQUNFLFVBQVUsQ0FBQyxHQUFHLE9BQU8sQ0FBQTtBQUN0Q0YsZ0JBQWdCLENBQUNHLFVBQVUsQ0FBQyxHQUFHLFFBQVEsQ0FBQTtBQUN2Q0gsZ0JBQWdCLENBQUNJLFdBQVcsQ0FBQyxHQUFHLFFBQVEsQ0FBQTtBQUN4Q0osZ0JBQWdCLENBQUNLLFVBQVUsQ0FBQyxHQUFHLFFBQVEsQ0FBQTtBQUN2Q0wsZ0JBQWdCLENBQUNNLFdBQVcsQ0FBQyxHQUFHLFFBQVEsQ0FBQTtBQUN4Q04sZ0JBQWdCLENBQUNPLFlBQVksQ0FBQyxHQUFHLFNBQVMsQ0FBQTs7QUFFMUM7QUFDQTtBQUNBO0FBQ0EsTUFBTUMsd0JBQXdCLENBQUM7QUFBQSxFQUFBLFdBQUEsR0FBQTtBQUFBLElBQUEsSUFBQSxDQUszQkMsS0FBSyxHQUFHLElBQUlDLEdBQUcsRUFBRSxDQUFBO0FBQUEsR0FBQTtBQUVqQjtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNJQyxFQUFBQSxHQUFHLENBQUNDLGFBQWEsRUFBRUMsYUFBYSxHQUFHLElBQUksRUFBRTtJQUVyQyxNQUFNQyxHQUFHLEdBQUcsSUFB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
