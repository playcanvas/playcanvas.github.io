/**
 * @license
 * PlayCanvas Engine v1.62.0 revision 818511d2b (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { Curve } from '../../../core/math/curve.js';
import { CurveSet } from '../../../core/math/curve-set.js';
import { Vec3 } from '../../../core/math/vec3.js';
import { LIGHTTYPE_DIRECTIONAL } from '../../../scene/constants.js';
import { Asset } from '../../asset/asset.js';
import { Component } from '../component.js';
import { ComponentSystem } from '../system.js';
import { ParticleSystemComponent } from './component.js';
import { ParticleSystemComponentData } from './data.js';

const _schema = ['enabled', 'autoPlay', 'numParticles', 'lifetime', 'rate', 'rate2', 'startAngle', 'startAngle2', 'loop', 'preWarm', 'lighting', 'halfLambert', 'intensity', 'depthWrite', 'noFog', 'depthSoftening', 'sort', 'blendType', 'stretch', 'alignToMotion', 'emitterShape', 'emitterExtents', 'emitterExtentsInner', 'emitterRadius', 'emitterRadiusInner', 'initialVelocity', 'wrap', 'wrapBounds', 'localSpace', 'screenSpace', 'colorMapAsset', 'normalMapAsset', 'mesh', 'meshAsset', 'renderAsset', 'orientation', 'particleNormal', 'localVelocityGraph', 'localVelocityGraph2', 'velocityGraph', 'velocityGraph2', 'rotationSpeedGraph', 'rotationSpeedGraph2', 'radialSpeedGraph', 'radialSpeedGraph2', 'scaleGraph', 'scaleGraph2', 'colorGraph', 'colorGraph2', 'alphaGraph', 'alphaGraph2', 'colorMap', 'normalMap', 'animTilesX', 'animTilesY', 'animStartFrame', 'animNumFrames', 'animNumAnimations', 'animIndex', 'randomizeAnimIndex', 'animSpeed', 'animLoop', 'layers'];

/**
 * Allows an Entity to render a particle system.
 *
 * @augments ComponentSystem
 */
class ParticleSystemComponentSystem extends ComponentSystem {
  /**
   * Create a new ParticleSystemComponentSystem.
   *
   * @param {import('../../app-base.js').AppBase} app - The Application.
   * @hideconstructor
   */
  constructor(app) {
    super(app);
    this.id = 'particlesystem';
    this.ComponentType = ParticleSystemComponent;
    this.DataType = ParticleSystemComponentData;
    this.schema = _schema;
    this.propertyTypes = {
      emitterExtents: 'vec3',
      emitterExtentsInner: 'vec3',
      particleNormal: 'vec3',
      wrapBounds: 'vec3',
      localVelocityGraph: 'curveset',
      localVelocityGraph2: 'curveset',
      velocityGraph: 'curveset',
      velocityGraph2: 'curveset',
      colorGraph: 'curveset',
      colorGraph2: 'curveset',
      alphaGraph: 'curve',
      alphaGraph2: 'curve',
      rotationSpeedGraph: 'curve',
      rotationSpeedGraph2: 'curve',
      radialSpeedGraph: 'curve',
      radialSpeedGraph2: 'curve',
      scaleGraph: 'curve',
      scaleGraph2: 'curve'
    };
    this.on('beforeremove', this.onBeforeRemove, this);
    this.app.systems.on('update', this.onUpdate, this);
  }
  initializeComponentData(component, _data, properties) {
    const data = {};
    properties = [];
    const types = this.propertyTypes;

    // we store the mesh asset id as "mesh" (it should be "meshAsset")
    // this re-maps "mesh" into "meshAsset" if it is an asset or an asset id
    if (_data.mesh instanceof Asset || typeof _data.mesh === 'number') {
      // migrate into meshAsset property
      _data.meshAsset = _data.mesh;
      delete _data.mesh;
    }
    for (const prop in _data) {
      if (_data.hasOwnProperty(prop)) {
        properties.push(prop);
        // duplicate input data as we are modifying it
        data[prop] = _data[prop];
      }
      if (types[prop] === 'vec3') {
        if (Array.isArray(data[prop])) {
          data[prop] = new Vec3(data[prop][0], data[prop][1], data[prop][2]);
        }
      } else if (types[prop] === 'curve') {
        if (!(data[prop] instanceof Curve)) {
          const t = data[prop].type;
          data[prop] = new Curve(data[prop].keys);
          data[prop].type = t;
        }
      } else if (types[prop] === 'curveset') {
        if (!(data[prop] instanceof CurveSet)) {
          const t = data[prop].type;
          data[prop] = new CurveSet(data[prop].keys);
          data[prop].type = t;
        }
      }

      // duplicate layer list
      if (data.layers && Array.isArray(data.layers)) {
        data.layers = data.layers.slice(0);
      }
    }
    super.initializeComponentData(component, data, properties);
  }
  cloneComponent(entity, clone) {
    const source = entity.particlesystem.data;
    const schema = this.schema;
    const data = {};
    for (let i = 0, len = schema.length; i < len; i++) {
      const prop = schema[i];
      let sourceProp = source[prop];
      if (sourceProp instanceof Vec3 || sourceProp instanceof Curve || sourceProp instanceof CurveSet) {
        sourceProp = sourceProp.clone();
        data[prop] = sourceProp;
      } else if (prop === 'layers') {
        data.layers = source.layers.slice(0);
      } else {
        if (sourceProp !== null && sourceProp !== undefined) {
          data[prop] = sourceProp;
        }
      }
    }
    return this.addComponent(clone, data);
  }
  onUpdate(dt) {
    const components = this.store;
    let numSteps;
    const stats = this.app.stats.particles;
    for (const id in components) {
      if (components.hasOwnProperty(id)) {
        const component = components[id];
        const entity = component.entity;
        const data = component.data;
        if (data.enabled && entity.enabled) {
          const emitter = entity.particlesystem.emitter;
          if (!emitter.meshInstance.visible) continue;

          // Bake ambient and directional lighting into one ambient cube
          // TODO: only do if lighting changed
          // TODO: don't do for every emitter
          if (emitter.lighting) {
            const layers = data.layers;
            let lightCube;
            for (let i = 0; i < layers.length; i++) {
              const layer = this.app.scene.layers.getLayerById(layers[i]);
              if (!layer) continue;
              if (!layer._lightCube) {
                layer._lightCube = new Float32Array(6 * 3);
              }
              lightCube = layer._lightCube;
              for (let j = 0; j < 6; j++) {
                lightCube[j * 3] = this.app.scene.ambientLight.r;
                lightCube[j * 3 + 1] = this.app.scene.ambientLight.g;
                lightCube[j * 3 + 2] = this.app.scene.ambientLight.b;
              }
              const dirs = layer._splitLights[LIGHTTYPE_DIRECTIONAL];
              for (let j = 0; j < dirs.length; j++) {
                for (let c = 0; c < 6; c++) {
                  const weight = Math.max(emitter.lightCubeDir[c].dot(dirs[j]._direction), 0) * dirs[j]._intensity;
                  lightCube[c * 3] += dirs[j]._color.r * weight;
                  lightCube[c * 3 + 1] += dirs[j]._color.g * weight;
                  lightCube[c * 3 + 2] += dirs[j]._color.b * weight;
                }
              }
            }
            emitter.constantLightCube.setValue(lightCube); // ?
          }

          if (!data.paused) {
            emitter.simTime += dt;
            if (emitter.simTime > emitter.fixedTimeStep) {
              numSteps = Math.floor(emitter.simTime / emitter.fixedTimeStep);
              emitter.simTime -= numSteps * emitter.fixedTimeStep;
            }
            if (numSteps) {
              numSteps = Math.min(numSteps, emitter.maxSubSteps);
              for (let i = 0; i < numSteps; i++) {
                emitter.addTime(emitter.fixedTimeStep, false);
              }
              stats._updatesPerFrame += numSteps;
              stats._frameTime += emitter._addTimeTime;
              emitter._addTimeTime = 0;
            }
            emitter.finishFrame();
          }
        }
      }
    }
  }
  onBeforeRemove(entity, component) {
    component.onBeforeRemove();
  }
  destroy() {
    super.destroy();
    this.app.systems.off('update', this.onUpdate, this);
  }
}
Component._buildAccessors(ParticleSystemComponent.prototype, _schema);

export { ParticleSystemComponentSystem };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3lzdGVtLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2NvbXBvbmVudHMvcGFydGljbGUtc3lzdGVtL3N5c3RlbS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDdXJ2ZSB9IGZyb20gJy4uLy4uLy4uL2NvcmUvbWF0aC9jdXJ2ZS5qcyc7XG5pbXBvcnQgeyBDdXJ2ZVNldCB9IGZyb20gJy4uLy4uLy4uL2NvcmUvbWF0aC9jdXJ2ZS1zZXQuanMnO1xuaW1wb3J0IHsgVmVjMyB9IGZyb20gJy4uLy4uLy4uL2NvcmUvbWF0aC92ZWMzLmpzJztcblxuaW1wb3J0IHsgTElHSFRUWVBFX0RJUkVDVElPTkFMIH0gZnJvbSAnLi4vLi4vLi4vc2NlbmUvY29uc3RhbnRzLmpzJztcblxuaW1wb3J0IHsgQXNzZXQgfSBmcm9tICcuLi8uLi9hc3NldC9hc3NldC5qcyc7XG5cbmltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJy4uL2NvbXBvbmVudC5qcyc7XG5pbXBvcnQgeyBDb21wb25lbnRTeXN0ZW0gfSBmcm9tICcuLi9zeXN0ZW0uanMnO1xuXG5pbXBvcnQgeyBQYXJ0aWNsZVN5c3RlbUNvbXBvbmVudCB9IGZyb20gJy4vY29tcG9uZW50LmpzJztcbmltcG9ydCB7IFBhcnRpY2xlU3lzdGVtQ29tcG9uZW50RGF0YSB9IGZyb20gJy4vZGF0YS5qcyc7XG5cbmNvbnN0IF9zY2hlbWEgPSBbXG4gICAgJ2VuYWJsZWQnLFxuICAgICdhdXRvUGxheScsXG4gICAgJ251bVBhcnRpY2xlcycsXG4gICAgJ2xpZmV0aW1lJyxcbiAgICAncmF0ZScsXG4gICAgJ3JhdGUyJyxcbiAgICAnc3RhcnRBbmdsZScsXG4gICAgJ3N0YXJ0QW5nbGUyJyxcbiAgICAnbG9vcCcsXG4gICAgJ3ByZVdhcm0nLFxuICAgICdsaWdodGluZycsXG4gICAgJ2hhbGZMYW1iZXJ0JyxcbiAgICAnaW50ZW5zaXR5JyxcbiAgICAnZGVwdGhXcml0ZScsXG4gICAgJ25vRm9nJyxcbiAgICAnZGVwdGhTb2Z0ZW5pbmcnLFxuICAgICdzb3J0JyxcbiAgICAnYmxlbmRUeXBlJyxcbiAgICAnc3RyZXRjaCcsXG4gICAgJ2FsaWduVG9Nb3Rpb24nLFxuICAgICdlbWl0dGVyU2hhcGUnLFxuICAgICdlbWl0dGVyRXh0ZW50cycsXG4gICAgJ2VtaXR0ZXJFeHRlbnRzSW5uZXInLFxuICAgICdlbWl0dGVyUmFkaXVzJyxcbiAgICAnZW1pdHRlclJhZGl1c0lubmVyJyxcbiAgICAnaW5pdGlhbFZlbG9jaXR5JyxcbiAgICAnd3JhcCcsXG4gICAgJ3dyYXBCb3VuZHMnLFxuICAgICdsb2NhbFNwYWNlJyxcbiAgICAnc2NyZWVuU3BhY2UnLFxuICAgICdjb2xvck1hcEFzc2V0JyxcbiAgICAnbm9ybWFsTWFwQXNzZXQnLFxuICAgICdtZXNoJyxcbiAgICAnbWVzaEFzc2V0JyxcbiAgICAncmVuZGVyQXNzZXQnLFxuICAgICdvcmllbnRhdGlvbicsXG4gICAgJ3BhcnRpY2xlTm9ybWFsJyxcbiAgICAnbG9jYWxWZWxvY2l0eUdyYXBoJyxcbiAgICAnbG9jYWxWZWxvY2l0eUdyYXBoMicsXG4gICAgJ3ZlbG9jaXR5R3JhcGgnLFxuICAgICd2ZWxvY2l0eUdyYXBoMicsXG4gICAgJ3JvdGF0aW9uU3BlZWRHcmFwaCcsXG4gICAgJ3JvdGF0aW9uU3BlZWRHcmFwaDInLFxuICAgICdyYWRpYWxTcGVlZEdyYXBoJyxcbiAgICAncmFkaWFsU3BlZWRHcmFwaDInLFxuICAgICdzY2FsZUdyYXBoJyxcbiAgICAnc2NhbGVHcmFwaDInLFxuICAgICdjb2xvckdyYXBoJyxcbiAgICAnY29sb3JHcmFwaDInLFxuICAgICdhbHBoYUdyYXBoJyxcbiAgICAnYWxwaGFHcmFwaDInLFxuICAgICdjb2xvck1hcCcsXG4gICAgJ25vcm1hbE1hcCcsXG4gICAgJ2FuaW1UaWxlc1gnLFxuICAgICdhbmltVGlsZXNZJyxcbiAgICAnYW5pbVN0YXJ0RnJhbWUnLFxuICAgICdhbmltTnVtRnJhbWVzJyxcbiAgICAnYW5pbU51bUFuaW1hdGlvbnMnLFxuICAgICdhbmltSW5kZXgnLFxuICAgICdyYW5kb21pemVBbmltSW5kZXgnLFxuICAgICdhbmltU3BlZWQnLFxuICAgICdhbmltTG9vcCcsXG4gICAgJ2xheWVycydcbl07XG5cbi8qKlxuICogQWxsb3dzIGFuIEVudGl0eSB0byByZW5kZXIgYSBwYXJ0aWNsZSBzeXN0ZW0uXG4gKlxuICogQGF1Z21lbnRzIENvbXBvbmVudFN5c3RlbVxuICovXG5jbGFzcyBQYXJ0aWNsZVN5c3RlbUNvbXBvbmVudFN5c3RlbSBleHRlbmRzIENvbXBvbmVudFN5c3RlbSB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IFBhcnRpY2xlU3lzdGVtQ29tcG9uZW50U3lzdGVtLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uLy4uL2FwcC1iYXNlLmpzJykuQXBwQmFzZX0gYXBwIC0gVGhlIEFwcGxpY2F0aW9uLlxuICAgICAqIEBoaWRlY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihhcHApIHtcbiAgICAgICAgc3VwZXIoYXBwKTtcblxuICAgICAgICB0aGlzLmlkID0gJ3BhcnRpY2xlc3lzdGVtJztcblxuICAgICAgICB0aGlzLkNvbXBvbmVudFR5cGUgPSBQYXJ0aWNsZVN5c3RlbUNvbXBvbmVudDtcbiAgICAgICAgdGhpcy5EYXRhVHlwZSA9IFBhcnRpY2xlU3lzdGVtQ29tcG9uZW50RGF0YTtcblxuICAgICAgICB0aGlzLnNjaGVtYSA9IF9zY2hlbWE7XG5cbiAgICAgICAgdGhpcy5wcm9wZXJ0eVR5cGVzID0ge1xuICAgICAgICAgICAgZW1pdHRlckV4dGVudHM6ICd2ZWMzJyxcbiAgICAgICAgICAgIGVtaXR0ZXJFeHRlbnRzSW5uZXI6ICd2ZWMzJyxcbiAgICAgICAgICAgIHBhcnRpY2xlTm9ybWFsOiAndmVjMycsXG4gICAgICAgICAgICB3cmFwQm91bmRzOiAndmVjMycsXG4gICAgICAgICAgICBsb2NhbFZlbG9jaXR5R3JhcGg6ICdjdXJ2ZXNldCcsXG4gICAgICAgICAgICBsb2NhbFZlbG9jaXR5R3JhcGgyOiAnY3VydmVzZXQnLFxuICAgICAgICAgICAgdmVsb2NpdHlHcmFwaDogJ2N1cnZlc2V0JyxcbiAgICAgICAgICAgIHZlbG9jaXR5R3JhcGgyOiAnY3VydmVzZXQnLFxuICAgICAgICAgICAgY29sb3JHcmFwaDogJ2N1cnZlc2V0JyxcbiAgICAgICAgICAgIGNvbG9yR3JhcGgyOiAnY3VydmVzZXQnLFxuICAgICAgICAgICAgYWxwaGFHcmFwaDogJ2N1cnZlJyxcbiAgICAgICAgICAgIGFscGhhR3JhcGgyOiAnY3VydmUnLFxuICAgICAgICAgICAgcm90YXRpb25TcGVlZEdyYXBoOiAnY3VydmUnLFxuICAgICAgICAgICAgcm90YXRpb25TcGVlZEdyYXBoMjogJ2N1cnZlJyxcbiAgICAgICAgICAgIHJhZGlhbFNwZWVkR3JhcGg6ICdjdXJ2ZScsXG4gICAgICAgICAgICByYWRpYWxTcGVlZEdyYXBoMjogJ2N1cnZlJyxcbiAgICAgICAgICAgIHNjYWxlR3JhcGg6ICdjdXJ2ZScsXG4gICAgICAgICAgICBzY2FsZUdyYXBoMjogJ2N1cnZlJ1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMub24oJ2JlZm9yZXJlbW92ZScsIHRoaXMub25CZWZvcmVSZW1vdmUsIHRoaXMpO1xuICAgICAgICB0aGlzLmFwcC5zeXN0ZW1zLm9uKCd1cGRhdGUnLCB0aGlzLm9uVXBkYXRlLCB0aGlzKTtcbiAgICB9XG5cbiAgICBpbml0aWFsaXplQ29tcG9uZW50RGF0YShjb21wb25lbnQsIF9kYXRhLCBwcm9wZXJ0aWVzKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSB7fTtcblxuICAgICAgICBwcm9wZXJ0aWVzID0gW107XG4gICAgICAgIGNvbnN0IHR5cGVzID0gdGhpcy5wcm9wZXJ0eVR5cGVzO1xuXG4gICAgICAgIC8vIHdlIHN0b3JlIHRoZSBtZXNoIGFzc2V0IGlkIGFzIFwibWVzaFwiIChpdCBzaG91bGQgYmUgXCJtZXNoQXNzZXRcIilcbiAgICAgICAgLy8gdGhpcyByZS1tYXBzIFwibWVzaFwiIGludG8gXCJtZXNoQXNzZXRcIiBpZiBpdCBpcyBhbiBhc3NldCBvciBhbiBhc3NldCBpZFxuICAgICAgICBpZiAoX2RhdGEubWVzaCBpbnN0YW5jZW9mIEFzc2V0IHx8IHR5cGVvZiBfZGF0YS5tZXNoID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgLy8gbWlncmF0ZSBpbnRvIG1lc2hBc3NldCBwcm9wZXJ0eVxuICAgICAgICAgICAgX2RhdGEubWVzaEFzc2V0ID0gX2RhdGEubWVzaDtcbiAgICAgICAgICAgIGRlbGV0ZSBfZGF0YS5tZXNoO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChjb25zdCBwcm9wIGluIF9kYXRhKSB7XG4gICAgICAgICAgICBpZiAoX2RhdGEuaGFzT3duUHJvcGVydHkocHJvcCkpIHtcbiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLnB1c2gocHJvcCk7XG4gICAgICAgICAgICAgICAgLy8gZHVwbGljYXRlIGlucHV0IGRhdGEgYXMgd2UgYXJlIG1vZGlmeWluZyBpdFxuICAgICAgICAgICAgICAgIGRhdGFbcHJvcF0gPSBfZGF0YVtwcm9wXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHR5cGVzW3Byb3BdID09PSAndmVjMycpIHtcbiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhW3Byb3BdKSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhW3Byb3BdID0gbmV3IFZlYzMoZGF0YVtwcm9wXVswXSwgZGF0YVtwcm9wXVsxXSwgZGF0YVtwcm9wXVsyXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlc1twcm9wXSA9PT0gJ2N1cnZlJykge1xuICAgICAgICAgICAgICAgIGlmICghKGRhdGFbcHJvcF0gaW5zdGFuY2VvZiBDdXJ2ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IGRhdGFbcHJvcF0udHlwZTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtwcm9wXSA9IG5ldyBDdXJ2ZShkYXRhW3Byb3BdLmtleXMpO1xuICAgICAgICAgICAgICAgICAgICBkYXRhW3Byb3BdLnR5cGUgPSB0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZXNbcHJvcF0gPT09ICdjdXJ2ZXNldCcpIHtcbiAgICAgICAgICAgICAgICBpZiAoIShkYXRhW3Byb3BdIGluc3RhbmNlb2YgQ3VydmVTZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBkYXRhW3Byb3BdLnR5cGU7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbcHJvcF0gPSBuZXcgQ3VydmVTZXQoZGF0YVtwcm9wXS5rZXlzKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtwcm9wXS50eXBlID0gdDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGR1cGxpY2F0ZSBsYXllciBsaXN0XG4gICAgICAgICAgICBpZiAoZGF0YS5sYXllcnMgJiYgQXJyYXkuaXNBcnJheShkYXRhLmxheWVycykpIHtcbiAgICAgICAgICAgICAgICBkYXRhLmxheWVycyA9IGRhdGEubGF5ZXJzLnNsaWNlKDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgc3VwZXIuaW5pdGlhbGl6ZUNvbXBvbmVudERhdGEoY29tcG9uZW50LCBkYXRhLCBwcm9wZXJ0aWVzKTtcbiAgICB9XG5cbiAgICBjbG9uZUNvbXBvbmVudChlbnRpdHksIGNsb25lKSB7XG4gICAgICAgIGNvbnN0IHNvdXJjZSA9IGVudGl0eS5wYXJ0aWNsZXN5c3RlbS5kYXRhO1xuICAgICAgICBjb25zdCBzY2hlbWEgPSB0aGlzLnNjaGVtYTtcblxuICAgICAgICBjb25zdCBkYXRhID0ge307XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHNjaGVtYS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgY29uc3QgcHJvcCA9IHNjaGVtYVtpXTtcbiAgICAgICAgICAgIGxldCBzb3VyY2VQcm9wID0gc291cmNlW3Byb3BdO1xuICAgICAgICAgICAgaWYgKHNvdXJjZVByb3AgaW5zdGFuY2VvZiBWZWMzIHx8XG4gICAgICAgICAgICAgICAgc291cmNlUHJvcCBpbnN0YW5jZW9mIEN1cnZlIHx8XG4gICAgICAgICAgICAgICAgc291cmNlUHJvcCBpbnN0YW5jZW9mIEN1cnZlU2V0KSB7XG5cbiAgICAgICAgICAgICAgICBzb3VyY2VQcm9wID0gc291cmNlUHJvcC5jbG9uZSgpO1xuICAgICAgICAgICAgICAgIGRhdGFbcHJvcF0gPSBzb3VyY2VQcm9wO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwcm9wID09PSAnbGF5ZXJzJykge1xuICAgICAgICAgICAgICAgIGRhdGEubGF5ZXJzID0gc291cmNlLmxheWVycy5zbGljZSgwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHNvdXJjZVByb3AgIT09IG51bGwgJiYgc291cmNlUHJvcCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbcHJvcF0gPSBzb3VyY2VQcm9wO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmFkZENvbXBvbmVudChjbG9uZSwgZGF0YSk7XG4gICAgfVxuXG4gICAgb25VcGRhdGUoZHQpIHtcbiAgICAgICAgY29uc3QgY29tcG9uZW50cyA9IHRoaXMuc3RvcmU7XG4gICAgICAgIGxldCBudW1TdGVwcztcbiAgICAgICAgY29uc3Qgc3RhdHMgPSB0aGlzLmFwcC5zdGF0cy5wYXJ0aWNsZXM7XG5cbiAgICAgICAgZm9yIChjb25zdCBpZCBpbiBjb21wb25lbnRzKSB7XG4gICAgICAgICAgICBpZiAoY29tcG9uZW50cy5oYXNPd25Qcm9wZXJ0eShpZCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSBjb21wb25lbnRzW2lkXTtcbiAgICAgICAgICAgICAgICBjb25zdCBlbnRpdHkgPSBjb21wb25lbnQuZW50aXR5O1xuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBjb21wb25lbnQuZGF0YTtcblxuICAgICAgICAgICAgICAgIGlmIChkYXRhLmVuYWJsZWQgJiYgZW50aXR5LmVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW1pdHRlciA9IGVudGl0eS5wYXJ0aWNsZXN5c3RlbS5lbWl0dGVyO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWVtaXR0ZXIubWVzaEluc3RhbmNlLnZpc2libGUpIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEJha2UgYW1iaWVudCBhbmQgZGlyZWN0aW9uYWwgbGlnaHRpbmcgaW50byBvbmUgYW1iaWVudCBjdWJlXG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IG9ubHkgZG8gaWYgbGlnaHRpbmcgY2hhbmdlZFxuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBkb24ndCBkbyBmb3IgZXZlcnkgZW1pdHRlclxuICAgICAgICAgICAgICAgICAgICBpZiAoZW1pdHRlci5saWdodGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGF5ZXJzID0gZGF0YS5sYXllcnM7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgbGlnaHRDdWJlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsYXllcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IHRoaXMuYXBwLnNjZW5lLmxheWVycy5nZXRMYXllckJ5SWQobGF5ZXJzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWxheWVyKSBjb250aW51ZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbGF5ZXIuX2xpZ2h0Q3ViZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXllci5fbGlnaHRDdWJlID0gbmV3IEZsb2F0MzJBcnJheSg2ICogMyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0Q3ViZSA9IGxheWVyLl9saWdodEN1YmU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCA2OyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHRDdWJlW2ogKiAzXSA9IHRoaXMuYXBwLnNjZW5lLmFtYmllbnRMaWdodC5yO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodEN1YmVbaiAqIDMgKyAxXSA9IHRoaXMuYXBwLnNjZW5lLmFtYmllbnRMaWdodC5nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodEN1YmVbaiAqIDMgKyAyXSA9IHRoaXMuYXBwLnNjZW5lLmFtYmllbnRMaWdodC5iO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXJzID0gbGF5ZXIuX3NwbGl0TGlnaHRzW0xJR0hUVFlQRV9ESVJFQ1RJT05BTF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBkaXJzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgNjsgYysrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB3ZWlnaHQgPSBNYXRoLm1heChlbWl0dGVyLmxpZ2h0Q3ViZURpcltjXS5kb3QoZGlyc1tqXS5fZGlyZWN0aW9uKSwgMCkgKiBkaXJzW2pdLl9pbnRlbnNpdHk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodEN1YmVbYyAqIDNdICs9IGRpcnNbal0uX2NvbG9yLnIgKiB3ZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWdodEN1YmVbYyAqIDMgKyAxXSArPSBkaXJzW2pdLl9jb2xvci5nICogd2VpZ2h0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHRDdWJlW2MgKiAzICsgMl0gKz0gZGlyc1tqXS5fY29sb3IuYiAqIHdlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVtaXR0ZXIuY29uc3RhbnRMaWdodEN1YmUuc2V0VmFsdWUobGlnaHRDdWJlKTsgLy8gP1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkYXRhLnBhdXNlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW1pdHRlci5zaW1UaW1lICs9IGR0O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVtaXR0ZXIuc2ltVGltZSA+IGVtaXR0ZXIuZml4ZWRUaW1lU3RlcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bVN0ZXBzID0gTWF0aC5mbG9vcihlbWl0dGVyLnNpbVRpbWUgLyBlbWl0dGVyLmZpeGVkVGltZVN0ZXApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXR0ZXIuc2ltVGltZSAtPSBudW1TdGVwcyAqIGVtaXR0ZXIuZml4ZWRUaW1lU3RlcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudW1TdGVwcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bVN0ZXBzID0gTWF0aC5taW4obnVtU3RlcHMsIGVtaXR0ZXIubWF4U3ViU3RlcHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtU3RlcHM7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0dGVyLmFkZFRpbWUoZW1pdHRlci5maXhlZFRpbWVTdGVwLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzLl91cGRhdGVzUGVyRnJhbWUgKz0gbnVtU3RlcHM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHMuX2ZyYW1lVGltZSArPSBlbWl0dGVyLl9hZGRUaW1lVGltZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0dGVyLl9hZGRUaW1lVGltZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbWl0dGVyLmZpbmlzaEZyYW1lKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbkJlZm9yZVJlbW92ZShlbnRpdHksIGNvbXBvbmVudCkge1xuICAgICAgICBjb21wb25lbnQub25CZWZvcmVSZW1vdmUoKTtcbiAgICB9XG5cbiAgICBkZXN0cm95KCkge1xuICAgICAgICBzdXBlci5kZXN0cm95KCk7XG5cbiAgICAgICAgdGhpcy5hcHAuc3lzdGVtcy5vZmYoJ3VwZGF0ZScsIHRoaXMub25VcGRhdGUsIHRoaXMpO1xuICAgIH1cbn1cblxuQ29tcG9uZW50Ll9idWlsZEFjY2Vzc29ycyhQYXJ0aWNsZVN5c3RlbUNvbXBvbmVudC5wcm90b3R5cGUsIF9zY2hlbWEpO1xuXG5leHBvcnQgeyBQYXJ0aWNsZVN5c3RlbUNvbXBvbmVudFN5c3RlbSB9O1xuIl0sIm5hbWVzIjpbIl9zY2hlbWEiLCJQYXJ0aWNsZVN5c3RlbUNvbXBvbmVudFN5c3RlbSIsIkNvbXBvbmVudFN5c3RlbSIsImNvbnN0cnVjdG9yIiwiYXBwIiwiaWQiLCJDb21wb25lbnRUeXBlIiwiUGFydGljbGVTeXN0ZW1Db21wb25lbnQiLCJEYXRhVHlwZSIsIlBhcnRpY2xlU3lzdGVtQ29tcG9uZW50RGF0YSIsInNjaGVtYSIsInByb3BlcnR5VHlwZXMiLCJlbWl0dGVyRXh0ZW50cyIsImVtaXR0ZXJFeHRlbnRzSW5uZXIiLCJwYXJ0aWNsZU5vcm1hbCIsIndyYXBCb3VuZHMiLCJsb2NhbFZlbG9jaXR5R3JhcGgiLCJsb2NhbFZlbG9jaXR5R3JhcGgyIiwidmVsb2NpdHlHcmFwaCIsInZlbG9jaXR5R3JhcGgyIiwiY29sb3JHcmFwaCIsImNvbG9yR3JhcGgyIiwiYWxwaGFHcmFwaCIsImFscGhhR3JhcGgyIiwicm90YXRpb25TcGVlZEdyYXBoIiwicm90YXRpb25TcGVlZEdyYXBoMiIsInJhZGlhbFNwZWVkR3JhcGgiLCJyYWRpYWxTcGVlZEdyYXBoMiIsInNjYWxlR3JhcGgiLCJzY2FsZUdyYXBoMiIsIm9uIiwib25CZWZvcmVSZW1vdmUiLCJzeXN0ZW1zIiwib25VcGRhdGUiLCJpbml0aWFsaXplQ29tcG9uZW50RGF0YSIsImNvbXBvbmVudCIsIl9kYXRhIiwicHJvcGVydGllcyIsImRhdGEiLCJ0eXBlcyIsIm1lc2giLCJBc3NldCIsIm1lc2hBc3NldCIsInByb3AiLCJoYXNPd25Qcm9wZXJ0eSIsInB1c2giLCJBcnJheSIsImlzQXJyYXkiLCJWZWMzIiwiQ3VydmUiLCJ0IiwidHlwZSIsImtleXMiLCJDdXJ2ZVNldCIsImxheWVycyIsInNsaWNlIiwiY2xvbmVDb21wb25lbnQiLCJlbnRpdHkiLCJjbG9uZSIsInNvdXJjZSIsInBhcnRpY2xlc3lzdGVtIiwiaSIsImxlbiIsImxlbmd0aCIsInNvdXJjZVByb3AiLCJ1bmRlZmluZWQiLCJhZGRDb21wb25lbnQiLCJkdCIsImNvbXBvbmVudHMiLCJzdG9yZSIsIm51bVN0ZXBzIiwic3RhdHMiLCJwYXJ0aWNsZXMiLCJlbmFibGVkIiwiZW1pdHRlciIsIm1lc2hJbnN0YW5jZSIsInZpc2libGUiLCJsaWdodGluZyIsImxpZ2h0Q3ViZSIsImxheWVyIiwic2NlbmUiLCJnZXRMYXllckJ5SWQiLCJfbGlnaHRDdWJlIiwiRmxvYXQzMkFycmF5IiwiaiIsImFtYmllbnRMaWdodCIsInIiLCJnIiwiYiIsImRpcnMiLCJfc3BsaXRMaWdodHMiLCJMSUdIVFRZUEVfRElSRUNUSU9OQUwiLCJjIiwid2VpZ2h0IiwiTWF0aCIsIm1heCIsImxpZ2h0Q3ViZURpciIsImRvdCIsIl9kaXJlY3Rpb24iLCJfaW50ZW5zaXR5IiwiX2NvbG9yIiwiY29uc3RhbnRMaWdodEN1YmUiLCJzZXRWYWx1ZSIsInBhdXNlZCIsInNpbVRpbWUiLCJmaXhlZFRpbWVTdGVwIiwiZmxvb3IiLCJtaW4iLCJtYXhTdWJTdGVwcyIsImFkZFRpbWUiLCJfdXBkYXRlc1BlckZyYW1lIiwiX2ZyYW1lVGltZSIsIl9hZGRUaW1lVGltZSIsImZpbmlzaEZyYW1lIiwiZGVzdHJveSIsIm9mZiIsIkNvbXBvbmVudCIsIl9idWlsZEFjY2Vzc29ycyIsInByb3RvdHlwZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBY0EsTUFBTUEsT0FBTyxHQUFHLENBQ1osU0FBUyxFQUNULFVBQVUsRUFDVixjQUFjLEVBQ2QsVUFBVSxFQUNWLE1BQU0sRUFDTixPQUFPLEVBQ1AsWUFBWSxFQUNaLGFBQWEsRUFDYixNQUFNLEVBQ04sU0FBUyxFQUNULFVBQVUsRUFDVixhQUFhLEVBQ2IsV0FBVyxFQUNYLFlBQVksRUFDWixPQUFPLEVBQ1AsZ0JBQWdCLEVBQ2hCLE1BQU0sRUFDTixXQUFXLEVBQ1gsU0FBUyxFQUNULGVBQWUsRUFDZixjQUFjLEVBQ2QsZ0JBQWdCLEVBQ2hCLHFCQUFxQixFQUNyQixlQUFlLEVBQ2Ysb0JBQW9CLEVBQ3BCLGlCQUFpQixFQUNqQixNQUFNLEVBQ04sWUFBWSxFQUNaLFlBQVksRUFD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
