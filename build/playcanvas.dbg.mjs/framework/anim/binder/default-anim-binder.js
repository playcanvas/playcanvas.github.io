/**
 * @license
 * PlayCanvas Engine v1.62.0-dev revision 7d088032c (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../../../core/debug.js';
import { AnimBinder } from './anim-binder.js';
import { AnimTarget } from '../evaluator/anim-target.js';
import { Entity } from '../../entity.js';

/**
 * Implementation of {@link AnimBinder} for animating a skeleton in the graph-node hierarchy.
 *
 * @implements {AnimBinder}
 * @ignore
 */
class DefaultAnimBinder {
  constructor(graph) {
    this._isPathInMask = (path, checkMaskValue) => {
      const maskItem = this._mask[path];
      if (!maskItem) return false;else if (maskItem.children || checkMaskValue && maskItem.value !== false) return true;
      return false;
    };
    this.graph = graph;
    if (!graph) return;
    this._mask = null;
    const nodes = {};
    // cache node names so we can quickly resolve animation paths
    const flatten = function flatten(node) {
      nodes[node.name] = node;
      for (let i = 0; i < node.children.length; ++i) {
        flatten(node.children[i]);
      }
    };
    flatten(graph);
    this.nodes = nodes;
    this.targetCache = {};
    this.visitedFallbackGraphPaths = {};
    const findMeshInstances = function findMeshInstances(node) {
      // walk up to the first parent node of entity type (skips internal nodes of Model)
      let object = node;
      while (object && !(object instanceof Entity)) {
        object = object.parent;
      }

      // get meshInstances from either model or render component
      let meshInstances;
      if (object) {
        if (object.render) {
          meshInstances = object.render.meshInstances;
        } else if (object.model) {
          meshInstances = object.model.meshInstances;
        }
      }
      return meshInstances;
    };
    this.nodeCounts = {}; // map of node path -> count
    this.activeNodes = []; // list of active nodes
    this.handlers = {
      'localPosition': function (node) {
        const object = node.localPosition;
        const func = function func(value) {
          object.set(...value);
        };
        return DefaultAnimBinder.createAnimTarget(func, 'vector', 3, node, 'localPosition');
      },
      'localRotation': function (node) {
        const object = node.localRotation;
        const func = function func(value) {
          object.set(...value);
        };
        return DefaultAnimBinder.createAnimTarget(func, 'quaternion', 4, node, 'localRotation');
      },
      'localScale': function (node) {
        const object = node.localScale;
        const func = function func(value) {
          object.set(...value);
        };
        return DefaultAnimBinder.createAnimTarget(func, 'vector', 3, node, 'localScale');
      },
      'weight': function (node, weightName) {
        if (weightName.indexOf('name.') === 0) {
          weightName = weightName.replace('name.', '');
        } else {
          weightName = Number(weightName);
        }
        const meshInstances = findMeshInstances(node);
        let setters;
        if (meshInstances) {
          for (let i = 0; i < meshInstances.length; ++i) {
            if (meshInstances[i].node.name === node.name && meshInstances[i].morphInstance) {
              const morphInstance = meshInstances[i].morphInstance;
              const func = value => {
                morphInstance.setWeight(weightName, value[0]);
              };
              if (!setters) setters = [];
              setters.push(func);
            }
          }
        }
        if (setters) {
          const callSetters = value => {
            for (let i = 0; i < setters.length; ++i) {
              setters[i](value);
            }
          };
          return DefaultAnimBinder.createAnimTarget(callSetters, 'number', 1, node, `weight.${weightName}`);
        }
        return null;
      },
      'materialTexture': (node, textureName) => {
        const meshInstances = findMeshInstances(node);
        if (meshInstances) {
          let meshInstance;
          for (let i = 0; i < meshInstances.length; ++i) {
            if (meshInstances[i].node.name === node.name) {
              meshInstance = meshInstances[i];
              break;
            }
          }
          if (meshInstance) {
            const func = value => {
              const textureAsset = this.animComponent.system.app.assets.get(value[0]);
              if (textureAsset && textureAsset.resource && textureAsset.type === 'texture') {
                meshInstance.material[textureName] = textureAsset.resource;
                meshInstance.material.update();
              }
            };
            return DefaultAnimBinder.createAnimTarget(func, 'vector', 1, node, 'materialTexture', 'material');
          }
        }
        return null;
      }
    };
  }
  _isPathActive(path) {
    if (!this._mask) return true;
    const rootNodeNames = [path.entityPath[0], this.graph.name];
    for (let j = 0; j < rootNodeNames.length; ++j) {
      let currEntityPath = rootNodeNames[j];
      if (this._isPathInMask(currEntityPath, path.entityPath.length === 1)) return true;
      for (let i = 1; i < path.entityPath.length; i++) {
        currEntityPath += '/' + path.entityPath[i];
        if (this._isPathInMask(currEntityPath, i === path.entityPath.length - 1)) return true;
      }
    }
    return false;
  }
  findNode(path) {
    if (!this._isPathActive(path)) {
      return null;
    }
    let node;
    if (this.graph) {
      node = this.graph.findByPath(path.entityPath);
      // if the path is not found under the given root node, try to find the path using the root node as the base of the path instead
      if (!node) {
        node = this.graph.findByPath(path.entityPath.slice(1));
      }
    }
    if (!node) {
      node = this.nodes[path.entityPath[path.entityPath.length - 1] || ""];
      const fallbackGraphPath = AnimBinder.encode(path.entityPath[path.entityPath.length - 1] || "", 'graph', path.propertyPath);
      if (this.visitedFallbackGraphPaths[fallbackGraphPath] === 1) {
        Debug.warn(`Anim Binder: Multiple animation curves with the path ${fallbackGraphPath} are present in the ${this.graph.path} graph which may result in the incorrect binding of animations`);
      }
      if (!Number.isFinite(this.visitedFallbackGraphPaths[fallbackGraphPath])) {
        this.visitedFallbackGraphPaths[fallbackGraphPath] = 0;
      } else {
        this.visitedFallbackGraphPaths[fallbackGraphPath]++;
      }
    }
    return node;
  }
  static createAnimTarget(func, type, valueCount, node, propertyPath, componentType) {
    const targetPath = AnimBinder.encode(node.path, componentType ? componentType : 'entity', propertyPath);
    return new AnimTarget(func, type, valueCount, targetPath);
  }
  resolve(path) {
    const encodedPath = AnimBinder.encode(path.entityPath, path.component, path.propertyPath);
    let target = this.targetCache[encodedPath];
    if (target) return target;
    const node = this.findNode(path);
    if (!node) {
      return null;
    }
    const handler = this.handlers[path.propertyPath];
    if (!handler) {
      return null;
    }
    target = handler(node);
    if (!target) {
      return null;
    }
    this.targetCache[encodedPath] = target;
    if (!this.nodeCounts[node.path]) {
      this.activeNodes.push(node);
      this.nodeCounts[node.path] = 1;
    } else {
      this.nodeCounts[node.path]++;
    }
    return target;
  }
  unresolve(path) {
    if (path.component !== 'graph') return;
    const node = this.nodes[path.entityPath[path.entityPath.length - 1] || ""];
    this.nodeCounts[node.path]--;
    if (this.nodeCounts[node.path] === 0) {
      const activeNodes = this.activeNodes;
      const i = activeNodes.indexOf(node.node); // :(
      const len = activeNodes.length;
      if (i < len - 1) {
        activeNodes[i] = activeNodes[len - 1];
      }
      activeNodes.pop();
    }
  }

  // flag animating nodes as dirty
  update(deltaTime) {
    const activeNodes = this.activeNodes;
    for (let i = 0; i < activeNodes.length; ++i) {
      activeNodes[i]._dirtifyLocal();
    }
  }
  assignMask(mask) {
    if (mask !== this._mask) {
      this._mask = mask;
      return true;
    }
    return false;
  }
}

export { DefaultAnimBinder };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVmYXVsdC1hbmltLWJpbmRlci5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay9hbmltL2JpbmRlci9kZWZhdWx0LWFuaW0tYmluZGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9kZWJ1Zy5qcyc7XG5pbXBvcnQgeyBBbmltQmluZGVyIH0gZnJvbSAnLi9hbmltLWJpbmRlci5qcyc7XG5pbXBvcnQgeyBBbmltVGFyZ2V0IH0gZnJvbSAnLi4vZXZhbHVhdG9yL2FuaW0tdGFyZ2V0LmpzJztcbmltcG9ydCB7IEVudGl0eSB9IGZyb20gJy4uLy4uL2VudGl0eS5qcyc7XG4vKipcbiAqIEltcGxlbWVudGF0aW9uIG9mIHtAbGluayBBbmltQmluZGVyfSBmb3IgYW5pbWF0aW5nIGEgc2tlbGV0b24gaW4gdGhlIGdyYXBoLW5vZGUgaGllcmFyY2h5LlxuICpcbiAqIEBpbXBsZW1lbnRzIHtBbmltQmluZGVyfVxuICogQGlnbm9yZVxuICovXG5jbGFzcyBEZWZhdWx0QW5pbUJpbmRlciB7XG4gICAgY29uc3RydWN0b3IoZ3JhcGgpIHtcbiAgICAgICAgdGhpcy5ncmFwaCA9IGdyYXBoO1xuXG4gICAgICAgIGlmICghZ3JhcGgpIHJldHVybjtcblxuICAgICAgICB0aGlzLl9tYXNrID0gbnVsbDtcblxuICAgICAgICBjb25zdCBub2RlcyA9IHsgfTtcbiAgICAgICAgLy8gY2FjaGUgbm9kZSBuYW1lcyBzbyB3ZSBjYW4gcXVpY2tseSByZXNvbHZlIGFuaW1hdGlvbiBwYXRoc1xuICAgICAgICBjb25zdCBmbGF0dGVuID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgIG5vZGVzW25vZGUubmFtZV0gPSBub2RlO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2RlLmNoaWxkcmVuLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgZmxhdHRlbihub2RlLmNoaWxkcmVuW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgZmxhdHRlbihncmFwaCk7XG4gICAgICAgIHRoaXMubm9kZXMgPSBub2RlcztcbiAgICAgICAgdGhpcy50YXJnZXRDYWNoZSA9IHt9O1xuICAgICAgICAvLyAjaWYgX0RFQlVHXG4gICAgICAgIHRoaXMudmlzaXRlZEZhbGxiYWNrR3JhcGhQYXRocyA9IHt9O1xuICAgICAgICAvLyAjZW5kaWZcblxuICAgICAgICBjb25zdCBmaW5kTWVzaEluc3RhbmNlcyA9IGZ1bmN0aW9uIChub2RlKSB7XG5cbiAgICAgICAgICAgIC8vIHdhbGsgdXAgdG8gdGhlIGZpcnN0IHBhcmVudCBub2RlIG9mIGVudGl0eSB0eXBlIChza2lwcyBpbnRlcm5hbCBub2RlcyBvZiBNb2RlbClcbiAgICAgICAgICAgIGxldCBvYmplY3QgPSBub2RlO1xuICAgICAgICAgICAgd2hpbGUgKG9iamVjdCAmJiAhKG9iamVjdCBpbnN0YW5jZW9mIEVudGl0eSkpIHtcbiAgICAgICAgICAgICAgICBvYmplY3QgPSBvYmplY3QucGFyZW50O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBnZXQgbWVzaEluc3RhbmNlcyBmcm9tIGVpdGhlciBtb2RlbCBvciByZW5kZXIgY29tcG9uZW50XG4gICAgICAgICAgICBsZXQgbWVzaEluc3RhbmNlcztcbiAgICAgICAgICAgIGlmIChvYmplY3QpIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqZWN0LnJlbmRlcikge1xuICAgICAgICAgICAgICAgICAgICBtZXNoSW5zdGFuY2VzID0gb2JqZWN0LnJlbmRlci5tZXNoSW5zdGFuY2VzO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqZWN0Lm1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lc2hJbnN0YW5jZXMgPSBvYmplY3QubW9kZWwubWVzaEluc3RhbmNlcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbWVzaEluc3RhbmNlcztcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLm5vZGVDb3VudHMgPSB7fTsgICAgICAgICAgICAgICAvLyBtYXAgb2Ygbm9kZSBwYXRoIC0+IGNvdW50XG4gICAgICAgIHRoaXMuYWN0aXZlTm9kZXMgPSBbXTsgICAgICAgICAgICAgIC8vIGxpc3Qgb2YgYWN0aXZlIG5vZGVzXG4gICAgICAgIHRoaXMuaGFuZGxlcnMgPSB7XG4gICAgICAgICAgICAnbG9jYWxQb3NpdGlvbic6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0ID0gbm9kZS5sb2NhbFBvc2l0aW9uO1xuICAgICAgICAgICAgICAgIGNvbnN0IGZ1bmMgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnNldCguLi52YWx1ZSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gRGVmYXVsdEFuaW1CaW5kZXIuY3JlYXRlQW5pbVRhcmdldChmdW5jLCAndmVjdG9yJywgMywgbm9kZSwgJ2xvY2FsUG9zaXRpb24nKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdsb2NhbFJvdGF0aW9uJzogZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3QgPSBub2RlLmxvY2FsUm90YXRpb247XG4gICAgICAgICAgICAgICAgY29uc3QgZnVuYyA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBvYmplY3Quc2V0KC4uLnZhbHVlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBEZWZhdWx0QW5pbUJpbmRlci5jcmVhdGVBbmltVGFyZ2V0KGZ1bmMsICdxdWF0ZXJuaW9uJywgNCwgbm9kZSwgJ2xvY2FsUm90YXRpb24nKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdsb2NhbFNjYWxlJzogZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3QgPSBub2RlLmxvY2FsU2NhbGU7XG4gICAgICAgICAgICAgICAgY29uc3QgZnVuYyA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBvYmplY3Quc2V0KC4uLnZhbHVlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBEZWZhdWx0QW5pbUJpbmRlci5jcmVhdGVBbmltVGFyZ2V0KGZ1bmMsICd2ZWN0b3InLCAzLCBub2RlLCAnbG9jYWxTY2FsZScpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJ3dlaWdodCc6IGZ1bmN0aW9uIChub2RlLCB3ZWlnaHROYW1lKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdlaWdodE5hbWUuaW5kZXhPZignbmFtZS4nKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB3ZWlnaHROYW1lID0gd2VpZ2h0TmFtZS5yZXBsYWNlKCduYW1lLicsICcnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB3ZWlnaHROYW1lID0gTnVtYmVyKHdlaWdodE5hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBtZXNoSW5zdGFuY2VzID0gZmluZE1lc2hJbnN0YW5jZXMobm9kZSk7XG4gICAgICAgICAgICAgICAgbGV0IHNldHRlcnM7XG4gICAgICAgICAgICAgICAgaWYgKG1lc2hJbnN0YW5jZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtZXNoSW5zdGFuY2VzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobWVzaEluc3RhbmNlc1tpXS5ub2RlLm5hbWUgPT09IG5vZGUubmFtZSAmJiBtZXNoSW5zdGFuY2VzW2ldLm1vcnBoSW5zdGFuY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtb3JwaEluc3RhbmNlID0gbWVzaEluc3RhbmNlc1tpXS5tb3JwaEluc3RhbmNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZ1bmMgPSAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9ycGhJbnN0YW5jZS5zZXRXZWlnaHQod2VpZ2h0TmFtZSwgdmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzZXR0ZXJzKSBzZXR0ZXJzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGVycy5wdXNoKGZ1bmMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzZXR0ZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhbGxTZXR0ZXJzID0gKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNldHRlcnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0ZXJzW2ldKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIERlZmF1bHRBbmltQmluZGVyLmNyZWF0ZUFuaW1UYXJnZXQoY2FsbFNldHRlcnMsICdudW1iZXInLCAxLCBub2RlLCBgd2VpZ2h0LiR7d2VpZ2h0TmFtZX1gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ21hdGVyaWFsVGV4dHVyZSc6IChub2RlLCB0ZXh0dXJlTmFtZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1lc2hJbnN0YW5jZXMgPSBmaW5kTWVzaEluc3RhbmNlcyhub2RlKTtcbiAgICAgICAgICAgICAgICBpZiAobWVzaEluc3RhbmNlcykge1xuICAgICAgICAgICAgICAgICAgICBsZXQgbWVzaEluc3RhbmNlO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1lc2hJbnN0YW5jZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZXNoSW5zdGFuY2VzW2ldLm5vZGUubmFtZSA9PT0gbm9kZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzaEluc3RhbmNlID0gbWVzaEluc3RhbmNlc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobWVzaEluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmdW5jID0gKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dHVyZUFzc2V0ID0gdGhpcy5hbmltQ29tcG9uZW50LnN5c3RlbS5hcHAuYXNzZXRzLmdldCh2YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRleHR1cmVBc3NldCAmJiB0ZXh0dXJlQXNzZXQucmVzb3VyY2UgJiYgdGV4dHVyZUFzc2V0LnR5cGUgPT09ICd0ZXh0dXJlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNoSW5zdGFuY2UubWF0ZXJpYWxbdGV4dHVyZU5hbWVdID0gdGV4dHVyZUFzc2V0LnJlc291cmNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNoSW5zdGFuY2UubWF0ZXJpYWwudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBEZWZhdWx0QW5pbUJpbmRlci5jcmVhdGVBbmltVGFyZ2V0KGZ1bmMsICd2ZWN0b3InLCAxLCBub2RlLCAnbWF0ZXJpYWxUZXh0dXJlJywgJ21hdGVyaWFsJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBfaXNQYXRoSW5NYXNrID0gKHBhdGgsIGNoZWNrTWFza1ZhbHVlKSA9PiB7XG4gICAgICAgIGNvbnN0IG1hc2tJdGVtID0gdGhpcy5fbWFza1twYXRoXTtcbiAgICAgICAgaWYgKCFtYXNrSXRlbSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICBlbHNlIGlmIChtYXNrSXRlbS5jaGlsZHJlbiB8fCAoY2hlY2tNYXNrVmFsdWUgJiYgbWFza0l0ZW0udmFsdWUgIT09IGZhbHNlKSkgcmV0dXJuIHRydWU7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgX2lzUGF0aEFjdGl2ZShwYXRoKSB7XG4gICAgICAgIGlmICghdGhpcy5fbWFzaykgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgY29uc3Qgcm9vdE5vZGVOYW1lcyA9IFtwYXRoLmVudGl0eVBhdGhbMF0sIHRoaXMuZ3JhcGgubmFtZV07XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgcm9vdE5vZGVOYW1lcy5sZW5ndGg7ICsraikge1xuICAgICAgICAgICAgbGV0IGN1cnJFbnRpdHlQYXRoID0gcm9vdE5vZGVOYW1lc1tqXTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9pc1BhdGhJbk1hc2soY3VyckVudGl0eVBhdGgsIHBhdGguZW50aXR5UGF0aC5sZW5ndGggPT09IDEpKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcGF0aC5lbnRpdHlQYXRoLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY3VyckVudGl0eVBhdGggKz0gJy8nICsgcGF0aC5lbnRpdHlQYXRoW2ldO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc1BhdGhJbk1hc2soY3VyckVudGl0eVBhdGgsIGkgPT09IHBhdGguZW50aXR5UGF0aC5sZW5ndGggLSAxKSkgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGZpbmROb2RlKHBhdGgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9pc1BhdGhBY3RpdmUocGF0aCkpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG5vZGU7XG4gICAgICAgIGlmICh0aGlzLmdyYXBoKSB7XG4gICAgICAgICAgICBub2RlID0gdGhpcy5ncmFwaC5maW5kQnlQYXRoKHBhdGguZW50aXR5UGF0aCk7XG4gICAgICAgICAgICAvLyBpZiB0aGUgcGF0aCBpcyBub3QgZm91bmQgdW5kZXIgdGhlIGdpdmVuIHJvb3Qgbm9kZSwgdHJ5IHRvIGZpbmQgdGhlIHBhdGggdXNpbmcgdGhlIHJvb3Qgbm9kZSBhcyB0aGUgYmFzZSBvZiB0aGUgcGF0aCBpbnN0ZWFkXG4gICAgICAgICAgICBpZiAoIW5vZGUpIHtcbiAgICAgICAgICAgICAgICBub2RlID0gdGhpcy5ncmFwaC5maW5kQnlQYXRoKHBhdGguZW50aXR5UGF0aC5zbGljZSgxKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFub2RlKSB7XG4gICAgICAgICAgICBub2RlID0gdGhpcy5ub2Rlc1twYXRoLmVudGl0eVBhdGhbcGF0aC5lbnRpdHlQYXRoLmxlbmd0aCAtIDFdIHx8IFwiXCJdO1xuXG4gICAgICAgICAgICAvLyAjaWYgX0RFQlVHXG4gICAgICAgICAgICBjb25zdCBmYWxsYmFja0dyYXBoUGF0aCA9IEFuaW1CaW5kZXIuZW5jb2RlKHBhdGguZW50aXR5UGF0aFtwYXRoLmVudGl0eVBhdGgubGVuZ3RoIC0gMV0gfHwgXCJcIiwgJ2dyYXBoJywgcGF0aC5wcm9wZXJ0eVBhdGgpO1xuICAgICAgICAgICAgaWYgKHRoaXMudmlzaXRlZEZhbGxiYWNrR3JhcGhQYXRoc1tmYWxsYmFja0dyYXBoUGF0aF0gPT09IDEpIHtcbiAgICAgICAgICAgICAgICBEZWJ1Zy53YXJuKGBBbmltIEJpbmRlcjogTXVsdGlwbGUgYW5pbWF0aW9uIGN1cnZlcyB3aXRoIHRoZSBwYXRoICR7ZmFsbGJhY2tHcmFwaFBhdGh9IGFyZSBwcmVzZW50IGluIHRoZSAke3RoaXMuZ3JhcGgucGF0aH0gZ3JhcGggd2hpY2ggbWF5IHJlc3VsdCBpbiB0aGUgaW5jb3JyZWN0IGJpbmRpbmcgb2YgYW5pbWF0aW9uc2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNGaW5pdGUodGhpcy52aXNpdGVkRmFsbGJhY2tHcmFwaFBhdGhzW2ZhbGxiYWNrR3JhcGhQYXRoXSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZpc2l0ZWRGYWxsYmFja0dyYXBoUGF0aHNbZmFsbGJhY2tHcmFwaFBhdGhdID0gMDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52aXNpdGVkRmFsbGJhY2tHcmFwaFBhdGhzW2ZhbGxiYWNrR3JhcGhQYXRoXSsrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gI2VuZGlmXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgfVxuXG4gICAgc3RhdGljIGNyZWF0ZUFuaW1UYXJnZXQoZnVuYywgdHlwZSwgdmFsdWVDb3VudCwgbm9kZSwgcHJvcGVydHlQYXRoLCBjb21wb25lbnRUeXBlKSB7XG4gICAgICAgIGNvbnN0IHRhcmdldFBhdGggPSBBbmltQmluZGVyLmVuY29kZShub2RlLnBhdGgsIGNvbXBvbmVudFR5cGUgPyBjb21wb25lbnRUeXBlIDogJ2VudGl0eScsIHByb3BlcnR5UGF0aCk7XG4gICAgICAgIHJldHVybiBuZXcgQW5pbVRhcmdldChmdW5jLCB0eXBlLCB2YWx1ZUNvdW50LCB0YXJnZXRQYXRoKTtcbiAgICB9XG5cbiAgICByZXNvbHZlKHBhdGgpIHtcbiAgICAgICAgY29uc3QgZW5jb2RlZFBhdGggPSBBbmltQmluZGVyLmVuY29kZShwYXRoLmVudGl0eVBhdGgsIHBhdGguY29tcG9uZW50LCBwYXRoLnByb3BlcnR5UGF0aCk7XG4gICAgICAgIGxldCB0YXJnZXQgPSB0aGlzLnRhcmdldENhY2hlW2VuY29kZWRQYXRoXTtcbiAgICAgICAgaWYgKHRhcmdldCkgcmV0dXJuIHRhcmdldDtcblxuICAgICAgICBjb25zdCBub2RlID0gdGhpcy5maW5kTm9kZShwYXRoKTtcbiAgICAgICAgaWYgKCFub2RlKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGhhbmRsZXIgPSB0aGlzLmhhbmRsZXJzW3BhdGgucHJvcGVydHlQYXRoXTtcbiAgICAgICAgaWYgKCFoYW5kbGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRhcmdldCA9IGhhbmRsZXIobm9kZSk7XG4gICAgICAgIGlmICghdGFyZ2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudGFyZ2V0Q2FjaGVbZW5jb2RlZFBhdGhdID0gdGFyZ2V0O1xuXG4gICAgICAgIGlmICghdGhpcy5ub2RlQ291bnRzW25vZGUucGF0aF0pIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlTm9kZXMucHVzaChub2RlKTtcbiAgICAgICAgICAgIHRoaXMubm9kZUNvdW50c1tub2RlLnBhdGhdID0gMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubm9kZUNvdW50c1tub2RlLnBhdGhdKys7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgIH1cblxuICAgIHVucmVzb2x2ZShwYXRoKSB7XG4gICAgICAgIGlmIChwYXRoLmNvbXBvbmVudCAhPT0gJ2dyYXBoJylcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICBjb25zdCBub2RlID0gdGhpcy5ub2Rlc1twYXRoLmVudGl0eVBhdGhbcGF0aC5lbnRpdHlQYXRoLmxlbmd0aCAtIDFdIHx8IFwiXCJdO1xuXG4gICAgICAgIHRoaXMubm9kZUNvdW50c1tub2RlLnBhdGhdLS07XG4gICAgICAgIGlmICh0aGlzLm5vZGVDb3VudHNbbm9kZS5wYXRoXSA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3QgYWN0aXZlTm9kZXMgPSB0aGlzLmFjdGl2ZU5vZGVzO1xuICAgICAgICAgICAgY29uc3QgaSA9IGFjdGl2ZU5vZGVzLmluZGV4T2Yobm9kZS5ub2RlKTsgIC8vIDooXG4gICAgICAgICAgICBjb25zdCBsZW4gPSBhY3RpdmVOb2Rlcy5sZW5ndGg7XG4gICAgICAgICAgICBpZiAoaSA8IGxlbiAtIDEpIHtcbiAgICAgICAgICAgICAgICBhY3RpdmVOb2Rlc1tpXSA9IGFjdGl2ZU5vZGVzW2xlbiAtIDFdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYWN0aXZlTm9kZXMucG9wKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBmbGFnIGFuaW1hdGluZyBub2RlcyBhcyBkaXJ0eVxuICAgIHVwZGF0ZShkZWx0YVRpbWUpIHtcbiAgICAgICAgY29uc3QgYWN0aXZlTm9kZXMgPSB0aGlzLmFjdGl2ZU5vZGVzO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFjdGl2ZU5vZGVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBhY3RpdmVOb2Rlc1tpXS5fZGlydGlmeUxvY2FsKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3NpZ25NYXNrKG1hc2spIHtcbiAgICAgICAgaWYgKG1hc2sgIT09IHRoaXMuX21hc2spIHtcbiAgICAgICAgICAgIHRoaXMuX21hc2sgPSBtYXNrO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgRGVmYXVsdEFuaW1CaW5kZXIgfTtcbiJdLCJuYW1lcyI6WyJEZWZhdWx0QW5pbUJpbmRlciIsImNvbnN0cnVjdG9yIiwiZ3JhcGgiLCJfaXNQYXRoSW5NYXNrIiwicGF0aCIsImNoZWNrTWFza1ZhbHVlIiwibWFza0l0ZW0iLCJfbWFzayIsImNoaWxkcmVuIiwidmFsdWUiLCJub2RlcyIsImZsYXR0ZW4iLCJub2RlIiwibmFtZSIsImkiLCJsZW5ndGgiLCJ0YXJnZXRDYWNoZSIsInZpc2l0ZWRGYWxsYmFja0dyYXBoUGF0aHMiLCJmaW5kTWVzaEluc3RhbmNlcyIsIm9iamVjdCIsIkVudGl0eSIsInBhcmVudCIsIm1lc2hJbnN0YW5jZXMiLCJyZW5kZXIiLCJtb2RlbCIsIm5vZGVDb3VudHMiLCJhY3RpdmVOb2RlcyIsImhhbmRsZXJzIiwibG9jYWxQb3NpdGlvbiIsImZ1bmMiLCJzZXQiLCJjcmVhdGVBbmltVGFyZ2V0IiwibG9jYWxSb3RhdGlvbiIsImxvY2FsU2NhbGUiLCJ3ZWlnaHROYW1lIiwiaW5kZXhPZiIsInJlcGxhY2UiLCJOdW1iZXIiLCJzZXR0ZXJzIiwibW9ycGhJbnN0YW5jZSIsInNldFdlaWdodCIsInB1c2giLCJjYWxsU2V0dGVycyIsInRleHR1cmVOYW1lIiwibWVzaEluc3RhbmNlIiwidGV4dHVyZUFzc2V0IiwiYW5pbUNvbXBvbmVudCIsInN5c3RlbSIsImFwcCIsImFzc2V0cyIsImdldCIsInJlc291cmNlIiwidHlwZSIsIm1hdGVyaWFsIiwidXBkYXRlIiwiX2lzUGF0aEFjdGl2ZSIsInJvb3ROb2RlTmFtZXMiLCJlbnRpdHlQYXRoIiwiaiIsImN1cnJFbnRpdHlQYXRoIiwiZmluZE5vZGUiLCJmaW5kQnlQYXRoIiwic2xpY2UiLCJmYWxsYmFja0dyYXBoUGF0aCIsIkFuaW1CaW5kZXIiLCJlbmNvZGUiLCJwcm9wZXJ0eVBhdGgiLCJEZWJ1ZyIsIndhcm4iLCJpc0Zpbml0ZSIsInZhbHVlQ291bnQiLCJjb21wb25lbnRUeXBlIiwidGFyZ2V0UGF0aCIsIkFuaW1UYXJnZXQiLCJyZXNvbHZlIiwiZW5jb2RlZFBhdGgiLCJjb21wb25lbnQiLCJ0YXJnZXQiLCJoYW5kbGVyIiwidW5yZXNvbHZlIiwibGVuIiwicG9wIiwiZGVsdGFUaW1lIiwiX2RpcnRpZnlMb2NhbCIsImFzc2lnbk1hc2siLCJtYXNrIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsaUJBQWlCLENBQUM7RUFDcEJDLFdBQVcsQ0FBQ0MsS0FBSyxFQUFFO0FBQUEsSUFBQSxJQUFBLENBOEhuQkMsYUFBYSxHQUFHLENBQUNDLElBQUksRUFBRUMsY0FBYyxLQUFLO0FBQ3RDLE1BQUEsTUFBTUMsUUFBUSxHQUFHLElBQUksQ0FBQ0MsS0FBSyxDQUFDSCxJQUFJLENBQUMsQ0FBQTtNQUNqQyxJQUFJLENBQUNFLFFBQVEsRUFBRSxPQUFPLEtBQUssQ0FBQyxLQUN2QixJQUFJQSxRQUFRLENBQUNFLFFBQVEsSUFBS0gsY0FBYyxJQUFJQyxRQUFRLENBQUNHLEtBQUssS0FBSyxLQUFNLEVBQUUsT0FBTyxJQUFJLENBQUE7QUFDdkYsTUFBQSxPQUFPLEtBQUssQ0FBQTtLQUNmLENBQUE7SUFsSUcsSUFBSSxDQUFDUCxLQUFLLEdBQUdBLEtBQUssQ0FBQTtJQUVsQixJQUFJLENBQUNBLEtBQUssRUFBRSxPQUFBO0lBRVosSUFBSSxDQUFDSyxLQUFLLEdBQUcsSUFBSSxDQUFBO0lBRWpCLE1BQU1HLEtBQUssR0FBRyxFQUFHLENBQUE7QUFDakI7QUFDQSxJQUFBLE1BQU1DLE9BQU8sR0FBRyxTQUFWQSxPQUFPLENBQWFDLElBQUksRUFBRTtBQUM1QkYsTUFBQUEsS0FBSyxDQUFDRSxJQUFJLENBQUNDLElBQUksQ0FBQyxHQUFHRCxJQUFJLENBQUE7QUFDdkIsTUFBQSxLQUFLLElBQUlFLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR0YsSUFBSSxDQUFDSixRQUFRLENBQUNPLE1BQU0sRUFBRSxFQUFFRCxDQUFDLEVBQUU7QUFDM0NILFFBQUFBLE9BQU8sQ0FBQ0MsSUFBSSxDQUFDSixRQUFRLENBQUNNLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDN0IsT0FBQTtLQUNILENBQUE7SUFDREgsT0FBTyxDQUFDVCxLQUFLLENBQUMsQ0FBQTtJQUNkLElBQUksQ0FBQ1EsS0FBSyxHQUFHQSxLQUFLLENBQUE7QUFDbEIsSUFBQSxJQUFJLENBQUNNLFdBQVcsR0FBRyxFQUFFLENBQUE7QUFFckIsSUFBQSxJQUFJLENBQUNDLHlCQUF5QixHQUFHLEVBQUUsQ0FBQTtBQUduQyxJQUFBLE1BQU1DLGlCQUFpQixHQUFHLFNBQXBCQSxpQkFBaUIsQ0FBYU4sSUFBSSxFQUFFO0FBRXRDO01BQ0EsSUFBSU8sTUFBTSxHQUFHUCxJQUFJLENBQUE7QUFDakIsTUFBQSxPQUFPTyxNQUFNLElBQUksRUFBRUEsTUFBTSxZQUFZQyxNQUFNLENBQUMsRUFBRTtRQUMxQ0QsTUFBTSxHQUFHQSxNQUFNLENBQUNFLE1BQU0sQ0FBQTtBQUMxQixPQUFBOztBQUVBO0FBQ0EsTUFBQSxJQUFJQyxhQUFhLENBQUE7QUFDakIsTUFBQSxJQUFJSCxNQUFNLEVBQUU7UUFDUixJQUFJQSxNQUFNLENBQUNJLE1BQU0sRUFBRTtBQUNmRCxVQUFBQSxhQUFhLEdBQUdILE1BQU0sQ0FBQ0ksTUFBTSxDQUFDRCxhQUFhLENBQUE7QUFDL0MsU0FBQyxNQUFNLElBQUlILE1BQU0sQ0FBQ0ssS0FBSyxFQUFFO0FBQ3JCRixVQUFBQSxhQUFhLEdBQUdILE1BQU0sQ0FBQ0ssS0FBSyxDQUFDRixhQUFhLENBQUE7QUFDOUMsU0FBQTtBQUNKLE9BQUE7QUFDQSxNQUFBLE9BQU9BLGFBQWEsQ0FBQTtLQUN2QixDQUFBO0FBRUQsSUFBQSxJQUFJLENBQUNHLFVBQVUsR0FBRyxFQUFFLENBQUM7QUFDckIsSUFBQSxJQUFJLENBQUNDLFdBQVcsR0FBRyxFQUFFLENBQUM7SUFDdEIsSUFBSSxDQUFDQyxRQUFRLEdBQUc7TUFDWixlQUFlLEVBQUUsVUFBVWYsSUFBSSxFQUFFO0FBQzdCLFFBQUEsTUFBTU8sTUFBTSxHQUFHUCxJQUFJLENBQUNnQixhQUFhLENBQUE7QUFDakMsUUFBQSxNQUFNQyxJQUFJLEdBQUcsU0FBUEEsSUFBSSxDQUFhcEIsS0FBSyxFQUFFO0FBQzFCVSxVQUFBQSxNQUFNLENBQUNXLEdBQUcsQ0FBQyxHQUFHckIsS0FBSyxDQUFDLENBQUE7U0FDdkIsQ0FBQTtBQUNELFFBQUEsT0FBT1QsaUJBQWlCLENBQUMrQixnQkFBZ0IsQ0FBQ0YsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUVqQixJQUFJLEVBQUUsZUFBZSxDQUFDLENBQUE7T0FDdEY7TUFFRCxlQUFlLEVBQUUsVUFBVUEsSUFBSSxFQUFFO0FBQzdCLFFBQUEsTUFBTU8sTUFBTSxHQUFHUCxJQUFJLENBQUNvQixhQUFhLENBQUE7QUFDakMsUUFBQSxNQUFNSCxJQUFJLEdBQUcsU0FBUEEsSUFBSSxDQUFhcEIsS0FBSyxFQUFFO0FBQzFCVSxVQUFBQSxNQUFNLENBQUNXLEdBQUcsQ0FBQyxHQUFHckIsS0FBSyxDQUFDLENBQUE7U0FDdkIsQ0FBQTtBQUNELFFBQUEsT0FBT1QsaUJBQWlCLENBQUMrQixnQkFBZ0IsQ0FBQ0YsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDLEVBQUVqQixJQUFJLEVBQUUsZUFBZSxDQUFDLENBQUE7T0FDMUY7TUFFRCxZQUFZLEVBQUUsVUFBVUEsSUFBSSxFQUFFO0FBQzFCLFFBQUEsTUFBTU8sTUFBTSxHQUFHUCxJQUFJLENBQUNxQixVQUFVLENBQUE7QUFDOUIsUUFBQSxNQUFNSixJQUFJLEdBQUcsU0FBUEEsSUFBSSxDQUFhcEIsS0FBSyxFQUFFO0FBQzFCVSxVQUFBQSxNQUFNLENBQUNXLEdBQUcsQ0FBQyxHQUFHckIsS0FBSyxDQUFDLENBQUE7U0FDdkIsQ0FBQTtBQUNELFFBQUEsT0FBT1QsaUJBQWlCLENBQUMrQixnQkFBZ0IsQ0FBQ0YsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUVqQixJQUFJLEVBQUUsWUFBWSxDQUFDLENBQUE7T0FDbkY7QUFFRCxNQUFBLFFBQVEsRUFBRSxVQUFVQSxJQUFJLEVBQUVzQixVQUFVLEVBQUU7UUFDbEMsSUFBSUEsVUFBVSxDQUFDQyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO1VBQ25DRCxVQUFVLEdBQUdBLFVBQVUsQ0FBQ0UsT0FBTyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQTtBQUNoRCxTQUFDLE1BQU07QUFDSEYsVUFBQUEsVUFBVSxHQUFHRyxNQUFNLENBQUNILFVBQVUsQ0FBQyxDQUFBO0FBQ25DLFNBQUE7QUFDQSxRQUFBLE1BQU1aLGFBQWEsR0FBR0osaUJBQWlCLENBQUNOLElBQUksQ0FBQyxDQUFBO0FBQzdDLFFBQUEsSUFBSTBCLE9BQU8sQ0FBQTtBQUNYLFFBQUEsSUFBSWhCLGFBQWEsRUFBRTtBQUNmLFVBQUEsS0FBSyxJQUFJUixDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUdRLGFBQWEsQ0FBQ1AsTUFBTSxFQUFFLEVBQUVELENBQUMsRUFBRTtBQUMzQyxZQUFBLElBQUlRLGFBQWEsQ0FBQ1IsQ0FBQyxDQUFDLENBQUNGLElBQUksQ0FBQ0MsSUFBSSxLQUFLRCxJQUFJLENBQUNDLElBQUksSUFBSVMsYUFBYSxDQUFDUixDQUFDLENBQUMsQ0FBQ3lCLGFBQWEsRUFBRTtBQUM1RSxjQUFBLE1BQU1BLGFBQWEsR0FBR2pCLGFBQWEsQ0FBQ1IsQ0FBQyxDQUFDLENBQUN5QixhQUFhLENBQUE7Y0FDcEQsTUFBTVYsSUFBSSxHQUFJcEIsS0FBSyxJQUFLO2dCQUNwQjhCLGFBQWEsQ0FBQ0MsU0FBUyxDQUFDTixVQUFVLEVBQUV6QixLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtlQUNoRCxDQUFBO0FBQ0QsY0FBQSxJQUFJLENBQUM2QixPQUFPLEVBQUVBLE9BQU8sR0FBRyxFQUFFLENBQUE7QUFDMUJBLGNBQUFBLE9BQU8sQ0FBQ0csSUFBSSxDQUFDWixJQUFJLENBQUMsQ0FBQTtBQUN0QixhQUFBO0FBQ0osV0FBQTtBQUNKLFNBQUE7QUFDQSxRQUFBLElBQUlTLE9BQU8sRUFBRTtVQUNULE1BQU1JLFdBQVcsR0FBSWpDLEtBQUssSUFBSztBQUMzQixZQUFBLEtBQUssSUFBSUssQ0FBQyxHQUFHLENBQUMsRUFBRUEsQ0FBQyxHQUFHd0IsT0FBTyxDQUFDdkIsTUFBTSxFQUFFLEVBQUVELENBQUMsRUFBRTtBQUNyQ3dCLGNBQUFBLE9BQU8sQ0FBQ3hCLENBQUMsQ0FBQyxDQUFDTCxLQUFLLENBQUMsQ0FBQTtBQUNyQixhQUFBO1dBQ0gsQ0FBQTtBQUNELFVBQUEsT0FBT1QsaUJBQWlCLENBQUMrQixnQkFBZ0IsQ0FBQ1csV0FBVyxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUU5QixJQUFJLEVBQUcsQ0FBU3NCLE9BQUFBLEVBQUFBLFVBQVcsRUFBQyxDQUFDLENBQUE7QUFDckcsU0FBQTtBQUNBLFFBQUEsT0FBTyxJQUFJLENBQUE7T0FDZDtBQUNELE1BQUEsaUJBQWlCLEVBQUUsQ0FBQ3RCLElBQUksRUFBRStCLFdBQVcsS0FBSztBQUN0QyxRQUFBLE1BQU1yQixhQUFhLEdBQUdKLGlCQUFpQixDQUFDTixJQUFJLENBQUMsQ0FBQTtBQUM3QyxRQUFBLElBQUlVLGFBQWEsRUFBRTtBQUNmLFVBQUEsSUFBSXNCLFlBQVksQ0FBQTtBQUNoQixVQUFBLEtBQUssSUFBSTlCLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR1EsYUFBYSxDQUFDUCxNQUFNLEVBQUUsRUFBRUQsQ0FBQyxFQUFFO0FBQzNDLFlBQUEsSUFBSVEsYUFBYSxDQUFDUixDQUFDLENBQUMsQ0FBQ0YsSUFBSSxDQUFDQyxJQUFJLEtBQUtELElBQUksQ0FBQ0MsSUFBSSxFQUFFO0FBQzFDK0IsY0FBQUEsWUFBWSxHQUFHdEIsYUFBYSxDQUFDUixDQUFDLENBQUMsQ0FBQTtBQUMvQixjQUFBLE1BQUE7QUFDSixhQUFBO0FBQ0osV0FBQTtBQUNBLFVBQUEsSUFBSThCLFlBQVksRUFBRTtZQUNkLE1BQU1mLElBQUksR0FBSXBCLEtBQUssSUFBSztBQUNwQixjQUFBLE1BQU1vQyxZQUFZLEdBQUcsSUFBSSxDQUFDQyxhQUFhLENBQUNDLE1BQU0sQ0FBQ0MsR0FBRyxDQUFDQyxNQUFNLENBQUNDLEdBQUcsQ0FBQ3pDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO2NBQ3ZFLElBQUlvQyxZQUFZLElBQUlBLFlBQVksQ0FBQ00sUUFBUSxJQUFJTixZQUFZLENBQUNPLElBQUksS0FBSyxTQUFTLEVBQUU7Z0JBQzFFUixZQUFZLENBQUNTLFFBQVEsQ0FBQ1YsV0FBVyxDQUFDLEdBQUdFLFlBQVksQ0FBQ00sUUFBUSxDQUFBO0FBQzFEUCxnQkFBQUEsWUFBWSxDQUFDUyxRQUFRLENBQUNDLE1BQU0sRUFBRSxDQUFBO0FBQ2xDLGVBQUE7YUFDSCxDQUFBO0FBQ0QsWUFBQSxPQUFPdEQsaUJBQWlCLENBQUMrQixnQkFBZ0IsQ0FBQ0YsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUVqQixJQUFJLEVBQUUsaUJBQWlCLEVBQUUsVUFBVSxDQUFDLENBQUE7QUFDckcsV0FBQTtBQUNKLFNBQUE7QUFFQSxRQUFBLE9BQU8sSUFBSSxDQUFBO0FBQ2YsT0FBQTtLQUNILENBQUE7QUFDTCxHQUFBO0VBU0EyQyxhQUFhLENBQUNuRCxJQUFJLEVBQUU7QUFDaEIsSUFBQSxJQUFJLENBQUMsSUFBSSxDQUFDRyxLQUFLLEVBQUUsT0FBTyxJQUFJLENBQUE7QUFFNUIsSUFBQSxNQUFNaUQsYUFBYSxHQUFHLENBQUNwRCxJQUFJLENBQUNxRCxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDdkQsS0FBSyxDQUFDVyxJQUFJLENBQUMsQ0FBQTtBQUMzRCxJQUFBLEtBQUssSUFBSTZDLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR0YsYUFBYSxDQUFDekMsTUFBTSxFQUFFLEVBQUUyQyxDQUFDLEVBQUU7QUFDM0MsTUFBQSxJQUFJQyxjQUFjLEdBQUdILGFBQWEsQ0FBQ0UsQ0FBQyxDQUFDLENBQUE7QUFDckMsTUFBQSxJQUFJLElBQUksQ0FBQ3ZELGFBQWEsQ0FBQ3dELGNBQWMsRUFBRXZELElBQUksQ0FBQ3FELFVBQVUsQ0FBQzFDLE1BQU0sS0FBSyxDQUFDLENBQUMsRUFBRSxPQUFPLElBQUksQ0FBQTtBQUNqRixNQUFBLEtBQUssSUFBSUQsQ0FBQyxHQUFHLENBQUMsRUFBRUEsQ0FBQyxHQUFHVixJQUFJLENBQUNxRCxVQUFVLENBQUMxQyxNQUFNLEVBQUVELENBQUMsRUFBRSxFQUFFO1FBQzdDNkMsY0FBYyxJQUFJLEdBQUcsR0FBR3ZELElBQUksQ0FBQ3FELFVBQVUsQ0FBQzNDLENBQUMsQ0FBQyxDQUFBO0FBQzFDLFFBQUEsSUFBSSxJQUFJLENBQUNYLGFBQWEsQ0FBQ3dELGNBQWMsRUFBRTdDLENBQUMsS0FBS1YsSUFBSSxDQUFDcUQsVUFBVSxDQUFDMUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxFQUFFLE9BQU8sSUFBSSxDQUFBO0FBQ3pGLE9BQUE7QUFDSixLQUFBO0FBQ0EsSUFBQSxPQUFPLEtBQUssQ0FBQTtBQUNoQixHQUFBO0VBRUE2QyxRQUFRLENBQUN4RCxJQUFJLEVBQUU7QUFDWCxJQUFBLElBQUksQ0FBQyxJQUFJLENBQUNtRCxhQUFhLENBQUNuRCxJQUFJLENBQUMsRUFBRTtBQUMzQixNQUFBLE9BQU8sSUFBSSxDQUFBO0FBQ2YsS0FBQTtBQUVBLElBQUEsSUFBSVEsSUFBSSxDQUFBO0lBQ1IsSUFBSSxJQUFJLENBQUNWLEtBQUssRUFBRTtNQUNaVSxJQUFJLEdBQUcsSUFBSSxDQUFDVixLQUFLLENBQUMyRCxVQUFVLENBQUN6RCxJQUFJLENBQUNxRCxVQUFVLENBQUMsQ0FBQTtBQUM3QztNQUNBLElBQUksQ0FBQzdDLElBQUksRUFBRTtBQUNQQSxRQUFBQSxJQUFJLEdBQUcsSUFBSSxDQUFDVixLQUFLLENBQUMyRCxVQUFVLENBQUN6RCxJQUFJLENBQUNxRCxVQUFVLENBQUNLLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQzFELE9BQUE7QUFDSixLQUFBO0lBQ0EsSUFBSSxDQUFDbEQsSUFBSSxFQUFFO0FBQ1BBLE1BQUFBLElBQUksR0FBRyxJQUFJLENBQUNGLEtBQUssQ0FBQ04sSUFBSSxDQUFDcUQsVUFBVSxDQUFDckQsSUFBSSxDQUFDcUQsVUFBVSxDQUFDMUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFBO01BR3BFLE1BQU1nRCxpQkFBaUIsR0FBR0MsVUFBVSxDQUFDQyxNQUFNLENBQUM3RCxJQUFJLENBQUNxRCxVQUFVLENBQUNyRCxJQUFJLENBQUNxRCxVQUFVLENBQUMxQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLE9BQU8sRUFBRVgsSUFBSSxDQUFDOEQsWUFBWSxDQUFDLENBQUE7TUFDMUgsSUFBSSxJQUFJLENBQUNqRCx5QkFBeUIsQ0FBQzhDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxFQUFFO0FBQ3pESSxRQUFBQSxLQUFLLENBQUNDLElBQUksQ0FBRSxDQUFBLHFEQUFBLEVBQXVETCxpQkFBa0IsQ0FBQSxvQkFBQSxFQUFzQixJQUFJLENBQUM3RCxLQUFLLENBQUNFLElBQUssQ0FBQSw4REFBQSxDQUErRCxDQUFDLENBQUE7QUFDL0wsT0FBQTtBQUNBLE1BQUEsSUFBSSxDQUFDaUMsTUFBTSxDQUFDZ0MsUUFBUSxDQUFDLElBQUksQ0FBQ3BELHlCQUF5QixDQUFDOEMsaUJBQWlCLENBQUMsQ0FBQyxFQUFFO0FBQ3JFLFFBQUEsSUFBSSxDQUFDOUMseUJBQXlCLENBQUM4QyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQTtBQUN6RCxPQUFDLE1BQU07QUFDSCxRQUFBLElBQUksQ0FBQzlDLHlCQUF5QixDQUFDOEMsaUJBQWlCLENBQUMsRUFBRSxDQUFBO0FBQ3ZELE9BQUE7QUFFSixLQUFBO0FBQ0EsSUFBQSxPQUFPbkQsSUFBSSxDQUFBO0FBQ2YsR0FBQTtBQUVBLEVBQUEsT0FBT21CLGdCQUFnQixDQUFDRixJQUFJLEVBQUV1QixJQUFJLEVBQUVrQixVQUFVLEVBQUUxRCxJQUFJLEVBQUVzRCxZQUFZLEVBQUVLLGFBQWEsRUFBRTtBQUMvRSxJQUFBLE1BQU1DLFVBQVUsR0FBR1IsVUFBVSxDQUFDQyxNQUFNLENBQUNyRCxJQUFJLENBQUNSLElBQUksRUFBRW1FLGFBQWEsR0FBR0EsYUFBYSxHQUFHLFFBQVEsRUFBRUwsWUFBWSxDQUFDLENBQUE7SUFDdkcsT0FBTyxJQUFJTyxVQUFVLENBQUM1QyxJQUFJLEVBQUV1QixJQUFJLEVBQUVrQixVQUFVLEVBQUVFLFVBQVUsQ0FBQyxDQUFBO0FBQzdELEdBQUE7RUFFQUUsT0FBTyxDQUFDdEUsSUFBSSxFQUFFO0FBQ1YsSUFBQSxNQUFNdUUsV0FBVyxHQUFHWCxVQUFVLENBQUNDLE1BQU0sQ0FBQzdELElBQUksQ0FBQ3FELFVBQVUsRUFBRXJELElBQUksQ0FBQ3dFLFNBQVMsRUFBRXhFLElBQUksQ0FBQzhELFlBQVksQ0FBQyxDQUFBO0FBQ3pGLElBQUEsSUFBSVcsTUFBTSxHQUFHLElBQUksQ0FBQzdELFdBQVcsQ0FBQzJELFdBQVcsQ0FBQyxDQUFBO0lBQzFDLElBQUlFLE1BQU0sRUFBRSxPQUFPQSxNQUFNLENBQUE7QUFFekIsSUFBQSxNQUFNakUsSUFBSSxHQUFHLElBQUksQ0FBQ2dELFFBQVEsQ0FBQ3hELElBQUksQ0FBQyxDQUFBO0lBQ2hDLElBQUksQ0FBQ1EsSUFBSSxFQUFFO0FBQ1AsTUFBQSxPQUFPLElBQUksQ0FBQTtBQUNmLEtBQUE7SUFFQSxNQUFNa0UsT0FBTyxHQUFHLElBQUksQ0FBQ25ELFFBQVEsQ0FBQ3ZCLElBQUksQ0FBQzhELFlBQVksQ0FBQyxDQUFBO0lBQ2hELElBQUksQ0FBQ1ksT0FBTyxFQUFFO0FBQ1YsTUFBQSxPQUFPLElBQUksQ0FBQTtBQUNmLEtBQUE7QUFFQUQsSUFBQUEsTUFBTSxHQUFHQyxPQUFPLENBQUNsRSxJQUFJLENBQUMsQ0FBQTtJQUN0QixJQUFJLENBQUNpRSxNQUFNLEVBQUU7QUFDVCxNQUFBLE9BQU8sSUFBSSxDQUFBO0FBQ2YsS0FBQTtBQUVBLElBQUEsSUFBSSxDQUFDN0QsV0FBVyxDQUFDMkQsV0FBVyxDQUFDLEdBQUdFLE1BQU0sQ0FBQTtJQUV0QyxJQUFJLENBQUMsSUFBSSxDQUFDcEQsVUFBVSxDQUFDYixJQUFJLENBQUNSLElBQUksQ0FBQyxFQUFFO0FBQzdCLE1BQUEsSUFBSSxDQUFDc0IsV0FBVyxDQUFDZSxJQUFJLENBQUM3QixJQUFJLENBQUMsQ0FBQTtNQUMzQixJQUFJLENBQUNhLFVBQVUsQ0FBQ2IsSUFBSSxDQUFDUixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDbEMsS0FBQyxNQUFNO0FBQ0gsTUFBQSxJQUFJLENBQUNxQixVQUFVLENBQUNiLElBQUksQ0FBQ1IsSUFBSSxDQUFDLEVBQUUsQ0FBQTtBQUNoQyxLQUFBO0FBRUEsSUFBQSxPQUFPeUUsTUFBTSxDQUFBO0FBQ2pCLEdBQUE7RUFFQUUsU0FBUyxDQUFDM0UsSUFBSSxFQUFFO0FBQ1osSUFBQSxJQUFJQSxJQUFJLENBQUN3RSxTQUFTLEtBQUssT0FBTyxFQUMxQixPQUFBO0lBRUosTUFBTWhFLElBQUksR0FBRyxJQUFJLENBQUNGLEtBQUssQ0FBQ04sSUFBSSxDQUFDcUQsVUFBVSxDQUFDckQsSUFBSSxDQUFDcUQsVUFBVSxDQUFDMUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFBO0FBRTFFLElBQUEsSUFBSSxDQUFDVSxVQUFVLENBQUNiLElBQUksQ0FBQ1IsSUFBSSxDQUFDLEVBQUUsQ0FBQTtJQUM1QixJQUFJLElBQUksQ0FBQ3FCLFVBQVUsQ0FBQ2IsSUFBSSxDQUFDUixJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUU7QUFDbEMsTUFBQSxNQUFNc0IsV0FBVyxHQUFHLElBQUksQ0FBQ0EsV0FBVyxDQUFBO01BQ3BDLE1BQU1aLENBQUMsR0FBR1ksV0FBVyxDQUFDUyxPQUFPLENBQUN2QixJQUFJLENBQUNBLElBQUksQ0FBQyxDQUFDO0FBQ3pDLE1BQUEsTUFBTW9FLEdBQUcsR0FBR3RELFdBQVcsQ0FBQ1gsTUFBTSxDQUFBO0FBQzlCLE1BQUEsSUFBSUQsQ0FBQyxHQUFHa0UsR0FBRyxHQUFHLENBQUMsRUFBRTtRQUNidEQsV0FBVyxDQUFDWixDQUFDLENBQUMsR0FBR1ksV0FBVyxDQUFDc0QsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFBO0FBQ3pDLE9BQUE7TUFDQXRELFdBQVcsQ0FBQ3VELEdBQUcsRUFBRSxDQUFBO0FBQ3JCLEtBQUE7QUFDSixHQUFBOztBQUVBO0VBQ0EzQixNQUFNLENBQUM0QixTQUFTLEVBQUU7QUFDZCxJQUFBLE1BQU14RCxXQUFXLEdBQUcsSUFBSSxDQUFDQSxXQUFXLENBQUE7QUFDcEMsSUFBQSxLQUFLLElBQUlaLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR1ksV0FBVyxDQUFDWCxNQUFNLEVBQUUsRUFBRUQsQ0FBQyxFQUFFO0FBQ3pDWSxNQUFBQSxXQUFXLENBQUNaLENBQUMsQ0FBQyxDQUFDcUUsYUFBYSxFQUFFLENBQUE7QUFDbEMsS0FBQTtBQUNKLEdBQUE7RUFFQUMsVUFBVSxDQUFDQyxJQUFJLEVBQUU7QUFDYixJQUFBLElBQUlBLElBQUksS0FBSyxJQUFJLENBQUM5RSxLQUFLLEVBQUU7TUFDckIsSUFBSSxDQUFDQSxLQUFLLEdBQUc4RSxJQUFJLENBQUE7QUFDakIsTUFBQSxPQUFPLElBQUksQ0FBQTtBQUNmLEtBQUE7QUFDQSxJQUFBLE9BQU8sS0FBSyxDQUFBO0FBQ2hCLEdBQUE7QUFDSjs7OzsifQ==
