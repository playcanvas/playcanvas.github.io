import"../../core/tracing.js";import{UNIFORMTYPE_FLOAT as t,UNIFORMTYPE_VEC2 as o,UNIFORMTYPE_VEC3 as s,UNIFORMTYPE_VEC4 as e,UNIFORMTYPE_INT as r,UNIFORMTYPE_IVEC2 as n,UNIFORMTYPE_IVEC3 as a,UNIFORMTYPE_IVEC4 as i,UNIFORMTYPE_MAT2 as c,UNIFORMTYPE_MAT3 as l,UNIFORMTYPE_FLOATARRAY as f,UNIFORMTYPE_VEC2ARRAY as h,UNIFORMTYPE_VEC3ARRAY as g}from"./constants.js";const m=[];m[t]=function(t,o,s){t.storageFloat32[s]=o},m[o]=(t,o,s)=>{const e=t.storageFloat32;e[s]=o[0],e[s+1]=o[1]},m[s]=(t,o,s)=>{const e=t.storageFloat32;e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2]},m[e]=(t,o,s)=>{const e=t.storageFloat32;e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]},m[r]=function(t,o,s){t.storageInt32[s]=o},m[n]=function(t,o,s){const e=t.storageInt32;e[s]=o[0],e[s+1]=o[1]},m[a]=function(t,o,s){const e=t.storageInt32;e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2]},m[i]=function(t,o,s){const e=t.storageInt32;e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]},m[c]=(t,o,s)=>{const e=t.storageFloat32;e[s]=o[0],e[s+1]=o[1],e[s+4]=o[2],e[s+5]=o[3],e[s+8]=o[4],e[s+9]=o[5]},m[l]=(t,o,s)=>{const e=t.storageFloat32;e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+4]=o[3],e[s+5]=o[4],e[s+6]=o[5],e[s+8]=o[6],e[s+9]=o[7],e[s+10]=o[8]},m[f]=function(t,o,s,e){const r=t.storageFloat32;for(let t=0;t<e;t++)r[s+4*t]=o[t]},m[h]=(t,o,s,e)=>{const r=t.storageFloat32;for(let t=0;t<e;t++)r[s+4*t]=o[2*t],r[s+4*t+1]=o[2*t+1]},m[g]=(t,o,s,e)=>{const r=t.storageFloat32;for(let t=0;t<e;t++)r[s+4*t]=o[3*t],r[s+4*t+1]=o[3*t+1],r[s+4*t+2]=o[3*t+2]};class u{constructor(t,o){this.device=t,this.format=o,this.impl=t.createUniformBufferImpl(this),this.storage=new ArrayBuffer(o.byteSize),this.storageFloat32=new Float32Array(this.storage),this.storageInt32=new Int32Array(this.storage),t._vram.ub+=this.format.byteSize}destroy(){const t=this.device;this.impl.destroy(t),t._vram.ub-=this.format.byteSize}loseContext(){this.impl.loseContext()}setUniform(t){const o=t.offset,s=t.scopeId.value;if(null!=s){const e=m[t.updateType];e?e(this,s,o,t.count):this.storageFloat32.set(s,o)}}set(t){const o=this.format.map.get(t);o&&this.setUniform(o)}update(){const t=this.format.uniforms;for(let o=0;o<t.length;o++)this.setUniform(t[o]);this.impl.unlock(this)}}export{u as UniformBuffer};
