/**
 * @license
 * PlayCanvas Engine v1.58.0-preview revision 1fec26519 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { platform } from '../../../core/platform.js';
import { EventHandler } from '../../../core/event-handler.js';
import { Quat } from '../../../core/math/quat.js';
import { Vec2 } from '../../../core/math/vec2.js';
import { Vec3 } from '../../../core/math/vec3.js';
import { ElementComponent } from './component.js';
import { Ray } from '../../../core/shape/ray.js';
import { Plane } from '../../../core/shape/plane.js';

const _inputScreenPosition = new Vec2();
const _inputWorldPosition = new Vec3();
const _ray = new Ray();
const _plane = new Plane();
const _entityRotation = new Quat();
const OPPOSITE_AXIS = {
  x: 'y',
  y: 'x'
};

class ElementDragHelper extends EventHandler {
  constructor(element, axis) {
    super();
    if (!element || !(element instanceof ElementComponent)) {
      throw new Error('Element was null or not an ElementComponent');
    }
    if (axis && axis !== 'x' && axis !== 'y') {
      throw new Error('Unrecognized axis: ' + axis);
    }
    this._element = element;
    this._app = element.system.app;
    this._axis = axis || null;
    this._enabled = true;
    this._dragScale = new Vec3();
    this._dragStartMousePosition = new Vec3();
    this._dragStartHandlePosition = new Vec3();
    this._deltaMousePosition = new Vec3();
    this._deltaHandlePosition = new Vec3();
    this._isDragging = false;
    this._toggleLifecycleListeners('on');
  }

  _toggleLifecycleListeners(onOrOff) {
    this._element[onOrOff]('mousedown', this._onMouseDownOrTouchStart, this);
    this._element[onOrOff]('touchstart', this._onMouseDownOrTouchStart, this);
  }
  _toggleDragListeners(onOrOff) {
    const isOn = onOrOff === 'on';

    if (this._hasDragListeners && isOn) {
      return;
    }
    if (!this._handleMouseUpOrTouchEnd) {
      this._handleMouseUpOrTouchEnd = this._onMouseUpOrTouchEnd.bind(this);
    }

    if (this._app.mouse) {
      this._element[onOrOff]('mousemove', this._onMove, this);
      this._element[onOrOff]('mouseup', this._handleMouseUpOrTouchEnd, false);
    }

    if (platform.touch) {
      this._element[onOrOff]('touchmove', this._onMove, this);
      this._element[onOrOff]('touchend', this._handleMouseUpOrTouchEnd, this);
      this._element[onOrOff]('touchcancel', this._handleMouseUpOrTouchEnd, this);
    }
    this._hasDragListeners = isOn;
  }
  _onMouseDownOrTouchStart(event) {
    if (this._element && !this._isDragging && this.enabled) {
      this._dragCamera = event.camera;
      this._calculateDragScale();
      const currentMousePosition = this._screenToLocal(event);
      if (currentMousePosition) {
        this._toggleDragListeners('on');
        this._isDragging = true;
        this._dragStartMousePosition.copy(currentMousePosition);
        this._dragStartHandlePosition.copy(this._element.entity.getLocalPosition());
        this.fire('drag:start');
      }
    }
  }
  _onMouseUpOrTouchEnd() {
    if (this._isDragging) {
      this._isDragging = false;
      this._toggleDragListeners('off');
      this.fire('drag:end');
    }
  }

  _screenToLocal(event) {
    this._determineInputPosition(event);
    this._chooseRayOriginAndDirection();
    _plane.point.copy(this._element.entity.getLocalPosition());
    _plane.normal.copy(this._element.entity.forward).mulScalar(-1);
    const denominator = _plane.normal.dot(_ray.direction);

    if (Math.abs(denominator) > 0) {
      const rayOriginToPlaneOrigin = _plane.point.sub(_ray.origin);
      const collisionDistance = rayOriginToPlaneOrigin.dot(_plane.normal) / denominator;
      const position = _ray.origin.add(_ray.direction.mulScalar(collisionDistance));
      _entityRotation.copy(this._element.entity.getRotation()).invert().transformVector(position, position);
      position.mul(this._dragScale);
      return position;
    }
    return null;
  }
  _determineInputPosition(event) {
    const devicePixelRatio = this._app.graphicsDevice.maxPixelRatio;
    if (typeof event.x !== 'undefined' && typeof event.y !== 'undefined') {
      _inputScreenPosition.x = event.x * devicePixelRatio;
      _inputScreenPosition.y = event.y * devicePixelRatio;
    } else if (event.changedTouches) {
      _inputScreenPosition.x = event.changedTouches[0].x * devicePixelRatio;
      _inputScreenPosition.y = event.changedTouches[0].y * devicePixelRatio;
    } else {
      console.warn('Could not determine position from input event');
    }
  }
  _chooseRayOriginAndDirection() {
    if (this._element.screen && this._element.screen.screen.screenSpace) {
      _ray.origin.set(_inputScreenPosition.x, -_inputScreenPosition.y, 0);
      _ray.direction.copy(Vec3.FORWARD);
    } else {
      _inputWorldPosition.copy(this._dragCamera.screenToWorld(_inputScreenPosition.x, _inputScreenPosition.y, 1));
      _ray.origin.copy(this._dragCamera.entity.getPosition());
      _ray.direction.copy(_inputWorldPosition).sub(_ray.origin).normalize();
    }
  }
  _calculateDragScale() {
    let current = this._element.entity.parent;
    const screen = this._element.screen && this._element.screen.screen;
    const isWithin2DScreen = screen && screen.screenSpace;
    const screenScale = isWithin2DScreen ? screen.scale : 1;
    const dragScale = this._dragScale;
    dragScale.set(screenScale, screenScale, screenScale);
    while (current) {
      dragScale.mul(current.getLocalScale());
      current = current.parent;
      if (isWithin2DScreen && current.screen) {
        break;
      }
    }
    dragScale.x = 1 / dragScale.x;
    dragScale.y = 1 / dragScale.y;
    dragScale.z = 1 / dragScale.z;
  }

  _onMove(event) {
    const {
      _element: element,
      _deltaMousePosition: deltaMousePosition,
      _deltaHandlePosition: deltaHandlePosition,
      _axis: axis
    } = this;
    if (element && this._isDragging && this.enabled && element.enabled && element.entity.enabled) {
      const currentMousePosition = this._screenToLocal(event);
      if (currentMousePosition) {
        deltaMousePosition.sub2(currentMousePosition, this._dragStartMousePosition);
        deltaHandlePosition.add2(this._dragStartHandlePosition, deltaMousePosition);
        if (axis) {
          const currentPosition = element.entity.getLocalPosition();
          const constrainedAxis = OPPOSITE_AXIS[axis];
          deltaHandlePosition[constrainedAxis] = currentPosition[constrainedAxis];
        }
        element.entity.setLocalPosition(deltaHandlePosition);
        this.fire('drag:move', deltaHandlePosition);
      }
    }
  }
  destroy() {
    this._toggleLifecycleListeners('off');
    this._toggleDragListeners('off');
  }
  set enabled(value) {
    this._enabled = value;
  }
  get enabled() {
    return this._enabled;
  }
  get isDragging() {
    return this._isDragging;
  }
}

export { ElementDragHelper };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWxlbWVudC1kcmFnLWhlbHBlci5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay9jb21wb25lbnRzL2VsZW1lbnQvZWxlbWVudC1kcmFnLWhlbHBlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwbGF0Zm9ybSB9IGZyb20gJy4uLy4uLy4uL2NvcmUvcGxhdGZvcm0uanMnO1xuaW1wb3J0IHsgRXZlbnRIYW5kbGVyIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9ldmVudC1oYW5kbGVyLmpzJztcblxuaW1wb3J0IHsgUXVhdCB9IGZyb20gJy4uLy4uLy4uL2NvcmUvbWF0aC9xdWF0LmpzJztcbmltcG9ydCB7IFZlYzIgfSBmcm9tICcuLi8uLi8uLi9jb3JlL21hdGgvdmVjMi5qcyc7XG5pbXBvcnQgeyBWZWMzIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9tYXRoL3ZlYzMuanMnO1xuXG5pbXBvcnQgeyBFbGVtZW50Q29tcG9uZW50IH0gZnJvbSAnLi9jb21wb25lbnQuanMnO1xuaW1wb3J0IHsgUmF5IH0gZnJvbSAnLi4vLi4vLi4vY29yZS9zaGFwZS9yYXkuanMnO1xuaW1wb3J0IHsgUGxhbmUgfSBmcm9tICcuLi8uLi8uLi9jb3JlL3NoYXBlL3BsYW5lLmpzJztcblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uLy4uL2lucHV0L2VsZW1lbnQtaW5wdXQnKS5FbGVtZW50VG91Y2hFdmVudH0gRWxlbWVudFRvdWNoRXZlbnQgKi9cblxuY29uc3QgX2lucHV0U2NyZWVuUG9zaXRpb24gPSBuZXcgVmVjMigpO1xuY29uc3QgX2lucHV0V29ybGRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7XG5jb25zdCBfcmF5ID0gbmV3IFJheSgpO1xuY29uc3QgX3BsYW5lID0gbmV3IFBsYW5lKCk7XG5jb25zdCBfZW50aXR5Um90YXRpb24gPSBuZXcgUXVhdCgpO1xuXG5jb25zdCBPUFBPU0lURV9BWElTID0ge1xuICAgIHg6ICd5JyxcbiAgICB5OiAneCdcbn07XG5cbi8qKlxuICogSGVscGVyIGNsYXNzIHRoYXQgbWFrZXMgaXQgZWFzeSB0byBjcmVhdGUgRWxlbWVudHMgdGhhdCBjYW4gYmUgZHJhZ2dlZCBieSB0aGUgbW91c2Ugb3IgdG91Y2guXG4gKlxuICogQGF1Z21lbnRzIEV2ZW50SGFuZGxlclxuICovXG5jbGFzcyBFbGVtZW50RHJhZ0hlbHBlciBleHRlbmRzIEV2ZW50SGFuZGxlciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IEVsZW1lbnREcmFnSGVscGVyIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtFbGVtZW50Q29tcG9uZW50fSBlbGVtZW50IC0gVGhlIEVsZW1lbnQgdGhhdCBzaG91bGQgYmVjb21lIGRyYWdnYWJsZS5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2F4aXNdIC0gT3B0aW9uYWwgYXhpcyB0byBjb25zdHJhaW4gdG8sIGVpdGhlciAneCcsICd5JyBvciBudWxsLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQsIGF4aXMpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICBpZiAoIWVsZW1lbnQgfHwgIShlbGVtZW50IGluc3RhbmNlb2YgRWxlbWVudENvbXBvbmVudCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRWxlbWVudCB3YXMgbnVsbCBvciBub3QgYW4gRWxlbWVudENvbXBvbmVudCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGF4aXMgJiYgYXhpcyAhPT0gJ3gnICYmIGF4aXMgIT09ICd5Jykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbnJlY29nbml6ZWQgYXhpczogJyArIGF4aXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICAgIHRoaXMuX2FwcCA9IGVsZW1lbnQuc3lzdGVtLmFwcDtcbiAgICAgICAgdGhpcy5fYXhpcyA9IGF4aXMgfHwgbnVsbDtcbiAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuX2RyYWdTY2FsZSA9IG5ldyBWZWMzKCk7XG4gICAgICAgIHRoaXMuX2RyYWdTdGFydE1vdXNlUG9zaXRpb24gPSBuZXcgVmVjMygpO1xuICAgICAgICB0aGlzLl9kcmFnU3RhcnRIYW5kbGVQb3NpdGlvbiA9IG5ldyBWZWMzKCk7XG4gICAgICAgIHRoaXMuX2RlbHRhTW91c2VQb3NpdGlvbiA9IG5ldyBWZWMzKCk7XG4gICAgICAgIHRoaXMuX2RlbHRhSGFuZGxlUG9zaXRpb24gPSBuZXcgVmVjMygpO1xuICAgICAgICB0aGlzLl9pc0RyYWdnaW5nID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5fdG9nZ2xlTGlmZWN5Y2xlTGlzdGVuZXJzKCdvbicpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gYSBuZXcgZHJhZyBvcGVyYXRpb24gc3RhcnRzLlxuICAgICAqXG4gICAgICogQGV2ZW50IEVsZW1lbnREcmFnSGVscGVyI2RyYWc6c3RhcnRcbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gdGhlIGN1cnJlbnQgbmV3IGRyYWcgb3BlcmF0aW9uIGVuZHMuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgRWxlbWVudERyYWdIZWxwZXIjZHJhZzplbmRcbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW5ldmVyIHRoZSBwb3NpdGlvbiBvZiB0aGUgZHJhZ2dlZCBlbGVtZW50IGNoYW5nZXMuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgRWxlbWVudERyYWdIZWxwZXIjZHJhZzptb3ZlXG4gICAgICogQHBhcmFtIHtWZWMzfSB2YWx1ZSAtIFRoZSBjdXJyZW50IHBvc2l0aW9uLlxuICAgICAqL1xuXG4gICAgX3RvZ2dsZUxpZmVjeWNsZUxpc3RlbmVycyhvbk9yT2ZmKSB7XG4gICAgICAgIHRoaXMuX2VsZW1lbnRbb25Pck9mZl0oJ21vdXNlZG93bicsIHRoaXMuX29uTW91c2VEb3duT3JUb3VjaFN0YXJ0LCB0aGlzKTtcbiAgICAgICAgdGhpcy5fZWxlbWVudFtvbk9yT2ZmXSgndG91Y2hzdGFydCcsIHRoaXMuX29uTW91c2VEb3duT3JUb3VjaFN0YXJ0LCB0aGlzKTtcbiAgICB9XG5cbiAgICBfdG9nZ2xlRHJhZ0xpc3RlbmVycyhvbk9yT2ZmKSB7XG4gICAgICAgIGNvbnN0IGlzT24gPSBvbk9yT2ZmID09PSAnb24nO1xuXG4gICAgICAgIC8vIFByZXZlbnQgbXVsdGlwbGUgbGlzdGVuZXJzXG4gICAgICAgIGlmICh0aGlzLl9oYXNEcmFnTGlzdGVuZXJzICYmIGlzT24pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5faGFuZGxlTW91c2VVcE9yVG91Y2hFbmQpIHtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZU1vdXNlVXBPclRvdWNoRW5kID0gdGhpcy5fb25Nb3VzZVVwT3JUb3VjaEVuZC5iaW5kKHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gbW91c2UgZXZlbnRzLCBpZiBtb3VzZSBpcyBhdmFpbGFibGVcbiAgICAgICAgaWYgKHRoaXMuX2FwcC5tb3VzZSkge1xuICAgICAgICAgICAgdGhpcy5fZWxlbWVudFtvbk9yT2ZmXSgnbW91c2Vtb3ZlJywgdGhpcy5fb25Nb3ZlLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuX2VsZW1lbnRbb25Pck9mZl0oJ21vdXNldXAnLCB0aGlzLl9oYW5kbGVNb3VzZVVwT3JUb3VjaEVuZCwgZmFsc2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdG91Y2ggZXZlbnRzLCBpZiB0b3VjaCBpcyBhdmFpbGFibGVcbiAgICAgICAgaWYgKHBsYXRmb3JtLnRvdWNoKSB7XG4gICAgICAgICAgICB0aGlzLl9lbGVtZW50W29uT3JPZmZdKCd0b3VjaG1vdmUnLCB0aGlzLl9vbk1vdmUsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5fZWxlbWVudFtvbk9yT2ZmXSgndG91Y2hlbmQnLCB0aGlzLl9oYW5kbGVNb3VzZVVwT3JUb3VjaEVuZCwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLl9lbGVtZW50W29uT3JPZmZdKCd0b3VjaGNhbmNlbCcsIHRoaXMuX2hhbmRsZU1vdXNlVXBPclRvdWNoRW5kLCB0aGlzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2hhc0RyYWdMaXN0ZW5lcnMgPSBpc09uO1xuICAgIH1cblxuICAgIF9vbk1vdXNlRG93bk9yVG91Y2hTdGFydChldmVudCkge1xuICAgICAgICBpZiAodGhpcy5fZWxlbWVudCAmJiAhdGhpcy5faXNEcmFnZ2luZyAmJiB0aGlzLmVuYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX2RyYWdDYW1lcmEgPSBldmVudC5jYW1lcmE7XG4gICAgICAgICAgICB0aGlzLl9jYWxjdWxhdGVEcmFnU2NhbGUoKTtcblxuICAgICAgICAgICAgY29uc3QgY3VycmVudE1vdXNlUG9zaXRpb24gPSB0aGlzLl9zY3JlZW5Ub0xvY2FsKGV2ZW50KTtcblxuICAgICAgICAgICAgaWYgKGN1cnJlbnRNb3VzZVBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdG9nZ2xlRHJhZ0xpc3RlbmVycygnb24nKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9pc0RyYWdnaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLl9kcmFnU3RhcnRNb3VzZVBvc2l0aW9uLmNvcHkoY3VycmVudE1vdXNlUG9zaXRpb24pO1xuICAgICAgICAgICAgICAgIHRoaXMuX2RyYWdTdGFydEhhbmRsZVBvc2l0aW9uLmNvcHkodGhpcy5fZWxlbWVudC5lbnRpdHkuZ2V0TG9jYWxQb3NpdGlvbigpKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZmlyZSgnZHJhZzpzdGFydCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgX29uTW91c2VVcE9yVG91Y2hFbmQoKSB7XG4gICAgICAgIGlmICh0aGlzLl9pc0RyYWdnaW5nKSB7XG4gICAgICAgICAgICB0aGlzLl9pc0RyYWdnaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLl90b2dnbGVEcmFnTGlzdGVuZXJzKCdvZmYnKTtcblxuICAgICAgICAgICAgdGhpcy5maXJlKCdkcmFnOmVuZCcpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgY2FsY3VsYXRlcyB0aGUgYFZlYzNgIGludGVyc2VjdGlvbiBwb2ludCBvZiBwbGFuZS9yYXkgaW50ZXJzZWN0aW9uIGJhc2VkIG9uXG4gICAgICogdGhlIG1vdXNlL3RvdWNoIGlucHV0IGV2ZW50LiBJZiB0aGVyZSBpcyBubyBpbnRlcnNlY3Rpb24sIGl0IHJldHVybnMgYG51bGxgLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtFbGVtZW50VG91Y2hFdmVudH0gZXZlbnQgLSBUaGUgZXZlbnQuXG4gICAgICogQHJldHVybnMge1ZlYzN8bnVsbH0gVGhlIGBWZWMzYCBpbnRlcnNlY3Rpb24gcG9pbnQgb2YgcGxhbmUvcmF5IGludGVyc2VjdGlvbiwgaWYgdGhlcmVcbiAgICAgKiBpcyBhbiBpbnRlcnNlY3Rpb24sIG90aGVyd2lzZSBgbnVsbGBcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zY3JlZW5Ub0xvY2FsKGV2ZW50KSB7XG4gICAgICAgIHRoaXMuX2RldGVybWluZUlucHV0UG9zaXRpb24oZXZlbnQpO1xuICAgICAgICB0aGlzLl9jaG9vc2VSYXlPcmlnaW5BbmREaXJlY3Rpb24oKTtcblxuICAgICAgICBfcGxhbmUucG9pbnQuY29weSh0aGlzLl9lbGVtZW50LmVudGl0eS5nZXRMb2NhbFBvc2l0aW9uKCkpO1xuICAgICAgICBfcGxhbmUubm9ybWFsLmNvcHkodGhpcy5fZWxlbWVudC5lbnRpdHkuZm9yd2FyZCkubXVsU2NhbGFyKC0xKTtcblxuICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IF9wbGFuZS5ub3JtYWwuZG90KF9yYXkuZGlyZWN0aW9uKTtcblxuICAgICAgICAvLyBJZiB0aGUgcmF5IGFuZCBwbGFuZSBhcmUgbm90IHBhcmFsbGVsXG4gICAgICAgIGlmIChNYXRoLmFicyhkZW5vbWluYXRvcikgPiAwKSB7XG4gICAgICAgICAgICBjb25zdCByYXlPcmlnaW5Ub1BsYW5lT3JpZ2luID0gX3BsYW5lLnBvaW50LnN1YihfcmF5Lm9yaWdpbik7XG4gICAgICAgICAgICBjb25zdCBjb2xsaXNpb25EaXN0YW5jZSA9IHJheU9yaWdpblRvUGxhbmVPcmlnaW4uZG90KF9wbGFuZS5ub3JtYWwpIC8gZGVub21pbmF0b3I7XG4gICAgICAgICAgICBjb25zdCBwb3NpdGlvbiA9IF9yYXkub3JpZ2luLmFkZChfcmF5LmRpcmVjdGlvbi5tdWxTY2FsYXIoY29sbGlzaW9uRGlzdGFuY2UpKTtcblxuICAgICAgICAgICAgX2VudGl0eVJvdGF0aW9uLmNvcHkodGhpcy5fZWxlbWVudC5lbnRpdHkuZ2V0Um90YXRpb24oKSkuaW52ZXJ0KCkudHJhbnNmb3JtVmVjdG9yKHBvc2l0aW9uLCBwb3NpdGlvbik7XG5cbiAgICAgICAgICAgIHBvc2l0aW9uLm11bCh0aGlzLl9kcmFnU2NhbGUpO1xuXG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb247XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBfZGV0ZXJtaW5lSW5wdXRQb3NpdGlvbihldmVudCkge1xuICAgICAgICBjb25zdCBkZXZpY2VQaXhlbFJhdGlvID0gdGhpcy5fYXBwLmdyYXBoaWNzRGV2aWNlLm1heFBpeGVsUmF0aW87XG5cbiAgICAgICAgaWYgKHR5cGVvZiBldmVudC54ICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgZXZlbnQueSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIF9pbnB1dFNjcmVlblBvc2l0aW9uLnggPSBldmVudC54ICogZGV2aWNlUGl4ZWxSYXRpbztcbiAgICAgICAgICAgIF9pbnB1dFNjcmVlblBvc2l0aW9uLnkgPSBldmVudC55ICogZGV2aWNlUGl4ZWxSYXRpbztcbiAgICAgICAgfSBlbHNlIGlmIChldmVudC5jaGFuZ2VkVG91Y2hlcykge1xuICAgICAgICAgICAgX2lucHV0U2NyZWVuUG9zaXRpb24ueCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnggKiBkZXZpY2VQaXhlbFJhdGlvO1xuICAgICAgICAgICAgX2lucHV0U2NyZWVuUG9zaXRpb24ueSA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnkgKiBkZXZpY2VQaXhlbFJhdGlvO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3QgZGV0ZXJtaW5lIHBvc2l0aW9uIGZyb20gaW5wdXQgZXZlbnQnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9jaG9vc2VSYXlPcmlnaW5BbmREaXJlY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLl9lbGVtZW50LnNjcmVlbiAmJiB0aGlzLl9lbGVtZW50LnNjcmVlbi5zY3JlZW4uc2NyZWVuU3BhY2UpIHtcbiAgICAgICAgICAgIF9yYXkub3JpZ2luLnNldChfaW5wdXRTY3JlZW5Qb3NpdGlvbi54LCAtX2lucHV0U2NyZWVuUG9zaXRpb24ueSwgMCk7XG4gICAgICAgICAgICBfcmF5LmRpcmVjdGlvbi5jb3B5KFZlYzMuRk9SV0FSRCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfaW5wdXRXb3JsZFBvc2l0aW9uLmNvcHkodGhpcy5fZHJhZ0NhbWVyYS5zY3JlZW5Ub1dvcmxkKF9pbnB1dFNjcmVlblBvc2l0aW9uLngsIF9pbnB1dFNjcmVlblBvc2l0aW9uLnksIDEpKTtcbiAgICAgICAgICAgIF9yYXkub3JpZ2luLmNvcHkodGhpcy5fZHJhZ0NhbWVyYS5lbnRpdHkuZ2V0UG9zaXRpb24oKSk7XG4gICAgICAgICAgICBfcmF5LmRpcmVjdGlvbi5jb3B5KF9pbnB1dFdvcmxkUG9zaXRpb24pLnN1YihfcmF5Lm9yaWdpbikubm9ybWFsaXplKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfY2FsY3VsYXRlRHJhZ1NjYWxlKCkge1xuICAgICAgICBsZXQgY3VycmVudCA9IHRoaXMuX2VsZW1lbnQuZW50aXR5LnBhcmVudDtcbiAgICAgICAgY29uc3Qgc2NyZWVuID0gdGhpcy5fZWxlbWVudC5zY3JlZW4gJiYgdGhpcy5fZWxlbWVudC5zY3JlZW4uc2NyZWVuO1xuICAgICAgICBjb25zdCBpc1dpdGhpbjJEU2NyZWVuID0gc2NyZWVuICYmIHNjcmVlbi5zY3JlZW5TcGFjZTtcbiAgICAgICAgY29uc3Qgc2NyZWVuU2NhbGUgPSBpc1dpdGhpbjJEU2NyZWVuID8gc2NyZWVuLnNjYWxlIDogMTtcbiAgICAgICAgY29uc3QgZHJhZ1NjYWxlID0gdGhpcy5fZHJhZ1NjYWxlO1xuXG4gICAgICAgIGRyYWdTY2FsZS5zZXQoc2NyZWVuU2NhbGUsIHNjcmVlblNjYWxlLCBzY3JlZW5TY2FsZSk7XG5cbiAgICAgICAgd2hpbGUgKGN1cnJlbnQpIHtcbiAgICAgICAgICAgIGRyYWdTY2FsZS5tdWwoY3VycmVudC5nZXRMb2NhbFNjYWxlKCkpO1xuICAgICAgICAgICAgY3VycmVudCA9IGN1cnJlbnQucGFyZW50O1xuXG4gICAgICAgICAgICBpZiAoaXNXaXRoaW4yRFNjcmVlbiAmJiBjdXJyZW50LnNjcmVlbikge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZHJhZ1NjYWxlLnggPSAxIC8gZHJhZ1NjYWxlLng7XG4gICAgICAgIGRyYWdTY2FsZS55ID0gMSAvIGRyYWdTY2FsZS55O1xuICAgICAgICBkcmFnU2NhbGUueiA9IDEgLyBkcmFnU2NhbGUuejtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaW5rZWQgdG8gYF9lbGVtZW50YCBldmVudHM6IGBtb3VzZW1vdmVgIGFuZCBgdG91Y2htb3ZlYFxuICAgICAqXG4gICAgICogQHBhcmFtIHtFbGVtZW50VG91Y2hFdmVudH0gZXZlbnQgLSBUaGUgZXZlbnQuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfb25Nb3ZlKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIF9lbGVtZW50OiBlbGVtZW50LFxuICAgICAgICAgICAgX2RlbHRhTW91c2VQb3NpdGlvbjogZGVsdGFNb3VzZVBvc2l0aW9uLFxuICAgICAgICAgICAgX2RlbHRhSGFuZGxlUG9zaXRpb246IGRlbHRhSGFuZGxlUG9zaXRpb24sXG4gICAgICAgICAgICBfYXhpczogYXhpc1xuICAgICAgICB9ID0gdGhpcztcbiAgICAgICAgaWYgKGVsZW1lbnQgJiYgdGhpcy5faXNEcmFnZ2luZyAmJiB0aGlzLmVuYWJsZWQgJiYgZWxlbWVudC5lbmFibGVkICYmIGVsZW1lbnQuZW50aXR5LmVuYWJsZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRNb3VzZVBvc2l0aW9uID0gdGhpcy5fc2NyZWVuVG9Mb2NhbChldmVudCk7XG4gICAgICAgICAgICBpZiAoY3VycmVudE1vdXNlUG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICBkZWx0YU1vdXNlUG9zaXRpb24uc3ViMihjdXJyZW50TW91c2VQb3NpdGlvbiwgdGhpcy5fZHJhZ1N0YXJ0TW91c2VQb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgZGVsdGFIYW5kbGVQb3NpdGlvbi5hZGQyKHRoaXMuX2RyYWdTdGFydEhhbmRsZVBvc2l0aW9uLCBkZWx0YU1vdXNlUG9zaXRpb24pO1xuXG4gICAgICAgICAgICAgICAgaWYgKGF4aXMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFBvc2l0aW9uID0gZWxlbWVudC5lbnRpdHkuZ2V0TG9jYWxQb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb25zdHJhaW5lZEF4aXMgPSBPUFBPU0lURV9BWElTW2F4aXNdO1xuICAgICAgICAgICAgICAgICAgICBkZWx0YUhhbmRsZVBvc2l0aW9uW2NvbnN0cmFpbmVkQXhpc10gPSBjdXJyZW50UG9zaXRpb25bY29uc3RyYWluZWRBeGlzXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmVudGl0eS5zZXRMb2NhbFBvc2l0aW9uKGRlbHRhSGFuZGxlUG9zaXRpb24pO1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyZSgnZHJhZzptb3ZlJywgZGVsdGFIYW5kbGVQb3NpdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBkZXN0cm95KCkge1xuICAgICAgICB0aGlzLl90b2dnbGVMaWZlY3ljbGVMaXN0ZW5lcnMoJ29mZicpO1xuICAgICAgICB0aGlzLl90b2dnbGVEcmFnTGlzdGVuZXJzKCdvZmYnKTtcbiAgICB9XG5cbiAgICBzZXQgZW5hYmxlZCh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9lbmFibGVkID0gdmFsdWU7XG4gICAgfVxuXG4gICAgZ2V0IGVuYWJsZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkO1xuICAgIH1cblxuICAgIGdldCBpc0RyYWdnaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faXNEcmFnZ2luZztcbiAgICB9XG59XG5cbmV4cG9ydCB7IEVsZW1lbnREcmFnSGVscGVyIH07XG4iXSwibmFtZXMiOlsiX2lucHV0U2NyZWVuUG9zaXRpb24iLCJWZWMyIiwiX2lucHV0V29ybGRQb3NpdGlvbiIsIlZlYzMiLCJfcmF5IiwiUmF5IiwiX3BsYW5lIiwiUGxhbmUiLCJfZW50aXR5Um90YXRpb24iLCJRdWF0IiwiT1BQT1NJVEVfQVhJUyIsIngiLCJ5IiwiRWxlbWVudERyYWdIZWxwZXIiLCJFdmVudEhhbmRsZXIiLCJjb25zdHJ1Y3RvciIsImVsZW1lbnQiLCJheGlzIiwiRWxlbWVudENvbXBvbmVudCIsIkVycm9yIiwiX2VsZW1lbnQiLCJfYXBwIiwic3lzdGVtIiwiYXBwIiwiX2F4aXMiLCJfZW5hYmxlZCIsIl9kcmFnU2NhbGUiLCJfZHJhZ1N0YXJ0TW91c2VQb3NpdGlvbiIsIl9kcmFnU3RhcnRIYW5kbGVQb3NpdGlvbiIsIl9kZWx0YU1vdXNlUG9zaXRpb24iLCJfZGVsdGFIYW5kbGVQb3NpdGlvbiIsIl9pc0RyYWdnaW5nIiwiX3RvZ2dsZUxpZmVjeWNsZUxpc3RlbmVycyIsIm9uT3JPZmYiLCJfb25Nb3VzZURvd25PclRvdWNoU3RhcnQiLCJfdG9nZ2xlRHJhZ0xpc3RlbmVycyIsImlzT24iLCJfaGFzRHJhZ0xpc3RlbmVycyIsIl9oYW5kbGVNb3VzZVVwT3JUb3VjaEVuZCIsIl9vbk1vdXNlVXBPclRvdWNoRW5kIiwiYmluZCIsIm1vdXNlIiwiX29uTW92ZSIsInBsYXRmb3JtIiwidG91Y2giLCJldmVudCIsImVuYWJsZWQiLCJfZHJhZ0NhbWVyYSIsImNhbWVyYSIsIl9jYWxjdWxhdGVEcmFnU2NhbGUiLCJjdXJyZW50TW91c2VQb3NpdGlvbiIsIl9zY3JlZW5Ub0xvY2FsIiwiY29weSIsImVudGl0eSIsImdldExvY2FsUG9zaXRpb24iLCJmaXJlIiwiX2RldGVybWluZUlucHV0UG9zaXRpb24iLCJfY2hvb3NlUmF5T3JpZ2luQW5kRGlyZWN0aW9uIiwicG9pbnQiLCJub3JtYWwiLCJmb3J3YXJkIiwibXVsU2NhbGFyIiwiZGVub21pbmF0b3IiLCJkb3QiLCJkaXJlY3Rpb24iLCJNYXRoIiwiYWJzIiwicmF5T3JpZ2luVG9QbGFuZU9yaWdpbiIsInN1YiIsIm9yaWdpbiIsImNvbGxpc2lvbkRpc3RhbmNlIiwicG9zaXRpb24iLCJhZGQiLCJnZXRSb3RhdGlvbiIsImludmVydCIsInRyYW5zZm9ybVZlY3RvciIsIm11bCIsImRldmljZVBpeGVsUmF0aW8iLCJncmFwaGljc0RldmljZSIsIm1heFBpeGVsUmF0aW8iLCJjaGFuZ2VkVG91Y2hlcyIsImNvbnNvbGUiLCJ3YXJuIiwic2NyZWVuIiwic2NyZWVuU3BhY2UiLCJzZXQiLCJGT1JXQVJEIiwic2NyZWVuVG9Xb3JsZCIsImdldFBvc2l0aW9uIiwibm9ybWFsaXplIiwiY3VycmVudCIsInBhcmVudCIsImlzV2l0aGluMkRTY3JlZW4iLCJzY3JlZW5TY2FsZSIsInNjYWxlIiwiZHJhZ1NjYWxlIiwiZ2V0TG9jYWxTY2FsZSIsInoiLCJkZWx0YU1vdXNlUG9zaXRpb24iLCJkZWx0YUhhbmRsZVBvc2l0aW9uIiwic3ViMiIsImFkZDIiLCJjdXJyZW50UG9zaXRpb24iLCJjb25zdHJhaW5lZEF4aXMiLCJzZXRMb2NhbFBvc2l0aW9uIiwiZGVzdHJveSIsInZhbHVlIiwiaXNEcmFnZ2luZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFhQSxNQUFNQSxvQkFBb0IsR0FBRyxJQUFJQyxJQUFJLEVBQUUsQ0FBQTtBQUN2QyxNQUFNQyxtQkFBbUIsR0FBRyxJQUFJQyxJQUFJLEVBQUUsQ0FBQTtBQUN0QyxNQUFNQyxJQUFJLEdBQUcsSUFBSUMsR0FBRyxFQUFFLENBQUE7QUFDdEIsTUFBTUMsTUFBTSxHQUFHLElBQUlDLEtBQUssRUFBRSxDQUFBO0FBQzFCLE1BQU1DLGVBQWUsR0FBRyxJQUFJQyxJQUFJLEVBQUUsQ0FBQTtBQUVsQyxNQUFNQyxhQUFhLEdBQUc7QUFDbEJDLEVBQUFBLENBQUMsRUFBRSxHQUFHO0FBQ05DLEVBQUFBLENBQUMsRUFBRSxHQUFBO0FBQ1AsQ0FBQyxDQUFBOztBQU9ELE1BQU1DLGlCQUFpQixTQUFTQyxZQUFZLENBQUM7QUFPekNDLEVBQUFBLFdBQVcsQ0FBQ0MsT0FBTyxFQUFFQyxJQUFJLEVBQUU7QUFDdkIsSUFBQSxLQUFLLEVBQUUsQ0FBQTtJQUVQLElBQUksQ0FBQ0QsT0FBTyxJQUFJLEVBQUVBLE9BQU8sWUFBWUUsZ0JBQWdCLENBQUMsRUFBRTtBQUNwRCxNQUFBLE1BQU0sSUFBSUMsS0FBSyxDQUFDLDZDQUE2QyxDQUFDLENBQUE7QUFDbEUsS0FBQTtJQUVBLElBQUlGLElBQUksSUFBSUEsSUFBSSxLQUFLLEdBQUcsSUFBSUEsSUFBSSxLQUFLLEdBQUcsRUFBRTtBQUN0QyxNQUFBLE1BQU0sSUFBSUUsS0FBSyxDQUFDLHFCQUFxQixHQUFHRixJQUFJLENBQUMs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
