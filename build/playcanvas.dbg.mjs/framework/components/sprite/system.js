/**
 * @license
 * PlayCanvas Engine v1.62.0 revision 818511d2b (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { Color } from '../../../core/math/color.js';
import { PIXELFORMAT_RGBA8, CULLFACE_NONE } from '../../../platform/graphics/constants.js';
import { Texture } from '../../../platform/graphics/texture.js';
import { BLEND_PREMULTIPLIED, SPRITE_RENDERMODE_SLICED, SPRITE_RENDERMODE_TILED } from '../../../scene/constants.js';
import { StandardMaterial } from '../../../scene/materials/standard-material.js';
import { Component } from '../component.js';
import { ComponentSystem } from '../system.js';
import { SpriteComponent } from './component.js';
import { SpriteComponentData } from './data.js';

const _schema = ['enabled'];

/**
 * Manages creation of {@link SpriteComponent}s.
 *
 * @augments ComponentSystem
 */
class SpriteComponentSystem extends ComponentSystem {
  /**
   * Create a new SpriteComponentSystem instance.
   *
   * @param {import('../../app-base.js').AppBase} app - The application.
   * @hideconstructor
   */
  constructor(app) {
    super(app);
    this.id = 'sprite';
    this.ComponentType = SpriteComponent;
    this.DataType = SpriteComponentData;
    this.schema = _schema;

    // default texture - make white so we can tint it with emissive color
    this._defaultTexture = null;

    // default material used by sprites
    this._defaultMaterial = null;

    // material used for 9-slicing in sliced mode
    this._default9SlicedMaterialSlicedMode = null;

    // material used for 9-slicing in tiled mode
    this._default9SlicedMaterialTiledMode = null;
    this.app.systems.on('update', this.onUpdate, this);
    this.on('beforeremove', this.onBeforeRemove, this);
  }
  set defaultMaterial(material) {
    this._defaultMaterial = material;
  }
  get defaultMaterial() {
    if (!this._defaultMaterial) {
      const texture = new Texture(this.app.graphicsDevice, {
        width: 1,
        height: 1,
        format: PIXELFORMAT_RGBA8,
        name: 'sprite'
      });
      const pixels = new Uint8Array(texture.lock());
      pixels[0] = pixels[1] = pixels[2] = pixels[3] = 255;
      texture.unlock();
      const material = new StandardMaterial();
      material.diffuse.set(0, 0, 0); // black diffuse color to prevent ambient light being included
      material.emissive.set(0.5, 0.5, 0.5); // use non-white to compile shader correctly
      material.emissiveMap = texture;
      material.emissiveTint = true;
      material.opacityMap = texture;
      material.opacityMapChannel = 'a';
      material.opacityTint = true;
      material.opacity = 0; // use non-1 opacity to compile shader correctly
      material.useLighting = false;
      material.useGammaTonemap = false;
      material.useFog = false;
      material.useSkybox = false;
      material.blendType = BLEND_PREMULTIPLIED;
      material.depthWrite = false;
      material.pixelSnap = false;
      material.cull = CULLFACE_NONE; // don't cull because we might flipX or flipY which uses negative scale on the graph node
      material.update();
      this._defaultTexture = texture;
      this._defaultMaterial = material;
    }
    return this._defaultMaterial;
  }
  set default9SlicedMaterialSlicedMode(material) {
    this._default9SlicedMaterialSlicedMode = material;
  }
  get default9SlicedMaterialSlicedMode() {
    if (!this._default9SlicedMaterialSlicedMode) {
      const material = this.defaultMaterial.clone();
      material.nineSlicedMode = SPRITE_RENDERMODE_SLICED;
      material.update();
      this._default9SlicedMaterialSlicedMode = material;
    }
    return this._default9SlicedMaterialSlicedMode;
  }
  set default9SlicedMaterialTiledMode(material) {
    this._default9SlicedMaterialTiledMode = material;
  }
  get default9SlicedMaterialTiledMode() {
    if (!this._default9SlicedMaterialTiledMode) {
      const material = this.defaultMaterial.clone();
      material.nineSlicedMode = SPRITE_RENDERMODE_TILED;
      material.update();
      this._default9SlicedMaterialTiledMode = material;
    }
    return this._default9SlicedMaterialTiledMode;
  }
  destroy() {
    super.destroy();
    this.app.systems.off('update', this.onUpdate, this);
    if (this._defaultTexture) {
      this._defaultTexture.destroy();
      this._defaultTexture = null;
    }
  }
  initializeComponentData(component, data, properties) {
    if (data.enabled !== undefined) {
      component.enabled = data.enabled;
    }
    component.type = data.type;
    if (data.layers && Array.isArray(data.layers)) {
      component.layers = data.layers.slice(0);
    }
    if (data.drawOrder !== undefined) {
      component.drawOrder = data.drawOrder;
    }
    if (data.color !== undefined) {
      if (data.color instanceof Color) {
        component.color.set(data.color.r, data.color.g, data.color.b, data.opacity !== undefined ? data.opacity : 1);
      } else {
        component.color.set(data.color[0], data.color[1], data.color[2], data.opacity !== undefined ? data.opacity : 1);
      }

      /* eslint-disable no-self-assign */
      // force update
      component.color = component.color;
      /* eslint-enable no-self-assign */
    }

    if (data.opacity !== undefined) {
      component.opacity = data.opacity;
    }
    if (data.flipX !== undefined) {
      component.flipX = data.flipX;
    }
    if (data.flipY !== undefined) {
      component.flipY = data.flipY;
    }
    if (data.width !== undefined) {
      component.width = data.width;
    }
    if (data.height !== undefined) {
      component.height = data.height;
    }
    if (data.spriteAsset !== undefined) {
      component.spriteAsset = data.spriteAsset;
    }
    if (data.sprite) {
      component.sprite = data.sprite;
    }
    if (data.frame !== undefined) {
      component.frame = data.frame;
    }
    if (data.clips) {
      for (const name in data.clips) {
        component.addClip(data.clips[name]);
      }
    }
    if (data.speed !== undefined) {
      component.speed = data.speed;
    }
    if (data.autoPlayClip) {
      component.autoPlayClip = data.autoPlayClip;
    }
    component.batchGroupId = data.batchGroupId === undefined || data.batchGroupId === null ? -1 : data.batchGroupId;
    super.initializeComponentData(component, data, properties);
  }
  cloneComponent(entity, clone) {
    const source = entity.sprite;
    return this.addComponent(clone, {
      enabled: source.enabled,
      type: source.type,
      spriteAsset: source.spriteAsset,
      sprite: source.sprite,
      frame: source.frame,
      color: source.color.clone(),
      opacity: source.opacity,
      flipX: source.flipX,
      flipY: source.flipY,
      speed: source.speed,
      clips: source.clips,
      autoPlayClip: source.autoPlayClip,
      batchGroupId: source.batchGroupId,
      drawOrder: source.drawOrder,
      layers: source.layers.slice(0)
    });
  }
  onUpdate(dt) {
    const components = this.store;
    for (const id in components) {
      if (components.hasOwnProperty(id)) {
        const component = components[id];
        // if sprite component is enabled advance its current clip
        if (component.data.enabled && component.entity.enabled) {
          const sprite = component.entity.sprite;
          if (sprite._currentClip) {
            sprite._currentClip._update(dt);
          }
        }
      }
    }
  }
  onBeforeRemove(entity, component) {
    component.onDestroy();
  }
}
Component._buildAccessors(SpriteComponent.prototype, _schema);

export { SpriteComponentSystem };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3lzdGVtLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2NvbXBvbmVudHMvc3ByaXRlL3N5c3RlbS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb2xvciB9IGZyb20gJy4uLy4uLy4uL2NvcmUvbWF0aC9jb2xvci5qcyc7XG5cbmltcG9ydCB7XG4gICAgQ1VMTEZBQ0VfTk9ORSxcbiAgICBQSVhFTEZPUk1BVF9SR0JBOFxufSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgVGV4dHVyZSB9IGZyb20gJy4uLy4uLy4uL3BsYXRmb3JtL2dyYXBoaWNzL3RleHR1cmUuanMnO1xuXG5pbXBvcnQgeyBCTEVORF9QUkVNVUxUSVBMSUVELCBTUFJJVEVfUkVOREVSTU9ERV9TTElDRUQsIFNQUklURV9SRU5ERVJNT0RFX1RJTEVEIH0gZnJvbSAnLi4vLi4vLi4vc2NlbmUvY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IFN0YW5kYXJkTWF0ZXJpYWwgfSBmcm9tICcuLi8uLi8uLi9zY2VuZS9tYXRlcmlhbHMvc3RhbmRhcmQtbWF0ZXJpYWwuanMnO1xuXG5pbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnQuanMnO1xuaW1wb3J0IHsgQ29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi4vc3lzdGVtLmpzJztcblxuaW1wb3J0IHsgU3ByaXRlQ29tcG9uZW50IH0gZnJvbSAnLi9jb21wb25lbnQuanMnO1xuaW1wb3J0IHsgU3ByaXRlQ29tcG9uZW50RGF0YSB9IGZyb20gJy4vZGF0YS5qcyc7XG5cbmNvbnN0IF9zY2hlbWEgPSBbJ2VuYWJsZWQnXTtcblxuLyoqXG4gKiBNYW5hZ2VzIGNyZWF0aW9uIG9mIHtAbGluayBTcHJpdGVDb21wb25lbnR9cy5cbiAqXG4gKiBAYXVnbWVudHMgQ29tcG9uZW50U3lzdGVtXG4gKi9cbmNsYXNzIFNwcml0ZUNvbXBvbmVudFN5c3RlbSBleHRlbmRzIENvbXBvbmVudFN5c3RlbSB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IFNwcml0ZUNvbXBvbmVudFN5c3RlbSBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi8uLi9hcHAtYmFzZS5qcycpLkFwcEJhc2V9IGFwcCAtIFRoZSBhcHBsaWNhdGlvbi5cbiAgICAgKiBAaGlkZWNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoYXBwKSB7XG4gICAgICAgIHN1cGVyKGFwcCk7XG5cbiAgICAgICAgdGhpcy5pZCA9ICdzcHJpdGUnO1xuXG4gICAgICAgIHRoaXMuQ29tcG9uZW50VHlwZSA9IFNwcml0ZUNvbXBvbmVudDtcbiAgICAgICAgdGhpcy5EYXRhVHlwZSA9IFNwcml0ZUNvbXBvbmVudERhdGE7XG5cbiAgICAgICAgdGhpcy5zY2hlbWEgPSBfc2NoZW1hO1xuXG4gICAgICAgIC8vIGRlZmF1bHQgdGV4dHVyZSAtIG1ha2Ugd2hpdGUgc28gd2UgY2FuIHRpbnQgaXQgd2l0aCBlbWlzc2l2ZSBjb2xvclxuICAgICAgICB0aGlzLl9kZWZhdWx0VGV4dHVyZSA9IG51bGw7XG5cbiAgICAgICAgLy8gZGVmYXVsdCBtYXRlcmlhbCB1c2VkIGJ5IHNwcml0ZXNcbiAgICAgICAgdGhpcy5fZGVmYXVsdE1hdGVyaWFsID0gbnVsbDtcblxuICAgICAgICAvLyBtYXRlcmlhbCB1c2VkIGZvciA5LXNsaWNpbmcgaW4gc2xpY2VkIG1vZGVcbiAgICAgICAgdGhpcy5fZGVmYXVsdDlTbGljZWRNYXRlcmlhbFNsaWNlZE1vZGUgPSBudWxsO1xuXG4gICAgICAgIC8vIG1hdGVyaWFsIHVzZWQgZm9yIDktc2xpY2luZyBpbiB0aWxlZCBtb2RlXG4gICAgICAgIHRoaXMuX2RlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxUaWxlZE1vZGUgPSBudWxsO1xuXG4gICAgICAgIHRoaXMuYXBwLnN5c3RlbXMub24oJ3VwZGF0ZScsIHRoaXMub25VcGRhdGUsIHRoaXMpO1xuICAgICAgICB0aGlzLm9uKCdiZWZvcmVyZW1vdmUnLCB0aGlzLm9uQmVmb3JlUmVtb3ZlLCB0aGlzKTtcbiAgICB9XG5cbiAgICBzZXQgZGVmYXVsdE1hdGVyaWFsKG1hdGVyaWFsKSB7XG4gICAgICAgIHRoaXMuX2RlZmF1bHRNYXRlcmlhbCA9IG1hdGVyaWFsO1xuICAgIH1cblxuICAgIGdldCBkZWZhdWx0TWF0ZXJpYWwoKSB7XG4gICAgICAgIGlmICghdGhpcy5fZGVmYXVsdE1hdGVyaWFsKSB7XG4gICAgICAgICAgICBjb25zdCB0ZXh0dXJlID0gbmV3IFRleHR1cmUodGhpcy5hcHAuZ3JhcGhpY3NEZXZpY2UsIHtcbiAgICAgICAgICAgICAgICB3aWR0aDogMSxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDEsXG4gICAgICAgICAgICAgICAgZm9ybWF0OiBQSVhFTEZPUk1BVF9SR0JBOCxcbiAgICAgICAgICAgICAgICBuYW1lOiAnc3ByaXRlJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBwaXhlbHMgPSBuZXcgVWludDhBcnJheSh0ZXh0dXJlLmxvY2soKSk7XG4gICAgICAgICAgICBwaXhlbHNbMF0gPSBwaXhlbHNbMV0gPSBwaXhlbHNbMl0gPSBwaXhlbHNbM10gPSAyNTU7XG4gICAgICAgICAgICB0ZXh0dXJlLnVubG9jaygpO1xuXG4gICAgICAgICAgICBjb25zdCBtYXRlcmlhbCA9IG5ldyBTdGFuZGFyZE1hdGVyaWFsKCk7XG4gICAgICAgICAgICBtYXRlcmlhbC5kaWZmdXNlLnNldCgwLCAwLCAwKTsgLy8gYmxhY2sgZGlmZnVzZSBjb2xvciB0byBwcmV2ZW50IGFtYmllbnQgbGlnaHQgYmVpbmcgaW5jbHVkZWRcbiAgICAgICAgICAgIG1hdGVyaWFsLmVtaXNzaXZlLnNldCgwLjUsIDAuNSwgMC41KTsgLy8gdXNlIG5vbi13aGl0ZSB0byBjb21waWxlIHNoYWRlciBjb3JyZWN0bHlcbiAgICAgICAgICAgIG1hdGVyaWFsLmVtaXNzaXZlTWFwID0gdGV4dHVyZTtcbiAgICAgICAgICAgIG1hdGVyaWFsLmVtaXNzaXZlVGludCA9IHRydWU7XG4gICAgICAgICAgICBtYXRlcmlhbC5vcGFjaXR5TWFwID0gdGV4dHVyZTtcbiAgICAgICAgICAgIG1hdGVyaWFsLm9wYWNpdHlNYXBDaGFubmVsID0gJ2EnO1xuICAgICAgICAgICAgbWF0ZXJpYWwub3BhY2l0eVRpbnQgPSB0cnVlO1xuICAgICAgICAgICAgbWF0ZXJpYWwub3BhY2l0eSA9IDA7IC8vIHVzZSBub24tMSBvcGFjaXR5IHRvIGNvbXBpbGUgc2hhZGVyIGNvcnJlY3RseVxuICAgICAgICAgICAgbWF0ZXJpYWwudXNlTGlnaHRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIG1hdGVyaWFsLnVzZUdhbW1hVG9uZW1hcCA9IGZhbHNlO1xuICAgICAgICAgICAgbWF0ZXJpYWwudXNlRm9nID0gZmFsc2U7XG4gICAgICAgICAgICBtYXRlcmlhbC51c2VTa3lib3ggPSBmYWxzZTtcbiAgICAgICAgICAgIG1hdGVyaWFsLmJsZW5kVHlwZSA9IEJMRU5EX1BSRU1VTFRJUExJRUQ7XG4gICAgICAgICAgICBtYXRlcmlhbC5kZXB0aFdyaXRlID0gZmFsc2U7XG4gICAgICAgICAgICBtYXRlcmlhbC5waXhlbFNuYXAgPSBmYWxzZTtcbiAgICAgICAgICAgIG1hdGVyaWFsLmN1bGwgPSBDVUxMRkFDRV9OT05FOyAvLyBkb24ndCBjdWxsIGJlY2F1c2Ugd2UgbWlnaHQgZmxpcFggb3IgZmxpcFkgd2hpY2ggdXNlcyBuZWdhdGl2ZSBzY2FsZSBvbiB0aGUgZ3JhcGggbm9kZVxuICAgICAgICAgICAgbWF0ZXJpYWwudXBkYXRlKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRUZXh0dXJlID0gdGV4dHVyZTtcbiAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRNYXRlcmlhbCA9IG1hdGVyaWFsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9kZWZhdWx0TWF0ZXJpYWw7XG4gICAgfVxuXG4gICAgc2V0IGRlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxTbGljZWRNb2RlKG1hdGVyaWFsKSB7XG4gICAgICAgIHRoaXMuX2RlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxTbGljZWRNb2RlID0gbWF0ZXJpYWw7XG4gICAgfVxuXG4gICAgZ2V0IGRlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxTbGljZWRNb2RlKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2RlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxTbGljZWRNb2RlKSB7XG4gICAgICAgICAgICBjb25zdCBtYXRlcmlhbCA9IHRoaXMuZGVmYXVsdE1hdGVyaWFsLmNsb25lKCk7XG4gICAgICAgICAgICBtYXRlcmlhbC5uaW5lU2xpY2VkTW9kZSA9IFNQUklURV9SRU5ERVJNT0RFX1NMSUNFRDtcbiAgICAgICAgICAgIG1hdGVyaWFsLnVwZGF0ZSgpO1xuXG4gICAgICAgICAgICB0aGlzLl9kZWZhdWx0OVNsaWNlZE1hdGVyaWFsU2xpY2VkTW9kZSA9IG1hdGVyaWFsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9kZWZhdWx0OVNsaWNlZE1hdGVyaWFsU2xpY2VkTW9kZTtcbiAgICB9XG5cbiAgICBzZXQgZGVmYXVsdDlTbGljZWRNYXRlcmlhbFRpbGVkTW9kZShtYXRlcmlhbCkge1xuICAgICAgICB0aGlzLl9kZWZhdWx0OVNsaWNlZE1hdGVyaWFsVGlsZWRNb2RlID0gbWF0ZXJpYWw7XG4gICAgfVxuXG4gICAgZ2V0IGRlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxUaWxlZE1vZGUoKSB7XG4gICAgICAgIGlmICghdGhpcy5fZGVmYXVsdDlTbGljZWRNYXRlcmlhbFRpbGVkTW9kZSkge1xuICAgICAgICAgICAgY29uc3QgbWF0ZXJpYWwgPSB0aGlzLmRlZmF1bHRNYXRlcmlhbC5jbG9uZSgpO1xuICAgICAgICAgICAgbWF0ZXJpYWwubmluZVNsaWNlZE1vZGUgPSBTUFJJVEVfUkVOREVSTU9ERV9USUxFRDtcbiAgICAgICAgICAgIG1hdGVyaWFsLnVwZGF0ZSgpO1xuXG4gICAgICAgICAgICB0aGlzLl9kZWZhdWx0OVNsaWNlZE1hdGVyaWFsVGlsZWRNb2RlID0gbWF0ZXJpYWw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2RlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxUaWxlZE1vZGU7XG4gICAgfVxuXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgc3VwZXIuZGVzdHJveSgpO1xuXG4gICAgICAgIHRoaXMuYXBwLnN5c3RlbXMub2ZmKCd1cGRhdGUnLCB0aGlzLm9uVXBkYXRlLCB0aGlzKTtcblxuICAgICAgICBpZiAodGhpcy5fZGVmYXVsdFRleHR1cmUpIHtcbiAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRUZXh0dXJlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRUZXh0dXJlID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGluaXRpYWxpemVDb21wb25lbnREYXRhKGNvbXBvbmVudCwgZGF0YSwgcHJvcGVydGllcykge1xuICAgICAgICBpZiAoZGF0YS5lbmFibGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5lbmFibGVkID0gZGF0YS5lbmFibGVkO1xuICAgICAgICB9XG5cbiAgICAgICAgY29tcG9uZW50LnR5cGUgPSBkYXRhLnR5cGU7XG5cbiAgICAgICAgaWYgKGRhdGEubGF5ZXJzICYmIEFycmF5LmlzQXJyYXkoZGF0YS5sYXllcnMpKSB7XG4gICAgICAgICAgICBjb21wb25lbnQubGF5ZXJzID0gZGF0YS5sYXllcnMuc2xpY2UoMCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS5kcmF3T3JkZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29tcG9uZW50LmRyYXdPcmRlciA9IGRhdGEuZHJhd09yZGVyO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEuY29sb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYgKGRhdGEuY29sb3IgaW5zdGFuY2VvZiBDb2xvcikge1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudC5jb2xvci5zZXQoZGF0YS5jb2xvci5yLCBkYXRhLmNvbG9yLmcsIGRhdGEuY29sb3IuYiwgZGF0YS5vcGFjaXR5ICE9PSB1bmRlZmluZWQgPyBkYXRhLm9wYWNpdHkgOiAxKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50LmNvbG9yLnNldChkYXRhLmNvbG9yWzBdLCBkYXRhLmNvbG9yWzFdLCBkYXRhLmNvbG9yWzJdLCBkYXRhLm9wYWNpdHkgIT09IHVuZGVmaW5lZCA/IGRhdGEub3BhY2l0eSA6IDEpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1zZWxmLWFzc2lnbiAqL1xuICAgICAgICAgICAgLy8gZm9yY2UgdXBkYXRlXG4gICAgICAgICAgICBjb21wb25lbnQuY29sb3IgPSBjb21wb25lbnQuY29sb3I7XG4gICAgICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLXNlbGYtYXNzaWduICovXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS5vcGFjaXR5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5vcGFjaXR5ID0gZGF0YS5vcGFjaXR5O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEuZmxpcFggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29tcG9uZW50LmZsaXBYID0gZGF0YS5mbGlwWDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLmZsaXBZICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5mbGlwWSA9IGRhdGEuZmxpcFk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS53aWR0aCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb21wb25lbnQud2lkdGggPSBkYXRhLndpZHRoO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEuaGVpZ2h0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5oZWlnaHQgPSBkYXRhLmhlaWdodDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLnNwcml0ZUFzc2V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5zcHJpdGVBc3NldCA9IGRhdGEuc3ByaXRlQXNzZXQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS5zcHJpdGUpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5zcHJpdGUgPSBkYXRhLnNwcml0ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLmZyYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5mcmFtZSA9IGRhdGEuZnJhbWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS5jbGlwcykge1xuICAgICAgICAgICAgZm9yIChjb25zdCBuYW1lIGluIGRhdGEuY2xpcHMpIHtcbiAgICAgICAgICAgICAgICBjb21wb25lbnQuYWRkQ2xpcChkYXRhLmNsaXBzW25hbWVdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLnNwZWVkICE9PSB1bmRlZmluZWQpICB7XG4gICAgICAgICAgICBjb21wb25lbnQuc3BlZWQgPSBkYXRhLnNwZWVkO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEuYXV0b1BsYXlDbGlwKSB7XG4gICAgICAgICAgICBjb21wb25lbnQuYXV0b1BsYXlDbGlwID0gZGF0YS5hdXRvUGxheUNsaXA7XG4gICAgICAgIH1cblxuICAgICAgICBjb21wb25lbnQuYmF0Y2hHcm91cElkID0gZGF0YS5iYXRjaEdyb3VwSWQgPT09IHVuZGVmaW5lZCB8fCBkYXRhLmJhdGNoR3JvdXBJZCA9PT0gbnVsbCA/IC0xIDogZGF0YS5iYXRjaEdyb3VwSWQ7XG5cbiAgICAgICAgc3VwZXIuaW5pdGlhbGl6ZUNvbXBvbmVudERhdGEoY29tcG9uZW50LCBkYXRhLCBwcm9wZXJ0aWVzKTtcbiAgICB9XG5cbiAgICBjbG9uZUNvbXBvbmVudChlbnRpdHksIGNsb25lKSB7XG4gICAgICAgIGNvbnN0IHNvdXJjZSA9IGVudGl0eS5zcHJpdGU7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkQ29tcG9uZW50KGNsb25lLCB7XG4gICAgICAgICAgICBlbmFibGVkOiBzb3VyY2UuZW5hYmxlZCxcbiAgICAgICAgICAgIHR5cGU6IHNvdXJjZS50eXBlLFxuICAgICAgICAgICAgc3ByaXRlQXNzZXQ6IHNvdXJjZS5zcHJpdGVBc3NldCxcbiAgICAgICAgICAgIHNwcml0ZTogc291cmNlLnNwcml0ZSxcbiAgICAgICAgICAgIGZyYW1lOiBzb3VyY2UuZnJhbWUsXG4gICAgICAgICAgICBjb2xvcjogc291cmNlLmNvbG9yLmNsb25lKCksXG4gICAgICAgICAgICBvcGFjaXR5OiBzb3VyY2Uub3BhY2l0eSxcbiAgICAgICAgICAgIGZsaXBYOiBzb3VyY2UuZmxpcFgsXG4gICAgICAgICAgICBmbGlwWTogc291cmNlLmZsaXBZLFxuICAgICAgICAgICAgc3BlZWQ6IHNvdXJjZS5zcGVlZCxcbiAgICAgICAgICAgIGNsaXBzOiBzb3VyY2UuY2xpcHMsXG4gICAgICAgICAgICBhdXRvUGxheUNsaXA6IHNvdXJjZS5hdXRvUGxheUNsaXAsXG4gICAgICAgICAgICBiYXRjaEdyb3VwSWQ6IHNvdXJjZS5iYXRjaEdyb3VwSWQsXG4gICAgICAgICAgICBkcmF3T3JkZXI6IHNvdXJjZS5kcmF3T3JkZXIsXG4gICAgICAgICAgICBsYXllcnM6IHNvdXJjZS5sYXllcnMuc2xpY2UoMClcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgb25VcGRhdGUoZHQpIHtcbiAgICAgICAgY29uc3QgY29tcG9uZW50cyA9IHRoaXMuc3RvcmU7XG5cbiAgICAgICAgZm9yIChjb25zdCBpZCBpbiBjb21wb25lbnRzKSB7XG4gICAgICAgICAgICBpZiAoY29tcG9uZW50cy5oYXNPd25Qcm9wZXJ0eShpZCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSBjb21wb25lbnRzW2lkXTtcbiAgICAgICAgICAgICAgICAvLyBpZiBzcHJpdGUgY29tcG9uZW50IGlzIGVuYWJsZWQgYWR2YW5jZSBpdHMgY3VycmVudCBjbGlwXG4gICAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudC5kYXRhLmVuYWJsZWQgJiYgY29tcG9uZW50LmVudGl0eS5lbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwcml0ZSA9IGNvbXBvbmVudC5lbnRpdHkuc3ByaXRlO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc3ByaXRlLl9jdXJyZW50Q2xpcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3ByaXRlLl9jdXJyZW50Q2xpcC5fdXBkYXRlKGR0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uQmVmb3JlUmVtb3ZlKGVudGl0eSwgY29tcG9uZW50KSB7XG4gICAgICAgIGNvbXBvbmVudC5vbkRlc3Ryb3koKTtcbiAgICB9XG59XG5cbkNvbXBvbmVudC5fYnVpbGRBY2Nlc3NvcnMoU3ByaXRlQ29tcG9uZW50LnByb3RvdHlwZSwgX3NjaGVtYSk7XG5cbmV4cG9ydCB7IFNwcml0ZUNvbXBvbmVudFN5c3RlbSB9O1xuIl0sIm5hbWVzIjpbIl9zY2hlbWEiLCJTcHJpdGVDb21wb25lbnRTeXN0ZW0iLCJDb21wb25lbnRTeXN0ZW0iLCJjb25zdHJ1Y3RvciIsImFwcCIsImlkIiwiQ29tcG9uZW50VHlwZSIsIlNwcml0ZUNvbXBvbmVudCIsIkRhdGFUeXBlIiwiU3ByaXRlQ29tcG9uZW50RGF0YSIsInNjaGVtYSIsIl9kZWZhdWx0VGV4dHVyZSIsIl9kZWZhdWx0TWF0ZXJpYWwiLCJfZGVmYXVsdDlTbGljZWRNYXRlcmlhbFNsaWNlZE1vZGUiLCJfZGVmYXVsdDlTbGljZWRNYXRlcmlhbFRpbGVkTW9kZSIsInN5c3RlbXMiLCJvbiIsIm9uVXBkYXRlIiwib25CZWZvcmVSZW1vdmUiLCJkZWZhdWx0TWF0ZXJpYWwiLCJtYXRlcmlhbCIsInRleHR1cmUiLCJUZXh0dXJlIiwiZ3JhcGhpY3NEZXZpY2UiLCJ3aWR0aCIsImhlaWdodCIsImZvcm1hdCIsIlBJWEVMRk9STUFUX1JHQkE4IiwibmFtZSIsInBpeGVscyIsIlVpbnQ4QXJyYXkiLCJsb2NrIiwidW5sb2NrIiwiU3RhbmRhcmRNYXRlcmlhbCIsImRpZmZ1c2UiLCJzZXQiLCJlbWlzc2l2ZSIsImVtaXNzaXZlTWFwIiwiZW1pc3NpdmVUaW50Iiwib3BhY2l0eU1hcCIsIm9wYWNpdHlNYXBDaGFubmVsIiwib3BhY2l0eVRpbnQiLCJvcGFjaXR5IiwidXNlTGlnaHRpbmciLCJ1c2VHYW1tYVRvbmVtYXAiLCJ1c2VGb2ciLCJ1c2VTa3lib3giLCJibGVuZFR5cGUiLCJCTEVORF9QUkVNVUxUSVBMSUVEIiwiZGVwdGhXcml0ZSIsInBpeGVsU25hcCIsImN1bGwiLCJDVUxMRkFDRV9OT05FIiwidXBkYXRlIiwiZGVmYXVsdDlTbGljZWRNYXRlcmlhbFNsaWNlZE1vZGUiLCJjbG9uZSIsIm5pbmVTbGljZWRNb2RlIiwiU1BSSVRFX1JFTkRFUk1PREVfU0xJQ0VEIiwiZGVmYXVsdDlTbGljZWRNYXRlcmlhbFRpbGVkTW9kZSIsIlNQUklURV9SRU5ERVJNT0RFX1RJTEVEIiwiZGVzdHJveSIsIm9mZiIsImluaXRpYWxpemVDb21wb25lbnREYXRhIiwiY29tcG9uZW50IiwiZGF0YSIsInByb3BlcnRpZXMiLCJlbmFibGVkIiwidW5kZWZpbmVkIiwidHlwZSIsImxheWVycyIsIkFycmF5IiwiaXNBcnJheSIsInNsaWNlIiwiZHJhd09yZGVyIiwiY29sb3IiLCJDb2xvciIsInIiLCJnIiwiYiIsImZsaXBYIiwiZmxpcFkiLCJzcHJpdGVBc3NldCIsInNwcml0ZSIsImZyYW1lIiwiY2xpcHMiLCJhZGRDbGlwIiwic3BlZWQiLCJhdXRvUGxheUNsaXAiLCJiYXRjaEdyb3VwSWQiLCJjbG9uZUNvbXBvbmVudCIsImVudGl0eSIsInNvdXJjZSIsImFkZENvbXBvbmVudCIsImR0IiwiY29tcG9uZW50cyIsInN0b3JlIiwiaGFzT3duUHJvcGVydHkiLCJfY3VycmVudENsaXAiLCJfdXBkYXRlIiwib25EZXN0cm95IiwiQ29tcG9uZW50IiwiX2J1aWxkQWNjZXNzb3JzIiwicHJvdG90eXBlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFpQkEsTUFBTUEsT0FBTyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUE7O0FBRTNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQyxxQkFBcUIsU0FBU0MsZUFBZSxDQUFDO0FBQ2hEO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNJQyxXQUFXLENBQUNDLEdBQUcsRUFBRTtJQUNiLEtBQUssQ0FBQ0EsR0FBRyxDQUFDLENBQUE7SUFFVixJQUFJLENBQUNDLEVBQUUsR0FBRyxRQUFRLENBQUE7SUFFbEIsSUFBSSxDQUFDQyxhQUFhLEdBQUdDLGVBQWUsQ0FBQTtJQUNwQyxJQUFJLENBQUNDLFFBQVEsR0FBR0MsbUJBQW1CLENBQUE7SUFFbkMsSUFBSSxDQUFDQyxNQUFNLEdBQUdWLE9BQU8sQ0FBQTs7QUFFckI7SUFDQSxJQUFJLENBQUNXLGVBQWUsR0FBRyxJQUFJLENBQUE7O0FBRTNCO0lBQ0EsSUFBSSxDQUFDQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUE7O0FBRTVCO0lBQ0EsSUFBSSxDQUFDQyxpQ0FBaUMsR0FBRyxJQUFJLENBQUE7O0FBRTdDO0lBQ0EsSUFBSSxDQUFDQyxnQ0FBZ0MsR0FBRyxJQUFJLENBQUE7QUFFNUMsSUFBQSxJQUFJLENBQUNWLEdBQUcsQ0FBQ1csT0FBTyxDQUFDQyxFQUFFLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQ0MsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFBO0lBQ2xELElBQUksQ0FBQ0QsRUFBRSxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUNFLGNBQWMsRUFBRSxJQUFJLENBQUMsQ0FBQTtBQUN0RCxHQUFBO0VBRUEsSUFBSUMsZUFBZSxDQUFDQyxRQUFRLEVBQUU7SUFDMUIsSUFBSSxDQUFDUixnQkFBZ0IsR0FBR1EsUUFBUSxDQUFBO0FBQ3BDLEdBQUE7QUFFQSxFQUFBLElBQUlELGVBQWUsR0FBRztBQUNsQixJQUFBLElBQUksQ0FBQyxJQUFJLENBQUNQLGdCQUFnQixFQUFFO01BQ3hCLE1BQU1TLE9BQU8sR0FBRyxJQUFJQyxPQUFPLENBQUMsSUFBSSxDQUFDbEIsR0FBRyxDQUFDbUIsY0FBYyxFQUFFO0FBQ2pEQyxRQUFBQSxLQUFLLEVBQUUsQ0FBQztBQUNSQyxRQUFBQSxNQUFNLEVBQUUsQ0FBQztBQUNUQyxRQUFBQSxNQUFNLEVBQUVDLGlCQUFpQjtBQUN6QkMsUUFBQUEsSUFBSSxFQUFFLFFBQUE7QUFDVixPQUFDLENBQUMsQ0FBQTtNQUNGLE1BQU1DLE1BQU0sR0FBRyxJQUFJQyxVQUFVLENBQUNULE9BQU8sQ0FBQ1UsSUFBSSxFQUFFLENBQUMsQ0FBQTtBQUM3Q0YsTUFBQUEsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHQSxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUdBLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBR0EsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQTtNQUNuRFIsT0FBTyxDQUFDVyxNQUFNLEVBQUUsQ0FBQTtBQUVoQixNQUFBLE1BQU1aLFFBQVEsR0FBRyxJQUFJYSxnQkFBZ0IsRUFBRSxDQUFBO0FBQ3ZDYixNQUFBQSxRQUFRLENBQUNjLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDOUJmLE1BQUFBLFFBQVEsQ0FBQ2dCLFFBQVEsQ0FBQ0QsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7TUFDckNmLFFBQVEsQ0FBQ2lCLFdBQVcsR0FBR2hCLE9BQU8sQ0FBQTtNQUM5QkQsUUFBUSxDQUFDa0IsWUFBWSxHQUFHLElBQUksQ0FBQTtNQUM1QmxCLFFBQVEsQ0FBQ21CLFVBQVUsR0FBR2xCLE9BQU8sQ0FBQTtNQUM3QkQsUUFBUSxDQUFDb0IsaUJBQWlCLEdBQUcsR0FBRyxDQUFBO01BQ2hDcEIsUUFBUSxDQUFDcUIsV0FBVyxHQUFHLElBQUksQ0FBQTtBQUMzQnJCLE1BQUFBLFFBQVEsQ0FBQ3NCLE9BQU8sR0FBRyxDQUFDLENBQUM7TUFDckJ0QixRQUFRLENBQUN1QixXQUFXLEdBQUcsS0FBSyxDQUFBO01BQzVCdkIsUUFBUSxDQUFDd0IsZUFBZSxHQUFHLEtBQUssQ0FBQTtNQUNoQ3hCLFFBQVEsQ0FBQ3lCLE1BQU0sR0FBRyxLQUFLLENBQUE7TUFDdkJ6QixRQUFRLENBQUMwQixTQUFTLEdBQUcsS0FBSyxDQUFBO01BQzFCMUIsUUFBUSxDQUFDMkIsU0FBUyxHQUFHQyxtQkFBbUIsQ0FBQTtNQUN4QzVCLFFBQVEsQ0FBQzZCLFVBQVUsR0FBRyxLQUFLLENBQUE7TUFDM0I3QixRQUFRLENBQUM4QixTQUFTLEdBQUcsS0FBSyxDQUFBO0FBQzFCOUIsTUFBQUEsUUFBUSxDQUFDK0IsSUFBSSxHQUFHQyxhQUFhLENBQUM7TUFDOUJoQyxRQUFRLENBQUNpQyxNQUFNLEVBQUUsQ0FBQTtNQUVqQixJQUFJLENBQUMxQyxlQUFlLEdBQUdVLE9BQU8sQ0FBQTtNQUM5QixJQUFJLENBQUNULGdCQUFnQixHQUFHUSxRQUFRLENBQUE7QUFDcEMsS0FBQTtJQUNBLE9BQU8sSUFBSSxDQUFDUixnQkFBZ0IsQ0FBQTtBQUNoQyxHQUFBO0VBRUEsSUFBSTBDLGdDQUFnQyxDQUFDbEMsUUFBUSxFQUFFO0lBQzNDLElBQUksQ0FBQ1AsaUNBQWlDLEdBQUdPLFFBQVEsQ0FBQTtBQUNyRCxHQUFBO0FBRUEsRUFBQSxJQUFJa0MsZ0NBQWdDLEdBQUc7QUFDbkMsSUFBQSxJQUFJLENBQUMsSUFBSSxDQUFDekMsaUNBQWlDLEVBQUU7QUFDekMsTUFBQSxNQUFNTyxRQUFRLEdBQUcsSUFBSSxDQUFDRCxlQUFlLENBQUNvQyxLQUFLLEVBQUUsQ0FBQTtNQUM3Q25DLFFBQVEsQ0FBQ29DLGNBQWMsR0FBR0Msd0JBQXdCLENBQUE7TUFDbERyQyxRQUFRLENBQUNpQyxNQUFNLEVBQUUsQ0FBQTtNQUVqQixJQUFJLENBQUN4QyxpQ0FBaUMsR0FBR08sUUFBUSxDQUFBO0FBQ3JELEtBQUE7SUFDQSxPQUFPLElBQUksQ0FBQ1AsaUNBQWlDLENBQUE7QUFDakQsR0FBQTtFQUVBLElBQUk2QywrQkFBK0IsQ0FBQ3RDLFFBQVEsRUFBRTtJQUMxQyxJQUFJLENBQUNOLGdDQUFnQyxHQUFHTSxRQUFRLENBQUE7QUFDcEQsR0FBQTtBQUVBLEVBQUEsSUFBSXNDLCtCQUErQixHQUFHO0FBQ2xDLElBQUEsSUFBSSxDQUFDLElBQUksQ0FBQzVDLGdDQUFnQyxFQUFFO0FBQ3hDLE1BQUEsTUFBTU0sUUFBUSxHQUFHLElBQUksQ0FBQ0QsZUFBZSxDQUFDb0MsS0FBSyxFQUFFLENBQUE7TUFDN0NuQyxRQUFRLENBQUNvQyxjQUFjLEdBQUdHLHVCQUF1QixDQUFBO01BQ2pEdkMsUUFBUSxDQUFDaUMsTUFBTSxFQUFFLENBQUE7TUFFakIsSUFBSSxDQUFDdkMsZ0NBQWdDLEdBQUdNLFFBQVEsQ0FBQTtBQUNwRCxLQUFBO0lBQ0EsT0FBTyxJQUFJLENBQUNOLGdDQUFnQyxDQUFBO0FBQ2hELEdBQUE7QUFFQThDLEVBQUFBLE9BQU8sR0FBRztJQUNOLEtBQUssQ0FBQ0EsT0FBTyxFQUFFLENBQUE7QUFFZixJQUFBLElBQUksQ0FBQ3hELEdBQUcsQ0FBQ1csT0FBTyxDQUFDOEMsR0FBRyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUM1QyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFFbkQsSUFBSSxJQUFJLENBQUNOLGVBQWUsRUFBRTtBQUN0QixNQUFBLElBQUksQ0FBQ0EsZUFBZSxDQUFDaUQsT0FBTyxFQUFFLENBQUE7TUFDOUIsSUFBSSxDQUFDakQsZUFBZSxHQUFHLElBQUksQ0FBQTtBQUMvQixLQUFBO0FBQ0osR0FBQTtBQUVBbUQsRUFBQUEsdUJBQXVCLENBQUNDLFNBQVMsRUFBRUMsSUFBSSxFQUFFQyxVQUFVLEVBQUU7QUFDakQsSUFBQSxJQUFJRCxJQUFJLENBQUNFLE9BQU8sS0FBS0MsU0FBUyxFQUFFO0FBQzVCSixNQUFBQSxTQUFTLENBQUNHLE9BQU8sR0FBR0YsSUFBSSxDQUFDRSxPQUFPLENBQUE7QUFDcEMsS0FBQTtBQUVBSCxJQUFBQSxTQUFTLENBQUNLLElBQUksR0FBR0osSUFBSSxDQUFDSSxJQUFJLENBQUE7QUFFMUIsSUFBQSxJQUFJSixJQUFJLENBQUNLLE1BQU0sSUFBSUMsS0FBSyxDQUFDQyxPQUFPLENBQUNQLElBQUksQ0FBQ0ssTUFBTSxDQUFDLEVBQUU7TUFDM0NOLFNBQVMsQ0FBQ00sTUFBTSxHQUFHTCxJQUFJLENBQUNLLE1BQU0sQ0FBQ0csS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQzNDLEtBQUE7QUFFQSxJQUFBLElBQUlSLElBQUksQ0FBQ1MsU0FBUyxLQUFLTixTQUFTLEVBQUU7QUFDOUJKLE1BQUFBLFNBQVMsQ0FBQ1UsU0FBUyxHQUFHVCxJQUFJLENBQUNTLFNBQVMsQ0FBQTtBQUN4QyxLQUFBO0FBRUEsSUFBQSxJQUFJVCxJQUFJLENBQUNVLEtBQUssS0FBS1AsU0FBUyxFQUFFO0FBQzFCLE1BQUEsSUFBSUgsSUFBSSxDQUFDVSxLQUFLLFlBQVlDLEtBQUssRUFBRTtBQUM3QlosUUFBQUEsU0FBUyxDQUFDVyxLQUFLLENBQUN2QyxHQUFHLENBQUM2QixJQUFJLENBQUNVLEtBQUssQ0FBQ0UsQ0FBQyxFQUFFWixJQUFJLENBQUNVLEtBQUssQ0FBQ0csQ0FBQyxFQUFFYixJQUFJLENBQUNVLEtBQUssQ0FBQ0ksQ0FBQyxFQUFFZCxJQUFJLENBQUN0QixPQUFPLEtBQUt5QixTQUFTLEdBQUdILElBQUksQ0FBQ3RCLE9BQU8sR0FBRyxDQUFDLENBQUMsQ0FBQTtBQUNoSCxPQUFDLE1BQU07QUFDSHFCLFFBQUFBLFNBQVMsQ0FBQ1csS0FBSyxDQUFDdkMsR0FBRyxDQUFDNkIsSUFBSSxDQUFDVSxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUVWLElBQUksQ0FBQ1UsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFVixJQUFJLENBQUNVLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRVYsSUFBSSxDQUFDdEIsT0FBTyxLQUFLeUIsU0FBUyxHQUFHSCxJQUFJLENBQUN0QixPQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUE7QUFDbkgsT0FBQTs7QUFFQTtBQUNBO0FBQ0FxQixNQUFBQSxTQUFTLENBQUNXLEtBQUssR0FBR1gsU0FBUyxDQUFDVyxLQUFLLENBQUE7QUFDakM7QUFDSixLQUFBOztBQUVBLElBQUEsSUFBSVYsSUFBSSxDQUFDdEIsT0FBTyxLQUFLeUIsU0FBUyxFQUFFO0FBQzVCSixNQUFBQSxTQUFTLENBQUNyQixPQUFPLEdBQUdzQixJQUFJLENBQUN0QixPQUFPLENBQUE7QUFDcEMsS0FBQTtBQUVBLElBQUEsSUFBSXNCLElBQUksQ0FBQ2UsS0FBSyxLQUFLWixTQUFTLEVBQUU7QUFDMUJKLE1BQUFBLFNBQVMsQ0FBQ2dCLEtBQUssR0FBR2YsSUFBSSxDQUFDZSxLQUFLLENBQUE7QUFDaEMsS0FBQTtBQUVBLElBQUEsSUFBSWYsSUFBSSxDQUFDZ0IsS0FBSyxLQUFLYixTQUFTLEVBQUU7QUFDMUJKLE1BQUFBLFNBQVMsQ0FBQ2lCLEtBQUssR0FBR2hCLElBQUksQ0FBQ2dCLEtBQUssQ0FBQTtBQUNoQyxLQUFBO0FBRUEsSUFBQSxJQUFJaEIsSUFBSSxDQUFDeEMsS0FBSyxLQUFLMkMsU0FBUyxFQUFFO0FBQzFCSixNQUFBQSxTQUFTLENBQUN2QyxLQUFLLEdBQUd3QyxJQUFJLENBQUN4QyxLQUFLLENBQUE7QUFDaEMsS0FBQTtBQUVBLElBQUEsSUFBSXdDLElBQUksQ0FBQ3ZDLE1BQU0sS0FBSzBDLFNBQVMsRUFBRTtBQUMzQkosTUFBQUEsU0FBUyxDQUFDdEMsTUFBTSxHQUFHdUMsSUFBSSxDQUFDdkMsTUFBTSxDQUFBO0FBQ2xDLEtBQUE7QUFFQSxJQUFBLElBQUl1QyxJQUFJLENBQUNpQixXQUFXLEtBQUtkLFNBQVMsRUFBRTtBQUNoQ0osTUFBQUEsU0FBUyxDQUFDa0IsV0FBVyxHQUFHakIsSUFBSSxDQUFDaUIsV0FBVyxDQUFBO0FBQzVDLEtBQUE7SUFFQSxJQUFJakIsSUFBSSxDQUFDa0IsTUFBTSxFQUFFO0FBQ2JuQixNQUFBQSxTQUFTLENBQUNtQixNQUFNLEdBQUdsQixJQUFJLENBQUNrQixNQUFNLENBQUE7QUFDbEMsS0FBQTtBQUVBLElBQUEsSUFBSWxCLElBQUksQ0FBQ21CLEtBQUssS0FBS2hCLFNBQVMsRUFBRTtBQUMxQkosTUFBQUEsU0FBUyxDQUFDb0IsS0FBSyxHQUFHbkIsSUFBSSxDQUFDbUIsS0FBSyxDQUFBO0FBQ2hDLEtBQUE7SUFFQSxJQUFJbkIsSUFBSSxDQUFDb0IsS0FBSyxFQUFFO0FBQ1osTUFBQSxLQUFLLE1BQU14RCxJQUFJLElBQUlvQyxJQUFJLENBQUNvQixLQUFLLEVBQUU7UUFDM0JyQixTQUFTLENBQUNzQixPQUFPLENBQUNyQixJQUFJLENBQUNvQixLQUFLLENBQUN4RCxJQUFJLENBQUMsQ0FBQyxDQUFBO0FBQ3ZDLE9BQUE7QUFDSixLQUFBO0FBRUEsSUFBQSxJQUFJb0MsSUFBSSxDQUFDc0IsS0FBSyxLQUFLbkIsU0FBUyxFQUFHO0FBQzNCSixNQUFBQSxTQUFTLENBQUN1QixLQUFLLEdBQUd0QixJQUFJLENBQUNzQixLQUFLLENBQUE7QUFDaEMsS0FBQTtJQUVBLElBQUl0QixJQUFJLENBQUN1QixZQUFZLEVBQUU7QUFDbkJ4QixNQUFBQSxTQUFTLENBQUN3QixZQUFZLEdBQUd2QixJQUFJLENBQUN1QixZQUFZLENBQUE7QUFDOUMsS0FBQTtJQUVBeEIsU0FBUyxDQUFDeUIsWUFBWSxHQUFHeEIsSUFBSSxDQUFDd0IsWUFBWSxLQUFLckIsU0FBUyxJQUFJSCxJQUFJLENBQUN3QixZQUFZLEtBQUssSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHeEIsSUFBSSxDQUFDd0IsWUFBWSxDQUFBO0lBRS9HLEtBQUssQ0FBQzFCLHVCQUF1QixDQUFDQyxTQUFTLEVBQUVDLElBQUksRUFBRUMsVUFBVSxDQUFDLENBQUE7QUFDOUQsR0FBQTtBQUVBd0IsRUFBQUEsY0FBYyxDQUFDQyxNQUFNLEVBQUVuQyxLQUFLLEVBQUU7QUFDMUIsSUFBQSxNQUFNb0MsTUFBTSxHQUFHRCxNQUFNLENBQUNSLE1BQU0sQ0FBQTtBQUU1QixJQUFBLE9BQU8sSUFBSSxDQUFDVSxZQUFZLENBQUNyQyxLQUFLLEVBQUU7TUFDNUJXLE9BQU8sRUFBRXlCLE1BQU0sQ0FBQ3pCLE9BQU87TUFDdkJFLElBQUksRUFBRXVCLE1BQU0sQ0FBQ3ZCLElBQUk7TUFDakJhLFdBQVcsRUFBRVUsTUFBTSxDQUFDVixXQUFXO01BQy9CQyxNQUFNLEVBQUVTLE1BQU0sQ0FBQ1QsTUFBTTtNQUNyQkMsS0FBSyxFQUFFUSxNQUFNLENBQUNSLEtBQUs7QUFDbkJULE1BQUFBLEtBQUssRUFBRWlCLE1BQU0sQ0FBQ2pCLEtBQUssQ0FBQ25CLEtBQUssRUFBRTtNQUMzQmIsT0FBTyxFQUFFaUQsTUFBTSxDQUFDakQsT0FBTztNQUN2QnFDLEtBQUssRUFBRVksTUFBTSxDQUFDWixLQUFLO01BQ25CQyxLQUFLLEVBQUVXLE1BQU0sQ0FBQ1gsS0FBSztNQUNuQk0sS0FBSyxFQUFFSyxNQUFNLENBQUNMLEtBQUs7TUFDbkJGLEtBQUssRUFBRU8sTUFBTSxDQUFDUCxLQUFLO01BQ25CRyxZQUFZLEVBQUVJLE1BQU0sQ0FBQ0osWUFBWTtNQUNqQ0MsWUFBWSxFQUFFRyxNQUFNLENBQUNILFlBQVk7TUFDakNmLFNBQVMsRUFBRWtCLE1BQU0sQ0FBQ2xCLFNBQVM7QUFDM0JKLE1BQUFBLE1BQU0sRUFBRXNCLE1BQU0sQ0FBQ3RCLE1BQU0sQ0FBQ0csS0FBSyxDQUFDLENBQUMsQ0FBQTtBQUNqQyxLQUFDLENBQUMsQ0FBQTtBQUNOLEdBQUE7RUFFQXZELFFBQVEsQ0FBQzRFLEVBQUUsRUFBRTtBQUNULElBQUEsTUFBTUMsVUFBVSxHQUFHLElBQUksQ0FBQ0MsS0FBSyxDQUFBO0FBRTdCLElBQUEsS0FBSyxNQUFNMUYsRUFBRSxJQUFJeUYsVUFBVSxFQUFFO0FBQ3pCLE1BQUEsSUFBSUEsVUFBVSxDQUFDRSxjQUFjLENBQUMzRixFQUFFLENBQUMsRUFBRTtBQUMvQixRQUFBLE1BQU0wRCxTQUFTLEdBQUcrQixVQUFVLENBQUN6RixFQUFFLENBQUMsQ0FBQTtBQUNoQztRQUNBLElBQUkwRCxTQUFTLENBQUNDLElBQUksQ0FBQ0UsT0FBTyxJQUFJSCxTQUFTLENBQUMyQixNQUFNLENBQUN4QixPQUFPLEVBQUU7QUFDcEQsVUFBQSxNQUFNZ0IsTUFBTSxHQUFHbkIsU0FBUyxDQUFDMkIsTUFBTSxDQUFDUixNQUFNLENBQUE7VUFDdEMsSUFBSUEsTUFBTSxDQUFDZSxZQUFZLEVBQUU7QUFDckJmLFlBQUFBLE1BQU0sQ0FBQ2UsWUFBWSxDQUFDQyxPQUFPLENBQUNMLEVBQUUsQ0FBQyxDQUFBO0FBQ25DLFdBQUE7QUFDSixTQUFBO0FBQ0osT0FBQTtBQUNKLEtBQUE7QUFDSixHQUFBO0FBRUEzRSxFQUFBQSxjQUFjLENBQUN3RSxNQUFNLEVBQUUzQixTQUFTLEVBQUU7SUFDOUJBLFNBQVMsQ0FBQ29DLFNBQVMsRUFBRSxDQUFBO0FBQ3pCLEdBQUE7QUFDSixDQUFBO0FBRUFDLFNBQVMsQ0FBQ0MsZUFBZSxDQUFDOUYsZUFBZSxDQUFDK0YsU0FBUyxFQUFFdEcsT0FBTyxDQUFDOzs7OyJ9
