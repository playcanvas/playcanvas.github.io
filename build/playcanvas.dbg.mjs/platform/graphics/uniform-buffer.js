/**
 * @license
 * PlayCanvas Engine v1.58.0-preview revision 1fec26519 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../../core/debug.js';
import { uniformTypeToName, UNIFORMTYPE_FLOAT, UNIFORMTYPE_VEC2, UNIFORMTYPE_VEC3, UNIFORMTYPE_VEC4, UNIFORMTYPE_INT, UNIFORMTYPE_IVEC2, UNIFORMTYPE_IVEC3, UNIFORMTYPE_IVEC4, UNIFORMTYPE_MAT2, UNIFORMTYPE_MAT3 } from './constants.js';

const _updateFunctions = [];
_updateFunctions[UNIFORMTYPE_FLOAT] = function (uniformBuffer, value, offset) {
  const dst = uniformBuffer.storageFloat32;
  dst[offset] = value;
};
_updateFunctions[UNIFORMTYPE_VEC2] = (uniformBuffer, value, offset) => {
  const dst = uniformBuffer.storageFloat32;
  dst[offset] = value[0];
  dst[offset + 1] = value[1];
};
_updateFunctions[UNIFORMTYPE_VEC3] = (uniformBuffer, value, offset) => {
  const dst = uniformBuffer.storageFloat32;
  dst[offset] = value[0];
  dst[offset + 1] = value[1];
  dst[offset + 2] = value[2];
};
_updateFunctions[UNIFORMTYPE_VEC4] = (uniformBuffer, value, offset) => {
  const dst = uniformBuffer.storageFloat32;
  dst[offset] = value[0];
  dst[offset + 1] = value[1];
  dst[offset + 2] = value[2];
  dst[offset + 3] = value[3];
};
_updateFunctions[UNIFORMTYPE_INT] = function (uniformBuffer, value, offset) {
  const dst = uniformBuffer.storageInt32;
  dst[offset] = value;
};
_updateFunctions[UNIFORMTYPE_IVEC2] = function (uniformBuffer, value, offset) {
  const dst = uniformBuffer.storageInt32;
  dst[offset] = value[0];
  dst[offset + 1] = value[1];
};
_updateFunctions[UNIFORMTYPE_IVEC3] = function (uniformBuffer, value, offset) {
  const dst = uniformBuffer.storageInt32;
  dst[offset] = value[0];
  dst[offset + 1] = value[1];
  dst[offset + 2] = value[2];
};
_updateFunctions[UNIFORMTYPE_IVEC4] = function (uniformBuffer, value, offset) {
  const dst = uniformBuffer.storageInt32;
  dst[offset] = value[0];
  dst[offset + 1] = value[1];
  dst[offset + 2] = value[2];
  dst[offset + 3] = value[3];
};

_updateFunctions[UNIFORMTYPE_MAT2] = (uniformBuffer, value, offset) => {
  const dst = uniformBuffer.storageFloat32;
  dst[offset] = value[0];
  dst[offset + 1] = value[1];
  dst[offset + 4] = value[2];
  dst[offset + 5] = value[3];
  dst[offset + 8] = value[4];
  dst[offset + 9] = value[5];
};

_updateFunctions[UNIFORMTYPE_MAT3] = (uniformBuffer, value, offset) => {
  const dst = uniformBuffer.storageFloat32;
  dst[offset] = value[0];
  dst[offset + 1] = value[1];
  dst[offset + 2] = value[2];
  dst[offset + 4] = value[3];
  dst[offset + 5] = value[4];
  dst[offset + 6] = value[5];
  dst[offset + 8] = value[6];
  dst[offset + 9] = value[7];
  dst[offset + 10] = value[8];
};

class UniformBuffer {
  constructor(graphicsDevice, format) {
    this.device = graphicsDevice;
    this.format = format;
    Debug.assert(format);
    this.impl = graphicsDevice.createUniformBufferImpl(this);
    this.storage = new ArrayBuffer(format.byteSize);
    this.storageFloat32 = new Float32Array(this.storage);
    this.storageInt32 = new Int32Array(this.storage);
    graphicsDevice._vram.ub += this.format.byteSize;

  }

  destroy() {
    const device = this.device;

    this.impl.destroy(device);
    device._vram.ub -= this.format.byteSize;
  }

  loseContext() {
    this.impl.loseContext();
  }

  setUniform(uniformFormat) {
    Debug.assert(uniformFormat);
    const offset = uniformFormat.offset;
    const value = uniformFormat.scopeId.value;
    if (value !== null && value !== undefined) {
      const updateFunction = _updateFunctions[uniformFormat.type];
      if (updateFunction) {
        updateFunction(this, value, offset);
      } else {
        this.storageFloat32.set(value, offset);
      }
    } else {
      Debug.warnOnce(`Value was not set when assigning to uniform [${uniformFormat.name}]` + `, expected type ${uniformTypeToName[uniformFormat.type]}`);
    }
  }

  set(name) {
    const uniformFormat = this.format.map.get(name);
    Debug.assert(uniformFormat, `Uniform name [${name}] is not part of the Uniform buffer.`);
    if (uniformFormat) {
      this.setUniform(uniformFormat);
    }
  }
  update() {
    const uniforms = this.format.uniforms;
    for (let i = 0; i < uniforms.length; i++) {
      this.setUniform(uniforms[i]);
    }

    this.impl.unlock(this);
  }
}

export { UniformBuffer };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5pZm9ybS1idWZmZXIuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9wbGF0Zm9ybS9ncmFwaGljcy91bmlmb3JtLWJ1ZmZlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uLy4uL2NvcmUvZGVidWcuanMnO1xuaW1wb3J0IHtcbiAgICB1bmlmb3JtVHlwZVRvTmFtZSxcbiAgICBVTklGT1JNVFlQRV9JTlQsIFVOSUZPUk1UWVBFX0ZMT0FULCBVTklGT1JNVFlQRV9WRUMyLCBVTklGT1JNVFlQRV9WRUMzLFxuICAgIFVOSUZPUk1UWVBFX1ZFQzQsIFVOSUZPUk1UWVBFX0lWRUMyLCBVTklGT1JNVFlQRV9JVkVDMywgVU5JRk9STVRZUEVfSVZFQzQsXG4gICAgVU5JRk9STVRZUEVfTUFUMiwgVU5JRk9STVRZUEVfTUFUM1xufSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2dyYXBoaWNzLWRldmljZS5qcycpLkdyYXBoaWNzRGV2aWNlfSBHcmFwaGljc0RldmljZSAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vdW5pZm9ybS1idWZmZXItZm9ybWF0LmpzJykuVW5pZm9ybUJ1ZmZlckZvcm1hdH0gVW5pZm9ybUJ1ZmZlckZvcm1hdCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vdW5pZm9ybS1idWZmZXItZm9ybWF0LmpzJykuVW5pZm9ybUZvcm1hdH0gVW5pZm9ybUZvcm1hdCAqL1xuXG4vLyBVbmlmb3JtIGJ1ZmZlciBzZXQgZnVuY3Rpb25zIC0gb25seSBpbXBsZW1lbnRlZCBmb3IgdHlwZXMgZm9yIHdoaWNoIHRoZSBkZWZhdWx0XG4vLyBhcnJheSB0byBidWZmZXIgY29weSBkb2VzIG5vdCB3b3JrLCBvciBjb3VsZCBiZSBzbG93ZXIuXG5jb25zdCBfdXBkYXRlRnVuY3Rpb25zID0gW107XG5cbl91cGRhdGVGdW5jdGlvbnNbVU5JRk9STVRZUEVfRkxPQVRdID0gZnVuY3Rpb24gKHVuaWZvcm1CdWZmZXIsIHZhbHVlLCBvZmZzZXQpIHtcbiAgICBjb25zdCBkc3QgPSB1bmlmb3JtQnVmZmVyLnN0b3JhZ2VGbG9hdDMyO1xuICAgIGRzdFtvZmZzZXRdID0gdmFsdWU7XG59O1xuXG5fdXBkYXRlRnVuY3Rpb25zW1VOSUZPUk1UWVBFX1ZFQzJdID0gKHVuaWZvcm1CdWZmZXIsIHZhbHVlLCBvZmZzZXQpID0+IHtcbiAgICBjb25zdCBkc3QgPSB1bmlmb3JtQnVmZmVyLnN0b3JhZ2VGbG9hdDMyO1xuICAgIGRzdFtvZmZzZXRdID0gdmFsdWVbMF07XG4gICAgZHN0W29mZnNldCArIDFdID0gdmFsdWVbMV07XG59O1xuXG5fdXBkYXRlRnVuY3Rpb25zW1VOSUZPUk1UWVBFX1ZFQzNdID0gKHVuaWZvcm1CdWZmZXIsIHZhbHVlLCBvZmZzZXQpID0+IHtcbiAgICBjb25zdCBkc3QgPSB1bmlmb3JtQnVmZmVyLnN0b3JhZ2VGbG9hdDMyO1xuICAgIGRzdFtvZmZzZXRdID0gdmFsdWVbMF07XG4gICAgZHN0W29mZnNldCArIDFdID0gdmFsdWVbMV07XG4gICAgZHN0W29mZnNldCArIDJdID0gdmFsdWVbMl07XG59O1xuXG5fdXBkYXRlRnVuY3Rpb25zW1VOSUZPUk1UWVBFX1ZFQzRdID0gKHVuaWZvcm1CdWZmZXIsIHZhbHVlLCBvZmZzZXQpID0+IHtcbiAgICBjb25zdCBkc3QgPSB1bmlmb3JtQnVmZmVyLnN0b3JhZ2VGbG9hdDMyO1xuICAgIGRzdFtvZmZzZXRdID0gdmFsdWVbMF07XG4gICAgZHN0W29mZnNldCArIDFdID0gdmFsdWVbMV07XG4gICAgZHN0W29mZnNldCArIDJdID0gdmFsdWVbMl07XG4gICAgZHN0W29mZnNldCArIDNdID0gdmFsdWVbM107XG59O1xuXG5fdXBkYXRlRnVuY3Rpb25zW1VOSUZPUk1UWVBFX0lOVF0gPSBmdW5jdGlvbiAodW5pZm9ybUJ1ZmZlciwgdmFsdWUsIG9mZnNldCkge1xuICAgIGNvbnN0IGRzdCA9IHVuaWZvcm1CdWZmZXIuc3RvcmFnZUludDMyO1xuICAgIGRzdFtvZmZzZXRdID0gdmFsdWU7XG59O1xuXG5fdXBkYXRlRnVuY3Rpb25zW1VOSUZPUk1UWVBFX0lWRUMyXSA9IGZ1bmN0aW9uICh1bmlmb3JtQnVmZmVyLCB2YWx1ZSwgb2Zmc2V0KSB7XG4gICAgY29uc3QgZHN0ID0gdW5pZm9ybUJ1ZmZlci5zdG9yYWdlSW50MzI7XG4gICAgZHN0W29mZnNldF0gPSB2YWx1ZVswXTtcbiAgICBkc3Rbb2Zmc2V0ICsgMV0gPSB2YWx1ZVsxXTtcbn07XG5cbl91cGRhdGVGdW5jdGlvbnNbVU5JRk9STVRZUEVfSVZFQzNdID0gZnVuY3Rpb24gKHVuaWZvcm1CdWZmZXIsIHZhbHVlLCBvZmZzZXQpIHtcbiAgICBjb25zdCBkc3QgPSB1bmlmb3JtQnVmZmVyLnN0b3JhZ2VJbnQzMjtcbiAgICBkc3Rbb2Zmc2V0XSA9IHZhbHVlWzBdO1xuICAgIGRzdFtvZmZzZXQgKyAxXSA9IHZhbHVlWzFdO1xuICAgIGRzdFtvZmZzZXQgKyAyXSA9IHZhbHVlWzJdO1xufTtcblxuX3VwZGF0ZUZ1bmN0aW9uc1tVTklGT1JNVFlQRV9JVkVDNF0gPSBmdW5jdGlvbiAodW5pZm9ybUJ1ZmZlciwgdmFsdWUsIG9mZnNldCkge1xuICAgIGNvbnN0IGRzdCA9IHVuaWZvcm1CdWZmZXIuc3RvcmFnZUludDMyO1xuICAgIGRzdFtvZmZzZXRdID0gdmFsdWVbMF07XG4gICAgZHN0W29mZnNldCArIDFdID0gdmFsdWVbMV07XG4gICAgZHN0W29mZnNldCArIDJdID0gdmFsdWVbMl07XG4gICAgZHN0W29mZnNldCArIDNdID0gdmFsdWVbM107XG59O1xuXG4vLyBjb252ZXJ0IGZyb20gY29udGludW91cyBhcnJheSB0byB2ZWMyWzNdIHdpdGggcGFkZGluZyB0byB2ZWM0WzJdXG5fdXBkYXRlRnVuY3Rpb25zW1VOSUZPUk1UWVBFX01BVDJdID0gKHVuaWZvcm1CdWZmZXIsIHZhbHVlLCBvZmZzZXQpID0+IHtcbiAgICBjb25zdCBkc3QgPSB1bmlmb3JtQnVmZmVyLnN0b3JhZ2VGbG9hdDMyO1xuICAgIGRzdFtvZmZzZXRdID0gdmFsdWVbMF07XG4gICAgZHN0W29mZnNldCArIDFdID0gdmFsdWVbMV07XG5cbiAgICBkc3Rbb2Zmc2V0ICsgNF0gPSB2YWx1ZVsyXTtcbiAgICBkc3Rbb2Zmc2V0ICsgNV0gPSB2YWx1ZVszXTtcblxuICAgIGRzdFtvZmZzZXQgKyA4XSA9IHZhbHVlWzRdO1xuICAgIGRzdFtvZmZzZXQgKyA5XSA9IHZhbHVlWzVdO1xufTtcblxuLy8gY29udmVydCBmcm9tIGNvbnRpbnVvdXMgYXJyYXkgdG8gdmVjM1szXSB3aXRoIHBhZGRpbmcgdG8gdmVjNFszXVxuX3VwZGF0ZUZ1bmN0aW9uc1tVTklGT1JNVFlQRV9NQVQzXSA9ICh1bmlmb3JtQnVmZmVyLCB2YWx1ZSwgb2Zmc2V0KSA9PiB7XG4gICAgY29uc3QgZHN0ID0gdW5pZm9ybUJ1ZmZlci5zdG9yYWdlRmxvYXQzMjtcbiAgICBkc3Rbb2Zmc2V0XSA9IHZhbHVlWzBdO1xuICAgIGRzdFtvZmZzZXQgKyAxXSA9IHZhbHVlWzFdO1xuICAgIGRzdFtvZmZzZXQgKyAyXSA9IHZhbHVlWzJdO1xuXG4gICAgZHN0W29mZnNldCArIDRdID0gdmFsdWVbM107XG4gICAgZHN0W29mZnNldCArIDVdID0gdmFsdWVbNF07XG4gICAgZHN0W29mZnNldCArIDZdID0gdmFsdWVbNV07XG5cbiAgICBkc3Rbb2Zmc2V0ICsgOF0gPSB2YWx1ZVs2XTtcbiAgICBkc3Rbb2Zmc2V0ICsgOV0gPSB2YWx1ZVs3XTtcbiAgICBkc3Rbb2Zmc2V0ICsgMTBdID0gdmFsdWVbOF07XG59O1xuXG4vKipcbiAqIEEgdW5pZm9ybSBidWZmZXIgcmVwcmVzZW50cyBhIEdQVSBtZW1vcnkgYnVmZmVyIHN0b3JpbmcgdGhlIHVuaWZvcm1zLlxuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgVW5pZm9ybUJ1ZmZlciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IFVuaWZvcm1CdWZmZXIgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0dyYXBoaWNzRGV2aWNlfSBncmFwaGljc0RldmljZSAtIFRoZSBncmFwaGljcyBkZXZpY2UgdXNlZCB0byBtYW5hZ2UgdGhpcyB1bmlmb3JtIGJ1ZmZlci5cbiAgICAgKiBAcGFyYW0ge1VuaWZvcm1CdWZmZXJGb3JtYXR9IGZvcm1hdCAtIEZvcm1hdCBvZiB0aGUgdW5pZm9ybSBidWZmZXJcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihncmFwaGljc0RldmljZSwgZm9ybWF0KSB7XG4gICAgICAgIHRoaXMuZGV2aWNlID0gZ3JhcGhpY3NEZXZpY2U7XG4gICAgICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0O1xuICAgICAgICBEZWJ1Zy5hc3NlcnQoZm9ybWF0KTtcblxuICAgICAgICB0aGlzLmltcGwgPSBncmFwaGljc0RldmljZS5jcmVhdGVVbmlmb3JtQnVmZmVySW1wbCh0aGlzKTtcblxuICAgICAgICB0aGlzLnN0b3JhZ2UgPSBuZXcgQXJyYXlCdWZmZXIoZm9ybWF0LmJ5dGVTaXplKTtcbiAgICAgICAgdGhpcy5zdG9yYWdlRmxvYXQzMiA9IG5ldyBGbG9hdDMyQXJyYXkodGhpcy5zdG9yYWdlKTtcbiAgICAgICAgdGhpcy5zdG9yYWdlSW50MzIgPSBuZXcgSW50MzJBcnJheSh0aGlzLnN0b3JhZ2UpO1xuXG4gICAgICAgIGdyYXBoaWNzRGV2aWNlLl92cmFtLnViICs9IHRoaXMuZm9ybWF0LmJ5dGVTaXplO1xuXG4gICAgICAgIC8vIFRPRE86IHJlZ2lzdGVyIHdpdGggdGhlIGRldmljZSBhbmQgaGFuZGxlIGxvc3QgY29udGV4dFxuICAgICAgICAvLyB0aGlzLmRldmljZS5idWZmZXJzLnB1c2godGhpcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRnJlZXMgcmVzb3VyY2VzIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHVuaWZvcm0gYnVmZmVyLlxuICAgICAqL1xuICAgIGRlc3Ryb3koKSB7XG5cbiAgICAgICAgLy8gLy8gc3RvcCB0cmFja2luZyB0aGUgdmVydGV4IGJ1ZmZlclxuICAgICAgICBjb25zdCBkZXZpY2UgPSB0aGlzLmRldmljZTtcblxuICAgICAgICAvLyBUT0RPOiByZW1vdmUgdGhlIGJ1ZmZlciBmcm9tIHRoZSBsaXN0IG9uIHRoZSBkZXZpY2UgKGxvc3QgY29udGV4dCBoYW5kbGluZylcblxuICAgICAgICB0aGlzLmltcGwuZGVzdHJveShkZXZpY2UpO1xuXG4gICAgICAgIGRldmljZS5fdnJhbS51YiAtPSB0aGlzLmZvcm1hdC5ieXRlU2l6ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxsZWQgd2hlbiB0aGUgcmVuZGVyaW5nIGNvbnRleHQgd2FzIGxvc3QuIEl0IHJlbGVhc2VzIGFsbCBjb250ZXh0IHJlbGF0ZWQgcmVzb3VyY2VzLlxuICAgICAqXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGxvc2VDb250ZXh0KCkge1xuICAgICAgICB0aGlzLmltcGwubG9zZUNvbnRleHQoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBc3NpZ24gYSB2YWx1ZSB0byB0aGUgdW5pZm9ybSBzcGVjaWZpZWQgYnkgaXRzIGZvcm1hdC4gVGhpcyBpcyB0aGUgZmFzdCB2ZXJzaW9uIG9mIGFzc2lnbmluZ1xuICAgICAqIGEgdmFsdWUgdG8gYSB1bmlmb3JtLCBhdm9pZGluZyBhbnkgbG9va3Vwcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7VW5pZm9ybUZvcm1hdH0gdW5pZm9ybUZvcm1hdCAtIFRoZSBmb3JtYXQgb2YgdGhlIHVuaWZvcm0uXG4gICAgICovXG4gICAgc2V0VW5pZm9ybSh1bmlmb3JtRm9ybWF0KSB7XG4gICAgICAgIERlYnVnLmFzc2VydCh1bmlmb3JtRm9ybWF0KTtcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gdW5pZm9ybUZvcm1hdC5vZmZzZXQ7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdW5pZm9ybUZvcm1hdC5zY29wZUlkLnZhbHVlO1xuXG4gICAgICAgIGlmICh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVGdW5jdGlvbiA9IF91cGRhdGVGdW5jdGlvbnNbdW5pZm9ybUZvcm1hdC50eXBlXTtcbiAgICAgICAgICAgIGlmICh1cGRhdGVGdW5jdGlvbikge1xuICAgICAgICAgICAgICAgIHVwZGF0ZUZ1bmN0aW9uKHRoaXMsIHZhbHVlLCBvZmZzZXQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3JhZ2VGbG9hdDMyLnNldCh2YWx1ZSwgb2Zmc2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIERlYnVnLndhcm5PbmNlKGBWYWx1ZSB3YXMgbm90IHNldCB3aGVuIGFzc2lnbmluZyB0byB1bmlmb3JtIFske3VuaWZvcm1Gb3JtYXQubmFtZX1dYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYCwgZXhwZWN0ZWQgdHlwZSAke3VuaWZvcm1UeXBlVG9OYW1lW3VuaWZvcm1Gb3JtYXQudHlwZV19YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBc3NpZ24gYSB2YWx1ZSB0byB0aGUgdW5pZm9ybSBzcGVjaWZpZWQgYnkgbmFtZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHVuaWZvcm0uXG4gICAgICovXG4gICAgc2V0KG5hbWUpIHtcbiAgICAgICAgY29uc3QgdW5pZm9ybUZvcm1hdCA9IHRoaXMuZm9ybWF0Lm1hcC5nZXQobmFtZSk7XG4gICAgICAgIERlYnVnLmFzc2VydCh1bmlmb3JtRm9ybWF0LCBgVW5pZm9ybSBuYW1lIFske25hbWV9XSBpcyBub3QgcGFydCBvZiB0aGUgVW5pZm9ybSBidWZmZXIuYCk7XG4gICAgICAgIGlmICh1bmlmb3JtRm9ybWF0KSB7XG4gICAgICAgICAgICB0aGlzLnNldFVuaWZvcm0odW5pZm9ybUZvcm1hdCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB1cGRhdGUoKSB7XG5cbiAgICAgICAgLy8gc2V0IG5ldyB2YWx1ZXNcbiAgICAgICAgY29uc3QgdW5pZm9ybXMgPSB0aGlzLmZvcm1hdC51bmlmb3JtcztcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1bmlmb3Jtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5zZXRVbmlmb3JtKHVuaWZvcm1zW2ldKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwbG9hZCB0aGUgbmV3IGRhdGFcbiAgICAgICAgdGhpcy5pbXBsLnVubG9jayh0aGlzKTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFVuaWZvcm1CdWZmZXIgfTtcbiJdLCJuYW1lcyI6WyJfdXBkYXRlRnVuY3Rpb25zIiwiVU5JRk9STVRZUEVfRkxPQVQiLCJ1bmlmb3JtQnVmZmVyIiwidmFsdWUiLCJvZmZzZXQiLCJkc3QiLCJzdG9yYWdlRmxvYXQzMiIsIlVOSUZPUk1UWVBFX1ZFQzIiLCJVTklGT1JNVFlQRV9WRUMzIiwiVU5JRk9STVRZUEVfVkVDNCIsIlVOSUZPUk1UWVBFX0lOVCIsInN0b3JhZ2VJbnQzMiIsIlVOSUZPUk1UWVBFX0lWRUMyIiwiVU5JRk9STVRZUEVfSVZFQzMiLCJVTklGT1JNVFlQRV9JVkVDNCIsIlVOSUZPUk1UWVBFX01BVDIiLCJVTklGT1JNVFlQRV9NQVQzIiwiVW5pZm9ybUJ1ZmZlciIsImNvbnN0cnVjdG9yIiwiZ3JhcGhpY3NEZXZpY2UiLCJmb3JtYXQiLCJkZXZpY2UiLCJEZWJ1ZyIsImFzc2VydCIsImltcGwiLCJjcmVhdGVVbmlmb3JtQnVmZmVySW1wbCIsInN0b3JhZ2UiLCJBcnJheUJ1ZmZlciIsImJ5dGVTaXplIiwiRmxvYXQzMkFycmF5IiwiSW50MzJBcnJheSIsIl92cmFtIiwidWIiLCJkZXN0cm95IiwibG9zZUNvbnRleHQiLCJzZXRVbmlmb3JtIiwidW5pZm9ybUZvcm1hdCIsInNjb3BlSWQiLCJ1bmRlZmluZWQiLCJ1cGRhdGVGdW5jdGlvbiIsInR5cGUiLCJzZXQiLCJ3YXJuT25jZSIsIm5hbWUiLCJ1bmlmb3JtVHlwZVRvTmFtZSIsIm1hcCIsImdldCIsInVwZGF0ZSIsInVuaWZvcm1zIiwiaSIsImxlbmd0aCIsInVubG9jayJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFjQSxNQUFNQSxnQkFBZ0IsR0FBRyxFQUFFLENBQUE7QUFFM0JBLGdCQUFnQixDQUFDQyxpQkFBaUIsQ0FBQyxHQUFHLFVBQVVDLGFBQWEsRUFBRUMsS0FBSyxFQUFFQyxNQUFNLEVBQUU7QUFDMUUsRUFBQSxNQUFNQyxHQUFHLEdBQUdILGFBQWEsQ0FBQ0ksY0FBYyxDQUFBO0FBQ3hDRCxFQUFBQSxHQUFHLENBQUNELE1BQU0sQ0FBQyxHQUFHRCxLQUFLLENBQUE7QUFDdkIsQ0FBQyxDQUFBO0FBRURILGdCQUFnQixDQUFDTyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUNMLGFBQWEsRUFBRUMsS0FBSyxFQUFFQyxNQUFNLEtBQUs7QUFDbkUsRUFBQSxNQUFNQyxHQUFHLEdBQUdILGFBQWEsQ0FBQ0ksY0FBYyxDQUFBO0FBQ3hDRCxFQUFBQSxHQUFHLENBQUNELE1BQU0sQ0FBQyxHQUFHRCxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7RUFDdEJFLEdBQUcsQ0FBQ0QsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHRCxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDOUIsQ0FBQyxDQUFBO0FBRURILGdCQUFnQixDQUFDUSxnQkFBZ0IsQ0FBQyxHQUFHLENBQUNOLGFBQWEsRUFBRUMsS0FBSyxFQUFFQyxNQUFNLEtBQUs7QUFDbkUsRUFBQSxNQUFNQyxHQUFHLEdBQUdILGFBQWEsQ0FBQ0ksY0FBYyxDQUFBO0FBQ3hDRCxFQUFBQSxHQUFHLENBQUNELE1BQU0sQ0FBQyxHQUFHRCxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7RUFDdEJFLEdBQUcsQ0FBQ0QsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHRCxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7RUFDMUJFLEdBQUcsQ0FBQ0QsTUFBTSxH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
