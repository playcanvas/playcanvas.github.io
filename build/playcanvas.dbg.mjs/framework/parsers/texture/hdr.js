/**
 * @license
 * PlayCanvas Engine v1.62.0 revision 818511d2b (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../../../core/debug.js';
import { ReadStream } from '../../../core/read-stream.js';
import { TEXHINT_ASSET, ADDRESS_REPEAT, ADDRESS_CLAMP_TO_EDGE, FILTER_NEAREST, PIXELFORMAT_RGBA8, TEXTURETYPE_RGBE } from '../../../platform/graphics/constants.js';
import { Texture } from '../../../platform/graphics/texture.js';
import { Asset } from '../../asset/asset.js';

/** @typedef {import('../../handlers/texture.js').TextureParser} TextureParser */

/**
 * Texture parser for hdr files.
 *
 * @implements {TextureParser}
 * @ignore
 */
class HdrParser {
  constructor(registry) {
    this.maxRetries = 0;
  }
  load(url, callback, asset) {
    Asset.fetchArrayBuffer(url.load, callback, asset, this.maxRetries);
  }
  open(url, data, device) {
    const textureData = this.parse(data);
    if (!textureData) {
      return null;
    }
    const texture = new Texture(device, {
      name: url,
      profilerHint: TEXHINT_ASSET,
      addressU: ADDRESS_REPEAT,
      addressV: ADDRESS_CLAMP_TO_EDGE,
      minFilter: FILTER_NEAREST,
      magFilter: FILTER_NEAREST,
      width: textureData.width,
      height: textureData.height,
      levels: textureData.levels,
      format: PIXELFORMAT_RGBA8,
      type: TEXTURETYPE_RGBE,
      // RGBE can't be filtered, so mipmaps are out of the question! (unless we generated them ourselves)
      mipmaps: false
    });
    texture.upload();
    return texture;
  }

  // https://floyd.lbl.gov/radiance/refer/filefmts.pdf with help from http://www.graphics.cornell.edu/~bjw/rgbe/rgbe.c
  parse(data) {
    const readStream = new ReadStream(data);

    // require magic
    const magic = readStream.readLine();
    if (!magic.startsWith('#?RADIANCE')) {
      Debug.error('radiance header has invalid magic');
      return null;
    }

    // read header variables
    const variables = {};
    while (true) {
      const line = readStream.readLine();
      if (line.length === 0) {
        // empty line signals end of header
        break;
      } else {
        const parts = line.split('=');
        if (parts.length === 2) {
          variables[parts[0]] = parts[1];
        }
      }
    }

    // we require FORMAT variable
    if (!variables.hasOwnProperty('FORMAT')) {
      Debug.error('radiance header missing FORMAT variable');
      return null;
    }

    // read the resolution specifier
    const resolution = readStream.readLine().split(' ');
    if (resolution.length !== 4) {
      Debug.error('radiance header has invalid resolution');
      return null;
    }
    const height = parseInt(resolution[1], 10);
    const width = parseInt(resolution[3], 10);
    const pixels = this._readPixels(readStream, width, height, resolution[0] === '-Y');
    if (!pixels) {
      return null;
    }

    // create texture
    return {
      width: width,
      height: height,
      levels: [pixels]
    };
  }
  _readPixels(readStream, width, height, flipY) {
    // out of bounds
    if (width < 8 || width > 0x7fff) {
      return this._readPixelsFlat(readStream, width, height);
    }
    const rgbe = [0, 0, 0, 0];

    // check first scanline width to determine whether the file is RLE
    readStream.readArray(rgbe);
    if (rgbe[0] !== 2 || rgbe[1] !== 2 || (rgbe[2] & 0x80) !== 0) {
      // not RLE
      readStream.skip(-4);
      return this._readPixelsFlat(readStream, width, height);
    }

    // allocate texture buffer
    const buffer = new ArrayBuffer(width * height * 4);
    const view = new Uint8Array(buffer);
    let scanstart = flipY ? 0 : width * 4 * (height - 1);
    let x, y, i, channel, count, value;
    for (y = 0; y < height; ++y) {
      // read scanline width specifier
      if (y) {
        readStream.readArray(rgbe);
      }

      // sanity check it
      if ((rgbe[2] << 8) + rgbe[3] !== width) {
        Debug.error('radiance has invalid scanline width');
        return null;
      }

      // each scanline is stored by channel
      for (channel = 0; channel < 4; ++channel) {
        x = 0;
        while (x < width) {
          count = readStream.readU8();
          if (count > 128) {
            // run of the same value
            count -= 128;
            if (x + count > width) {
              Debug.error('radiance has invalid scanline data');
              return null;
            }
            value = readStream.readU8();
            for (i = 0; i < count; ++i) {
              view[scanstart + channel + 4 * x++] = value;
            }
          } else {
            // non-run
            if (count === 0 || x + count > width) {
              Debug.error('radiance has invalid scanline data');
              return null;
            }
            for (i = 0; i < count; ++i) {
              view[scanstart + channel + 4 * x++] = readStream.readU8();
            }
          }
        }
      }
      scanstart += width * 4 * (flipY ? 1 : -1);
    }
    return view;
  }
  _readPixelsFlat(readStream, width, height) {
    return readStream.remainingBytes === width * height * 4 ? new Uint8Array(readStream.arraybuffer, readStream.offset) : null;
  }
}

export { HdrParser };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGRyLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL3BhcnNlcnMvdGV4dHVyZS9oZHIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcgfSBmcm9tICcuLi8uLi8uLi9jb3JlL2RlYnVnLmpzJztcbmltcG9ydCB7IFJlYWRTdHJlYW0gfSBmcm9tICcuLi8uLi8uLi9jb3JlL3JlYWQtc3RyZWFtLmpzJztcblxuaW1wb3J0IHtcbiAgICBURVhISU5UX0FTU0VULFxuICAgIEFERFJFU1NfUkVQRUFULCBBRERSRVNTX0NMQU1QX1RPX0VER0UsXG4gICAgRklMVEVSX05FQVJFU1QsXG4gICAgUElYRUxGT1JNQVRfUkdCQTgsXG4gICAgVEVYVFVSRVRZUEVfUkdCRVxufSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgVGV4dHVyZSB9IGZyb20gJy4uLy4uLy4uL3BsYXRmb3JtL2dyYXBoaWNzL3RleHR1cmUuanMnO1xuXG5pbXBvcnQgeyBBc3NldCB9IGZyb20gJy4uLy4uL2Fzc2V0L2Fzc2V0LmpzJztcblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uLy4uL2hhbmRsZXJzL3RleHR1cmUuanMnKS5UZXh0dXJlUGFyc2VyfSBUZXh0dXJlUGFyc2VyICovXG5cbi8qKlxuICogVGV4dHVyZSBwYXJzZXIgZm9yIGhkciBmaWxlcy5cbiAqXG4gKiBAaW1wbGVtZW50cyB7VGV4dHVyZVBhcnNlcn1cbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgSGRyUGFyc2VyIHtcbiAgICBjb25zdHJ1Y3RvcihyZWdpc3RyeSkge1xuICAgICAgICB0aGlzLm1heFJldHJpZXMgPSAwO1xuICAgIH1cblxuICAgIGxvYWQodXJsLCBjYWxsYmFjaywgYXNzZXQpIHtcbiAgICAgICAgQXNzZXQuZmV0Y2hBcnJheUJ1ZmZlcih1cmwubG9hZCwgY2FsbGJhY2ssIGFzc2V0LCB0aGlzLm1heFJldHJpZXMpO1xuICAgIH1cblxuICAgIG9wZW4odXJsLCBkYXRhLCBkZXZpY2UpIHtcbiAgICAgICAgY29uc3QgdGV4dHVyZURhdGEgPSB0aGlzLnBhcnNlKGRhdGEpO1xuXG4gICAgICAgIGlmICghdGV4dHVyZURhdGEpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdGV4dHVyZSA9IG5ldyBUZXh0dXJlKGRldmljZSwge1xuICAgICAgICAgICAgbmFtZTogdXJsLFxuICAgICAgICAgICAgLy8gI2lmIF9QUk9GSUxFUlxuICAgICAgICAgICAgcHJvZmlsZXJIaW50OiBURVhISU5UX0FTU0VULFxuICAgICAgICAgICAgLy8gI2VuZGlmXG4gICAgICAgICAgICBhZGRyZXNzVTogQUREUkVTU19SRVBFQVQsXG4gICAgICAgICAgICBhZGRyZXNzVjogQUREUkVTU19DTEFNUF9UT19FREdFLFxuICAgICAgICAgICAgbWluRmlsdGVyOiBGSUxURVJfTkVBUkVTVCxcbiAgICAgICAgICAgIG1hZ0ZpbHRlcjogRklMVEVSX05FQVJFU1QsXG4gICAgICAgICAgICB3aWR0aDogdGV4dHVyZURhdGEud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IHRleHR1cmVEYXRhLmhlaWdodCxcbiAgICAgICAgICAgIGxldmVsczogdGV4dHVyZURhdGEubGV2ZWxzLFxuICAgICAgICAgICAgZm9ybWF0OiBQSVhFTEZPUk1BVF9SR0JBOCxcbiAgICAgICAgICAgIHR5cGU6IFRFWFRVUkVUWVBFX1JHQkUsXG4gICAgICAgICAgICAvLyBSR0JFIGNhbid0IGJlIGZpbHRlcmVkLCBzbyBtaXBtYXBzIGFyZSBvdXQgb2YgdGhlIHF1ZXN0aW9uISAodW5sZXNzIHdlIGdlbmVyYXRlZCB0aGVtIG91cnNlbHZlcylcbiAgICAgICAgICAgIG1pcG1hcHM6IGZhbHNlXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRleHR1cmUudXBsb2FkKCk7XG5cbiAgICAgICAgcmV0dXJuIHRleHR1cmU7XG4gICAgfVxuXG4gICAgLy8gaHR0cHM6Ly9mbG95ZC5sYmwuZ292L3JhZGlhbmNlL3JlZmVyL2ZpbGVmbXRzLnBkZiB3aXRoIGhlbHAgZnJvbSBodHRwOi8vd3d3LmdyYXBoaWNzLmNvcm5lbGwuZWR1L35iancvcmdiZS9yZ2JlLmNcbiAgICBwYXJzZShkYXRhKSB7XG4gICAgICAgIGNvbnN0IHJlYWRTdHJlYW0gPSBuZXcgUmVhZFN0cmVhbShkYXRhKTtcblxuICAgICAgICAvLyByZXF1aXJlIG1hZ2ljXG4gICAgICAgIGNvbnN0IG1hZ2ljID0gcmVhZFN0cmVhbS5yZWFkTGluZSgpO1xuICAgICAgICBpZiAoIW1hZ2ljLnN0YXJ0c1dpdGgoJyM/UkFESUFOQ0UnKSkge1xuICAgICAgICAgICAgRGVidWcuZXJyb3IoJ3JhZGlhbmNlIGhlYWRlciBoYXMgaW52YWxpZCBtYWdpYycpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICAvLyByZWFkIGhlYWRlciB2YXJpYWJsZXNcbiAgICAgICAgY29uc3QgdmFyaWFibGVzID0geyB9O1xuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgY29uc3QgbGluZSA9IHJlYWRTdHJlYW0ucmVhZExpbmUoKTtcbiAgICAgICAgICAgIGlmIChsaW5lLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIC8vIGVtcHR5IGxpbmUgc2lnbmFscyBlbmQgb2YgaGVhZGVyXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gbGluZS5zcGxpdCgnPScpO1xuICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyaWFibGVzW3BhcnRzWzBdXSA9IHBhcnRzWzFdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHdlIHJlcXVpcmUgRk9STUFUIHZhcmlhYmxlXG4gICAgICAgIGlmICghdmFyaWFibGVzLmhhc093blByb3BlcnR5KCdGT1JNQVQnKSkge1xuICAgICAgICAgICAgRGVidWcuZXJyb3IoJ3JhZGlhbmNlIGhlYWRlciBtaXNzaW5nIEZPUk1BVCB2YXJpYWJsZScpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICAvLyByZWFkIHRoZSByZXNvbHV0aW9uIHNwZWNpZmllclxuICAgICAgICBjb25zdCByZXNvbHV0aW9uID0gcmVhZFN0cmVhbS5yZWFkTGluZSgpLnNwbGl0KCcgJyk7XG4gICAgICAgIGlmIChyZXNvbHV0aW9uLmxlbmd0aCAhPT0gNCkge1xuICAgICAgICAgICAgRGVidWcuZXJyb3IoJ3JhZGlhbmNlIGhlYWRlciBoYXMgaW52YWxpZCByZXNvbHV0aW9uJyk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGhlaWdodCA9IHBhcnNlSW50KHJlc29sdXRpb25bMV0sIDEwKTtcbiAgICAgICAgY29uc3Qgd2lkdGggPSBwYXJzZUludChyZXNvbHV0aW9uWzNdLCAxMCk7XG4gICAgICAgIGNvbnN0IHBpeGVscyA9IHRoaXMuX3JlYWRQaXhlbHMocmVhZFN0cmVhbSwgd2lkdGgsIGhlaWdodCwgcmVzb2x1dGlvblswXSA9PT0gJy1ZJyk7XG5cbiAgICAgICAgaWYgKCFwaXhlbHMpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY3JlYXRlIHRleHR1cmVcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICAgICAgbGV2ZWxzOiBbcGl4ZWxzXVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIF9yZWFkUGl4ZWxzKHJlYWRTdHJlYW0sIHdpZHRoLCBoZWlnaHQsIGZsaXBZKSB7XG4gICAgICAgIC8vIG91dCBvZiBib3VuZHNcbiAgICAgICAgaWYgKHdpZHRoIDwgOCB8fCB3aWR0aCA+IDB4N2ZmZikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlYWRQaXhlbHNGbGF0KHJlYWRTdHJlYW0sIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmdiZSA9IFswLCAwLCAwLCAwXTtcblxuICAgICAgICAvLyBjaGVjayBmaXJzdCBzY2FubGluZSB3aWR0aCB0byBkZXRlcm1pbmUgd2hldGhlciB0aGUgZmlsZSBpcyBSTEVcbiAgICAgICAgcmVhZFN0cmVhbS5yZWFkQXJyYXkocmdiZSk7XG4gICAgICAgIGlmICgocmdiZVswXSAhPT0gMiB8fCByZ2JlWzFdICE9PSAyIHx8IChyZ2JlWzJdICYgMHg4MCkgIT09IDApKSB7XG4gICAgICAgICAgICAvLyBub3QgUkxFXG4gICAgICAgICAgICByZWFkU3RyZWFtLnNraXAoLTQpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlYWRQaXhlbHNGbGF0KHJlYWRTdHJlYW0sIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYWxsb2NhdGUgdGV4dHVyZSBidWZmZXJcbiAgICAgICAgY29uc3QgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKHdpZHRoICogaGVpZ2h0ICogNCk7XG4gICAgICAgIGNvbnN0IHZpZXcgPSBuZXcgVWludDhBcnJheShidWZmZXIpO1xuICAgICAgICBsZXQgc2NhbnN0YXJ0ID0gZmxpcFkgPyAwIDogd2lkdGggKiA0ICogKGhlaWdodCAtIDEpO1xuICAgICAgICBsZXQgeCwgeSwgaSwgY2hhbm5lbCwgY291bnQsIHZhbHVlO1xuXG4gICAgICAgIGZvciAoeSA9IDA7IHkgPCBoZWlnaHQ7ICsreSkge1xuICAgICAgICAgICAgLy8gcmVhZCBzY2FubGluZSB3aWR0aCBzcGVjaWZpZXJcbiAgICAgICAgICAgIGlmICh5KSB7XG4gICAgICAgICAgICAgICAgcmVhZFN0cmVhbS5yZWFkQXJyYXkocmdiZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHNhbml0eSBjaGVjayBpdFxuICAgICAgICAgICAgaWYgKChyZ2JlWzJdIDw8IDgpICsgcmdiZVszXSAhPT0gd2lkdGgpIHtcbiAgICAgICAgICAgICAgICBEZWJ1Zy5lcnJvcigncmFkaWFuY2UgaGFzIGludmFsaWQgc2NhbmxpbmUgd2lkdGgnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gZWFjaCBzY2FubGluZSBpcyBzdG9yZWQgYnkgY2hhbm5lbFxuICAgICAgICAgICAgZm9yIChjaGFubmVsID0gMDsgY2hhbm5lbCA8IDQ7ICsrY2hhbm5lbCkge1xuICAgICAgICAgICAgICAgIHggPSAwO1xuICAgICAgICAgICAgICAgIHdoaWxlICh4IDwgd2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY291bnQgPSByZWFkU3RyZWFtLnJlYWRVOCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY291bnQgPiAxMjgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJ1biBvZiB0aGUgc2FtZSB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnQgLT0gMTI4O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHggKyBjb3VudCA+IHdpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVidWcuZXJyb3IoJ3JhZGlhbmNlIGhhcyBpbnZhbGlkIHNjYW5saW5lIGRhdGEnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcmVhZFN0cmVhbS5yZWFkVTgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld1tzY2Fuc3RhcnQgKyBjaGFubmVsICsgNCAqIHgrK10gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vbi1ydW5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCA9PT0gMCB8fCB4ICsgY291bnQgPiB3aWR0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnLmVycm9yKCdyYWRpYW5jZSBoYXMgaW52YWxpZCBzY2FubGluZSBkYXRhJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdbc2NhbnN0YXJ0ICsgY2hhbm5lbCArIDQgKiB4KytdID0gcmVhZFN0cmVhbS5yZWFkVTgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2NhbnN0YXJ0ICs9IHdpZHRoICogNCAqIChmbGlwWSA/IDEgOiAtMSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdmlldztcbiAgICB9XG5cbiAgICBfcmVhZFBpeGVsc0ZsYXQocmVhZFN0cmVhbSwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICByZXR1cm4gcmVhZFN0cmVhbS5yZW1haW5pbmdCeXRlcyA9PT0gd2lkdGggKiBoZWlnaHQgKiA0ID8gbmV3IFVpbnQ4QXJyYXkocmVhZFN0cmVhbS5hcnJheWJ1ZmZlciwgcmVhZFN0cmVhbS5vZmZzZXQpIDogbnVsbDtcbiAgICB9XG59XG5cbmV4cG9ydCB7IEhkclBhcnNlciB9O1xuIl0sIm5hbWVzIjpbIkhkclBhcnNlciIsImNvbnN0cnVjdG9yIiwicmVnaXN0cnkiLCJtYXhSZXRyaWVzIiwibG9hZCIsInVybCIsImNhbGxiYWNrIiwiYXNzZXQiLCJBc3NldCIsImZldGNoQXJyYXlCdWZmZXIiLCJvcGVuIiwiZGF0YSIsImRldmljZSIsInRleHR1cmVEYXRhIiwicGFyc2UiLCJ0ZXh0dXJlIiwiVGV4dHVyZSIsIm5hbWUiLCJwcm9maWxlckhpbnQiLCJURVhISU5UX0FTU0VUIiwiYWRkcmVzc1UiLCJBRERSRVNTX1JFUEVBVCIsImFkZHJlc3NWIiwiQUREUkVTU19DTEFNUF9UT19FREdFIiwibWluRmlsdGVyIiwiRklMVEVSX05FQVJFU1QiLCJtYWdGaWx0ZXIiLCJ3aWR0aCIsImhlaWdodCIsImxldmVscyIsImZvcm1hdCIsIlBJWEVMRk9STUFUX1JHQkE4IiwidHlwZSIsIlRFWFRVUkVUWVBFX1JHQkUiLCJtaXBtYXBzIiwidXBsb2FkIiwicmVhZFN0cmVhbSIsIlJlYWRTdHJlYW0iLCJtYWdpYyIsInJlYWRMaW5lIiwic3RhcnRzV2l0aCIsIkRlYnVnIiwiZXJyb3IiLCJ2YXJpYWJsZXMiLCJsaW5lIiwibGVuZ3RoIiwicGFydHMiLCJzcGxpdCIsImhhc093blByb3BlcnR5IiwicmVzb2x1dGlvbiIsInBhcnNlSW50IiwicGl4ZWxzIiwiX3JlYWRQaXhlbHMiLCJmbGlwWSIsIl9yZWFkUGl4ZWxzRmxhdCIsInJnYmUiLCJyZWFkQXJyYXkiLCJza2lwIiwiYnVmZmVyIiwiQXJyYXlCdWZmZXIiLCJ2aWV3IiwiVWludDhBcnJheSIsInNjYW5zdGFydCIsIngiLCJ5IiwiaSIsImNoYW5uZWwiLCJjb3VudCIsInZhbHVlIiwicmVhZFU4IiwicmVtYWluaW5nQnl0ZXMiLCJhcnJheWJ1ZmZlciIsIm9mZnNldCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFjQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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
