/**
 * @license
 * PlayCanvas Engine v1.58.0-preview revision 1fec26519 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Color } from '../../../core/math/color.js';
import { PIXELFORMAT_R8_G8_B8_A8, CULLFACE_NONE } from '../../../platform/graphics/constants.js';
import { Texture } from '../../../platform/graphics/texture.js';
import { BLEND_PREMULTIPLIED, SPRITE_RENDERMODE_SLICED, SPRITE_RENDERMODE_TILED } from '../../../scene/constants.js';
import { StandardMaterial } from '../../../scene/materials/standard-material.js';
import { Component } from '../component.js';
import { ComponentSystem } from '../system.js';
import { SpriteComponent } from './component.js';
import { SpriteComponentData } from './data.js';

const _schema = ['enabled'];

class SpriteComponentSystem extends ComponentSystem {
  constructor(app) {
    super(app);
    this.id = 'sprite';
    this.ComponentType = SpriteComponent;
    this.DataType = SpriteComponentData;
    this.schema = _schema;

    this._defaultTexture = null;

    this._defaultMaterial = null;

    this._default9SlicedMaterialSlicedMode = null;

    this._default9SlicedMaterialTiledMode = null;
    this.app.systems.on('update', this.onUpdate, this);
    this.on('beforeremove', this.onBeforeRemove, this);
  }
  set defaultMaterial(material) {
    this._defaultMaterial = material;
  }
  get defaultMaterial() {
    if (!this._defaultMaterial) {
      const texture = new Texture(this.app.graphicsDevice, {
        width: 1,
        height: 1,
        format: PIXELFORMAT_R8_G8_B8_A8,
        name: 'sprite'
      });
      const pixels = new Uint8Array(texture.lock());
      pixels[0] = pixels[1] = pixels[2] = pixels[3] = 255;
      texture.unlock();
      const material = new StandardMaterial();
      material.diffuse.set(0, 0, 0);
      material.emissive.set(0.5, 0.5, 0.5);
      material.emissiveMap = texture;
      material.emissiveTint = true;
      material.opacityMap = texture;
      material.opacityMapChannel = 'a';
      material.opacityTint = true;
      material.opacity = 0;
      material.useLighting = false;
      material.useGammaTonemap = false;
      material.useFog = false;
      material.useSkybox = false;
      material.blendType = BLEND_PREMULTIPLIED;
      material.depthWrite = false;
      material.pixelSnap = false;
      material.cull = CULLFACE_NONE;
      material.update();
      this._defaultTexture = texture;
      this._defaultMaterial = material;
    }
    return this._defaultMaterial;
  }
  set default9SlicedMaterialSlicedMode(material) {
    this._default9SlicedMaterialSlicedMode = material;
  }
  get default9SlicedMaterialSlicedMode() {
    if (!this._default9SlicedMaterialSlicedMode) {
      const material = this.defaultMaterial.clone();
      material.nineSlicedMode = SPRITE_RENDERMODE_SLICED;
      material.update();
      this._default9SlicedMaterialSlicedMode = material;
    }
    return this._default9SlicedMaterialSlicedMode;
  }
  set default9SlicedMaterialTiledMode(material) {
    this._default9SlicedMaterialTiledMode = material;
  }
  get default9SlicedMaterialTiledMode() {
    if (!this._default9SlicedMaterialTiledMode) {
      const material = this.defaultMaterial.clone();
      material.nineSlicedMode = SPRITE_RENDERMODE_TILED;
      material.update();
      this._default9SlicedMaterialTiledMode = material;
    }
    return this._default9SlicedMaterialTiledMode;
  }
  destroy() {
    super.destroy();
    this.app.systems.off('update', this.onUpdate, this);
    if (this._defaultTexture) {
      this._defaultTexture.destroy();
      this._defaultTexture = null;
    }
  }
  initializeComponentData(component, data, properties) {
    if (data.enabled !== undefined) {
      component.enabled = data.enabled;
    }
    component.type = data.type;
    if (data.layers && Array.isArray(data.layers)) {
      component.layers = data.layers.slice(0);
    }
    if (data.drawOrder !== undefined) {
      component.drawOrder = data.drawOrder;
    }
    if (data.color !== undefined) {
      if (data.color instanceof Color) {
        component.color.set(data.color.r, data.color.g, data.color.b, data.opacity !== undefined ? data.opacity : 1);
      } else {
        component.color.set(data.color[0], data.color[1], data.color[2], data.opacity !== undefined ? data.opacity : 1);
      }

      component.color = component.color;
    }

    if (data.opacity !== undefined) {
      component.opacity = data.opacity;
    }
    if (data.flipX !== undefined) {
      component.flipX = data.flipX;
    }
    if (data.flipY !== undefined) {
      component.flipY = data.flipY;
    }
    if (data.width !== undefined) {
      component.width = data.width;
    }
    if (data.height !== undefined) {
      component.height = data.height;
    }
    if (data.spriteAsset !== undefined) {
      component.spriteAsset = data.spriteAsset;
    }
    if (data.sprite) {
      component.sprite = data.sprite;
    }
    if (data.frame !== undefined) {
      component.frame = data.frame;
    }
    if (data.clips) {
      for (const name in data.clips) {
        component.addClip(data.clips[name]);
      }
    }
    if (data.speed !== undefined) {
      component.speed = data.speed;
    }
    if (data.autoPlayClip) {
      component.autoPlayClip = data.autoPlayClip;
    }
    component.batchGroupId = data.batchGroupId === undefined || data.batchGroupId === null ? -1 : data.batchGroupId;
    super.initializeComponentData(component, data, properties);
  }
  cloneComponent(entity, clone) {
    const source = entity.sprite;
    return this.addComponent(clone, {
      enabled: source.enabled,
      type: source.type,
      spriteAsset: source.spriteAsset,
      sprite: source.sprite,
      frame: source.frame,
      color: source.color.clone(),
      opacity: source.opacity,
      flipX: source.flipX,
      flipY: source.flipY,
      speed: source.speed,
      clips: source.clips,
      autoPlayClip: source.autoPlayClip,
      batchGroupId: source.batchGroupId,
      drawOrder: source.drawOrder,
      layers: source.layers.slice(0)
    });
  }
  onUpdate(dt) {
    const components = this.store;
    for (const id in components) {
      if (components.hasOwnProperty(id)) {
        const component = components[id];
        if (component.data.enabled && component.entity.enabled) {
          const sprite = component.entity.sprite;
          if (sprite._currentClip) {
            sprite._currentClip._update(dt);
          }
        }
      }
    }
  }
  onBeforeRemove(entity, component) {
    component.onDestroy();
  }
}
Component._buildAccessors(SpriteComponent.prototype, _schema);

export { SpriteComponentSystem };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3lzdGVtLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2NvbXBvbmVudHMvc3ByaXRlL3N5c3RlbS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb2xvciB9IGZyb20gJy4uLy4uLy4uL2NvcmUvbWF0aC9jb2xvci5qcyc7XG5cbmltcG9ydCB7XG4gICAgQ1VMTEZBQ0VfTk9ORSxcbiAgICBQSVhFTEZPUk1BVF9SOF9HOF9COF9BOFxufSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgVGV4dHVyZSB9IGZyb20gJy4uLy4uLy4uL3BsYXRmb3JtL2dyYXBoaWNzL3RleHR1cmUuanMnO1xuXG5pbXBvcnQgeyBCTEVORF9QUkVNVUxUSVBMSUVELCBTUFJJVEVfUkVOREVSTU9ERV9TTElDRUQsIFNQUklURV9SRU5ERVJNT0RFX1RJTEVEIH0gZnJvbSAnLi4vLi4vLi4vc2NlbmUvY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IFN0YW5kYXJkTWF0ZXJpYWwgfSBmcm9tICcuLi8uLi8uLi9zY2VuZS9tYXRlcmlhbHMvc3RhbmRhcmQtbWF0ZXJpYWwuanMnO1xuXG5pbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnQuanMnO1xuaW1wb3J0IHsgQ29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi4vc3lzdGVtLmpzJztcblxuaW1wb3J0IHsgU3ByaXRlQ29tcG9uZW50IH0gZnJvbSAnLi9jb21wb25lbnQuanMnO1xuaW1wb3J0IHsgU3ByaXRlQ29tcG9uZW50RGF0YSB9IGZyb20gJy4vZGF0YS5qcyc7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuLi8uLi9hcHAtYmFzZS5qcycpLkFwcEJhc2V9IEFwcEJhc2UgKi9cblxuY29uc3QgX3NjaGVtYSA9IFsnZW5hYmxlZCddO1xuXG4vKipcbiAqIE1hbmFnZXMgY3JlYXRpb24gb2Yge0BsaW5rIFNwcml0ZUNvbXBvbmVudH1zLlxuICpcbiAqIEBhdWdtZW50cyBDb21wb25lbnRTeXN0ZW1cbiAqL1xuY2xhc3MgU3ByaXRlQ29tcG9uZW50U3lzdGVtIGV4dGVuZHMgQ29tcG9uZW50U3lzdGVtIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgU3ByaXRlQ29tcG9uZW50U3lzdGVtIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtBcHBCYXNlfSBhcHAgLSBUaGUgYXBwbGljYXRpb24uXG4gICAgICogQGhpZGVjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFwcCkge1xuICAgICAgICBzdXBlcihhcHApO1xuXG4gICAgICAgIHRoaXMuaWQgPSAnc3ByaXRlJztcblxuICAgICAgICB0aGlzLkNvbXBvbmVudFR5cGUgPSBTcHJpdGVDb21wb25lbnQ7XG4gICAgICAgIHRoaXMuRGF0YVR5cGUgPSBTcHJpdGVDb21wb25lbnREYXRhO1xuXG4gICAgICAgIHRoaXMuc2NoZW1hID0gX3NjaGVtYTtcblxuICAgICAgICAvLyBkZWZhdWx0IHRleHR1cmUgLSBtYWtlIHdoaXRlIHNvIHdlIGNhbiB0aW50IGl0IHdpdGggZW1pc3NpdmUgY29sb3JcbiAgICAgICAgdGhpcy5fZGVmYXVsdFRleHR1cmUgPSBudWxsO1xuXG4gICAgICAgIC8vIGRlZmF1bHQgbWF0ZXJpYWwgdXNlZCBieSBzcHJpdGVzXG4gICAgICAgIHRoaXMuX2RlZmF1bHRNYXRlcmlhbCA9IG51bGw7XG5cbiAgICAgICAgLy8gbWF0ZXJpYWwgdXNlZCBmb3IgOS1zbGljaW5nIGluIHNsaWNlZCBtb2RlXG4gICAgICAgIHRoaXMuX2RlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxTbGljZWRNb2RlID0gbnVsbDtcblxuICAgICAgICAvLyBtYXRlcmlhbCB1c2VkIGZvciA5LXNsaWNpbmcgaW4gdGlsZWQgbW9kZVxuICAgICAgICB0aGlzLl9kZWZhdWx0OVNsaWNlZE1hdGVyaWFsVGlsZWRNb2RlID0gbnVsbDtcblxuICAgICAgICB0aGlzLmFwcC5zeXN0ZW1zLm9uKCd1cGRhdGUnLCB0aGlzLm9uVXBkYXRlLCB0aGlzKTtcbiAgICAgICAgdGhpcy5vbignYmVmb3JlcmVtb3ZlJywgdGhpcy5vbkJlZm9yZVJlbW92ZSwgdGhpcyk7XG4gICAgfVxuXG4gICAgc2V0IGRlZmF1bHRNYXRlcmlhbChtYXRlcmlhbCkge1xuICAgICAgICB0aGlzLl9kZWZhdWx0TWF0ZXJpYWwgPSBtYXRlcmlhbDtcbiAgICB9XG5cbiAgICBnZXQgZGVmYXVsdE1hdGVyaWFsKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2RlZmF1bHRNYXRlcmlhbCkge1xuICAgICAgICAgICAgY29uc3QgdGV4dHVyZSA9IG5ldyBUZXh0dXJlKHRoaXMuYXBwLmdyYXBoaWNzRGV2aWNlLCB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IDEsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAxLFxuICAgICAgICAgICAgICAgIGZvcm1hdDogUElYRUxGT1JNQVRfUjhfRzhfQjhfQTgsXG4gICAgICAgICAgICAgICAgbmFtZTogJ3Nwcml0ZSdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgcGl4ZWxzID0gbmV3IFVpbnQ4QXJyYXkodGV4dHVyZS5sb2NrKCkpO1xuICAgICAgICAgICAgcGl4ZWxzWzBdID0gcGl4ZWxzWzFdID0gcGl4ZWxzWzJdID0gcGl4ZWxzWzNdID0gMjU1O1xuICAgICAgICAgICAgdGV4dHVyZS51bmxvY2soKTtcblxuICAgICAgICAgICAgY29uc3QgbWF0ZXJpYWwgPSBuZXcgU3RhbmRhcmRNYXRlcmlhbCgpO1xuICAgICAgICAgICAgbWF0ZXJpYWwuZGlmZnVzZS5zZXQoMCwgMCwgMCk7IC8vIGJsYWNrIGRpZmZ1c2UgY29sb3IgdG8gcHJldmVudCBhbWJpZW50IGxpZ2h0IGJlaW5nIGluY2x1ZGVkXG4gICAgICAgICAgICBtYXRlcmlhbC5lbWlzc2l2ZS5zZXQoMC41LCAwLjUsIDAuNSk7IC8vIHVzZSBub24td2hpdGUgdG8gY29tcGlsZSBzaGFkZXIgY29ycmVjdGx5XG4gICAgICAgICAgICBtYXRlcmlhbC5lbWlzc2l2ZU1hcCA9IHRleHR1cmU7XG4gICAgICAgICAgICBtYXRlcmlhbC5lbWlzc2l2ZVRpbnQgPSB0cnVlO1xuICAgICAgICAgICAgbWF0ZXJpYWwub3BhY2l0eU1hcCA9IHRleHR1cmU7XG4gICAgICAgICAgICBtYXRlcmlhbC5vcGFjaXR5TWFwQ2hhbm5lbCA9ICdhJztcbiAgICAgICAgICAgIG1hdGVyaWFsLm9wYWNpdHlUaW50ID0gdHJ1ZTtcbiAgICAgICAgICAgIG1hdGVyaWFsLm9wYWNpdHkgPSAwOyAvLyB1c2Ugbm9uLTEgb3BhY2l0eSB0byBjb21waWxlIHNoYWRlciBjb3JyZWN0bHlcbiAgICAgICAgICAgIG1hdGVyaWFsLnVzZUxpZ2h0aW5nID0gZmFsc2U7XG4gICAgICAgICAgICBtYXRlcmlhbC51c2VHYW1tYVRvbmVtYXAgPSBmYWxzZTtcbiAgICAgICAgICAgIG1hdGVyaWFsLnVzZUZvZyA9IGZhbHNlO1xuICAgICAgICAgICAgbWF0ZXJpYWwudXNlU2t5Ym94ID0gZmFsc2U7XG4gICAgICAgICAgICBtYXRlcmlhbC5ibGVuZFR5cGUgPSBCTEVORF9QUkVNVUxUSVBMSUVEO1xuICAgICAgICAgICAgbWF0ZXJpYWwuZGVwdGhXcml0ZSA9IGZhbHNlO1xuICAgICAgICAgICAgbWF0ZXJpYWwucGl4ZWxTbmFwID0gZmFsc2U7XG4gICAgICAgICAgICBtYXRlcmlhbC5jdWxsID0gQ1VMTEZBQ0VfTk9ORTsgLy8gZG9uJ3QgY3VsbCBiZWNhdXNlIHdlIG1pZ2h0IGZsaXBYIG9yIGZsaXBZIHdoaWNoIHVzZXMgbmVnYXRpdmUgc2NhbGUgb24gdGhlIGdyYXBoIG5vZGVcbiAgICAgICAgICAgIG1hdGVyaWFsLnVwZGF0ZSgpO1xuXG4gICAgICAgICAgICB0aGlzLl9kZWZhdWx0VGV4dHVyZSA9IHRleHR1cmU7XG4gICAgICAgICAgICB0aGlzLl9kZWZhdWx0TWF0ZXJpYWwgPSBtYXRlcmlhbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fZGVmYXVsdE1hdGVyaWFsO1xuICAgIH1cblxuICAgIHNldCBkZWZhdWx0OVNsaWNlZE1hdGVyaWFsU2xpY2VkTW9kZShtYXRlcmlhbCkge1xuICAgICAgICB0aGlzLl9kZWZhdWx0OVNsaWNlZE1hdGVyaWFsU2xpY2VkTW9kZSA9IG1hdGVyaWFsO1xuICAgIH1cblxuICAgIGdldCBkZWZhdWx0OVNsaWNlZE1hdGVyaWFsU2xpY2VkTW9kZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9kZWZhdWx0OVNsaWNlZE1hdGVyaWFsU2xpY2VkTW9kZSkge1xuICAgICAgICAgICAgY29uc3QgbWF0ZXJpYWwgPSB0aGlzLmRlZmF1bHRNYXRlcmlhbC5jbG9uZSgpO1xuICAgICAgICAgICAgbWF0ZXJpYWwubmluZVNsaWNlZE1vZGUgPSBTUFJJVEVfUkVOREVSTU9ERV9TTElDRUQ7XG4gICAgICAgICAgICBtYXRlcmlhbC51cGRhdGUoKTtcblxuICAgICAgICAgICAgdGhpcy5fZGVmYXVsdDlTbGljZWRNYXRlcmlhbFNsaWNlZE1vZGUgPSBtYXRlcmlhbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fZGVmYXVsdDlTbGljZWRNYXRlcmlhbFNsaWNlZE1vZGU7XG4gICAgfVxuXG4gICAgc2V0IGRlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxUaWxlZE1vZGUobWF0ZXJpYWwpIHtcbiAgICAgICAgdGhpcy5fZGVmYXVsdDlTbGljZWRNYXRlcmlhbFRpbGVkTW9kZSA9IG1hdGVyaWFsO1xuICAgIH1cblxuICAgIGdldCBkZWZhdWx0OVNsaWNlZE1hdGVyaWFsVGlsZWRNb2RlKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2RlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxUaWxlZE1vZGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGVyaWFsID0gdGhpcy5kZWZhdWx0TWF0ZXJpYWwuY2xvbmUoKTtcbiAgICAgICAgICAgIG1hdGVyaWFsLm5pbmVTbGljZWRNb2RlID0gU1BSSVRFX1JFTkRFUk1PREVfVElMRUQ7XG4gICAgICAgICAgICBtYXRlcmlhbC51cGRhdGUoKTtcblxuICAgICAgICAgICAgdGhpcy5fZGVmYXVsdDlTbGljZWRNYXRlcmlhbFRpbGVkTW9kZSA9IG1hdGVyaWFsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9kZWZhdWx0OVNsaWNlZE1hdGVyaWFsVGlsZWRNb2RlO1xuICAgIH1cblxuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIHN1cGVyLmRlc3Ryb3koKTtcblxuICAgICAgICB0aGlzLmFwcC5zeXN0ZW1zLm9mZigndXBkYXRlJywgdGhpcy5vblVwZGF0ZSwgdGhpcyk7XG5cbiAgICAgICAgaWYgKHRoaXMuX2RlZmF1bHRUZXh0dXJlKSB7XG4gICAgICAgICAgICB0aGlzLl9kZWZhdWx0VGV4dHVyZS5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLl9kZWZhdWx0VGV4dHVyZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpbml0aWFsaXplQ29tcG9uZW50RGF0YShjb21wb25lbnQsIGRhdGEsIHByb3BlcnRpZXMpIHtcbiAgICAgICAgaWYgKGRhdGEuZW5hYmxlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb21wb25lbnQuZW5hYmxlZCA9IGRhdGEuZW5hYmxlZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbXBvbmVudC50eXBlID0gZGF0YS50eXBlO1xuXG4gICAgICAgIGlmIChkYXRhLmxheWVycyAmJiBBcnJheS5pc0FycmF5KGRhdGEubGF5ZXJzKSkge1xuICAgICAgICAgICAgY29tcG9uZW50LmxheWVycyA9IGRhdGEubGF5ZXJzLnNsaWNlKDApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEuZHJhd09yZGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5kcmF3T3JkZXIgPSBkYXRhLmRyYXdPcmRlcjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLmNvbG9yICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmIChkYXRhLmNvbG9yIGluc3RhbmNlb2YgQ29sb3IpIHtcbiAgICAgICAgICAgICAgICBjb21wb25lbnQuY29sb3Iuc2V0KGRhdGEuY29sb3IuciwgZGF0YS5jb2xvci5nLCBkYXRhLmNvbG9yLmIsIGRhdGEub3BhY2l0eSAhPT0gdW5kZWZpbmVkID8gZGF0YS5vcGFjaXR5IDogMSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudC5jb2xvci5zZXQoZGF0YS5jb2xvclswXSwgZGF0YS5jb2xvclsxXSwgZGF0YS5jb2xvclsyXSwgZGF0YS5vcGFjaXR5ICE9PSB1bmRlZmluZWQgPyBkYXRhLm9wYWNpdHkgOiAxKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tc2VsZi1hc3NpZ24gKi9cbiAgICAgICAgICAgIC8vIGZvcmNlIHVwZGF0ZVxuICAgICAgICAgICAgY29tcG9uZW50LmNvbG9yID0gY29tcG9uZW50LmNvbG9yO1xuICAgICAgICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1zZWxmLWFzc2lnbiAqL1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEub3BhY2l0eSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb21wb25lbnQub3BhY2l0eSA9IGRhdGEub3BhY2l0eTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLmZsaXBYICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5mbGlwWCA9IGRhdGEuZmxpcFg7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS5mbGlwWSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb21wb25lbnQuZmxpcFkgPSBkYXRhLmZsaXBZO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEud2lkdGggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29tcG9uZW50LndpZHRoID0gZGF0YS53aWR0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLmhlaWdodCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb21wb25lbnQuaGVpZ2h0ID0gZGF0YS5oZWlnaHQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS5zcHJpdGVBc3NldCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb21wb25lbnQuc3ByaXRlQXNzZXQgPSBkYXRhLnNwcml0ZUFzc2V0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEuc3ByaXRlKSB7XG4gICAgICAgICAgICBjb21wb25lbnQuc3ByaXRlID0gZGF0YS5zcHJpdGU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS5mcmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb21wb25lbnQuZnJhbWUgPSBkYXRhLmZyYW1lO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEuY2xpcHMpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbmFtZSBpbiBkYXRhLmNsaXBzKSB7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50LmFkZENsaXAoZGF0YS5jbGlwc1tuYW1lXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS5zcGVlZCAhPT0gdW5kZWZpbmVkKSAge1xuICAgICAgICAgICAgY29tcG9uZW50LnNwZWVkID0gZGF0YS5zcGVlZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLmF1dG9QbGF5Q2xpcCkge1xuICAgICAgICAgICAgY29tcG9uZW50LmF1dG9QbGF5Q2xpcCA9IGRhdGEuYXV0b1BsYXlDbGlwO1xuICAgICAgICB9XG5cbiAgICAgICAgY29tcG9uZW50LmJhdGNoR3JvdXBJZCA9IGRhdGEuYmF0Y2hHcm91cElkID09PSB1bmRlZmluZWQgfHwgZGF0YS5iYXRjaEdyb3VwSWQgPT09IG51bGwgPyAtMSA6IGRhdGEuYmF0Y2hHcm91cElkO1xuXG4gICAgICAgIHN1cGVyLmluaXRpYWxpemVDb21wb25lbnREYXRhKGNvbXBvbmVudCwgZGF0YSwgcHJvcGVydGllcyk7XG4gICAgfVxuXG4gICAgY2xvbmVDb21wb25lbnQoZW50aXR5LCBjbG9uZSkge1xuICAgICAgICBjb25zdCBzb3VyY2UgPSBlbnRpdHkuc3ByaXRlO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmFkZENvbXBvbmVudChjbG9uZSwge1xuICAgICAgICAgICAgZW5hYmxlZDogc291cmNlLmVuYWJsZWQsXG4gICAgICAgICAgICB0eXBlOiBzb3VyY2UudHlwZSxcbiAgICAgICAgICAgIHNwcml0ZUFzc2V0OiBzb3VyY2Uuc3ByaXRlQXNzZXQsXG4gICAgICAgICAgICBzcHJpdGU6IHNvdXJjZS5zcHJpdGUsXG4gICAgICAgICAgICBmcmFtZTogc291cmNlLmZyYW1lLFxuICAgICAgICAgICAgY29sb3I6IHNvdXJjZS5jb2xvci5jbG9uZSgpLFxuICAgICAgICAgICAgb3BhY2l0eTogc291cmNlLm9wYWNpdHksXG4gICAgICAgICAgICBmbGlwWDogc291cmNlLmZsaXBYLFxuICAgICAgICAgICAgZmxpcFk6IHNvdXJjZS5mbGlwWSxcbiAgICAgICAgICAgIHNwZWVkOiBzb3VyY2Uuc3BlZWQsXG4gICAgICAgICAgICBjbGlwczogc291cmNlLmNsaXBzLFxuICAgICAgICAgICAgYXV0b1BsYXlDbGlwOiBzb3VyY2UuYXV0b1BsYXlDbGlwLFxuICAgICAgICAgICAgYmF0Y2hHcm91cElkOiBzb3VyY2UuYmF0Y2hHcm91cElkLFxuICAgICAgICAgICAgZHJhd09yZGVyOiBzb3VyY2UuZHJhd09yZGVyLFxuICAgICAgICAgICAgbGF5ZXJzOiBzb3VyY2UubGF5ZXJzLnNsaWNlKDApXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG9uVXBkYXRlKGR0KSB7XG4gICAgICAgIGNvbnN0IGNvbXBvbmVudHMgPSB0aGlzLnN0b3JlO1xuXG4gICAgICAgIGZvciAoY29uc3QgaWQgaW4gY29tcG9uZW50cykge1xuICAgICAgICAgICAgaWYgKGNvbXBvbmVudHMuaGFzT3duUHJvcGVydHkoaWQpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29tcG9uZW50ID0gY29tcG9uZW50c1tpZF07XG4gICAgICAgICAgICAgICAgLy8gaWYgc3ByaXRlIGNvbXBvbmVudCBpcyBlbmFibGVkIGFkdmFuY2UgaXRzIGN1cnJlbnQgY2xpcFxuICAgICAgICAgICAgICAgIGlmIChjb21wb25lbnQuZGF0YS5lbmFibGVkICYmIGNvbXBvbmVudC5lbnRpdHkuZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzcHJpdGUgPSBjb21wb25lbnQuZW50aXR5LnNwcml0ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNwcml0ZS5fY3VycmVudENsaXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwcml0ZS5fY3VycmVudENsaXAuX3VwZGF0ZShkdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbkJlZm9yZVJlbW92ZShlbnRpdHksIGNvbXBvbmVudCkge1xuICAgICAgICBjb21wb25lbnQub25EZXN0cm95KCk7XG4gICAgfVxufVxuXG5Db21wb25lbnQuX2J1aWxkQWNjZXNzb3JzKFNwcml0ZUNvbXBvbmVudC5wcm90b3R5cGUsIF9zY2hlbWEpO1xuXG5leHBvcnQgeyBTcHJpdGVDb21wb25lbnRTeXN0ZW0gfTtcbiJdLCJuYW1lcyI6WyJfc2NoZW1hIiwiU3ByaXRlQ29tcG9uZW50U3lzdGVtIiwiQ29tcG9uZW50U3lzdGVtIiwiY29uc3RydWN0b3IiLCJhcHAiLCJpZCIsIkNvbXBvbmVudFR5cGUiLCJTcHJpdGVDb21wb25lbnQiLCJEYXRhVHlwZSIsIlNwcml0ZUNvbXBvbmVudERhdGEiLCJzY2hlbWEiLCJfZGVmYXVsdFRleHR1cmUiLCJfZGVmYXVsdE1hdGVyaWFsIiwiX2RlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxTbGljZWRNb2RlIiwiX2RlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxUaWxlZE1vZGUiLCJzeXN0ZW1zIiwib24iLCJvblVwZGF0ZSIsIm9uQmVmb3JlUmVtb3ZlIiwiZGVmYXVsdE1hdGVyaWFsIiwibWF0ZXJpYWwiLCJ0ZXh0dXJlIiwiVGV4dHVyZSIsImdyYXBoaWNzRGV2aWNlIiwid2lkdGgiLCJoZWlnaHQiLCJmb3JtYXQiLCJQSVhFTEZPUk1BVF9SOF9HOF9COF9BOCIsIm5hbWUiLCJwaXhlbHMiLCJVaW50OEFycmF5IiwibG9jayIsInVubG9jayIsIlN0YW5kYXJkTWF0ZXJpYWwiLCJkaWZmdXNlIiwic2V0IiwiZW1pc3NpdmUiLCJlbWlzc2l2ZU1hcCIsImVtaXNzaXZlVGludCIsIm9wYWNpdHlNYXAiLCJvcGFjaXR5TWFwQ2hhbm5lbCIsIm9wYWNpdHlUaW50Iiwib3BhY2l0eSIsInVzZUxpZ2h0aW5nIiwidXNlR2FtbWFUb25lbWFwIiwidXNlRm9nIiwidXNlU2t5Ym94IiwiYmxlbmRUeXBlIiwiQkxFTkRfUFJFTVVMVElQTElFRCIsImRlcHRoV3JpdGUiLCJwaXhlbFNuYXAiLCJjdWxsIiwiQ1VMTEZBQ0VfTk9ORSIsInVwZGF0ZSIsImRlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxTbGljZWRNb2RlIiwiY2xvbmUiLCJuaW5lU2xpY2VkTW9kZSIsIlNQUklURV9SRU5ERVJNT0RFX1NMSUNFRCIsImRlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxUaWxlZE1vZGUiLCJTUFJJVEVfUkVOREVSTU9ERV9USUxFRCIsImRlc3Ryb3kiLCJvZmYiLCJpbml0aWFsaXplQ29tcG9uZW50RGF0YSIsImNvbXBvbmVudCIsImRhdGEiLCJwcm9wZXJ0aWVzIiwiZW5hYmxlZCIsInVuZGVmaW5lZCIsInR5cGUiLCJsYXllcnMiLCJBcnJheSIsImlzQXJyYXkiLCJzbGljZSIsImRyYXdPcmRlciIsImNvbG9yIiwiQ29sb3IiLCJyIiwiZyIsImIiLCJmbGlwWCIsImZsaXBZIiwic3ByaXRlQXNzZXQiLCJzcHJpdGUiLCJmcmFtZSIsImNsaXBzIiwiYWRkQ2xpcCIsInNwZWVkIiwiYXV0b1BsYXlDbGlwIiwiYmF0Y2hHcm91cElkIiwiY2xvbmVDb21wb25lbnQiLCJlbnRpdHkiLCJzb3VyY2UiLCJhZGRDb21wb25lbnQiLCJkdCIsImNvbXBvbmVudHMiLCJzdG9yZSIsImhhc093blByb3BlcnR5IiwiX2N1cnJlbnRDbGlwIiwiX3VwZGF0ZSIsIm9uRGVzdHJveSIsIkNvbXBvbmVudCIsIl9idWlsZEFjY2Vzc29ycyIsInByb3RvdHlwZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBbUJBLE1BQU1BLE9BQU8sR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFBOztBQU8zQixNQUFNQyxxQkFBcUIsU0FBU0MsZUFBZSxDQUFDO0VBT2hEQyxXQUFXLENBQUNDLEdBQUcsRUFBRTtJQUNiLEtBQUssQ0FBQ0EsR0FBRyxDQUFDLENBQUE7SUFFVixJQUFJLENBQUNDLEVBQUUsR0FBRyxRQUFRLENBQUE7SUFFbEIsSUFBSSxDQUFDQyxhQUFhLEdBQUdDLGVBQWUsQ0FBQTtJQUNwQyxJQUFJLENBQUNDLFFBQVEsR0FBR0MsbUJBQW1CLENBQUE7SUFFbkMsSUFBSSxDQUFDQyxNQUFNLEdBQUdWLE9BQU8sQ0FBQTs7SUFHckIsSUFBSSxDQUFDVyxlQUFlLEdBQUcsSUFBSSxDQUFBOztJQUczQixJQUFJLENBQUNDLGdCQUFnQixHQUFHLElBQUksQ0FBQTs7SUFHNUIsSUFBSSxDQUFDQyxpQ0FBaUMsR0FBRyxJQUFJLENBQUE7O0lBRzdDLElBQUksQ0FBQ0MsZ0NBQWdDLEdBQUcsSUFBSSxDQUFBO0FBRTVDLElBQUEsSUFBSSxDQUFDVixHQUFHLENBQUNXLE9BQU8sQ0FBQ0MsRUFBRSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUNDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUNsRCxJQUFJLENBQUNELEVBQUUsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDRSxjQUFjLEVB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
