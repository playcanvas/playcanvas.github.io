import { extends as _extends } from '../../../_virtual/_rollupPluginBabelHelpers.js';
import { AnimSnapshot } from './anim-snapshot.js';

// TODO: add configurable looping start/end times?

/**
 * AnimClip wraps the running state of an animation track. It contains and update the animation
 * 'cursor' and performs looping logic.
 *
 * @ignore
 */
class AnimClip {
  /**
   * Create a new animation clip.
   *
   * @param {import('./anim-track.js').AnimTrack} track - The animation data.
   * @param {number} time - The initial time of the clip.
   * @param {number} speed - Speed of the animation playback.
   * @param {boolean} playing - true if the clip is playing and false otherwise.
   * @param {boolean} loop - Whether the clip should loop.
   * @param {import('../../../core/event-handler.js').EventHandler} [eventHandler] - The handler
   * to call when an event is fired by the clip.
   */
  constructor(track, time, speed, playing, loop, eventHandler) {
    this._name = track.name; // default to track name
    this._track = track;
    this._snapshot = new AnimSnapshot(track);
    this._playing = playing;
    this._time = time; // play cursor
    this._speed = speed; // playback speed, may be negative
    this._loop = loop; // whether to loop
    this._blendWeight = 1.0; // blend weight 0..1
    this._blendOrder = 0.0; // blend order relative to other clips
    this._eventHandler = eventHandler;
    this.alignCursorToCurrentTime();
  }
  set name(name) {
    this._name = name;
  }
  get name() {
    return this._name;
  }
  set track(track) {
    this._track = track;
    this._snapshot = new AnimSnapshot(track);
  }
  get track() {
    return this._track;
  }
  get snapshot() {
    return this._snapshot;
  }
  set time(time) {
    this._time = time;
    this.alignCursorToCurrentTime();
  }
  get time() {
    return this._time;
  }
  set speed(speed) {
    const signChanged = Math.sign(speed) !== Math.sign(this._speed);
    this._speed = speed;
    if (signChanged) {
      this.alignCursorToCurrentTime();
    }
  }
  get speed() {
    return this._speed;
  }
  set loop(loop) {
    this._loop = loop;
  }
  get loop() {
    return this._loop;
  }
  set blendWeight(blendWeight) {
    this._blendWeight = blendWeight;
  }
  get blendWeight() {
    return this._blendWeight;
  }
  set blendOrder(blendOrder) {
    this._blendOrder = blendOrder;
  }
  get blendOrder() {
    return this._blendOrder;
  }
  set eventCursor(value) {
    this._eventCursor = value;
  }
  get eventCursor() {
    return this._eventCursor;
  }
  get eventCursorEnd() {
    return this.isReverse ? 0 : this._track.events.length - 1;
  }
  get nextEvent() {
    return this._track.events[this._eventCursor];
  }
  get isReverse() {
    return this._speed < 0;
  }
  nextEventAheadOfTime(time) {
    if (!this.nextEvent) return false;
    return this.isReverse ? this.nextEvent.time <= time : this.nextEvent.time >= time;
  }
  nextEventBehindTime(time) {
    if (!this.nextEvent) return false;
    if (time === this.track.duration) {
      return this.isReverse ? this.nextEvent.time >= time : this.nextEvent.time <= time;
    }
    return this.isReverse ? this.nextEvent.time > time : this.nextEvent.time < time;
  }
  resetEventCursor() {
    this._eventCursor = this.isReverse ? this._track.events.length - 1 : 0;
  }
  moveEventCursor() {
    this._eventCursor += this.isReverse ? -1 : 1;
    if (this._eventCursor >= this.track.events.length) {
      this._eventCursor = 0;
    } else if (this._eventCursor < 0) {
      this._eventCursor = this.track.events.length - 1;
    }
  }
  clipFrameTime(frameEndTime) {
    const eventFrame = AnimClip.eventFrame;
    eventFrame.start = 0;
    eventFrame.end = frameEndTime;
    eventFrame.residual = 0;

    // if this frame overlaps with the end of the track, we should clip off the end of the frame time then check that clipped time later
    if (this.isReverse) {
      if (frameEndTime < 0) {
        eventFrame.start = this.track.duration;
        eventFrame.end = 0;
        eventFrame.residual = frameEndTime + this.track.duration;
      }
    } else {
      if (frameEndTime > this.track.duration) {
        eventFrame.start = 0;
        eventFrame.end = this.track.duration;
        eventFrame.residual = frameEndTime - this.track.duration;
      }
    }
  }
  alignCursorToCurrentTime() {
    this.resetEventCursor();
    while (this.nextEventBehindTime(this._time) && this._eventCursor !== this.eventCursorEnd) {
      this.moveEventCursor();
    }
  }
  fireNextEvent() {
    this._eventHandler.fire(this.nextEvent.name, _extends({
      track: this.track
    }, this.nextEvent));
    this.moveEventCursor();
  }
  fireNextEventInFrame(frameStartTime, frameEndTime) {
    if (this.nextEventAheadOfTime(frameStartTime) && this.nextEventBehindTime(frameEndTime)) {
      this.fireNextEvent();
      return true;
    }
    return false;
  }
  activeEventsForFrame(frameStartTime, frameEndTime) {
    // get frame start and end times clipped to the track duration with the residual duration stored
    const eventFrame = AnimClip.eventFrame;
    this.clipFrameTime(frameEndTime);
    // fire all events that should fire during this clipped frame
    const initialCursor = this.eventCursor;
    while (this.fireNextEventInFrame(frameStartTime, eventFrame.end)) {
      if (initialCursor === this.eventCursor) {
        break;
      }
    }
    // recurse the process until the residual duration is 0
    if (this.loop && Math.abs(eventFrame.residual) > 0) {
      this.activeEventsForFrame(eventFrame.start, eventFrame.residual);
    }
  }
  progressForTime(time) {
    return time * this._speed / this._track.duration;
  }
  _update(deltaTime) {
    if (this._playing) {
      let time = this._time;
      const duration = this._track.duration;
      const speed = this._speed;
      const loop = this._loop;

      // check for events that should fire during this frame
      if (this._track.events.length > 0 && duration > 0) {
        this.activeEventsForFrame(time, time + speed * deltaTime);
      }

      // update time
      time += speed * deltaTime;

      // perform looping
      if (speed >= 0) {
        // playing forwards
        if (time > duration) {
          if (loop) {
            time = time % duration || 0; // if duration is 0, % is NaN
          } else {
            time = this._track.duration;
            this.pause();
          }
        }
      } else {
        // playing backwards
        if (time < 0) {
          if (loop) {
            time = duration + (time % duration || 0);
          } else {
            time = 0;
            this.pause();
          }
        }
      }
      this._time = time;
    }

    // update snapshot if time has changed
    if (this._time !== this._snapshot._time) {
      this._track.eval(this._time, this._snapshot);
    }
  }
  play() {
    this._playing = true;
    this._time = 0;
  }
  stop() {
    this._playing = false;
    this._time = 0;
  }
  pause() {
    this._playing = false;
  }
  resume() {
    this._playing = true;
  }
  reset() {
    this._time = 0;
  }
}
AnimClip.eventFrame = {
  start: 0,
  end: 0,
  residual: 0
};

export { AnimClip };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5pbS1jbGlwLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2FuaW0vZXZhbHVhdG9yL2FuaW0tY2xpcC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBbmltU25hcHNob3QgfSBmcm9tICcuL2FuaW0tc25hcHNob3QuanMnO1xuXG4vLyBUT0RPOiBhZGQgY29uZmlndXJhYmxlIGxvb3Bpbmcgc3RhcnQvZW5kIHRpbWVzP1xuXG4vKipcbiAqIEFuaW1DbGlwIHdyYXBzIHRoZSBydW5uaW5nIHN0YXRlIG9mIGFuIGFuaW1hdGlvbiB0cmFjay4gSXQgY29udGFpbnMgYW5kIHVwZGF0ZSB0aGUgYW5pbWF0aW9uXG4gKiAnY3Vyc29yJyBhbmQgcGVyZm9ybXMgbG9vcGluZyBsb2dpYy5cbiAqXG4gKiBAaWdub3JlXG4gKi9cbmNsYXNzIEFuaW1DbGlwIHtcbiAgICBzdGF0aWMgZXZlbnRGcmFtZSA9IHtcbiAgICAgICAgc3RhcnQ6IDAsXG4gICAgICAgIGVuZDogMCxcbiAgICAgICAgcmVzaWR1YWw6IDBcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IGFuaW1hdGlvbiBjbGlwLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4vYW5pbS10cmFjay5qcycpLkFuaW1UcmFja30gdHJhY2sgLSBUaGUgYW5pbWF0aW9uIGRhdGEuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHRpbWUgLSBUaGUgaW5pdGlhbCB0aW1lIG9mIHRoZSBjbGlwLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzcGVlZCAtIFNwZWVkIG9mIHRoZSBhbmltYXRpb24gcGxheWJhY2suXG4gICAgICogQHBhcmFtIHtib29sZWFufSBwbGF5aW5nIC0gdHJ1ZSBpZiB0aGUgY2xpcCBpcyBwbGF5aW5nIGFuZCBmYWxzZSBvdGhlcndpc2UuXG4gICAgICogQHBhcmFtIHtib29sZWFufSBsb29wIC0gV2hldGhlciB0aGUgY2xpcCBzaG91bGQgbG9vcC5cbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vLi4vLi4vY29yZS9ldmVudC1oYW5kbGVyLmpzJykuRXZlbnRIYW5kbGVyfSBbZXZlbnRIYW5kbGVyXSAtIFRoZSBoYW5kbGVyXG4gICAgICogdG8gY2FsbCB3aGVuIGFuIGV2ZW50IGlzIGZpcmVkIGJ5IHRoZSBjbGlwLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHRyYWNrLCB0aW1lLCBzcGVlZCwgcGxheWluZywgbG9vcCwgZXZlbnRIYW5kbGVyKSB7XG4gICAgICAgIHRoaXMuX25hbWUgPSB0cmFjay5uYW1lOyAgICAgICAgLy8gZGVmYXVsdCB0byB0cmFjayBuYW1lXG4gICAgICAgIHRoaXMuX3RyYWNrID0gdHJhY2s7XG4gICAgICAgIHRoaXMuX3NuYXBzaG90ID0gbmV3IEFuaW1TbmFwc2hvdCh0cmFjayk7XG4gICAgICAgIHRoaXMuX3BsYXlpbmcgPSBwbGF5aW5nO1xuICAgICAgICB0aGlzLl90aW1lID0gdGltZTsgICAgICAgICAgICAgIC8vIHBsYXkgY3Vyc29yXG4gICAgICAgIHRoaXMuX3NwZWVkID0gc3BlZWQ7ICAgICAgICAgICAgLy8gcGxheWJhY2sgc3BlZWQsIG1heSBiZSBuZWdhdGl2ZVxuICAgICAgICB0aGlzLl9sb29wID0gbG9vcDsgICAgICAgICAgICAgIC8vIHdoZXRoZXIgdG8gbG9vcFxuICAgICAgICB0aGlzLl9ibGVuZFdlaWdodCA9IDEuMDsgICAgICAgIC8vIGJsZW5kIHdlaWdodCAwLi4xXG4gICAgICAgIHRoaXMuX2JsZW5kT3JkZXIgPSAwLjA7ICAgICAgICAgLy8gYmxlbmQgb3JkZXIgcmVsYXRpdmUgdG8gb3RoZXIgY2xpcHNcbiAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVyID0gZXZlbnRIYW5kbGVyO1xuICAgICAgICB0aGlzLmFsaWduQ3Vyc29yVG9DdXJyZW50VGltZSgpO1xuICAgIH1cblxuICAgIHNldCBuYW1lKG5hbWUpIHtcbiAgICAgICAgdGhpcy5fbmFtZSA9IG5hbWU7XG4gICAgfVxuXG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9uYW1lO1xuICAgIH1cblxuICAgIHNldCB0cmFjayh0cmFjaykge1xuICAgICAgICB0aGlzLl90cmFjayA9IHRyYWNrO1xuICAgICAgICB0aGlzLl9zbmFwc2hvdCA9IG5ldyBBbmltU25hcHNob3QodHJhY2spO1xuICAgIH1cblxuICAgIGdldCB0cmFjaygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrO1xuICAgIH1cblxuICAgIGdldCBzbmFwc2hvdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NuYXBzaG90O1xuICAgIH1cblxuICAgIHNldCB0aW1lKHRpbWUpIHtcbiAgICAgICAgdGhpcy5fdGltZSA9IHRpbWU7XG4gICAgICAgIHRoaXMuYWxpZ25DdXJzb3JUb0N1cnJlbnRUaW1lKCk7XG4gICAgfVxuXG4gICAgZ2V0IHRpbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90aW1lO1xuICAgIH1cblxuICAgIHNldCBzcGVlZChzcGVlZCkge1xuICAgICAgICBjb25zdCBzaWduQ2hhbmdlZCA9IE1hdGguc2lnbihzcGVlZCkgIT09IE1hdGguc2lnbih0aGlzLl9zcGVlZCk7XG4gICAgICAgIHRoaXMuX3NwZWVkID0gc3BlZWQ7XG4gICAgICAgIGlmIChzaWduQ2hhbmdlZCkge1xuICAgICAgICAgICAgdGhpcy5hbGlnbkN1cnNvclRvQ3VycmVudFRpbWUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBzcGVlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NwZWVkO1xuICAgIH1cblxuICAgIHNldCBsb29wKGxvb3ApIHtcbiAgICAgICAgdGhpcy5fbG9vcCA9IGxvb3A7XG4gICAgfVxuXG4gICAgZ2V0IGxvb3AoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sb29wO1xuICAgIH1cblxuICAgIHNldCBibGVuZFdlaWdodChibGVuZFdlaWdodCkge1xuICAgICAgICB0aGlzLl9ibGVuZFdlaWdodCA9IGJsZW5kV2VpZ2h0O1xuICAgIH1cblxuICAgIGdldCBibGVuZFdlaWdodCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2JsZW5kV2VpZ2h0O1xuICAgIH1cblxuICAgIHNldCBibGVuZE9yZGVyKGJsZW5kT3JkZXIpIHtcbiAgICAgICAgdGhpcy5fYmxlbmRPcmRlciA9IGJsZW5kT3JkZXI7XG4gICAgfVxuXG4gICAgZ2V0IGJsZW5kT3JkZXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ibGVuZE9yZGVyO1xuICAgIH1cblxuICAgIHNldCBldmVudEN1cnNvcih2YWx1ZSkge1xuICAgICAgICB0aGlzLl9ldmVudEN1cnNvciA9IHZhbHVlO1xuICAgIH1cblxuICAgIGdldCBldmVudEN1cnNvcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50Q3Vyc29yO1xuICAgIH1cblxuICAgIGdldCBldmVudEN1cnNvckVuZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNSZXZlcnNlID8gMCA6IHRoaXMuX3RyYWNrLmV2ZW50cy5sZW5ndGggLSAxO1xuICAgIH1cblxuICAgIGdldCBuZXh0RXZlbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90cmFjay5ldmVudHNbdGhpcy5fZXZlbnRDdXJzb3JdO1xuICAgIH1cblxuICAgIGdldCBpc1JldmVyc2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zcGVlZCA8IDA7XG4gICAgfVxuXG4gICAgbmV4dEV2ZW50QWhlYWRPZlRpbWUodGltZSkge1xuICAgICAgICBpZiAoIXRoaXMubmV4dEV2ZW50KSByZXR1cm4gZmFsc2U7XG4gICAgICAgIHJldHVybiB0aGlzLmlzUmV2ZXJzZSA/IHRoaXMubmV4dEV2ZW50LnRpbWUgPD0gdGltZSA6IHRoaXMubmV4dEV2ZW50LnRpbWUgPj0gdGltZTtcbiAgICB9XG5cbiAgICBuZXh0RXZlbnRCZWhpbmRUaW1lKHRpbWUpIHtcbiAgICAgICAgaWYgKCF0aGlzLm5leHRFdmVudCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAodGltZSA9PT0gdGhpcy50cmFjay5kdXJhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNSZXZlcnNlID8gdGhpcy5uZXh0RXZlbnQudGltZSA+PSB0aW1lIDogdGhpcy5uZXh0RXZlbnQudGltZSA8PSB0aW1lO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmlzUmV2ZXJzZSA/IHRoaXMubmV4dEV2ZW50LnRpbWUgPiB0aW1lIDogdGhpcy5uZXh0RXZlbnQudGltZSA8IHRpbWU7XG4gICAgfVxuXG4gICAgcmVzZXRFdmVudEN1cnNvcigpIHtcbiAgICAgICAgdGhpcy5fZXZlbnRDdXJzb3IgPSB0aGlzLmlzUmV2ZXJzZSA/IHRoaXMuX3RyYWNrLmV2ZW50cy5sZW5ndGggLSAxIDogMDtcbiAgICB9XG5cbiAgICBtb3ZlRXZlbnRDdXJzb3IoKSB7XG4gICAgICAgIHRoaXMuX2V2ZW50Q3Vyc29yICs9ICh0aGlzLmlzUmV2ZXJzZSA/IC0xIDogMSk7XG4gICAgICAgIGlmICh0aGlzLl9ldmVudEN1cnNvciA+PSB0aGlzLnRyYWNrLmV2ZW50cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuX2V2ZW50Q3Vyc29yID0gMDtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9ldmVudEN1cnNvciA8IDApIHtcbiAgICAgICAgICAgIHRoaXMuX2V2ZW50Q3Vyc29yID0gdGhpcy50cmFjay5ldmVudHMubGVuZ3RoIC0gMTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNsaXBGcmFtZVRpbWUoZnJhbWVFbmRUaW1lKSB7XG4gICAgICAgIGNvbnN0IGV2ZW50RnJhbWUgPSBBbmltQ2xpcC5ldmVudEZyYW1lO1xuICAgICAgICBldmVudEZyYW1lLnN0YXJ0ID0gMDtcbiAgICAgICAgZXZlbnRGcmFtZS5lbmQgPSBmcmFtZUVuZFRpbWU7XG4gICAgICAgIGV2ZW50RnJhbWUucmVzaWR1YWwgPSAwO1xuXG4gICAgICAgIC8vIGlmIHRoaXMgZnJhbWUgb3ZlcmxhcHMgd2l0aCB0aGUgZW5kIG9mIHRoZSB0cmFjaywgd2Ugc2hvdWxkIGNsaXAgb2ZmIHRoZSBlbmQgb2YgdGhlIGZyYW1lIHRpbWUgdGhlbiBjaGVjayB0aGF0IGNsaXBwZWQgdGltZSBsYXRlclxuICAgICAgICBpZiAodGhpcy5pc1JldmVyc2UpIHtcbiAgICAgICAgICAgIGlmIChmcmFtZUVuZFRpbWUgPCAwKSB7XG4gICAgICAgICAgICAgICAgZXZlbnRGcmFtZS5zdGFydCA9IHRoaXMudHJhY2suZHVyYXRpb247XG4gICAgICAgICAgICAgICAgZXZlbnRGcmFtZS5lbmQgPSAwO1xuICAgICAgICAgICAgICAgIGV2ZW50RnJhbWUucmVzaWR1YWwgPSBmcmFtZUVuZFRpbWUgKyB0aGlzLnRyYWNrLmR1cmF0aW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGZyYW1lRW5kVGltZSA+IHRoaXMudHJhY2suZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICBldmVudEZyYW1lLnN0YXJ0ID0gMDtcbiAgICAgICAgICAgICAgICBldmVudEZyYW1lLmVuZCA9IHRoaXMudHJhY2suZHVyYXRpb247XG4gICAgICAgICAgICAgICAgZXZlbnRGcmFtZS5yZXNpZHVhbCA9IGZyYW1lRW5kVGltZSAtIHRoaXMudHJhY2suZHVyYXRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhbGlnbkN1cnNvclRvQ3VycmVudFRpbWUoKSB7XG4gICAgICAgIHRoaXMucmVzZXRFdmVudEN1cnNvcigpO1xuICAgICAgICB3aGlsZSAodGhpcy5uZXh0RXZlbnRCZWhpbmRUaW1lKHRoaXMuX3RpbWUpICYmIHRoaXMuX2V2ZW50Q3Vyc29yICE9PSB0aGlzLmV2ZW50Q3Vyc29yRW5kKSB7XG4gICAgICAgICAgICB0aGlzLm1vdmVFdmVudEN1cnNvcigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZmlyZU5leHRFdmVudCgpIHtcbiAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVyLmZpcmUodGhpcy5uZXh0RXZlbnQubmFtZSwgeyB0cmFjazogdGhpcy50cmFjaywgLi4udGhpcy5uZXh0RXZlbnQgfSk7XG4gICAgICAgIHRoaXMubW92ZUV2ZW50Q3Vyc29yKCk7XG4gICAgfVxuXG4gICAgZmlyZU5leHRFdmVudEluRnJhbWUoZnJhbWVTdGFydFRpbWUsIGZyYW1lRW5kVGltZSkge1xuICAgICAgICBpZiAodGhpcy5uZXh0RXZlbnRBaGVhZE9mVGltZShmcmFtZVN0YXJ0VGltZSkgJiYgdGhpcy5uZXh0RXZlbnRCZWhpbmRUaW1lKGZyYW1lRW5kVGltZSkpIHtcbiAgICAgICAgICAgIHRoaXMuZmlyZU5leHRFdmVudCgpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGFjdGl2ZUV2ZW50c0ZvckZyYW1lKGZyYW1lU3RhcnRUaW1lLCBmcmFtZUVuZFRpbWUpIHtcbiAgICAgICAgLy8gZ2V0IGZyYW1lIHN0YXJ0IGFuZCBlbmQgdGltZXMgY2xpcHBlZCB0byB0aGUgdHJhY2sgZHVyYXRpb24gd2l0aCB0aGUgcmVzaWR1YWwgZHVyYXRpb24gc3RvcmVkXG4gICAgICAgIGNvbnN0IGV2ZW50RnJhbWUgPSBBbmltQ2xpcC5ldmVudEZyYW1lO1xuICAgICAgICB0aGlzLmNsaXBGcmFtZVRpbWUoZnJhbWVFbmRUaW1lKTtcbiAgICAgICAgLy8gZmlyZSBhbGwgZXZlbnRzIHRoYXQgc2hvdWxkIGZpcmUgZHVyaW5nIHRoaXMgY2xpcHBlZCBmcmFtZVxuICAgICAgICBjb25zdCBpbml0aWFsQ3Vyc29yID0gdGhpcy5ldmVudEN1cnNvcjtcbiAgICAgICAgd2hpbGUgKHRoaXMuZmlyZU5leHRFdmVudEluRnJhbWUoZnJhbWVTdGFydFRpbWUsIGV2ZW50RnJhbWUuZW5kKSkge1xuICAgICAgICAgICAgaWYgKGluaXRpYWxDdXJzb3IgPT09IHRoaXMuZXZlbnRDdXJzb3IpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyByZWN1cnNlIHRoZSBwcm9jZXNzIHVudGlsIHRoZSByZXNpZHVhbCBkdXJhdGlvbiBpcyAwXG4gICAgICAgIGlmICh0aGlzLmxvb3AgJiYgTWF0aC5hYnMoZXZlbnRGcmFtZS5yZXNpZHVhbCkgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUV2ZW50c0ZvckZyYW1lKGV2ZW50RnJhbWUuc3RhcnQsIGV2ZW50RnJhbWUucmVzaWR1YWwpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJvZ3Jlc3NGb3JUaW1lKHRpbWUpIHtcbiAgICAgICAgcmV0dXJuICh0aW1lICogdGhpcy5fc3BlZWQpIC8gdGhpcy5fdHJhY2suZHVyYXRpb247XG4gICAgfVxuXG4gICAgX3VwZGF0ZShkZWx0YVRpbWUpIHtcbiAgICAgICAgaWYgKHRoaXMuX3BsYXlpbmcpIHtcbiAgICAgICAgICAgIGxldCB0aW1lID0gdGhpcy5fdGltZTtcbiAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uID0gdGhpcy5fdHJhY2suZHVyYXRpb247XG4gICAgICAgICAgICBjb25zdCBzcGVlZCA9IHRoaXMuX3NwZWVkO1xuICAgICAgICAgICAgY29uc3QgbG9vcCA9IHRoaXMuX2xvb3A7XG5cbiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBldmVudHMgdGhhdCBzaG91bGQgZmlyZSBkdXJpbmcgdGhpcyBmcmFtZVxuICAgICAgICAgICAgaWYgKHRoaXMuX3RyYWNrLmV2ZW50cy5sZW5ndGggPiAwICYmIGR1cmF0aW9uID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlRXZlbnRzRm9yRnJhbWUodGltZSwgdGltZSArIHNwZWVkICogZGVsdGFUaW1lKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gdXBkYXRlIHRpbWVcbiAgICAgICAgICAgIHRpbWUgKz0gc3BlZWQgKiBkZWx0YVRpbWU7XG5cbiAgICAgICAgICAgIC8vIHBlcmZvcm0gbG9vcGluZ1xuICAgICAgICAgICAgaWYgKHNwZWVkID49IDApIHtcbiAgICAgICAgICAgICAgICAvLyBwbGF5aW5nIGZvcndhcmRzXG4gICAgICAgICAgICAgICAgaWYgKHRpbWUgPiBkdXJhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBpZiAobG9vcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZSA9ICh0aW1lICUgZHVyYXRpb24pIHx8IDA7ICAvLyBpZiBkdXJhdGlvbiBpcyAwLCAlIGlzIE5hTlxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZSA9IHRoaXMuX3RyYWNrLmR1cmF0aW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXVzZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBwbGF5aW5nIGJhY2t3YXJkc1xuICAgICAgICAgICAgICAgIGlmICh0aW1lIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobG9vcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZSA9IGR1cmF0aW9uICsgKCh0aW1lICUgZHVyYXRpb24pIHx8IDApO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl90aW1lID0gdGltZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHVwZGF0ZSBzbmFwc2hvdCBpZiB0aW1lIGhhcyBjaGFuZ2VkXG4gICAgICAgIGlmICh0aGlzLl90aW1lICE9PSB0aGlzLl9zbmFwc2hvdC5fdGltZSkge1xuICAgICAgICAgICAgdGhpcy5fdHJhY2suZXZhbCh0aGlzLl90aW1lLCB0aGlzLl9zbmFwc2hvdCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwbGF5KCkge1xuICAgICAgICB0aGlzLl9wbGF5aW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fdGltZSA9IDA7XG4gICAgfVxuXG4gICAgc3RvcCgpIHtcbiAgICAgICAgdGhpcy5fcGxheWluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLl90aW1lID0gMDtcbiAgICB9XG5cbiAgICBwYXVzZSgpIHtcbiAgICAgICAgdGhpcy5fcGxheWluZyA9IGZhbHNlO1xuICAgIH1cblxuICAgIHJlc3VtZSgpIHtcbiAgICAgICAgdGhpcy5fcGxheWluZyA9IHRydWU7XG4gICAgfVxuXG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMuX3RpbWUgPSAwO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgQW5pbUNsaXAgfTtcbiJdLCJuYW1lcyI6WyJBbmltQ2xpcCIsImNvbnN0cnVjdG9yIiwidHJhY2siLCJ0aW1lIiwic3BlZWQiLCJwbGF5aW5nIiwibG9vcCIsImV2ZW50SGFuZGxlciIsIl9uYW1lIiwibmFtZSIsIl90cmFjayIsIl9zbmFwc2hvdCIsIkFuaW1TbmFwc2hvdCIsIl9wbGF5aW5nIiwiX3RpbWUiLCJfc3BlZWQiLCJfbG9vcCIsIl9ibGVuZFdlaWdodCIsIl9ibGVuZE9yZGVyIiwiX2V2ZW50SGFuZGxlciIsImFsaWduQ3Vyc29yVG9DdXJyZW50VGltZSIsInNuYXBzaG90Iiwic2lnbkNoYW5nZWQiLCJNYXRoIiwic2lnbiIsImJsZW5kV2VpZ2h0IiwiYmxlbmRPcmRlciIsImV2ZW50Q3Vyc29yIiwidmFsdWUiLCJfZXZlbnRDdXJzb3IiLCJldmVudEN1cnNvckVuZCIsImlzUmV2ZXJzZSIsImV2ZW50cyIsImxlbmd0aCIsIm5leHRFdmVudCIsIm5leHRFdmVudEFoZWFkT2ZUaW1lIiwibmV4dEV2ZW50QmVoaW5kVGltZSIsImR1cmF0aW9uIiwicmVzZXRFdmVudEN1cnNvciIsIm1vdmVFdmVudEN1cnNvciIsImNsaXBGcmFtZVRpbWUiLCJmcmFtZUVuZFRpbWUiLCJldmVudEZyYW1lIiwic3RhcnQiLCJlbmQiLCJyZXNpZHVhbCIsImZpcmVOZXh0RXZlbnQiLCJmaXJlIiwiX2V4dGVuZHMiLCJmaXJlTmV4dEV2ZW50SW5GcmFtZSIsImZyYW1lU3RhcnRUaW1lIiwiYWN0aXZlRXZlbnRzRm9yRnJhbWUiLCJpbml0aWFsQ3Vyc29yIiwiYWJzIiwicHJvZ3Jlc3NGb3JUaW1lIiwiX3VwZGF0ZSIsImRlbHRhVGltZSIsInBhdXNlIiwiZXZhbCIsInBsYXkiLCJzdG9wIiwicmVzdW1lIiwicmVzZXQiXSwibWFwcGluZ3MiOiI7OztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1BLFFBQVEsQ0FBQztBQU9YO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDSUMsRUFBQUEsV0FBV0EsQ0FBQ0MsS0FBSyxFQUFFQyxJQUFJLEVBQUVDLEtBQUssRUFBRUMsT0FBTyxFQUFFQyxJQUFJLEVBQUVDLFlBQVksRUFBRTtBQUN6RCxJQUFBLElBQUksQ0FBQ0MsS0FBSyxHQUFHTixLQUFLLENBQUNPLElBQUksQ0FBQztJQUN4QixJQUFJLENBQUNDLE1BQU0sR0FBR1IsS0FBSyxDQUFBO0FBQ25CLElBQUEsSUFBSSxDQUFDUyxTQUFTLEdBQUcsSUFBSUMsWUFBWSxDQUFDVixLQUFLLENBQUMsQ0FBQTtJQUN4QyxJQUFJLENBQUNXLFFBQVEsR0FBR1IsT0FBTyxDQUFBO0FBQ3ZCLElBQUEsSUFBSSxDQUFDUyxLQUFLLEdBQUdYLElBQUksQ0FBQztBQUNsQixJQUFBLElBQUksQ0FBQ1ksTUFBTSxHQUFHWCxLQUFLLENBQUM7QUFDcEIsSUFBQSxJQUFJLENBQUNZLEtBQUssR0FBR1YsSUFBSSxDQUFDO0FBQ2xCLElBQUEsSUFBSSxDQUFDVyxZ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
