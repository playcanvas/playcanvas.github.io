/**
 * @license
 * PlayCanvas Engine v1.59.0-preview revision 797466563 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { TRACEID_SHADER_ALLOC } from '../../core/constants.js';
import { Debug } from '../../core/debug.js';
import { Preprocessor } from '../../core/preprocessor.js';

let id = 0;

class Shader {

  constructor(graphicsDevice, definition) {
    this.meshUniformBufferFormat = void 0;
    this.meshBindGroupFormat = void 0;
    this.id = id++;
    this.device = graphicsDevice;
    this.definition = definition;
    this.name = definition.name || 'Untitled';
    Debug.assert(definition.vshader, 'No vertex shader has been specified when creating a shader.');
    Debug.assert(definition.fshader, 'No fragment shader has been specified when creating a shader.');

    definition.vshader = Preprocessor.run(definition.vshader);
    definition.fshader = Preprocessor.run(definition.fshader);
    this.init();
    this.impl = graphicsDevice.createShaderImpl(this);
    Debug.trace(TRACEID_SHADER_ALLOC, `Alloc: Id ${this.id} ${this.name}`, {
      instance: this
    });
  }

  init() {
    this.ready = false;
    this.failed = false;
  }

  destroy() {
    Debug.trace(TRACEID_SHADER_ALLOC, `DeAlloc: Id ${this.id} ${this.name}`);
    this.device.onDestroyShader(this);
    this.impl.destroy(this);
  }

  loseContext() {
    this.init();
    this.impl.loseContext();
  }
  restoreContext() {
    this.impl.restoreContext(this.device, this);
  }
}

export { Shader };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhZGVyLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvcGxhdGZvcm0vZ3JhcGhpY3Mvc2hhZGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRSQUNFSURfU0hBREVSX0FMTE9DIH0gZnJvbSAnLi4vLi4vY29yZS9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgRGVidWcgfSBmcm9tICcuLi8uLi9jb3JlL2RlYnVnLmpzJztcbmltcG9ydCB7IFByZXByb2Nlc3NvciB9IGZyb20gJy4uLy4uL2NvcmUvcHJlcHJvY2Vzc29yLmpzJztcblxubGV0IGlkID0gMDtcblxuLyoqXG4gKiBBIHNoYWRlciBpcyBhIHByb2dyYW0gdGhhdCBpcyByZXNwb25zaWJsZSBmb3IgcmVuZGVyaW5nIGdyYXBoaWNhbCBwcmltaXRpdmVzIG9uIGEgZGV2aWNlJ3NcbiAqIGdyYXBoaWNzIHByb2Nlc3Nvci4gVGhlIHNoYWRlciBpcyBnZW5lcmF0ZWQgZnJvbSBhIHNoYWRlciBkZWZpbml0aW9uLiBUaGlzIHNoYWRlciBkZWZpbml0aW9uXG4gKiBzcGVjaWZpZXMgdGhlIGNvZGUgZm9yIHByb2Nlc3NpbmcgdmVydGljZXMgYW5kIGZyYWdtZW50cyBwcm9jZXNzZWQgYnkgdGhlIEdQVS4gVGhlIGxhbmd1YWdlIG9mXG4gKiB0aGUgY29kZSBpcyBHTFNMIChvciBtb3JlIHNwZWNpZmljYWxseSBFU1NMLCB0aGUgT3BlbkdMIEVTIFNoYWRpbmcgTGFuZ3VhZ2UpLiBUaGUgc2hhZGVyXG4gKiBkZWZpbml0aW9uIGFsc28gZGVzY3JpYmVzIGhvdyB0aGUgUGxheUNhbnZhcyBlbmdpbmUgc2hvdWxkIG1hcCB2ZXJ0ZXggYnVmZmVyIGVsZW1lbnRzIG9udG8gdGhlXG4gKiBhdHRyaWJ1dGVzIHNwZWNpZmllZCBpbiB0aGUgdmVydGV4IHNoYWRlciBjb2RlLlxuICovXG5jbGFzcyBTaGFkZXIge1xuICAgIC8qKlxuICAgICAqIEZvcm1hdCBvZiB0aGUgdW5pZm9ybSBidWZmZXIgZm9yIG1lc2ggYmluZCBncm91cC5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtpbXBvcnQoJy4vdW5pZm9ybS1idWZmZXItZm9ybWF0LmpzJykuVW5pZm9ybUJ1ZmZlckZvcm1hdH1cbiAgICAgKi9cbiAgICBtZXNoVW5pZm9ybUJ1ZmZlckZvcm1hdDtcblxuICAgIC8qKlxuICAgICAqIEZvcm1hdCBvZiB0aGUgYmluZCBncm91cCBmb3IgdGhlIG1lc2ggYmluZCBncm91cC5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtpbXBvcnQoJy4vYmluZC1ncm91cC1mb3JtYXQuanMnKS5CaW5kR3JvdXBGb3JtYXR9XG4gICAgICovXG4gICAgbWVzaEJpbmRHcm91cEZvcm1hdDtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgU2hhZGVyIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4vZ3JhcGhpY3MtZGV2aWNlLmpzJykuR3JhcGhpY3NEZXZpY2V9IGdyYXBoaWNzRGV2aWNlIC0gVGhlIGdyYXBoaWNzIGRldmljZVxuICAgICAqIHVzZWQgdG8gbWFuYWdlIHRoaXMgc2hhZGVyLlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBkZWZpbml0aW9uIC0gVGhlIHNoYWRlciBkZWZpbml0aW9uIGZyb20gd2hpY2ggdG8gYnVpbGQgdGhlIHNoYWRlci5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2RlZmluaXRpb24ubmFtZV0gLSBUaGUgbmFtZSBvZiB0aGUgc2hhZGVyLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0PHN0cmluZywgc3RyaW5nPn0gZGVmaW5pdGlvbi5hdHRyaWJ1dGVzIC0gT2JqZWN0IGRldGFpbGluZyB0aGUgbWFwcGluZyBvZlxuICAgICAqIHZlcnRleCBzaGFkZXIgYXR0cmlidXRlIG5hbWVzIHRvIHNlbWFudGljcyBTRU1BTlRJQ18qLiBUaGlzIGVuYWJsZXMgdGhlIGVuZ2luZSB0byBtYXRjaFxuICAgICAqIHZlcnRleCBidWZmZXIgZGF0YSBhcyBpbnB1dHMgdG8gdGhlIHNoYWRlci5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZGVmaW5pdGlvbi52c2hhZGVyIC0gVmVydGV4IHNoYWRlciBzb3VyY2UgKEdMU0wgY29kZSkuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtkZWZpbml0aW9uLmZzaGFkZXJdIC0gRnJhZ21lbnQgc2hhZGVyIHNvdXJjZSAoR0xTTCBjb2RlKS4gT3B0aW9uYWwgd2hlblxuICAgICAqIHVzZVRyYW5zZm9ybUZlZWRiYWNrIGlzIHNwZWNpZmllZC5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtkZWZpbml0aW9uLnVzZVRyYW5zZm9ybUZlZWRiYWNrXSAtIFNwZWNpZmllcyB0aGF0IHRoaXMgc2hhZGVyIG91dHB1dHNcbiAgICAgKiBwb3N0LVZTIGRhdGEgdG8gYSBidWZmZXIuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiAvLyBDcmVhdGUgYSBzaGFkZXIgdGhhdCByZW5kZXJzIHByaW1pdGl2ZXMgd2l0aCBhIHNvbGlkIHJlZCBjb2xvclxuICAgICAqIHZhciBzaGFkZXJEZWZpbml0aW9uID0ge1xuICAgICAqICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICogICAgICAgICBhUG9zaXRpb246IHBjLlNFTUFOVElDX1BPU0lUSU9OXG4gICAgICogICAgIH0sXG4gICAgICogICAgIHZzaGFkZXI6IFtcbiAgICAgKiAgICAgICAgIFwiYXR0cmlidXRlIHZlYzMgYVBvc2l0aW9uO1wiLFxuICAgICAqICAgICAgICAgXCJcIixcbiAgICAgKiAgICAgICAgIFwidm9pZCBtYWluKHZvaWQpXCIsXG4gICAgICogICAgICAgICBcIntcIixcbiAgICAgKiAgICAgICAgIFwiICAgIGdsX1Bvc2l0aW9uID0gdmVjNChhUG9zaXRpb24sIDEuMCk7XCIsXG4gICAgICogICAgICAgICBcIn1cIlxuICAgICAqICAgICBdLmpvaW4oXCJcXG5cIiksXG4gICAgICogICAgIGZzaGFkZXI6IFtcbiAgICAgKiAgICAgICAgIFwicHJlY2lzaW9uIFwiICsgZ3JhcGhpY3NEZXZpY2UucHJlY2lzaW9uICsgXCIgZmxvYXQ7XCIsXG4gICAgICogICAgICAgICBcIlwiLFxuICAgICAqICAgICAgICAgXCJ2b2lkIG1haW4odm9pZClcIixcbiAgICAgKiAgICAgICAgIFwie1wiLFxuICAgICAqICAgICAgICAgXCIgICAgZ2xfRnJhZ0NvbG9yID0gdmVjNCgxLjAsIDAuMCwgMC4wLCAxLjApO1wiLFxuICAgICAqICAgICAgICAgXCJ9XCJcbiAgICAgKiAgICAgXS5qb2luKFwiXFxuXCIpXG4gICAgICogfTtcbiAgICAgKlxuICAgICAqIHZhciBzaGFkZXIgPSBuZXcgcGMuU2hhZGVyKGdyYXBoaWNzRGV2aWNlLCBzaGFkZXJEZWZpbml0aW9uKTtcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihncmFwaGljc0RldmljZSwgZGVmaW5pdGlvbikge1xuICAgICAgICB0aGlzLmlkID0gaWQrKztcbiAgICAgICAgdGhpcy5kZXZpY2UgPSBncmFwaGljc0RldmljZTtcbiAgICAgICAgdGhpcy5kZWZpbml0aW9uID0gZGVmaW5pdGlvbjtcbiAgICAgICAgdGhpcy5uYW1lID0gZGVmaW5pdGlvbi5uYW1lIHx8ICdVbnRpdGxlZCc7XG5cbiAgICAgICAgRGVidWcuYXNzZXJ0KGRlZmluaXRpb24udnNoYWRlciwgJ05vIHZlcnRleCBzaGFkZXIgaGFzIGJlZW4gc3BlY2lmaWVkIHdoZW4gY3JlYXRpbmcgYSBzaGFkZXIuJyk7XG4gICAgICAgIERlYnVnLmFzc2VydChkZWZpbml0aW9uLmZzaGFkZXIsICdObyBmcmFnbWVudCBzaGFkZXIgaGFzIGJlZW4gc3BlY2lmaWVkIHdoZW4gY3JlYXRpbmcgYSBzaGFkZXIuJyk7XG5cbiAgICAgICAgLy8gcHJlLXByb2Nlc3Mgc2hhZGVyIHNvdXJjZXNcbiAgICAgICAgZGVmaW5pdGlvbi52c2hhZGVyID0gUHJlcHJvY2Vzc29yLnJ1bihkZWZpbml0aW9uLnZzaGFkZXIpO1xuICAgICAgICBkZWZpbml0aW9uLmZzaGFkZXIgPSBQcmVwcm9jZXNzb3IucnVuKGRlZmluaXRpb24uZnNoYWRlcik7XG5cbiAgICAgICAgdGhpcy5pbml0KCk7XG5cbiAgICAgICAgdGhpcy5pbXBsID0gZ3JhcGhpY3NEZXZpY2UuY3JlYXRlU2hhZGVySW1wbCh0aGlzKTtcblxuICAgICAgICBEZWJ1Zy50cmFjZShUUkFDRUlEX1NIQURFUl9BTExPQywgYEFsbG9jOiBJZCAke3RoaXMuaWR9ICR7dGhpcy5uYW1lfWAsIHtcbiAgICAgICAgICAgIGluc3RhbmNlOiB0aGlzXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemUgYSBzaGFkZXIgYmFjayB0byBpdHMgZGVmYXVsdCBzdGF0ZS5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgaW5pdCgpIHtcbiAgICAgICAgdGhpcy5yZWFkeSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZhaWxlZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZyZWVzIHJlc291cmNlcyBhc3NvY2lhdGVkIHdpdGggdGhpcyBzaGFkZXIuXG4gICAgICovXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgRGVidWcudHJhY2UoVFJBQ0VJRF9TSEFERVJfQUxMT0MsIGBEZUFsbG9jOiBJZCAke3RoaXMuaWR9ICR7dGhpcy5uYW1lfWApO1xuICAgICAgICB0aGlzLmRldmljZS5vbkRlc3Ryb3lTaGFkZXIodGhpcyk7XG4gICAgICAgIHRoaXMuaW1wbC5kZXN0cm95KHRoaXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhbGxlZCB3aGVuIHRoZSBXZWJHTCBjb250ZXh0IHdhcyBsb3N0LiBJdCByZWxlYXNlcyBhbGwgY29udGV4dCByZWxhdGVkIHJlc291cmNlcy5cbiAgICAgKlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBsb3NlQ29udGV4dCgpIHtcbiAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgICAgIHRoaXMuaW1wbC5sb3NlQ29udGV4dCgpO1xuICAgIH1cblxuICAgIHJlc3RvcmVDb250ZXh0KCkge1xuICAgICAgICB0aGlzLmltcGwucmVzdG9yZUNvbnRleHQodGhpcy5kZXZpY2UsIHRoaXMpO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgU2hhZGVyIH07XG4iXSwibmFtZXMiOlsiaWQiLCJTaGFkZXIiLCJjb25zdHJ1Y3RvciIsImdyYXBoaWNzRGV2aWNlIiwiZGVmaW5pdGlvbiIsIm1lc2hVbmlmb3JtQnVmZmVyRm9ybWF0IiwibWVzaEJpbmRHcm91cEZvcm1hdCIsImRldmljZSIsIm5hbWUiLCJEZWJ1ZyIsImFzc2VydCIsInZzaGFkZXIiLCJmc2hhZGVyIiwiUHJlcHJvY2Vzc29yIiwicnVuIiwiaW5pdCIsImltcGwiLCJjcmVhdGVTaGFkZXJJbXBsIiwidHJhY2UiLCJUUkFDRUlEX1NIQURFUl9BTExPQyIsImluc3RhbmNlIiwicmVhZHkiLCJmYWlsZWQiLCJkZXN0cm95Iiwib25EZXN0cm95U2hhZGVyIiwibG9zZUNvbnRleHQiLCJyZXN0b3JlQ29udGV4dCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBSUEsSUFBSUEsRUFBRSxHQUFHLENBQUMsQ0FBQTs7QUFVVixNQUFNQyxNQUFNLENBQUM7O0FBd0RUQyxFQUFBQSxXQUFXLENBQUNDLGNBQWMsRUFBRUMsVUFBVSxFQUFFO0FBQUEsSUFBQSxJQUFBLENBbER4Q0MsdUJBQXVCLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0FPdkJDLG1CQUFtQixHQUFBLEtBQUEsQ0FBQSxDQUFBO0FBNENmLElBQUEsSUFBSSxDQUFDTixFQUFFLEdBQUdBLEVBQUUsRUFBRSxDQUFBO0lBQ2QsSUFBSSxDQUFDTyxNQUFNLEdBQUdKLGNBQWMsQ0FBQTtJQUM1QixJQUFJLENBQUNDLFVBQVUsR0FBR0EsVUFBVSxDQUFBO0FBQzVCLElBQUEsSUFBSSxDQUFDSSxJQUFJLEdBQUdKLFVBQVUsQ0FBQ0ksSUFBSSxJQUFJLFVBQVUsQ0FBQTtJQUV6Q0MsS0FBSyxDQUFDQyxNQUFNLENBQUNOLFVBQVUsQ0FBQ08sT0FBTyxFQUFFLDZEQUE2RCxDQUFDLENBQUE7SUFDL0ZGLEtBQUssQ0FBQ0MsTUFBTSxDQUFDTixVQUFVLENBQUNRLE9BQU8sRUFBRSwrREFBK0QsQ0FBQyxDQUFBOztJQUdqR1IsVUFBVSxDQUFDTyxPQUFPLEdBQUdFLFlBQVksQ0FBQ0MsR0FBRyxDQUFDVixVQUFVLENBQUNPLE9BQU8sQ0FBQyxDQUFBO0lBQ3pEUCxVQUFVLENBQUNRLE9BQU8sR0FBR0MsWUFBWSxDQUFDQyxHQUFHLENBQUNWLFVBQVUsQ0FBQ1EsT0FBTyxDQUFDLENBQUE7SUFFekQsSUFBSSxDQUFDRyxJQUFJLEVBQUUsQ0FBQTtJQUVYLElBQUksQ0FBQ0MsSUFBSSxHQUFHYixjQUFjLENBQUNjLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFBO0FBRWpEUixJQUFBQSxLQUFLLENBQUNTLEtBQUssQ0FBQ0Msb0JBQW9CLEVBQUcsQ0FBWSxVQUFBLEVBQUEsSUFBSSxDQUFDbkIsRUFBRyxDQUFHLENBQUEsRUFBQSxJQUFJLENBQUNRLElBQUssRUFBQyxFQUFFO0FBQ25FWSxNQUFBQSxRQUFRLEVBQUUsSUFBQTtBQUNkLEtBQUMsQ0FBQyxDQUFBO0FBQ04sR0FBQTs7QUFPQUwsRUFBQUEsSUFBSSxHQUFHO0lBQ0gsSUFBSSxDQUFDTSxLQUFLLEdBQUcsS0FBSyxDQUFBO0lBQ2xCLElBQUksQ0FBQ0MsTUFBTSxHQUFHLEtBQUssQ0FBQTtBQUN2QixHQUFBOztBQUtBQyxFQUFBQSxPQUFPLEdBQUc7QUFDTmQsSUFBQUEsS0FBSyxDQUFDUyxLQUFLLENBQUNDLG9CQUFvQixFQUFHLENBQWMsWUFBQSxFQUFBLElBQUksQ0FBQ25CLEVBQUcsQ0FBRyxDQUFBLEVBQUEsSUFBSSxDQUFDUSxJQUFLLEVBQUMsQ0FBQyxDQUFBO0FBQ3hFLElBQUEsSUFBSSxDQUFDRCxNQUFNLENBQUNpQixlQUFlLENBQUMsSUFBSSxDQUFDLENBQUE7QUFDakMsSUFBQSxJQUFJLENBQUNSLElBQUksQ0FBQ08sT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQzNCLEdBQUE7O0FBT0FFLEVBQUFBLFdBQVcsR0FBRztJQUNWLElBQUksQ0FBQ1YsSUFBSSxFQUFFLENBQUE7QUFDWCxJQUFBLElBQUksQ0FBQ0MsSUFBSSxDQUFDUyxXQUFXLEVBQUUsQ0FBQTtBQUMzQixHQUFBO0FBRUFDLEVBQUFBLGNBQWMsR0FBRztJQUNiLElBQUksQ0FBQ1YsSUFBSSxDQUFDVSxjQUFjLENBQUMsSUFBSSxDQUFDbkIsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFBO0FBQy9DLEdBQUE7QUFDSjs7OzsifQ==
