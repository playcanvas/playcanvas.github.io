/**
 * @license
 * PlayCanvas Engine v1.58.0-preview revision 1fec26519 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { BLENDMODE_ONE, BLENDMODE_ZERO, BLENDEQUATION_ADD, CULLFACE_BACK, FUNC_LESSEQUAL, BLENDEQUATION_MAX, BLENDEQUATION_MIN, BLENDMODE_DST_COLOR, BLENDMODE_ONE_MINUS_DST_COLOR, BLENDMODE_SRC_COLOR, BLENDMODE_SRC_ALPHA, BLENDMODE_ONE_MINUS_SRC_ALPHA } from '../../platform/graphics/constants.js';
import { BLEND_MAX, BLEND_MIN, BLEND_MULTIPLICATIVE, BLEND_SCREEN, BLEND_MULTIPLICATIVE2X, BLEND_ADDITIVEALPHA, BLEND_ADDITIVE, BLEND_PREMULTIPLIED, BLEND_NORMAL, BLEND_NONE } from '../constants.js';
import { Debug } from '../../core/debug.js';
import { getDefaultMaterial } from './default-material.js';
import { ShaderProcessorOptions } from '../../platform/graphics/shader-processor-options.js';
import { getProgramLibrary } from '../shader-lib/get-program-library.js';

let id = 0;

class Material {

  constructor() {
    this._shader = null;
    this.meshInstances = [];
    this.name = 'Untitled';
    this.id = id++;
    this.variants = {};
    this.parameters = {};

    this.alphaTest = 0;
    this.alphaToCoverage = false;
    this.blend = false;
    this.blendSrc = BLENDMODE_ONE;
    this.blendDst = BLENDMODE_ZERO;
    this.blendEquation = BLENDEQUATION_ADD;
    this.separateAlphaBlend = false;
    this.blendSrcAlpha = BLENDMODE_ONE;
    this.blendDstAlpha = BLENDMODE_ZERO;
    this.blendAlphaEquation = BLENDEQUATION_ADD;
    this.cull = CULLFACE_BACK;
    this.depthTest = true;
    this.depthFunc = FUNC_LESSEQUAL;
    this.depthWrite = true;
    this.stencilFront = null;
    this.stencilBack = null;
    this.depthBias = 0;
    this.slopeDepthBias = 0;
    this.redWrite = true;
    this.greenWrite = true;
    this.blueWrite = true;
    this.alphaWrite = true;
    this._shaderVersion = 0;
    this._scene = null;
    this._dirtyBlend = false;
    this.dirty = true;
  }
  set shader(shader) {
    this._shader = shader;
  }
  get shader() {
    return this._shader;
  }

  get transparent() {
    return this.blend;
  }
  set blendType(type) {
    let blend = true;
    switch (type) {
      case BLEND_NONE:
        blend = false;
        this.blendSrc = BLENDMODE_ONE;
        this.blendDst = BLENDMODE_ZERO;
        this.blendEquation = BLENDEQUATION_ADD;
        break;
      case BLEND_NORMAL:
        this.blendSrc = BLENDMODE_SRC_ALPHA;
        this.blendDst = BLENDMODE_ONE_MINUS_SRC_ALPHA;
        this.blendEquation = BLENDEQUATION_ADD;
        break;
      case BLEND_PREMULTIPLIED:
        this.blendSrc = BLENDMODE_ONE;
        this.blendDst = BLENDMODE_ONE_MINUS_SRC_ALPHA;
        this.blendEquation = BLENDEQUATION_ADD;
        break;
      case BLEND_ADDITIVE:
        this.blendSrc = BLENDMODE_ONE;
        this.blendDst = BLENDMODE_ONE;
        this.blendEquation = BLENDEQUATION_ADD;
        break;
      case BLEND_ADDITIVEALPHA:
        this.blendSrc = BLENDMODE_SRC_ALPHA;
        this.blendDst = BLENDMODE_ONE;
        this.blendEquation = BLENDEQUATION_ADD;
        break;
      case BLEND_MULTIPLICATIVE2X:
        this.blendSrc = BLENDMODE_DST_COLOR;
        this.blendDst = BLENDMODE_SRC_COLOR;
        this.blendEquation = BLENDEQUATION_ADD;
        break;
      case BLEND_SCREEN:
        this.blendSrc = BLENDMODE_ONE_MINUS_DST_COLOR;
        this.blendDst = BLENDMODE_ONE;
        this.blendEquation = BLENDEQUATION_ADD;
        break;
      case BLEND_MULTIPLICATIVE:
        this.blendSrc = BLENDMODE_DST_COLOR;
        this.blendDst = BLENDMODE_ZERO;
        this.blendEquation = BLENDEQUATION_ADD;
        break;
      case BLEND_MIN:
        this.blendSrc = BLENDMODE_ONE;
        this.blendDst = BLENDMODE_ONE;
        this.blendEquation = BLENDEQUATION_MIN;
        break;
      case BLEND_MAX:
        this.blendSrc = BLENDMODE_ONE;
        this.blendDst = BLENDMODE_ONE;
        this.blendEquation = BLENDEQUATION_MAX;
        break;
    }
    if (this.blend !== blend) {
      this.blend = blend;
      if (this._scene) {
        this._scene.layers._dirtyBlend = true;
      } else {
        this._dirtyBlend = true;
      }
    }
    this._updateMeshInstanceKeys();
  }
  get blendType() {
    if (!this.blend) {
      return BLEND_NONE;
    }
    if (this.blendSrc === BLENDMODE_SRC_ALPHA && this.blendDst === BLENDMODE_ONE_MINUS_SRC_ALPHA && this.blendEquation === BLENDEQUATION_ADD) {
      return BLEND_NORMAL;
    }
    if (this.blendSrc === BLENDMODE_ONE && this.blendDst === BLENDMODE_ONE && this.blendEquation === BLENDEQUATION_ADD) {
      return BLEND_ADDITIVE;
    }
    if (this.blendSrc === BLENDMODE_SRC_ALPHA && this.blendDst === BLENDMODE_ONE && this.blendEquation === BLENDEQUATION_ADD) {
      return BLEND_ADDITIVEALPHA;
    }
    if (this.blendSrc === BLENDMODE_DST_COLOR && this.blendDst === BLENDMODE_SRC_COLOR && this.blendEquation === BLENDEQUATION_ADD) {
      return BLEND_MULTIPLICATIVE2X;
    }
    if (this.blendSrc === BLENDMODE_ONE_MINUS_DST_COLOR && this.blendDst === BLENDMODE_ONE && this.blendEquation === BLENDEQUATION_ADD) {
      return BLEND_SCREEN;
    }
    if (this.blendSrc === BLENDMODE_ONE && this.blendDst === BLENDMODE_ONE && this.blendEquation === BLENDEQUATION_MIN) {
      return BLEND_MIN;
    }
    if (this.blendSrc === BLENDMODE_ONE && this.blendDst === BLENDMODE_ONE && this.blendEquation === BLENDEQUATION_MAX) {
      return BLEND_MAX;
    }
    if (this.blendSrc === BLENDMODE_DST_COLOR && this.blendDst === BLENDMODE_ZERO && this.blendEquation === BLENDEQUATION_ADD) {
      return BLEND_MULTIPLICATIVE;
    }
    if (this.blendSrc === BLENDMODE_ONE && this.blendDst === BLENDMODE_ONE_MINUS_SRC_ALPHA && this.blendEquation === BLENDEQUATION_ADD) {
      return BLEND_PREMULTIPLIED;
    }
    return BLEND_NORMAL;
  }

  copy(source) {
    this.name = source.name;
    this._shader = source._shader;

    this.alphaTest = source.alphaTest;
    this.alphaToCoverage = source.alphaToCoverage;
    this.blend = source.blend;
    this.blendSrc = source.blendSrc;
    this.blendDst = source.blendDst;
    this.blendEquation = source.blendEquation;
    this.separateAlphaBlend = source.separateAlphaBlend;
    this.blendSrcAlpha = source.blendSrcAlpha;
    this.blendDstAlpha = source.blendDstAlpha;
    this.blendAlphaEquation = source.blendAlphaEquation;
    this.cull = source.cull;
    this.depthTest = source.depthTest;
    this.depthFunc = source.depthFunc;
    this.depthWrite = source.depthWrite;
    this.depthBias = source.depthBias;
    this.slopeDepthBias = source.slopeDepthBias;
    if (source.stencilFront) this.stencilFront = source.stencilFront.clone();
    if (source.stencilBack) {
      if (source.stencilFront === source.stencilBack) {
        this.stencilBack = this.stencilFront;
      } else {
        this.stencilBack = source.stencilBack.clone();
      }
    }
    this.redWrite = source.redWrite;
    this.greenWrite = source.greenWrite;
    this.blueWrite = source.blueWrite;
    this.alphaWrite = source.alphaWrite;
    return this;
  }

  clone() {
    const clone = new this.constructor();
    return clone.copy(this);
  }
  _updateMeshInstanceKeys() {
    const meshInstances = this.meshInstances;
    for (let i = 0; i < meshInstances.length; i++) {
      meshInstances[i].updateKey();
    }
  }
  updateUniforms(device, scene) {}
  getShaderVariant(device, scene, objDefs, staticLightList, pass, sortedLights, viewUniformFormat, viewBindGroupFormat) {
    Debug.assert(this._shader, 'Material does not have a shader set', this);

    const key = `shader-id-${this._shader.id}`;
    const shaderDefinition = this._shader.definition;
    const materialGenerator = {
      generateKey: function (options) {
        return key;
      },
      createShaderDefinition: function (device, options) {
        return shaderDefinition;
      }
    };

    const libraryModuleName = 'shader';
    const library = getProgramLibrary(device);
    Debug.assert(!library.isRegistered(libraryModuleName));
    library.register(libraryModuleName, materialGenerator);

    const processingOptions = new ShaderProcessorOptions(viewUniformFormat, viewBindGroupFormat);
    const variant = library.getProgram(libraryModuleName, {}, processingOptions);

    library.unregister(libraryModuleName);
    return variant;
  }

  update() {
    this.dirty = true;
    if (this._shader) this._shader.failed = false;
  }

  clearParameters() {
    this.parameters = {};
  }
  getParameters() {
    return this.parameters;
  }
  clearVariants() {
    this.variants = {};

    const meshInstances = this.meshInstances;
    const count = meshInstances.length;
    for (let i = 0; i < count; i++) {
      meshInstances[i].clearShaders();
    }
  }

  getParameter(name) {
    return this.parameters[name];
  }

  setParameter(name, data) {
    if (data === undefined && typeof name === 'object') {
      const uniformObject = name;
      if (uniformObject.length) {
        for (let i = 0; i < uniformObject.length; i++) {
          this.setParameter(uniformObject[i]);
        }
        return;
      }
      name = uniformObject.name;
      data = uniformObject.value;
    }
    const param = this.parameters[name];
    if (param) {
      param.data = data;
    } else {
      this.parameters[name] = {
        scopeId: null,
        data: data
      };
    }
  }

  deleteParameter(name) {
    if (this.parameters[name]) {
      delete this.parameters[name];
    }
  }

  setParameters(device, names) {
    const parameters = this.parameters;
    if (names === undefined) names = parameters;
    for (const paramName in names) {
      const parameter = parameters[paramName];
      if (parameter) {
        if (!parameter.scopeId) {
          parameter.scopeId = device.scope.resolve(paramName);
        }
        parameter.scopeId.setValue(parameter.data);
      }
    }
  }

  destroy() {
    this.variants = {};
    this._shader = null;
    for (let i = 0; i < this.meshInstances.length; i++) {
      const meshInstance = this.meshInstances[i];
      meshInstance.clearShaders();
      meshInstance._material = null;
      if (meshInstance.mesh) {
        const defaultMaterial = getDefaultMaterial(meshInstance.mesh.device);
        if (this !== defaultMaterial) {
          meshInstance.material = defaultMaterial;
        }
      } else {
        Debug.warn('pc.Material: MeshInstance.mesh is null, default material cannot be assigned to the MeshInstance');
      }
    }
    this.meshInstances.length = 0;
  }

  addMeshInstanceRef(meshInstance) {
    this.meshInstances.push(meshInstance);
  }

  removeMeshInstanceRef(meshInstance) {
    const meshInstances = this.meshInstances;
    const i = meshInstances.indexOf(meshInstance);
    if (i !== -1) {
      meshInstances.splice(i, 1);
    }
  }
}

export { Material };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWF0ZXJpYWwuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9zY2VuZS9tYXRlcmlhbHMvbWF0ZXJpYWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBCTEVORE1PREVfWkVSTywgQkxFTkRNT0RFX09ORSwgQkxFTkRNT0RFX1NSQ19DT0xPUixcbiAgICBCTEVORE1PREVfRFNUX0NPTE9SLCBCTEVORE1PREVfT05FX01JTlVTX0RTVF9DT0xPUiwgQkxFTkRNT0RFX1NSQ19BTFBIQSxcbiAgICBCTEVORE1PREVfT05FX01JTlVTX1NSQ19BTFBIQSxcbiAgICBCTEVOREVRVUFUSU9OX0FERCxcbiAgICBCTEVOREVRVUFUSU9OX01JTiwgQkxFTkRFUVVBVElPTl9NQVgsXG4gICAgQ1VMTEZBQ0VfQkFDSyxcbiAgICBGVU5DX0xFU1NFUVVBTFxufSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9jb25zdGFudHMuanMnO1xuXG5pbXBvcnQge1xuICAgIEJMRU5EX0FERElUSVZFLCBCTEVORF9OT1JNQUwsIEJMRU5EX05PTkUsIEJMRU5EX1BSRU1VTFRJUExJRUQsXG4gICAgQkxFTkRfTVVMVElQTElDQVRJVkUsIEJMRU5EX0FERElUSVZFQUxQSEEsIEJMRU5EX01VTFRJUExJQ0FUSVZFMlgsIEJMRU5EX1NDUkVFTixcbiAgICBCTEVORF9NSU4sIEJMRU5EX01BWFxufSBmcm9tICcuLi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgRGVidWcgfSBmcm9tICcuLi8uLi9jb3JlL2RlYnVnLmpzJztcbmltcG9ydCB7IGdldERlZmF1bHRNYXRlcmlhbCB9IGZyb20gJy4vZGVmYXVsdC1tYXRlcmlhbC5qcyc7XG5pbXBvcnQgeyBTaGFkZXJQcm9jZXNzb3JPcHRpb25zIH0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3Mvc2hhZGVyLXByb2Nlc3Nvci1vcHRpb25zLmpzJztcbmltcG9ydCB7IGdldFByb2dyYW1MaWJyYXJ5IH0gZnJvbSAnLi4vc2hhZGVyLWxpYi9nZXQtcHJvZ3JhbS1saWJyYXJ5LmpzJztcblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uLy4uL3BsYXRmb3JtL2dyYXBoaWNzL3RleHR1cmUuanMnKS5UZXh0dXJlfSBUZXh0dXJlICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3Mvc2hhZGVyLmpzJykuU2hhZGVyfSBTaGFkZXIgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuLi9tZXNoLWluc3RhbmNlLmpzJykuTWVzaEluc3RhbmNlfSBNZXNoSW5zdGFuY2UgKi9cblxubGV0IGlkID0gMDtcblxuLyoqXG4gKiBBIG1hdGVyaWFsIGRldGVybWluZXMgaG93IGEgcGFydGljdWxhciBtZXNoIGluc3RhbmNlIGlzIHJlbmRlcmVkLiBJdCBzcGVjaWZpZXMgdGhlIHNoYWRlciBhbmRcbiAqIHJlbmRlciBzdGF0ZSB0aGF0IGlzIHNldCBiZWZvcmUgdGhlIG1lc2ggaW5zdGFuY2UgaXMgc3VibWl0dGVkIHRvIHRoZSBncmFwaGljcyBkZXZpY2UuXG4gKlxuICogQHByb3BlcnR5IHtudW1iZXJ9IGFscGhhVGVzdCBUaGUgYWxwaGEgdGVzdCByZWZlcmVuY2UgdmFsdWUgdG8gY29udHJvbCB3aGljaCBmcmFnbWVudHMgYXJlXG4gKiB3cml0dGVuIHRvIHRoZSBjdXJyZW50bHkgYWN0aXZlIHJlbmRlciB0YXJnZXQgYmFzZWQgb24gYWxwaGEgdmFsdWUuIEFsbCBmcmFnbWVudHMgd2l0aCBhbiBhbHBoYVxuICogdmFsdWUgb2YgbGVzcyB0aGFuIHRoZSBhbHBoYVRlc3QgcmVmZXJlbmNlIHZhbHVlIHdpbGwgYmUgZGlzY2FyZGVkLiBhbHBoYVRlc3QgZGVmYXVsdHMgdG8gMCAoYWxsXG4gKiBmcmFnbWVudHMgcGFzcykuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGFscGhhVG9Db3ZlcmFnZSBFbmFibGVzIG9yIGRpc2FibGVzIGFscGhhIHRvIGNvdmVyYWdlIChXZWJHTDIgb25seSkuIFdoZW5cbiAqIGVuYWJsZWQsIGFuZCBpZiBoYXJkd2FyZSBhbnRpLWFsaWFzaW5nIGlzIG9uLCBsaW1pdGVkIG9yZGVyLWluZGVwZW5kZW50IHRyYW5zcGFyZW5jeSBjYW4gYmVcbiAqIGFjaGlldmVkLiBRdWFsaXR5IGRlcGVuZHMgb24gdGhlIG51bWJlciBvZiBNU0FBIHNhbXBsZXMgb2YgdGhlIGN1cnJlbnQgcmVuZGVyIHRhcmdldC5cbiAqIEl0IGNhbiBuaWNlbHkgc29mdGVuIGVkZ2VzIG9mIG90aGVyd2lzZSBzaGFycCBhbHBoYSBjdXRvdXRzLCBidXQgaXNuJ3QgcmVjb21tZW5kZWQgZm9yIGxhcmdlXG4gKiBhcmVhIHNlbWktdHJhbnNwYXJlbnQgc3VyZmFjZXMuIE5vdGUsIHRoYXQgeW91IGRvbid0IG5lZWQgdG8gZW5hYmxlIGJsZW5kaW5nIHRvIG1ha2UgYWxwaGEgdG9cbiAqIGNvdmVyYWdlIHdvcmsuIEl0IHdpbGwgd29yayB3aXRob3V0IGl0LCBqdXN0IGxpa2UgYWxwaGFUZXN0LlxuICogQHByb3BlcnR5IHtib29sZWFufSBhbHBoYVdyaXRlIElmIHRydWUsIHRoZSBhbHBoYSBjb21wb25lbnQgb2YgZnJhZ21lbnRzIGdlbmVyYXRlZCBieSB0aGUgc2hhZGVyXG4gKiBvZiB0aGlzIG1hdGVyaWFsIGlzIHdyaXR0ZW4gdG8gdGhlIGNvbG9yIGJ1ZmZlciBvZiB0aGUgY3VycmVudGx5IGFjdGl2ZSByZW5kZXIgdGFyZ2V0LiBJZiBmYWxzZSxcbiAqIHRoZSBhbHBoYSBjb21wb25lbnQgd2lsbCBub3QgYmUgd3JpdHRlbi4gRGVmYXVsdHMgdG8gdHJ1ZS5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBibGVuZFR5cGUgQ29udHJvbHMgaG93IHByaW1pdGl2ZXMgYXJlIGJsZW5kZWQgd2hlbiBiZWluZyB3cml0dGVuIHRvIHRoZVxuICogY3VycmVudGx5IGFjdGl2ZSByZW5kZXIgdGFyZ2V0LiBDYW4gYmU6XG4gKlxuICogLSB7QGxpbmsgQkxFTkRfU1VCVFJBQ1RJVkV9OiBTdWJ0cmFjdCB0aGUgY29sb3Igb2YgdGhlIHNvdXJjZSBmcmFnbWVudCBmcm9tIHRoZSBkZXN0aW5hdGlvblxuICogZnJhZ21lbnQgYW5kIHdyaXRlIHRoZSByZXN1bHQgdG8gdGhlIGZyYW1lIGJ1ZmZlci5cbiAqIC0ge0BsaW5rIEJMRU5EX0FERElUSVZFfTogQWRkIHRoZSBjb2xvciBvZiB0aGUgc291cmNlIGZyYWdtZW50IHRvIHRoZSBkZXN0aW5hdGlvbiBmcmFnbWVudCBhbmRcbiAqIHdyaXRlIHRoZSByZXN1bHQgdG8gdGhlIGZyYW1lIGJ1ZmZlci5cbiAqIC0ge0BsaW5rIEJMRU5EX05PUk1BTH06IEVuYWJsZSBzaW1wbGUgdHJhbnNsdWNlbmN5IGZvciBtYXRlcmlhbHMgc3VjaCBhcyBnbGFzcy4gVGhpcyBpc1xuICogZXF1aXZhbGVudCB0byBlbmFibGluZyBhIHNvdXJjZSBibGVuZCBtb2RlIG9mIHtAbGluayBCTEVORE1PREVfU1JDX0FMUEhBfSBhbmQgYSBkZXN0aW5hdGlvblxuICogYmxlbmQgbW9kZSBvZiB7QGxpbmsgQkxFTkRNT0RFX09ORV9NSU5VU19TUkNfQUxQSEF9LlxuICogLSB7QGxpbmsgQkxFTkRfTk9ORX06IERpc2FibGUgYmxlbmRpbmcuXG4gKiAtIHtAbGluayBCTEVORF9QUkVNVUxUSVBMSUVEfTogU2ltaWxhciB0byB7QGxpbmsgQkxFTkRfTk9STUFMfSBleHBlY3QgdGhlIHNvdXJjZSBmcmFnbWVudCBpc1xuICogYXNzdW1lZCB0byBoYXZlIGFscmVhZHkgYmVlbiBtdWx0aXBsaWVkIGJ5IHRoZSBzb3VyY2UgYWxwaGEgdmFsdWUuXG4gKiAtIHtAbGluayBCTEVORF9NVUxUSVBMSUNBVElWRX06IE11bHRpcGx5IHRoZSBjb2xvciBvZiB0aGUgc291cmNlIGZyYWdtZW50IGJ5IHRoZSBjb2xvciBvZiB0aGVcbiAqIGRlc3RpbmF0aW9uIGZyYWdtZW50IGFuZCB3cml0ZSB0aGUgcmVzdWx0IHRvIHRoZSBmcmFtZSBidWZmZXIuXG4gKiAtIHtAbGluayBCTEVORF9BRERJVElWRUFMUEhBfTogU2FtZSBhcyB7QGxpbmsgQkxFTkRfQURESVRJVkV9IGV4Y2VwdCB0aGUgc291cmNlIFJHQiBpc1xuICogbXVsdGlwbGllZCBieSB0aGUgc291cmNlIGFscGhhLlxuICogLSB7QGxpbmsgQkxFTkRfTVVMVElQTElDQVRJVkUyWH06IE11bHRpcGxpZXMgY29sb3JzIGFuZCBkb3VibGVzIHRoZSByZXN1bHQuXG4gKiAtIHtAbGluayBCTEVORF9TQ1JFRU59OiBTb2Z0ZXIgdmVyc2lvbiBvZiBhZGRpdGl2ZS5cbiAqIC0ge0BsaW5rIEJMRU5EX01JTn06IE1pbmltdW0gY29sb3IuIENoZWNrIGFwcC5ncmFwaGljc0RldmljZS5leHRCbGVuZE1pbm1heCBmb3Igc3VwcG9ydC5cbiAqIC0ge0BsaW5rIEJMRU5EX01BWH06IE1heGltdW0gY29sb3IuIENoZWNrIGFwcC5ncmFwaGljc0RldmljZS5leHRCbGVuZE1pbm1heCBmb3Igc3VwcG9ydC5cbiAqXG4gKiBEZWZhdWx0cyB0byB7QGxpbmsgQkxFTkRfTk9ORX0uXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGJsdWVXcml0ZSBJZiB0cnVlLCB0aGUgYmx1ZSBjb21wb25lbnQgb2YgZnJhZ21lbnRzIGdlbmVyYXRlZCBieSB0aGUgc2hhZGVyXG4gKiBvZiB0aGlzIG1hdGVyaWFsIGlzIHdyaXR0ZW4gdG8gdGhlIGNvbG9yIGJ1ZmZlciBvZiB0aGUgY3VycmVudGx5IGFjdGl2ZSByZW5kZXIgdGFyZ2V0LiBJZiBmYWxzZSxcbiAqIHRoZSBibHVlIGNvbXBvbmVudCB3aWxsIG5vdCBiZSB3cml0dGVuLiBEZWZhdWx0cyB0byB0cnVlLlxuICogQHByb3BlcnR5IHtudW1iZXJ9IGN1bGwgQ29udHJvbHMgaG93IHRyaWFuZ2xlcyBhcmUgY3VsbGVkIGJhc2VkIG9uIHRoZWlyIGZhY2UgZGlyZWN0aW9uIHdpdGhcbiAqIHJlc3BlY3QgdG8gdGhlIHZpZXdwb2ludC4gQ2FuIGJlOlxuICpcbiAqIC0ge0BsaW5rIENVTExGQUNFX05PTkV9OiBEbyBub3QgY3VsbCB0cmlhbmdsZXMgYmFzZWQgb24gZmFjZSBkaXJlY3Rpb24uXG4gKiAtIHtAbGluayBDVUxMRkFDRV9CQUNLfTogQ3VsbCB0aGUgYmFjayBmYWNlcyBvZiB0cmlhbmdsZXMgKGRvIG5vdCByZW5kZXIgdHJpYW5nbGVzIGZhY2luZyBhd2F5XG4gKiBmcm9tIHRoZSB2aWV3IHBvaW50KS5cbiAqIC0ge0BsaW5rIENVTExGQUNFX0ZST05UfTogQ3VsbCB0aGUgZnJvbnQgZmFjZXMgb2YgdHJpYW5nbGVzIChkbyBub3QgcmVuZGVyIHRyaWFuZ2xlcyBmYWNpbmdcbiAqIHRvd2FyZHMgdGhlIHZpZXcgcG9pbnQpLlxuICogLSB7QGxpbmsgQ1VMTEZBQ0VfRlJPTlRBTkRCQUNLfTogQ3VsbCBib3RoIGZyb250IGFuZCBiYWNrIGZhY2VzICh0cmlhbmdsZXMgd2lsbCBub3QgYmVcbiAqIHJlbmRlcmVkKS5cbiAqXG4gKiBEZWZhdWx0cyB0byB7QGxpbmsgQ1VMTEZBQ0VfQkFDS30uXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGRlcHRoVGVzdCBJZiB0cnVlLCBmcmFnbWVudHMgZ2VuZXJhdGVkIGJ5IHRoZSBzaGFkZXIgb2YgdGhpcyBtYXRlcmlhbCBhcmVcbiAqIG9ubHkgd3JpdHRlbiB0byB0aGUgY3VycmVudCByZW5kZXIgdGFyZ2V0IGlmIHRoZXkgcGFzcyB0aGUgZGVwdGggdGVzdC4gSWYgZmFsc2UsIGZyYWdtZW50c1xuICogZ2VuZXJhdGVkIGJ5IHRoZSBzaGFkZXIgb2YgdGhpcyBtYXRlcmlhbCBhcmUgd3JpdHRlbiB0byB0aGUgY3VycmVudCByZW5kZXIgdGFyZ2V0IHJlZ2FyZGxlc3Mgb2ZcbiAqIHdoYXQgaXMgaW4gdGhlIGRlcHRoIGJ1ZmZlci4gRGVmYXVsdHMgdG8gdHJ1ZS5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBkZXB0aEZ1bmMgQ29udHJvbHMgaG93IHRoZSBkZXB0aCBvZiBuZXcgZnJhZ21lbnRzIGlzIGNvbXBhcmVkIGFnYWluc3QgdGhlXG4gKiBjdXJyZW50IGRlcHRoIGNvbnRhaW5lZCBpbiB0aGUgZGVwdGggYnVmZmVyLiBDYW4gYmU6XG4gKlxuICogLSB7QGxpbmsgRlVOQ19ORVZFUn06IGRvbid0IGRyYXdcbiAqIC0ge0BsaW5rIEZVTkNfTEVTU306IGRyYXcgaWYgbmV3IGRlcHRoIDwgZGVwdGggYnVmZmVyXG4gKiAtIHtAbGluayBGVU5DX0VRVUFMfTogZHJhdyBpZiBuZXcgZGVwdGggPT0gZGVwdGggYnVmZmVyXG4gKiAtIHtAbGluayBGVU5DX0xFU1NFUVVBTH06IGRyYXcgaWYgbmV3IGRlcHRoIDw9IGRlcHRoIGJ1ZmZlclxuICogLSB7QGxpbmsgRlVOQ19HUkVBVEVSfTogZHJhdyBpZiBuZXcgZGVwdGggPiBkZXB0aCBidWZmZXJcbiAqIC0ge0BsaW5rIEZVTkNfTk9URVFVQUx9OiBkcmF3IGlmIG5ldyBkZXB0aCAhPSBkZXB0aCBidWZmZXJcbiAqIC0ge0BsaW5rIEZVTkNfR1JFQVRFUkVRVUFMfTogZHJhdyBpZiBuZXcgZGVwdGggPj0gZGVwdGggYnVmZmVyXG4gKiAtIHtAbGluayBGVU5DX0FMV0FZU306IGFsd2F5cyBkcmF3XG4gKlxuICogRGVmYXVsdHMgdG8ge0BsaW5rIEZVTkNfTEVTU0VRVUFMfS5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gZGVwdGhXcml0ZSBJZiB0cnVlLCBmcmFnbWVudHMgZ2VuZXJhdGVkIGJ5IHRoZSBzaGFkZXIgb2YgdGhpcyBtYXRlcmlhbCB3cml0ZVxuICogYSBkZXB0aCB2YWx1ZSB0byB0aGUgZGVwdGggYnVmZmVyIG9mIHRoZSBjdXJyZW50bHkgYWN0aXZlIHJlbmRlciB0YXJnZXQuIElmIGZhbHNlLCBubyBkZXB0aFxuICogdmFsdWUgaXMgd3JpdHRlbi4gRGVmYXVsdHMgdG8gdHJ1ZS5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gZ3JlZW5Xcml0ZSBJZiB0cnVlLCB0aGUgZ3JlZW4gY29tcG9uZW50IG9mIGZyYWdtZW50cyBnZW5lcmF0ZWQgYnkgdGhlIHNoYWRlclxuICogb2YgdGhpcyBtYXRlcmlhbCBpcyB3cml0dGVuIHRvIHRoZSBjb2xvciBidWZmZXIgb2YgdGhlIGN1cnJlbnRseSBhY3RpdmUgcmVuZGVyIHRhcmdldC4gSWYgZmFsc2UsXG4gKiB0aGUgZ3JlZW4gY29tcG9uZW50IHdpbGwgbm90IGJlIHdyaXR0ZW4uIERlZmF1bHRzIHRvIHRydWUuXG4gKiBAcHJvcGVydHkge3N0cmluZ30gbmFtZSBUaGUgbmFtZSBvZiB0aGUgbWF0ZXJpYWwuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IHJlZFdyaXRlIElmIHRydWUsIHRoZSByZWQgY29tcG9uZW50IG9mIGZyYWdtZW50cyBnZW5lcmF0ZWQgYnkgdGhlIHNoYWRlciBvZlxuICogdGhpcyBtYXRlcmlhbCBpcyB3cml0dGVuIHRvIHRoZSBjb2xvciBidWZmZXIgb2YgdGhlIGN1cnJlbnRseSBhY3RpdmUgcmVuZGVyIHRhcmdldC4gSWYgZmFsc2UsXG4gKiB0aGUgcmVkIGNvbXBvbmVudCB3aWxsIG5vdCBiZSB3cml0dGVuLiBEZWZhdWx0cyB0byB0cnVlLlxuICogQHByb3BlcnR5IHtTaGFkZXJ8bnVsbH0gc2hhZGVyIFRoZSBzaGFkZXIgdXNlZCBieSB0aGlzIG1hdGVyaWFsIHRvIHJlbmRlciBtZXNoIGluc3RhbmNlc1xuICogKGRlZmF1bHQgaXMgbnVsbCkuXG4gKiBAcHJvcGVydHkge1N0ZW5jaWxQYXJhbWV0ZXJzfG51bGx9IHN0ZW5jaWxGcm9udCBTdGVuY2lsIHBhcmFtZXRlcnMgZm9yIGZyb250IGZhY2VzIChkZWZhdWx0IGlzXG4gKiBudWxsKS5cbiAqIEBwcm9wZXJ0eSB7U3RlbmNpbFBhcmFtZXRlcnN8bnVsbH0gc3RlbmNpbEJhY2sgU3RlbmNpbCBwYXJhbWV0ZXJzIGZvciBiYWNrIGZhY2VzIChkZWZhdWx0IGlzXG4gKiBudWxsKS5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBkZXB0aEJpYXMgT2Zmc2V0cyB0aGUgb3V0cHV0IGRlcHRoIGJ1ZmZlciB2YWx1ZS4gVXNlZnVsIGZvciBkZWNhbHMgdG8gcHJldmVudFxuICogei1maWdodGluZy5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBzbG9wZURlcHRoQmlhcyBTYW1lIGFzIHtAbGluayBNYXRlcmlhbCNkZXB0aEJpYXN9LCBidXQgYWxzbyBkZXBlbmRzIG9uIHRoZVxuICogc2xvcGUgb2YgdGhlIHRyaWFuZ2xlIHJlbGF0aXZlIHRvIHRoZSBjYW1lcmEuXG4gKi9cbmNsYXNzIE1hdGVyaWFsIHtcbiAgICAvKipcbiAgICAgKiBBIHNoYWRlciB1c2VkIHRvIHJlbmRlciB0aGUgbWF0ZXJpYWwuIE5vdGUgdGhhdCB0aGlzIGlzIHVzZWQgb25seSBieSBtYXRlcmlhbHMgd2hlcmUgdGhlIHVzZXJcbiAgICAgKiBzcGVjaWZpZXMgdGhlIHNoYWRlci4gTW9zdCBtYXRlcmlhbCB0eXBlcyBnZW5lcmF0ZSBtdWx0aXBsZSBzaGFkZXIgdmFyaWFudHMsIGFuZCBkbyBub3Qgc2V0IHRoaXMuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7U2hhZGVyfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3NoYWRlciA9IG51bGw7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgbWVzaCBpbnN0YW5jZXMgcmVmZXJlbmNpbmcgdGhpcyBtYXRlcmlhbFxuICAgICAqXG4gICAgICogQHR5cGUge01lc2hJbnN0YW5jZVtdfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgbWVzaEluc3RhbmNlcyA9IFtdO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IE1hdGVyaWFsIGluc3RhbmNlLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLm5hbWUgPSAnVW50aXRsZWQnO1xuICAgICAgICB0aGlzLmlkID0gaWQrKztcblxuICAgICAgICB0aGlzLnZhcmlhbnRzID0ge307XG4gICAgICAgIHRoaXMucGFyYW1ldGVycyA9IHt9O1xuXG4gICAgICAgIC8vIFJlbmRlciBzdGF0ZXNcbiAgICAgICAgdGhpcy5hbHBoYVRlc3QgPSAwO1xuICAgICAgICB0aGlzLmFscGhhVG9Db3ZlcmFnZSA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuYmxlbmQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5ibGVuZFNyYyA9IEJMRU5ETU9ERV9PTkU7XG4gICAgICAgIHRoaXMuYmxlbmREc3QgPSBCTEVORE1PREVfWkVSTztcbiAgICAgICAgdGhpcy5ibGVuZEVxdWF0aW9uID0gQkxFTkRFUVVBVElPTl9BREQ7XG5cbiAgICAgICAgdGhpcy5zZXBhcmF0ZUFscGhhQmxlbmQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5ibGVuZFNyY0FscGhhID0gQkxFTkRNT0RFX09ORTtcbiAgICAgICAgdGhpcy5ibGVuZERzdEFscGhhID0gQkxFTkRNT0RFX1pFUk87XG4gICAgICAgIHRoaXMuYmxlbmRBbHBoYUVxdWF0aW9uID0gQkxFTkRFUVVBVElPTl9BREQ7XG5cbiAgICAgICAgdGhpcy5jdWxsID0gQ1VMTEZBQ0VfQkFDSztcblxuICAgICAgICB0aGlzLmRlcHRoVGVzdCA9IHRydWU7XG4gICAgICAgIHRoaXMuZGVwdGhGdW5jID0gRlVOQ19MRVNTRVFVQUw7XG4gICAgICAgIHRoaXMuZGVwdGhXcml0ZSA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RlbmNpbEZyb250ID0gbnVsbDtcbiAgICAgICAgdGhpcy5zdGVuY2lsQmFjayA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5kZXB0aEJpYXMgPSAwO1xuICAgICAgICB0aGlzLnNsb3BlRGVwdGhCaWFzID0gMDtcblxuICAgICAgICB0aGlzLnJlZFdyaXRlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5ncmVlbldyaXRlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5ibHVlV3JpdGUgPSB0cnVlO1xuICAgICAgICB0aGlzLmFscGhhV3JpdGUgPSB0cnVlO1xuXG4gICAgICAgIHRoaXMuX3NoYWRlclZlcnNpb24gPSAwO1xuICAgICAgICB0aGlzLl9zY2VuZSA9IG51bGw7XG4gICAgICAgIHRoaXMuX2RpcnR5QmxlbmQgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBzZXQgc2hhZGVyKHNoYWRlcikge1xuICAgICAgICB0aGlzLl9zaGFkZXIgPSBzaGFkZXI7XG4gICAgfVxuXG4gICAgZ2V0IHNoYWRlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NoYWRlcjtcbiAgICB9XG5cbiAgICAvLyByZXR1cm5zIGJvb2xlYW4gZGVwZW5kaW5nIG9uIG1hdGVyaWFsIGJlaW5nIHRyYW5zcGFyZW50XG4gICAgZ2V0IHRyYW5zcGFyZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ibGVuZDtcbiAgICB9XG5cbiAgICBzZXQgYmxlbmRUeXBlKHR5cGUpIHtcbiAgICAgICAgbGV0IGJsZW5kID0gdHJ1ZTtcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICBjYXNlIEJMRU5EX05PTkU6XG4gICAgICAgICAgICAgICAgYmxlbmQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kU3JjID0gQkxFTkRNT0RFX09ORTtcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kRHN0ID0gQkxFTkRNT0RFX1pFUk87XG4gICAgICAgICAgICAgICAgdGhpcy5ibGVuZEVxdWF0aW9uID0gQkxFTkRFUVVBVElPTl9BREQ7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEJMRU5EX05PUk1BTDpcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kU3JjID0gQkxFTkRNT0RFX1NSQ19BTFBIQTtcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kRHN0ID0gQkxFTkRNT0RFX09ORV9NSU5VU19TUkNfQUxQSEE7XG4gICAgICAgICAgICAgICAgdGhpcy5ibGVuZEVxdWF0aW9uID0gQkxFTkRFUVVBVElPTl9BREQ7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEJMRU5EX1BSRU1VTFRJUExJRUQ6XG4gICAgICAgICAgICAgICAgdGhpcy5ibGVuZFNyYyA9IEJMRU5ETU9ERV9PTkU7XG4gICAgICAgICAgICAgICAgdGhpcy5ibGVuZERzdCA9IEJMRU5ETU9ERV9PTkVfTUlOVVNfU1JDX0FMUEhBO1xuICAgICAgICAgICAgICAgIHRoaXMuYmxlbmRFcXVhdGlvbiA9IEJMRU5ERVFVQVRJT05fQUREO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBCTEVORF9BRERJVElWRTpcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kU3JjID0gQkxFTkRNT0RFX09ORTtcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kRHN0ID0gQkxFTkRNT0RFX09ORTtcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kRXF1YXRpb24gPSBCTEVOREVRVUFUSU9OX0FERDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQkxFTkRfQURESVRJVkVBTFBIQTpcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kU3JjID0gQkxFTkRNT0RFX1NSQ19BTFBIQTtcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kRHN0ID0gQkxFTkRNT0RFX09ORTtcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kRXF1YXRpb24gPSBCTEVOREVRVUFUSU9OX0FERDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQkxFTkRfTVVMVElQTElDQVRJVkUyWDpcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kU3JjID0gQkxFTkRNT0RFX0RTVF9DT0xPUjtcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kRHN0ID0gQkxFTkRNT0RFX1NSQ19DT0xPUjtcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kRXF1YXRpb24gPSBCTEVOREVRVUFUSU9OX0FERDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQkxFTkRfU0NSRUVOOlxuICAgICAgICAgICAgICAgIHRoaXMuYmxlbmRTcmMgPSBCTEVORE1PREVfT05FX01JTlVTX0RTVF9DT0xPUjtcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kRHN0ID0gQkxFTkRNT0RFX09ORTtcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kRXF1YXRpb24gPSBCTEVOREVRVUFUSU9OX0FERDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQkxFTkRfTVVMVElQTElDQVRJVkU6XG4gICAgICAgICAgICAgICAgdGhpcy5ibGVuZFNyYyA9IEJMRU5ETU9ERV9EU1RfQ09MT1I7XG4gICAgICAgICAgICAgICAgdGhpcy5ibGVuZERzdCA9IEJMRU5ETU9ERV9aRVJPO1xuICAgICAgICAgICAgICAgIHRoaXMuYmxlbmRFcXVhdGlvbiA9IEJMRU5ERVFVQVRJT05fQUREO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBCTEVORF9NSU46XG4gICAgICAgICAgICAgICAgdGhpcy5ibGVuZFNyYyA9IEJMRU5ETU9ERV9PTkU7XG4gICAgICAgICAgICAgICAgdGhpcy5ibGVuZERzdCA9IEJMRU5ETU9ERV9PTkU7XG4gICAgICAgICAgICAgICAgdGhpcy5ibGVuZEVxdWF0aW9uID0gQkxFTkRFUVVBVElPTl9NSU47XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEJMRU5EX01BWDpcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kU3JjID0gQkxFTkRNT0RFX09ORTtcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kRHN0ID0gQkxFTkRNT0RFX09ORTtcbiAgICAgICAgICAgICAgICB0aGlzLmJsZW5kRXF1YXRpb24gPSBCTEVOREVRVUFUSU9OX01BWDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5ibGVuZCAhPT0gYmxlbmQpIHtcbiAgICAgICAgICAgIHRoaXMuYmxlbmQgPSBibGVuZDtcbiAgICAgICAgICAgIGlmICh0aGlzLl9zY2VuZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3NjZW5lLmxheWVycy5fZGlydHlCbGVuZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RpcnR5QmxlbmQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3VwZGF0ZU1lc2hJbnN0YW5jZUtleXMoKTtcbiAgICB9XG5cbiAgICBnZXQgYmxlbmRUeXBlKCkge1xuICAgICAgICBpZiAoIXRoaXMuYmxlbmQpIHtcbiAgICAgICAgICAgIHJldHVybiBCTEVORF9OT05FO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCh0aGlzLmJsZW5kU3JjID09PSBCTEVORE1PREVfU1JDX0FMUEhBKSAmJiAodGhpcy5ibGVuZERzdCA9PT0gQkxFTkRNT0RFX09ORV9NSU5VU19TUkNfQUxQSEEpICYmXG4gICAgICAgICAgICAodGhpcy5ibGVuZEVxdWF0aW9uID09PSBCTEVOREVRVUFUSU9OX0FERCkpIHtcbiAgICAgICAgICAgIHJldHVybiBCTEVORF9OT1JNQUw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoKHRoaXMuYmxlbmRTcmMgPT09IEJMRU5ETU9ERV9PTkUpICYmICh0aGlzLmJsZW5kRHN0ID09PSBCTEVORE1PREVfT05FKSAmJlxuICAgICAgICAgICAgKHRoaXMuYmxlbmRFcXVhdGlvbiA9PT0gQkxFTkRFUVVBVElPTl9BREQpKSB7XG4gICAgICAgICAgICByZXR1cm4gQkxFTkRfQURESVRJVkU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoKHRoaXMuYmxlbmRTcmMgPT09IEJMRU5ETU9ERV9TUkNfQUxQSEEpICYmICh0aGlzLmJsZW5kRHN0ID09PSBCTEVORE1PREVfT05FKSAmJlxuICAgICAgICAgICAgKHRoaXMuYmxlbmRFcXVhdGlvbiA9PT0gQkxFTkRFUVVBVElPTl9BREQpKSB7XG4gICAgICAgICAgICByZXR1cm4gQkxFTkRfQURESVRJVkVBTFBIQTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgodGhpcy5ibGVuZFNyYyA9PT0gQkxFTkRNT0RFX0RTVF9DT0xPUikgJiYgKHRoaXMuYmxlbmREc3QgPT09IEJMRU5ETU9ERV9TUkNfQ09MT1IpICYmXG4gICAgICAgICAgICAodGhpcy5ibGVuZEVxdWF0aW9uID09PSBCTEVOREVRVUFUSU9OX0FERCkpIHtcbiAgICAgICAgICAgIHJldHVybiBCTEVORF9NVUxUSVBMSUNBVElWRTJYO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCh0aGlzLmJsZW5kU3JjID09PSBCTEVORE1PREVfT05FX01JTlVTX0RTVF9DT0xPUikgJiYgKHRoaXMuYmxlbmREc3QgPT09IEJMRU5ETU9ERV9PTkUpICYmXG4gICAgICAgICAgICAodGhpcy5ibGVuZEVxdWF0aW9uID09PSBCTEVOREVRVUFUSU9OX0FERCkpIHtcbiAgICAgICAgICAgIHJldHVybiBCTEVORF9TQ1JFRU47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoKHRoaXMuYmxlbmRTcmMgPT09IEJMRU5ETU9ERV9PTkUpICYmICh0aGlzLmJsZW5kRHN0ID09PSBCTEVORE1PREVfT05FKSAmJlxuICAgICAgICAgICAgKHRoaXMuYmxlbmRFcXVhdGlvbiA9PT0gQkxFTkRFUVVBVElPTl9NSU4pKSB7XG4gICAgICAgICAgICByZXR1cm4gQkxFTkRfTUlOO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCh0aGlzLmJsZW5kU3JjID09PSBCTEVORE1PREVfT05FKSAmJiAodGhpcy5ibGVuZERzdCA9PT0gQkxFTkRNT0RFX09ORSkgJiZcbiAgICAgICAgICAgICh0aGlzLmJsZW5kRXF1YXRpb24gPT09IEJMRU5ERVFVQVRJT05fTUFYKSkge1xuICAgICAgICAgICAgcmV0dXJuIEJMRU5EX01BWDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgodGhpcy5ibGVuZFNyYyA9PT0gQkxFTkRNT0RFX0RTVF9DT0xPUikgJiYgKHRoaXMuYmxlbmREc3QgPT09IEJMRU5ETU9ERV9aRVJPKSAmJlxuICAgICAgICAgICAgKHRoaXMuYmxlbmRFcXVhdGlvbiA9PT0gQkxFTkRFUVVBVElPTl9BREQpKSB7XG4gICAgICAgICAgICByZXR1cm4gQkxFTkRfTVVMVElQTElDQVRJVkU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoKHRoaXMuYmxlbmRTcmMgPT09IEJMRU5ETU9ERV9PTkUpICYmICh0aGlzLmJsZW5kRHN0ID09PSBCTEVORE1PREVfT05FX01JTlVTX1NSQ19BTFBIQSkgJiZcbiAgICAgICAgICAgICh0aGlzLmJsZW5kRXF1YXRpb24gPT09IEJMRU5ERVFVQVRJT05fQUREKSkge1xuICAgICAgICAgICAgcmV0dXJuIEJMRU5EX1BSRU1VTFRJUExJRUQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gQkxFTkRfTk9STUFMO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvcHkgYSBtYXRlcmlhbC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7TWF0ZXJpYWx9IHNvdXJjZSAtIFRoZSBtYXRlcmlhbCB0byBjb3B5LlxuICAgICAqIEByZXR1cm5zIHtNYXRlcmlhbH0gVGhlIGRlc3RpbmF0aW9uIG1hdGVyaWFsLlxuICAgICAqL1xuICAgIGNvcHkoc291cmNlKSB7XG4gICAgICAgIHRoaXMubmFtZSA9IHNvdXJjZS5uYW1lO1xuICAgICAgICB0aGlzLl9zaGFkZXIgPSBzb3VyY2UuX3NoYWRlcjtcblxuICAgICAgICAvLyBSZW5kZXIgc3RhdGVzXG4gICAgICAgIHRoaXMuYWxwaGFUZXN0ID0gc291cmNlLmFscGhhVGVzdDtcbiAgICAgICAgdGhpcy5hbHBoYVRvQ292ZXJhZ2UgPSBzb3VyY2UuYWxwaGFUb0NvdmVyYWdlO1xuXG4gICAgICAgIHRoaXMuYmxlbmQgPSBzb3VyY2UuYmxlbmQ7XG4gICAgICAgIHRoaXMuYmxlbmRTcmMgPSBzb3VyY2UuYmxlbmRTcmM7XG4gICAgICAgIHRoaXMuYmxlbmREc3QgPSBzb3VyY2UuYmxlbmREc3Q7XG4gICAgICAgIHRoaXMuYmxlbmRFcXVhdGlvbiA9IHNvdXJjZS5ibGVuZEVxdWF0aW9uO1xuXG4gICAgICAgIHRoaXMuc2VwYXJhdGVBbHBoYUJsZW5kID0gc291cmNlLnNlcGFyYXRlQWxwaGFCbGVuZDtcbiAgICAgICAgdGhpcy5ibGVuZFNyY0FscGhhID0gc291cmNlLmJsZW5kU3JjQWxwaGE7XG4gICAgICAgIHRoaXMuYmxlbmREc3RBbHBoYSA9IHNvdXJjZS5ibGVuZERzdEFscGhhO1xuICAgICAgICB0aGlzLmJsZW5kQWxwaGFFcXVhdGlvbiA9IHNvdXJjZS5ibGVuZEFscGhhRXF1YXRpb247XG5cbiAgICAgICAgdGhpcy5jdWxsID0gc291cmNlLmN1bGw7XG5cbiAgICAgICAgdGhpcy5kZXB0aFRlc3QgPSBzb3VyY2UuZGVwdGhUZXN0O1xuICAgICAgICB0aGlzLmRlcHRoRnVuYyA9IHNvdXJjZS5kZXB0aEZ1bmM7XG4gICAgICAgIHRoaXMuZGVwdGhXcml0ZSA9IHNvdXJjZS5kZXB0aFdyaXRlO1xuICAgICAgICB0aGlzLmRlcHRoQmlhcyA9IHNvdXJjZS5kZXB0aEJpYXM7XG4gICAgICAgIHRoaXMuc2xvcGVEZXB0aEJpYXMgPSBzb3VyY2Uuc2xvcGVEZXB0aEJpYXM7XG4gICAgICAgIGlmIChzb3VyY2Uuc3RlbmNpbEZyb250KSB0aGlzLnN0ZW5jaWxGcm9udCA9IHNvdXJjZS5zdGVuY2lsRnJvbnQuY2xvbmUoKTtcbiAgICAgICAgaWYgKHNvdXJjZS5zdGVuY2lsQmFjaykge1xuICAgICAgICAgICAgaWYgKHNvdXJjZS5zdGVuY2lsRnJvbnQgPT09IHNvdXJjZS5zdGVuY2lsQmFjaykge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RlbmNpbEJhY2sgPSB0aGlzLnN0ZW5jaWxGcm9udDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGVuY2lsQmFjayA9IHNvdXJjZS5zdGVuY2lsQmFjay5jbG9uZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZWRXcml0ZSA9IHNvdXJjZS5yZWRXcml0ZTtcbiAgICAgICAgdGhpcy5ncmVlbldyaXRlID0gc291cmNlLmdyZWVuV3JpdGU7XG4gICAgICAgIHRoaXMuYmx1ZVdyaXRlID0gc291cmNlLmJsdWVXcml0ZTtcbiAgICAgICAgdGhpcy5hbHBoYVdyaXRlID0gc291cmNlLmFscGhhV3JpdGU7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xvbmUgYSBtYXRlcmlhbC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHt0aGlzfSBBIG5ld2x5IGNsb25lZCBtYXRlcmlhbC5cbiAgICAgKi9cbiAgICBjbG9uZSgpIHtcbiAgICAgICAgY29uc3QgY2xvbmUgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpO1xuICAgICAgICByZXR1cm4gY2xvbmUuY29weSh0aGlzKTtcbiAgICB9XG5cbiAgICBfdXBkYXRlTWVzaEluc3RhbmNlS2V5cygpIHtcbiAgICAgICAgY29uc3QgbWVzaEluc3RhbmNlcyA9IHRoaXMubWVzaEluc3RhbmNlcztcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtZXNoSW5zdGFuY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBtZXNoSW5zdGFuY2VzW2ldLnVwZGF0ZUtleSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdXBkYXRlVW5pZm9ybXMoZGV2aWNlLCBzY2VuZSkge1xuICAgIH1cblxuICAgIGdldFNoYWRlclZhcmlhbnQoZGV2aWNlLCBzY2VuZSwgb2JqRGVmcywgc3RhdGljTGlnaHRMaXN0LCBwYXNzLCBzb3J0ZWRMaWdodHMsIHZpZXdVbmlmb3JtRm9ybWF0LCB2aWV3QmluZEdyb3VwRm9ybWF0KSB7XG5cbiAgICAgICAgRGVidWcuYXNzZXJ0KHRoaXMuX3NoYWRlciwgJ01hdGVyaWFsIGRvZXMgbm90IGhhdmUgYSBzaGFkZXIgc2V0JywgdGhpcyk7XG5cbiAgICAgICAgLy8gZGVmYXVsdCBnZW5lcmF0b3IgZm9yIGEgbWF0ZXJpYWwgLSBzaW1wbHkgcmV0dXJuIGV4aXN0aW5nIHNoYWRlciBkZWZpbml0aW9uLiBVc2UgZ2VuZXJhdG9yIGFuZCBnZXRQcm9ncmFtXG4gICAgICAgIC8vIHRvIGFsbG93IGZvciBzaGFkZXIgcHJvY2Vzc2luZyB0byBiZSBjYWNoZWRcbiAgICAgICAgY29uc3Qga2V5ID0gYHNoYWRlci1pZC0ke3RoaXMuX3NoYWRlci5pZH1gO1xuICAgICAgICBjb25zdCBzaGFkZXJEZWZpbml0aW9uID0gdGhpcy5fc2hhZGVyLmRlZmluaXRpb247XG4gICAgICAgIGNvbnN0IG1hdGVyaWFsR2VuZXJhdG9yID0ge1xuICAgICAgICAgICAgZ2VuZXJhdGVLZXk6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgLy8gdW5pcXVlIG5hbWUgYmFzZWQgb2YgdGhlIHNoYWRlciBpZFxuICAgICAgICAgICAgICAgIHJldHVybiBrZXk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBjcmVhdGVTaGFkZXJEZWZpbml0aW9uOiBmdW5jdGlvbiAoZGV2aWNlLCBvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNoYWRlckRlZmluaXRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gdGVtcG9yYXJpbHkgcmVnaXN0ZXIgdGhlIHByb2dyYW0gZ2VuZXJhdG9yXG4gICAgICAgIGNvbnN0IGxpYnJhcnlNb2R1bGVOYW1lID0gJ3NoYWRlcic7XG4gICAgICAgIGNvbnN0IGxpYnJhcnkgPSBnZXRQcm9ncmFtTGlicmFyeShkZXZpY2UpO1xuICAgICAgICBEZWJ1Zy5hc3NlcnQoIWxpYnJhcnkuaXNSZWdpc3RlcmVkKGxpYnJhcnlNb2R1bGVOYW1lKSk7XG4gICAgICAgIGxpYnJhcnkucmVnaXN0ZXIobGlicmFyeU1vZHVsZU5hbWUsIG1hdGVyaWFsR2VuZXJhdG9yKTtcblxuICAgICAgICAvLyBnZW5lcmF0ZSBzaGFkZXIgdmFyaWFudCAtIGl0cyB0aGUgc2FtZSBzaGFkZXIsIGJ1dCB3aXRoIGRpZmZlcmVudCBwcm9jZXNzaW5nIG9wdGlvbnNcbiAgICAgICAgY29uc3QgcHJvY2Vzc2luZ09wdGlvbnMgPSBuZXcgU2hhZGVyUHJvY2Vzc29yT3B0aW9ucyh2aWV3VW5pZm9ybUZvcm1hdCwgdmlld0JpbmRHcm91cEZvcm1hdCk7XG4gICAgICAgIGNvbnN0IHZhcmlhbnQgPSBsaWJyYXJ5LmdldFByb2dyYW0obGlicmFyeU1vZHVsZU5hbWUsIHt9LCBwcm9jZXNzaW5nT3B0aW9ucyk7XG5cbiAgICAgICAgLy8gdW5yZWdpc3RlciBpdCBhZ2FpblxuICAgICAgICBsaWJyYXJ5LnVucmVnaXN0ZXIobGlicmFyeU1vZHVsZU5hbWUpO1xuXG4gICAgICAgIHJldHVybiB2YXJpYW50O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFwcGxpZXMgYW55IGNoYW5nZXMgbWFkZSB0byB0aGUgbWF0ZXJpYWwncyBwcm9wZXJ0aWVzLlxuICAgICAqL1xuICAgIHVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLl9zaGFkZXIpIHRoaXMuX3NoYWRlci5mYWlsZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBQYXJhbWV0ZXIgbWFuYWdlbWVudFxuICAgIGNsZWFyUGFyYW1ldGVycygpIHtcbiAgICAgICAgdGhpcy5wYXJhbWV0ZXJzID0ge307XG4gICAgfVxuXG4gICAgZ2V0UGFyYW1ldGVycygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyYW1ldGVycztcbiAgICB9XG5cbiAgICBjbGVhclZhcmlhbnRzKCkge1xuXG4gICAgICAgIC8vIGNsZWFyIHZhcmlhbnRzIG9uIHRoZSBtYXRlcmlhbFxuICAgICAgICB0aGlzLnZhcmlhbnRzID0ge307XG5cbiAgICAgICAgLy8gYnV0IGFsc28gY2xlYXIgdGhlbSBmcm9tIGFsbCBtYXRlcmlhbHMgdGhhdCByZWZlcmVuY2UgdGhlbVxuICAgICAgICBjb25zdCBtZXNoSW5zdGFuY2VzID0gdGhpcy5tZXNoSW5zdGFuY2VzO1xuICAgICAgICBjb25zdCBjb3VudCA9IG1lc2hJbnN0YW5jZXMubGVuZ3RoO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcbiAgICAgICAgICAgIG1lc2hJbnN0YW5jZXNbaV0uY2xlYXJTaGFkZXJzKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgdGhlIHNwZWNpZmllZCBzaGFkZXIgcGFyYW1ldGVyIGZyb20gYSBtYXRlcmlhbC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHBhcmFtZXRlciB0byBxdWVyeS5cbiAgICAgKiBAcmV0dXJucyB7b2JqZWN0fSBUaGUgbmFtZWQgcGFyYW1ldGVyLlxuICAgICAqL1xuICAgIGdldFBhcmFtZXRlcihuYW1lKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhcmFtZXRlcnNbbmFtZV07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyBhIHNoYWRlciBwYXJhbWV0ZXIgb24gYSBtYXRlcmlhbC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHBhcmFtZXRlciB0byBzZXQuXG4gICAgICogQHBhcmFtIHtudW1iZXJ8bnVtYmVyW118RmxvYXQzMkFycmF5fFRleHR1cmV9IGRhdGEgLSBUaGUgdmFsdWUgZm9yIHRoZSBzcGVjaWZpZWQgcGFyYW1ldGVyLlxuICAgICAqL1xuICAgIHNldFBhcmFtZXRlcihuYW1lLCBkYXRhKSB7XG5cbiAgICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCAmJiB0eXBlb2YgbmFtZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIGNvbnN0IHVuaWZvcm1PYmplY3QgPSBuYW1lO1xuICAgICAgICAgICAgaWYgKHVuaWZvcm1PYmplY3QubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1bmlmb3JtT2JqZWN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0UGFyYW1ldGVyKHVuaWZvcm1PYmplY3RbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBuYW1lID0gdW5pZm9ybU9iamVjdC5uYW1lO1xuICAgICAgICAgICAgZGF0YSA9IHVuaWZvcm1PYmplY3QudmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwYXJhbSA9IHRoaXMucGFyYW1ldGVyc1tuYW1lXTtcbiAgICAgICAgaWYgKHBhcmFtKSB7XG4gICAgICAgICAgICBwYXJhbS5kYXRhID0gZGF0YTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucGFyYW1ldGVyc1tuYW1lXSA9IHtcbiAgICAgICAgICAgICAgICBzY29wZUlkOiBudWxsLFxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWxldGVzIGEgc2hhZGVyIHBhcmFtZXRlciBvbiBhIG1hdGVyaWFsLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgcGFyYW1ldGVyIHRvIGRlbGV0ZS5cbiAgICAgKi9cbiAgICBkZWxldGVQYXJhbWV0ZXIobmFtZSkge1xuICAgICAgICBpZiAodGhpcy5wYXJhbWV0ZXJzW25hbWVdKSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5wYXJhbWV0ZXJzW25hbWVdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gdXNlZCB0byBhcHBseSBwYXJhbWV0ZXJzIGZyb20gdGhpcyBtYXRlcmlhbCBpbnRvIHNjb3BlIG9mIHVuaWZvcm1zLCBjYWxsZWQgaW50ZXJuYWxseSBieSBmb3J3YXJkLXJlbmRlcmVyXG4gICAgLy8gb3B0aW9uYWwgbGlzdCBvZiBwYXJhbWV0ZXIgbmFtZXMgdG8gYmUgc2V0IGNhbiBiZSBzcGVjaWZpZWQsIG90aGVyd2lzZSBhbGwgcGFyYW1ldGVycyBhcmUgc2V0XG4gICAgc2V0UGFyYW1ldGVycyhkZXZpY2UsIG5hbWVzKSB7XG4gICAgICAgIGNvbnN0IHBhcmFtZXRlcnMgPSB0aGlzLnBhcmFtZXRlcnM7XG4gICAgICAgIGlmIChuYW1lcyA9PT0gdW5kZWZpbmVkKSBuYW1lcyA9IHBhcmFtZXRlcnM7XG4gICAgICAgIGZvciAoY29uc3QgcGFyYW1OYW1lIGluIG5hbWVzKSB7XG4gICAgICAgICAgICBjb25zdCBwYXJhbWV0ZXIgPSBwYXJhbWV0ZXJzW3BhcmFtTmFtZV07XG4gICAgICAgICAgICBpZiAocGFyYW1ldGVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFwYXJhbWV0ZXIuc2NvcGVJZCkge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXIuc2NvcGVJZCA9IGRldmljZS5zY29wZS5yZXNvbHZlKHBhcmFtTmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHBhcmFtZXRlci5zY29wZUlkLnNldFZhbHVlKHBhcmFtZXRlci5kYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgdGhpcyBtYXRlcmlhbCBmcm9tIHRoZSBzY2VuZSBhbmQgcG9zc2libHkgZnJlZXMgdXAgbWVtb3J5IGZyb20gaXRzIHNoYWRlcnMgKGlmIHRoZXJlXG4gICAgICogYXJlIG5vIG90aGVyIG1hdGVyaWFscyB1c2luZyBpdCkuXG4gICAgICovXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy52YXJpYW50cyA9IHt9O1xuICAgICAgICB0aGlzLl9zaGFkZXIgPSBudWxsO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5tZXNoSW5zdGFuY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNoSW5zdGFuY2UgPSB0aGlzLm1lc2hJbnN0YW5jZXNbaV07XG4gICAgICAgICAgICBtZXNoSW5zdGFuY2UuY2xlYXJTaGFkZXJzKCk7XG4gICAgICAgICAgICBtZXNoSW5zdGFuY2UuX21hdGVyaWFsID0gbnVsbDtcblxuICAgICAgICAgICAgaWYgKG1lc2hJbnN0YW5jZS5tZXNoKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVmYXVsdE1hdGVyaWFsID0gZ2V0RGVmYXVsdE1hdGVyaWFsKG1lc2hJbnN0YW5jZS5tZXNoLmRldmljZSk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMgIT09IGRlZmF1bHRNYXRlcmlhbCkge1xuICAgICAgICAgICAgICAgICAgICBtZXNoSW5zdGFuY2UubWF0ZXJpYWwgPSBkZWZhdWx0TWF0ZXJpYWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBEZWJ1Zy53YXJuKCdwYy5NYXRlcmlhbDogTWVzaEluc3RhbmNlLm1lc2ggaXMgbnVsbCwgZGVmYXVsdCBtYXRlcmlhbCBjYW5ub3QgYmUgYXNzaWduZWQgdG8gdGhlIE1lc2hJbnN0YW5jZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tZXNoSW5zdGFuY2VzLmxlbmd0aCA9IDA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVnaXN0ZXJzIG1lc2ggaW5zdGFuY2UgYXMgcmVmZXJlbmNpbmcgdGhlIG1hdGVyaWFsLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtNZXNoSW5zdGFuY2V9IG1lc2hJbnN0YW5jZSAtIFRoZSBtZXNoIGluc3RhbmNlIHRvIGRlLXJlZ2lzdGVyLlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBhZGRNZXNoSW5zdGFuY2VSZWYobWVzaEluc3RhbmNlKSB7XG4gICAgICAgIHRoaXMubWVzaEluc3RhbmNlcy5wdXNoKG1lc2hJbnN0YW5jZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGUtcmVnaXN0ZXJzIG1lc2ggaW5zdGFuY2UgYXMgcmVmZXJlbmNpbmcgdGhlIG1hdGVyaWFsLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtNZXNoSW5zdGFuY2V9IG1lc2hJbnN0YW5jZSAtIFRoZSBtZXNoIGluc3RhbmNlIHRvIGRlLXJlZ2lzdGVyLlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICByZW1vdmVNZXNoSW5zdGFuY2VSZWYobWVzaEluc3RhbmNlKSB7XG4gICAgICAgIGNvbnN0IG1lc2hJbnN0YW5jZXMgPSB0aGlzLm1lc2hJbnN0YW5jZXM7XG4gICAgICAgIGNvbnN0IGkgPSBtZXNoSW5zdGFuY2VzLmluZGV4T2YobWVzaEluc3RhbmNlKTtcbiAgICAgICAgaWYgKGkgIT09IC0xKSB7XG4gICAgICAgICAgICBtZXNoSW5zdGFuY2VzLnNwbGljZShpLCAxKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHsgTWF0ZXJpYWwgfTtcbiJdLCJuYW1lcyI6WyJpZCIsIk1hdGVyaWFsIiwiY29uc3RydWN0b3IiLCJfc2hhZGVyIiwibWVzaEluc3RhbmNlcyIsIm5hbWUiLCJ2YXJpYW50cyIsInBhcmFtZXRlcnMiLCJhbHBoYVRlc3QiLCJhbHBoYVRvQ292ZXJhZ2UiLCJibGVuZCIsImJsZW5kU3JjIiwiQkxFTkRNT0RFX09ORSIsImJsZW5kRHN0IiwiQkxFTkRNT0RFX1pFUk8iLCJibGVuZEVxdWF0aW9uIiwiQkxFTkRFUVVBVElPTl9BREQiLCJzZXBhcmF0ZUFscGhhQmxlbmQiLCJibGVuZFNyY0FscGhhIiwiYmxlbmREc3RBbHBoYSIsImJsZW5kQWxwaGFFcXVhdGlvbiIsImN1bGwiLCJDVUxMRkFDRV9CQUNLIiwiZGVwdGhUZXN0IiwiZGVwdGhGdW5jIiwiRlVOQ19MRVNTRVFVQUwiLCJkZXB0aFdyaXRlIiwic3RlbmNpbEZyb250Iiwic3RlbmNpbEJhY2siLCJkZXB0aEJpYXMiLCJzbG9wZURlcHRoQmlhcyIsInJlZFdyaXRlIiwiZ3JlZW5Xcml0ZSIsImJsdWVXcml0ZSIsImFscGhhV3JpdGUiLCJfc2hhZGVyVmVyc2lvbiIsIl9zY2VuZSIsIl9kaXJ0eUJsZW5kIiwiZGlydHkiLCJzaGFkZXIiLCJ0cmFuc3BhcmVudCIsImJsZW5kVHlwZSIsInR5cGUiLCJCTEVORF9OT05FIiwiQkxFTkRfTk9STUFMIiwiQkxFTkRNT0RFX1NSQ19BTFBIQSIsIkJMRU5ETU9ERV9PTkVfTUlOVVNfU1JDX0FMUEhBIiwiQkxFTkRfUFJFTVVMVElQTElFRCIsIkJMRU5EX0FERElUSVZFIiwiQkxFTkRfQURESVRJVkVBTFBIQSIsIkJMRU5EX01VTFRJUExJQ0FUSVZFMlgiLCJCTEVORE1PREVfRFNUX0NPTE9SIiwiQkxFTkRNT0RFX1NSQ19DT0xPUiIsIkJMRU5EX1NDUkVFTiIsIkJMRU5ETU9ERV9PTkVfTUlOVVNfRFNUX0NPTE9SIiwiQkxFTkRfTVVMVElQTElDQVRJVkUiLCJCTEVORF9NSU4iLCJCTEVOREVRVUFUSU9OX01JTiIsIkJMRU5EX01BWCIsIkJMRU5ERVFVQVRJT05fTUFYIiwibGF5ZXJzIiwiX3VwZGF0ZU1lc2hJbnN0YW5jZUtleXMiLCJjb3B5Iiwic291cmNlIiwiY2xvbmUiLCJpIiwibGVuZ3RoIiwidXBkYXRlS2V5IiwidXBkYXRlVW5pZm9ybXMiLCJkZXZpY2UiLCJzY2VuZSIsImdldFNoYWRlclZhcmlhbnQiLCJvYmpEZWZzIiwic3RhdGljTGlnaHRMaXN0IiwicGFzcyIsInNvcnRlZExpZ2h0cyIsInZpZXdVbmlmb3JtRm9ybWF0Iiwidmlld0JpbmRHcm91cEZvcm1hdCIsIkRlYnVnIiwiYXNzZXJ0Iiwia2V5Iiwic2hhZGVyRGVmaW5pdGlvbiIsImRlZmluaXRpb24iLCJtYXRlcmlhbEdlbmVyYXRvciIsImdlbmVyYXRlS2V5Iiwib3B0aW9ucyIsImNyZWF0ZVNoYWRlckRlZmluaXRpb24iLCJsaWJyYXJ5TW9kdWxlTmFtZSIsImxpYnJhcnkiLCJnZXRQcm9ncmFtTGlicmFyeSIsImlzUmVnaXN0ZXJlZCIsInJlZ2lzdGVyIiwicHJvY2Vzc2luZ09wdGlvbnMiLCJTaGFkZXJQcm9jZXNzb3JPcHRpb25zIiwidmFyaWFudCIsImdldFByb2dyYW0iLCJ1bnJlZ2lzdGVyIiwidXBkYXRlIiwiZmFpbGVkIiwiY2xlYXJQYXJhbWV0ZXJzIiwiZ2V0UGFyYW1ldGVycyIsImNsZWFyVmFyaWFudHMiLCJjb3VudCIsImNsZWFyU2hhZGVycyIsImdldFBhcmFtZXRlciIsInNldFBhcmFtZXRlciIsImRhdGEiLCJ1bmRlZmluZWQiLCJ1bmlmb3JtT2JqZWN0IiwidmFsdWUiLCJwYXJhbSIsInNjb3BlSWQiLCJkZWxldGVQYXJhbWV0ZXIiLCJzZXRQYXJhbWV0ZXJzIiwibmFtZXMiLCJwYXJhbU5hbWUiLCJwYXJhbWV0ZXIiLCJzY29wZSIsInJlc29sdmUiLCJzZXRWYWx1ZSIsImRlc3Ryb3kiLCJtZXNoSW5zdGFuY2UiLCJfbWF0ZXJpYWwiLCJtZXNoIiwiZGVmYXVsdE1hdGVyaWFsIiwiZ2V0RGVmYXVsdE1hdGVyaWFsIiwibWF0ZXJpYWwiLCJ3YXJuIiwiYWRkTWVzaEluc3RhbmNlUmVmIiwicHVzaCIsInJlbW92ZU1lc2hJbnN0YW5jZVJlZiIsImluZGV4T2YiLCJzcGxpY2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQXdCQSxJQUFJQSxFQUFFLEdBQUcsQ0FBQyxDQUFBOztBQStGVixNQUFNQyxRQUFRLENBQUM7O0FBcUJYQyxFQUFBQSxXQUFXLEdBQUc7SUFBQSxJQWJkQyxDQUFBQSxPQUFPLEdBQUcsSUFBSSxDQUFBO0lBQUEsSUFRZEMsQ0FBQUEsYUFBYSxHQUFHLEVBQUUsQ0FBQTtJQU1kLElBQUksQ0FBQ0MsSUFBSSxHQUFHLFVBQVUsQ0FBQTtBQUN0QixJQUFBLElBQUksQ0FBQ0wsRUFBRSxHQUFHQSxFQUFFLEVBQUUsQ0FBQTtBQUVkLElBQUEsSUFBSSxDQUFDTSxRQUFRLEdBQUcsRUFBRSxDQUFBO0FBQ2xCLElBQUEsSUFBSSxDQUFDQyxVQUFVLEdBQUcsRUFBRSxDQUFBOztJQUdwQixJQUFJLENBQUNDLFNBQVMsR0FBRyxDQUFDLENB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
