import{path as e}from"../../../core/path.js";import"../../../core/tracing.js";import{http as t}from"../../../net/http.js";import{math as n}from"../../../math/math.js";import{Mat4 as s}from"../../../math/mat4.js";import{Vec2 as r}from"../../../math/vec2.js";import{Vec3 as o}from"../../../math/vec3.js";import{Color as a}from"../../../math/color.js";import{BoundingBox as i}from"../../../shape/bounding-box.js";import{CULLFACE_NONE as l,CULLFACE_BACK as c,INDEXFORMAT_UINT32 as u,INDEXFORMAT_UINT16 as f,BUFFER_STATIC as p,PRIMITIVE_TRIANGLES as h,PRIMITIVE_TRIFAN as m,PRIMITIVE_TRISTRIP as d,PRIMITIVE_LINESTRIP as y,PRIMITIVE_LINELOOP as g,PRIMITIVE_LINES as w,PRIMITIVE_POINTS as O,SEMANTIC_NORMAL as P,INDEXFORMAT_UINT8 as x,TYPE_FLOAT32 as b,FILTER_LINEAR_MIPMAP_LINEAR as T,FILTER_NEAREST_MIPMAP_LINEAR as M,FILTER_LINEAR_MIPMAP_NEAREST as C,FILTER_NEAREST_MIPMAP_NEAREST as _,FILTER_LINEAR as A,FILTER_NEAREST as v,ADDRESS_REPEAT as R,ADDRESS_MIRRORED_REPEAT as E,ADDRESS_CLAMP_TO_EDGE as G,TYPE_UINT32 as F,TYPE_INT32 as U,TYPE_UINT16 as D,TYPE_INT16 as V,TYPE_UINT8 as k,TYPE_INT8 as I,SEMANTIC_POSITION as S,SEMANTIC_TANGENT as j,SEMANTIC_COLOR as H,SEMANTIC_BLENDINDICES as L,SEMANTIC_BLENDWEIGHT as N,SEMANTIC_TEXCOORD0 as K,SEMANTIC_TEXCOORD1 as z,SEMANTIC_TEXCOORD2 as B,SEMANTIC_TEXCOORD3 as $,SEMANTIC_TEXCOORD4 as X,SEMANTIC_TEXCOORD5 as W,SEMANTIC_TEXCOORD6 as Y,SEMANTIC_TEXCOORD7 as q,typedArrayTypesByteSize as J,typedArrayTypes as Q}from"../../../graphics/constants.js";import{IndexBuffer as Z}from"../../../graphics/index-buffer.js";import{Texture as ee}from"../../../graphics/texture.js";import{VertexBuffer as te}from"../../../graphics/vertex-buffer.js";import{VertexFormat as ne}from"../../../graphics/vertex-format.js";import{SPECOCC_AO as se,BLEND_NONE as re,BLEND_NORMAL as oe,PROJECTION_ORTHOGRAPHIC as ae,PROJECTION_PERSPECTIVE as ie,ASPECT_AUTO as le,LIGHTFALLOFF_INVERSESQUARED as ce,ASPECT_MANUAL as ue}from"../../../scene/constants.js";import{calculateNormals as fe}from"../../../scene/procedural.js";import{GraphNode as pe}from"../../../scene/graph-node.js";import{Mesh as he}from"../../../scene/mesh.js";import{Morph as me}from"../../../scene/morph.js";import{MorphTarget as de}from"../../../scene/morph-target.js";import{Skin as ye}from"../../../scene/skin.js";import{StandardMaterial as ge}from"../../../scene/materials/standard-material.js";import{Render as we}from"../../../scene/render.js";import{Entity as Oe}from"../../../framework/entity.js";import{AnimCurve as Pe}from"../../../anim/evaluator/anim-curve.js";import{AnimData as xe}from"../../../anim/evaluator/anim-data.js";import{AnimTrack as be}from"../../../anim/evaluator/anim-track.js";import{INTERPOLATION_LINEAR as Te,INTERPOLATION_CUBIC as Me,INTERPOLATION_STEP as Ce}from"../../../anim/constants.js";import{Asset as _e}from"../../../asset/asset.js";import{GlbContainerResource as Ae}from"./glb-container-resource.js";import{WasmModule as ve}from"../../../core/wasm-module.js";let Re=null;const Ee=()=>"undefined"!=typeof window&&window.DracoDecoderModule;class Ge{constructor(e){this.gltf=e,this.nodes=null,this.scenes=null,this.animations=null,this.textures=null,this.materials=null,this.variants=null,this.meshVariants=null,this.meshDefaultMaterials=null,this.renders=null,this.skins=null,this.lights=null,this.cameras=null}destroy(){this.renders&&this.renders.forEach((e=>{e.meshes=null}))}}const Fe=function(e){return/^data:.*,.*$/i.test(e)},Ue=function(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":default:return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}},De=function(e){switch(e){case 5120:return I;case 5121:return k;case 5122:return V;case 5123:return D;case 5124:return U;case 5125:return F;case 5126:return b;default:return 0}},Ve=function(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:return 0}},ke={POSITION:S,NORMAL:P,TANGENT:j,COLOR_0:H,JOINTS_0:L,WEIGHTS_0:N,TEXCOORD_0:K,TEXCOORD_1:z,TEXCOORD_2:B,TEXCOORD_3:$,TEXCOORD_4:X,TEXCOORD_5:W,TEXCOORD_6:Y,TEXCOORD_7:q},Ie=function(e,t,n){const s=(e=>{switch(e){case I:return e=>Math.max(e/127,-1);case k:return e=>e/255;case V:return e=>Math.max(e/32767,-1);case D:return e=>e/65535;default:return e=>e}})(n),r=t.length;for(let n=0;n<r;++n)e[n]=s(t[n]);return e},Se=function e(t,n,s=!1){const r=Ue(t.type),o=function(e){switch(e){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:return null}}(t.componentType);if(!o)return null;const a=n[t.bufferView];let i;if(t.sparse){const s=t.sparse,a={count:s.count,type:"SCALAR"},l=e(Object.assign(a,s.indices),n,!0),c={count:s.count,type:t.scalar,componentType:t.componentType},u=e(Object.assign(c,s.values),n,!0);if(t.hasOwnProperty("bufferView")){i=e({bufferView:t.bufferView,byteOffset:t.byteOffset,componentType:t.componentType,count:t.count,type:t.type},n,!0).slice()}else i=new o(t.count*r);for(let e=0;e<s.count;++e){const t=l[e];for(let n=0;n<r;++n)i[t*r+n]=u[e*r+n]}}else if(s&&a.hasOwnProperty("byteStride")){const e=r*o.BYTES_PER_ELEMENT,n=new ArrayBuffer(t.count*e),s=new Uint8Array(n);let l=0;for(let n=0;n<t.count;++n){let r=(t.byteOffset||0)+n*a.byteStride;for(let t=0;t<e;++t)s[l++]=a[r++]}i=new o(n)}else i=new o(a.buffer,a.byteOffset+(t.byteOffset||0),t.count*r);return i},je=function(e,t){const n=Se(e,t,!0);if(n instanceof Float32Array||!e.normalized)return n;const s=new Float32Array(n.length);return Ie(s,n,De(e.componentType)),s},He=function(e){let t=e.min,n=e.max;if(!t||!n)return null;if(e.normalized){const s=De(e.componentType);t=Ie([],t,s),n=Ie([],n,s)}return new i(new o(.5*(n[0]+t[0]),.5*(n[1]+t[1]),.5*(n[2]+t[2])),new o(.5*(n[0]-t[0]),.5*(n[1]-t[1]),.5*(n[2]-t[2])))},Le=function(e,t){const n=e[S];if(!n||3!==n.components)return;let s;if(n.size!==n.stride){const e=n.stride/J[n.type],t=new Q[n.type](n.buffer,n.offset,n.count*e);s=new Q[n.type](3*n.count);for(let r=0;r<n.count;++r)s[3*r+0]=t[r*e+0],s[3*r+1]=t[r*e+1],s[3*r+2]=t[r*e+2]}else s=new Q[n.type](n.buffer,n.offset,3*n.count);const r=n.count;t||(t=function(e){const t=new Uint16Array(e);for(let n=0;n<e;n++)t[n]=n;return t}(r));const o=fe(s,t),a=new Float32Array(o.length);a.set(o),e[P]={buffer:a.buffer,size:12,offset:0,stride:12,count:r,components:3,type:b}},Ne=function(e){const t=new _e(e.name+"_clone",e.type,e.file,e.data,e.options);return t.loaded=!0,t.resource=function(e){const t=new ee(e.device,e);return t._levels=function(e){const t=[];for(let n=0;n<e._levels.length;++n){let s=[];if(e.cubemap)for(let t=0;t<6;++t)s.push(e._levels[n][t]);else s=e._levels[n];t.push(s)}return t}(e),t}(e.resource),e.registry.add(t),t},Ke=function(e,t,n){const s=t[S];if(!s)return null;const r=s.count,o=[];for(const e in t)t.hasOwnProperty(e)&&o.push({semantic:e,components:t[e].components,type:t[e].type,normalize:!!t[e].normalize});const a=[S,P,j,H,L,N,K,z];let i,l,c,u,f,h;o.sort((function(e,t){const n=a.indexOf(e.semantic),s=a.indexOf(t.semantic);return n<s?-1:s<n?1:0}));const m=new ne(e,o);let d=!0;for(i=0;i<m.elements.length;++i)if(f=m.elements[i],u=t[f.name],h=u.offset-s.offset,u.buffer!==s.buffer||u.stride!==f.stride||u.size!==f.size||h!==f.offset){d=!1;break}const y=new te(e,m,r,p),g=y.lock(),w=new Uint32Array(g);let O;if(d)O=new Uint32Array(s.buffer,s.offset,r*y.format.size/4),w.set(O);else{let e,n;for(i=0;i<y.format.elements.length;++i){f=y.format.elements[i],e=f.stride/4,u=t[f.name],n=u.stride/4,O=new Uint32Array(u.buffer,u.offset,(u.count-1)*n+(u.size+3)/4);let s=0,o=f.offset/4;const a=Math.floor((u.size+3)/4);for(l=0;l<r;++l){for(c=0;c<a;++c)w[o+c]=O[s+c];s+=n,o+=e}}}return n&&function(e){let t,n;const s=[],r=[],o=[];for(t=0;t<e.format.elements.length;++t){const n=e.format.elements[t];if(n.name===K||n.name===z)switch(n.dataType){case b:s.push({offset:n.offset/4+1,stride:n.stride/4});break;case D:r.push({offset:n.offset/2+1,stride:n.stride/2});break;case k:o.push({offset:n.offset+1,stride:n.stride})}}const a=function(s,r,o){const a=new r(e.storage);for(t=0;t<s.length;++t){let r=s[t].offset;const i=s[t].stride;for(n=0;n<e.numVertices;++n)a[r]=o-a[r],r+=i}};s.length>0&&a(s,Float32Array,1),r.length>0&&a(r,Uint16Array,65535),o.length>0&&a(o,Uint8Array,255)}(y),y.unlock(),y},ze=new s,Be=new o,$e=function(e,t,n,s,r,o,a,i,l){const c=[];return t.primitives.forEach((function(T){let M,C,_,A=null,v=!0;if(T.hasOwnProperty("extensions")){const t=T.extensions;if(t.hasOwnProperty("KHR_draco_mesh_compression")){const n=Re||Ee();if(n){const a=t.KHR_draco_mesh_compression;if(a.hasOwnProperty("attributes")){const t=s[a.bufferView],i=new n.DecoderBuffer;i.Init(t,t.length);const l=new n.Decoder,c=l.GetEncodedGeometryType(i);let u,f;switch(c){case n.POINT_CLOUD:M=O,u=new n.PointCloud,f=l.DecodeBufferToPointCloud(i,u);break;case n.TRIANGULAR_MESH:M=h,u=new n.Mesh,f=l.DecodeBufferToMesh(i,u);case n.INVALID_GEOMETRY_TYPE:}if(!f||!f.ok()||0===u.ptr)return void r("Failed to decode draco compressed asset: "+(f?f.error_msg():"Mesh asset - invalid draco compressed geometry type: "+c));const p=u.num_faces();if(c===n.TRIANGULAR_MESH){const e=u.num_points()>65535;_=3*p;const t=_*(e?4:2),s=n._malloc(t);e?(l.GetTrianglesUInt32Array(u,t,s),A=new Uint32Array(n.HEAPU32.buffer,s,_).slice()):(l.GetTrianglesUInt16Array(u,t,s),A=new Uint16Array(n.HEAPU16.buffer,s,_).slice()),n._free(s)}C=function(e,t,n,s,r,o,a){const i=t.num_points(),l=function(e,n){const o=s.GetAttributeByUniqueId(t,e),a=i*o.num_components();let l,c,u,f;switch(o.data_type()){case r.DT_UINT8:f=k,u=1,l=r._malloc(a*u),s.GetAttributeDataArrayForAllPoints(t,o,r.DT_UINT8,a*u,l),c=new Uint8Array(r.HEAPU8.buffer,l,a).slice();break;case r.DT_UINT16:f=D,u=2,l=r._malloc(a*u),s.GetAttributeDataArrayForAllPoints(t,o,r.DT_UINT16,a*u,l),c=new Uint16Array(r.HEAPU16.buffer,l,a).slice();break;case r.DT_FLOAT32:default:f=b,u=4,l=r._malloc(a*u),s.GetAttributeDataArrayForAllPoints(t,o,r.DT_FLOAT32,a*u,l),c=new Float32Array(r.HEAPF32.buffer,l,a).slice()}return r._free(l),{values:c,numComponents:o.num_components(),componentSizeInBytes:u,storageType:f,normalized:n===H&&f===k||o.normalized()}},c={},u=n.attributes;for(const e in u)if(u.hasOwnProperty(e)&&ke.hasOwnProperty(e)){const t=ke[e],n=l(u[e],t),s=n.numComponents*n.componentSizeInBytes;c[t]={values:n.values,buffer:n.values.buffer,size:s,offset:0,stride:s,count:i,components:n.numComponents,type:n.storageType,normalize:n.normalized}}return c.hasOwnProperty(P)||Le(c,o),Ke(e,c,a)}(e,u,a,l,n,A,o),n.destroy(u),n.destroy(l),n.destroy(i),v=!1}}}}C||(A=T.hasOwnProperty("indices")?Se(n[T.indices],s,!0):null,C=function(e,t,n,s,r,o,a){const i={},l=[];for(const e in t)t.hasOwnProperty(e)&&ke.hasOwnProperty(e)&&(i[e]=t[e],l.push(e+":"+t[e]));l.sort();const c=l.join();let u=a[c];if(!u){const l={};for(const e in i){const n=s[t[e]],o=Se(n,r),a=r[n.bufferView],i=ke[e],c=Ue(n.type)*Ve(n.componentType),u=a.hasOwnProperty("byteStride")?a.byteStride:c;l[i]={buffer:o.buffer,size:c,offset:o.byteOffset,stride:u,count:n.count,components:Ue(n.type),type:De(n.componentType),normalize:n.normalized}}l.hasOwnProperty(P)||Le(l,n),u=Ke(e,l,o),a[c]=u}return u}(e,T.attributes,A,n,s,o,a),M=function(e){if(!e.hasOwnProperty("mode"))return h;switch(e.mode){case 0:return O;case 1:return w;case 2:return g;case 3:return y;case 4:default:return h;case 5:return d;case 6:return m}}(T));let R=null;if(C){if(R=new he(e),R.vertexBuffer=C,R.primitive[0].type=M,R.primitive[0].base=0,R.primitive[0].indexed=null!==A,null!==A){let t;t=A instanceof Uint8Array?x:A instanceof Uint16Array?f:u,t!==u||e.extUintElement||(t=f,A=new Uint16Array(A));const n=new Z(e,t,A.length,p,A);R.indexBuffer[0]=n,R.primitive[0].count=A.length}else R.primitive[0].count=C.numVertices;if(T.hasOwnProperty("extensions")&&T.extensions.hasOwnProperty("KHR_materials_variants")){const e=T.extensions.KHR_materials_variants,t={};e.mappings.forEach((e=>{e.variants.forEach((n=>{t[n]=e.material}))})),i[R.id]=t}l[R.id]=T.material;let r=n[T.attributes.POSITION];if(R.aabb=He(r),v&&T.hasOwnProperty("targets")){const o=[];T.targets.forEach((function(e,a){const i={};e.hasOwnProperty("POSITION")&&(r=n[e.POSITION],i.deltaPositions=je(r,s),i.deltaPositionsType=b,i.aabb=He(r)),e.hasOwnProperty("NORMAL")&&(r=n[e.NORMAL],i.deltaNormals=je(r,s),i.deltaNormalsType=b),t.hasOwnProperty("extras")&&t.extras.hasOwnProperty("targetNames")?i.name=t.extras.targetNames[a]:i.name=a.toString(10),t.hasOwnProperty("weights")&&(i.defaultWeight=t.weights[a]),o.push(new de(i))})),R.morph=new me(o,e)}}c.push(R)})),c},Xe=function(e,t,s){var o;let a;const i=e.texCoord;if(i)for(a=0;a<s.length;++a)t[s[a]+"MapUv"]=i;const l=[0,0],c=[1,1],u=null==(o=e.extensions)?void 0:o.KHR_texture_transform;if(u){const e=u.offset||l,o=u.scale||c,i=u.rotation?-u.rotation*n.RAD_TO_DEG:0,f=new r(o[0],o[1]),p=new r(e[0],1-o[1]-e[1]);for(a=0;a<s.length;++a)t[`${s[a]}MapTiling`]=f,t[`${s[a]}MapOffset`]=p,t[`${s[a]}MapRotation`]=i}},We=function(e,t,n){let s,r;if(e.hasOwnProperty("diffuseFactor")?(s=e.diffuseFactor,t.diffuse.set(Math.pow(s[0],1/2.2),Math.pow(s[1],1/2.2),Math.pow(s[2],1/2.2)),t.opacity=s[3]):(t.diffuse.set(1,1,1),t.opacity=1),e.hasOwnProperty("diffuseTexture")){const s=e.diffuseTexture;r=n[s.index],t.diffuseMap=r,t.diffuseMapChannel="rgb",t.opacityMap=r,t.opacityMapChannel="a",Xe(s,t,["diffuse","opacity"])}if(t.useMetalness=!1,e.hasOwnProperty("specularFactor")?(s=e.specularFactor,t.specular.set(Math.pow(s[0],1/2.2),Math.pow(s[1],1/2.2),Math.pow(s[2],1/2.2))):t.specular.set(1,1,1),e.hasOwnProperty("glossinessFactor")?t.shininess=100*e.glossinessFactor:t.shininess=100,e.hasOwnProperty("specularGlossinessTexture")){const s=e.specularGlossinessTexture;t.specularEncoding="srgb",t.specularMap=t.glossMap=n[s.index],t.specularMapChannel="rgb",t.glossMapChannel="a",Xe(s,t,["gloss","metalness"])}},Ye=function(e,t,n){if(e.hasOwnProperty("clearcoatFactor")?t.clearCoat=.25*e.clearcoatFactor:t.clearCoat=0,e.hasOwnProperty("clearcoatTexture")){const s=e.clearcoatTexture;t.clearCoatMap=n[s.index],t.clearCoatMapChannel="r",Xe(s,t,["clearCoat"])}if(e.hasOwnProperty("clearcoatRoughnessFactor")?t.clearCoatGlossiness=e.clearcoatRoughnessFactor:t.clearCoatGlossiness=0,e.hasOwnProperty("clearcoatRoughnessTexture")){const s=e.clearcoatRoughnessTexture;t.clearCoatGlossMap=n[s.index],t.clearCoatGlossMapChannel="g",Xe(s,t,["clearCoatGloss"])}if(e.hasOwnProperty("clearcoatNormalTexture")){const s=e.clearcoatNormalTexture;t.clearCoatNormalMap=n[s.index],Xe(s,t,["clearCoatNormal"]),s.hasOwnProperty("scale")&&(t.clearCoatBumpiness=s.scale)}t.chunks.clearCoatGlossPS="\n        #ifdef MAPFLOAT\n        uniform float material_clearCoatGlossiness;\n        #endif\n        \n        #ifdef MAPTEXTURE\n        uniform sampler2D texture_clearCoatGlossMap;\n        #endif\n        \n        void getClearCoatGlossiness() {\n            ccGlossiness = 1.0;\n        \n        #ifdef MAPFLOAT\n            ccGlossiness *= material_clearCoatGlossiness;\n        #endif\n        \n        #ifdef MAPTEXTURE\n            ccGlossiness *= texture2DBias(texture_clearCoatGlossMap, $UV, textureBias).$CH;\n        #endif\n        \n        #ifdef MAPVERTEX\n            ccGlossiness *= saturate(vVertexColor.$VC);\n        #endif\n        \n            ccGlossiness = 1.0 - ccGlossiness;\n        \n            ccGlossiness += 0.0000001;\n        }\n        "},qe=function(e,t,n){t.useLighting=!1,t.emissive.copy(t.diffuse),t.emissiveTint=t.diffuseTint,t.emissiveMap=t.diffuseMap,t.emissiveMapUv=t.diffuseMapUv,t.emissiveMapTiling.copy(t.diffuseMapTiling),t.emissiveMapOffset.copy(t.diffuseMapOffset),t.emissiveMapRotation=t.diffuseMapRotation,t.emissiveMapChannel=t.diffuseMapChannel,t.emissiveVertexColor=t.diffuseVertexColor,t.emissiveVertexColorChannel=t.diffuseVertexColorChannel,t.diffuse.set(0,0,0),t.diffuseTint=!1,t.diffuseMap=null,t.diffuseVertexColor=!1},Je=function(e,t,n){if(t.useMetalnessSpecularColor=!0,e.hasOwnProperty("specularColorTexture")&&(t.specularEncoding="srgb",t.specularMap=n[e.specularColorTexture.index],t.specularMapChannel="rgb",Xe(e.specularColorTexture,t,["specular"])),e.hasOwnProperty("specularColorFactor")){const n=e.specularColorFactor;t.specular.set(Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2))}else t.specular.set(1,1,1);e.hasOwnProperty("specularFactor")?t.specularityFactor=e.specularFactor:t.specularityFactor=1,e.hasOwnProperty("specularTexture")&&(t.specularityFactorMapChannel="a",t.specularityFactorMap=n[e.specularTexture.index],Xe(e.specularTexture,t,["specularityFactor"]))},Qe=function(e,t,n){e.hasOwnProperty("ior")&&(t.refractionIndex=1/e.ior)},Ze=function(e,t,n){t.blendType=oe,t.useDynamicRefraction=!0,e.hasOwnProperty("transmissionFactor")&&(t.refraction=e.transmissionFactor),e.hasOwnProperty("transmissionTexture")&&(t.refractionMapChannel="r",t.refractionMap=n[e.transmissionTexture.index],Xe(e.transmissionTexture,t,["refraction"]))},et=function(e,t,n){if(t.useSheen=!0,e.hasOwnProperty("sheenColorFactor")){const n=e.sheenColorFactor;t.sheen.set(Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2))}else t.sheen.set(1,1,1);e.hasOwnProperty("sheenColorTexture")&&(t.sheenMap=n[e.sheenColorTexture.index],Xe(e.sheenColorTexture,t,["sheen"])),e.hasOwnProperty("sheenRoughnessFactor")?t.sheenGlossiness=e.sheenRoughnessFactor:t.sheenGlossiness=0,e.hasOwnProperty("sheenRoughnessTexture")&&(t.sheenGlossinessMap=n[e.sheenRoughnessTexture.index],t.sheenGlossinessMapChannel="a",Xe(e.sheenRoughnessTexture,t,["sheenGlossiness"]));t.chunks.sheenGlossPS="\n    #ifdef MAPFLOAT\n    uniform float material_sheenGlossiness;\n    #endif\n\n    #ifdef MAPTEXTURE\n    uniform sampler2D texture_sheenGlossinessMap;\n    #endif\n\n    void getSheenGlossiness() {\n        float sheenGlossiness = 1.0;\n\n        #ifdef MAPFLOAT\n        sheenGlossiness *= material_sheenGlossiness;\n        #endif\n\n        #ifdef MAPTEXTURE\n        sheenGlossiness *= texture2DBias(texture_sheenGlossinessMap, $UV, textureBias).$CH;\n        #endif\n\n        #ifdef MAPVERTEX\n        sheenGlossiness *= saturate(vVertexColor.$VC);\n        #endif\n\n        sheenGlossiness = 1.0 - sheenGlossiness;\n        sheenGlossiness += 0.0000001;\n        sGlossiness = sheenGlossiness;\n    }\n    "},tt=function(e,t,n){if(t.blendType=oe,t.useDynamicRefraction=!0,e.hasOwnProperty("thicknessFactor")&&(t.thickness=e.thicknessFactor),e.hasOwnProperty("thicknessTexture")&&(t.thicknessMap=n[e.thicknessTexture.index],Xe(e.thicknessTexture,t,["thickness"])),e.hasOwnProperty("attenuationDistance")&&(t.attenuationDistance=e.attenuationDistance),e.hasOwnProperty("attenuationColor")){const n=e.attenuationColor;t.attenuation.set(Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2))}},nt=function(e,t,n){e.hasOwnProperty("emissiveStrength")&&(t.emissiveIntensity=e.emissiveStrength)},st=function(e,t,n){const s=new ge;let r,o;if(s.occludeSpecular=se,s.diffuseTint=!0,s.diffuseVertexColor=!0,s.specularTint=!0,s.specularVertexColor=!0,e.hasOwnProperty("name")&&(s.name=e.name),e.hasOwnProperty("pbrMetallicRoughness")){const n=e.pbrMetallicRoughness;if(n.hasOwnProperty("baseColorFactor")?(r=n.baseColorFactor,s.diffuse.set(Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)),s.opacity=r[3]):(s.diffuse.set(1,1,1),s.opacity=1),n.hasOwnProperty("baseColorTexture")){const e=n.baseColorTexture;o=t[e.index],s.diffuseMap=o,s.diffuseMapChannel="rgb",s.opacityMap=o,s.opacityMapChannel="a",Xe(e,s,["diffuse","opacity"])}if(s.useMetalness=!0,s.specular.set(1,1,1),n.hasOwnProperty("metallicFactor")?s.metalness=n.metallicFactor:s.metalness=1,n.hasOwnProperty("roughnessFactor")?s.shininess=100*n.roughnessFactor:s.shininess=100,n.hasOwnProperty("metallicRoughnessTexture")){const e=n.metallicRoughnessTexture;s.metalnessMap=s.glossMap=t[e.index],s.metalnessMapChannel="b",s.glossMapChannel="g",Xe(e,s,["gloss","metalness"])}s.chunks.glossPS="\n        #ifdef MAPFLOAT\n        uniform float material_shininess;\n        #endif\n        \n        #ifdef MAPTEXTURE\n        uniform sampler2D texture_glossMap;\n        #endif\n        \n        void getGlossiness() {\n            dGlossiness = 1.0;\n        \n        #ifdef MAPFLOAT\n            dGlossiness *= material_shininess;\n        #endif\n        \n        #ifdef MAPTEXTURE\n            dGlossiness *= texture2DBias(texture_glossMap, $UV, textureBias).$CH;\n        #endif\n        \n        #ifdef MAPVERTEX\n            dGlossiness *= saturate(vVertexColor.$VC);\n        #endif\n        \n            dGlossiness = 1.0 - dGlossiness;\n        \n            dGlossiness += 0.0000001;\n        }\n        "}if(e.hasOwnProperty("normalTexture")){const n=e.normalTexture;s.normalMap=t[n.index],Xe(n,s,["normal"]),n.hasOwnProperty("scale")&&(s.bumpiness=n.scale)}if(e.hasOwnProperty("occlusionTexture")){const n=e.occlusionTexture;s.aoMap=t[n.index],s.aoMapChannel="r",Xe(n,s,["ao"])}if(e.hasOwnProperty("emissiveFactor")?(r=e.emissiveFactor,s.emissive.set(Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)),s.emissiveTint=!0):(s.emissive.set(0,0,0),s.emissiveTint=!1),e.hasOwnProperty("emissiveTexture")){const n=e.emissiveTexture;s.emissiveMap=t[n.index],Xe(n,s,["emissive"])}if(e.hasOwnProperty("alphaMode"))switch(e.alphaMode){case"MASK":s.blendType=re,e.hasOwnProperty("alphaCutoff")?s.alphaTest=e.alphaCutoff:s.alphaTest=.5;break;case"BLEND":s.blendType=oe,s.depthWrite=!1;break;default:s.blendType=re}else s.blendType=re;e.hasOwnProperty("doubleSided")?(s.twoSidedLighting=e.doubleSided,s.cull=e.doubleSided?l:c):(s.twoSidedLighting=!1,s.cull=c);const a={KHR_materials_clearcoat:Ye,KHR_materials_emissive_strength:nt,KHR_materials_ior:Qe,KHR_materials_pbrSpecularGlossiness:We,KHR_materials_sheen:et,KHR_materials_specular:Je,KHR_materials_transmission:Ze,KHR_materials_unlit:qe,KHR_materials_volume:tt};if(e.hasOwnProperty("extensions"))for(const n in e.extensions){const r=a[n];void 0!==r&&r(e.extensions[n],s,t)}return s.update(),s},rt=function(e,t){const n=new pe;if(e.hasOwnProperty("name")&&e.name.length>0?n.name=e.name:n.name="node_"+t,e.hasOwnProperty("matrix")&&(ze.data.set(e.matrix),ze.getTranslation(Be),n.setLocalPosition(Be),ze.getEulerAngles(Be),n.setLocalEulerAngles(Be),ze.getScale(Be),n.setLocalScale(Be)),e.hasOwnProperty("rotation")){const t=e.rotation;n.setLocalRotation(t[0],t[1],t[2],t[3])}if(e.hasOwnProperty("translation")){const t=e.translation;n.setLocalPosition(t[0],t[1],t[2])}if(e.hasOwnProperty("scale")){const t=e.scale;n.setLocalScale(t[0],t[1],t[2])}return n},ot=function(e,t){const s="orthographic"===e.type?ae:ie,r=s===ae?e.orthographic:e.perspective,o={enabled:!1,projection:s,nearClip:r.znear,aspectRatioMode:le};r.zfar&&(o.farClip=r.zfar),s===ae?(o.orthoHeight=.5*r.ymag,r.ymag&&(o.aspectRatioMode=ue,o.aspectRatio=r.xmag/r.ymag)):(o.fov=r.yfov*n.RAD_TO_DEG,r.aspectRatio&&(o.aspectRatioMode=ue,o.aspectRatio=r.aspectRatio));const a=new Oe(e.name);return a.addComponent("camera",o),a},at=function(e,t){const s={enabled:!1,type:"point"===e.type?"omni":e.type,color:e.hasOwnProperty("color")?new a(e.color):a.WHITE,range:e.hasOwnProperty("range")?e.range:9999,falloffMode:ce,intensity:e.hasOwnProperty("intensity")?n.clamp(e.intensity,0,2):1};e.hasOwnProperty("intensity")&&("point"===e.type||"omni"===e.type?s.luminance=e.intensity*(4*Math.PI):"spot"===e.type?e.hasOwnProperty("spot")&&e.spot.hasOwnProperty("outerConeAngle")?s.luminance=e.intensity*(2*Math.PI*(1-Math.cos(e.spot.outerConeAngle/2))):s.luminance=e.intensity*(4*Math.PI):s.luminance=e.intensity),e.hasOwnProperty("spot")&&(s.innerConeAngle=e.spot.hasOwnProperty("innerConeAngle")?e.spot.innerConeAngle*n.RAD_TO_DEG:0,s.outerConeAngle=e.spot.hasOwnProperty("outerConeAngle")?e.spot.outerConeAngle*n.RAD_TO_DEG:Math.PI/4);const r=new Oe(t.name);return r.rotateLocal(90,0,0),r.addComponent("light",s),r},it=function(e,t,n,r){if(!t.hasOwnProperty("skins")||0===t.skins.length)return[];const o=new Map;return t.skins.map((function(a){return function(e,t,n,r,o,a){let i,l,c;const u=t.joints,f=u.length,p=[];if(t.hasOwnProperty("inverseBindMatrices")){const e=t.inverseBindMatrices,o=Se(n[e],r,!0),a=[];for(i=0;i<f;i++){for(l=0;l<16;l++)a[l]=o[16*i+l];c=new s,c.set(a),p.push(c)}}else for(i=0;i<f;i++)c=new s,p.push(c);const h=[];for(i=0;i<f;i++)h[i]=o[u[i]].name;const m=h.join("#");let d=a.get(m);return d||(d=new ye(e,p,h),a.set(m,d)),d}(e,a,t.accessors,r,n,o)}))},lt=function(e,t,n,s){if(!e.hasOwnProperty("animations")||0===e.animations.length)return[];const r=s&&s.animation&&s.animation.preprocess,o=s&&s.animation&&s.animation.postprocess;return e.animations.map((function(s,a){r&&r(s);const i=function(e,t,n,s,r,o){const a=function(e){return new xe(Ue(e.type),je(e,s))},i={STEP:Ce,LINEAR:Te,CUBICSPLINE:Me},l={},c={},u={};let f,p=1;for(f=0;f<e.samplers.length;++f){const t=e.samplers[f];l.hasOwnProperty(t.input)||(l[t.input]=a(n[t.input])),c.hasOwnProperty(t.output)||(c[t.output]=a(n[t.output]));const s=t.hasOwnProperty("interpolation")&&i.hasOwnProperty(t.interpolation)?i[t.interpolation]:Te,r={paths:[],input:t.input,output:t.output,interpolation:s};u[f]=r}const h=[],m={translation:"localPosition",rotation:"localRotation",scale:"localScale"},d=e=>{const t=[];for(;e;)t.unshift(e.name),e=e.parent;return t},y=(e,t)=>{if(!o)return t;for(let n=0;n<o.length;n++){const s=o[n];if(s.name===e&&s.hasOwnProperty("extras")&&s.extras.hasOwnProperty("targetNames")&&s.extras.targetNames[t])return`name.${s.extras.targetNames[t]}`}return t},g=(e,t,n)=>{if(!c[e.output])return;const s=c[e.output].data.length/l[e.input].data.length,r=c[e.output].data.length/s;for(let o=0;o<s;o++){const a=new Float32Array(r);for(let t=0;t<r;t++)a[t]=c[e.output].data[t*s+o];const i=new xe(1,a);c[-p]=i;const l={paths:[{entityPath:n,component:"graph",propertyPath:[`weight.${y(t.name,o)}`]}],input:e.input,output:-p,interpolation:e.interpolation};p++,u[`morphCurve-${f}-${o}`]=l}};for(f=0;f<e.channels.length;++f){const t=e.channels[f],n=t.target,s=u[t.sampler],o=r[n.node],a=d(o);n.path.startsWith("weights")?(g(s,o,a),delete u[t.sampler],delete c[s.output]):s.paths.push({entityPath:a,component:"graph",propertyPath:[m[n.path]]})}const w=[],O=[],P=[];for(const e in l)w.push(l[e]),l[e]=w.length-1;for(const e in c)O.push(c[e]),c[e]=O.length-1;for(const e in u){const t=u[e];P.push(new Pe(t.paths,l[t.input],c[t.output],t.interpolation)),"localRotation"===t.paths[0].propertyPath[0]&&t.interpolation!==Me&&h.push(P[P.length-1].output)}h.sort();let x,b=null;for(f=0;f<h.length;++f){const e=h[f];if(0===f||e!==b){if(x=O[e],4===x.components){const e=x.data,t=e.length-4;for(let n=0;n<t;n+=4)e[n+0]*e[n+4]+e[n+1]*e[n+5]+e[n+2]*e[n+6]+e[n+3]*e[n+7]<0&&(e[n+4]*=-1,e[n+5]*=-1,e[n+6]*=-1,e[n+7]*=-1)}b=e}}let T=0;for(f=0;f<w.length;f++)x=w[f]._data,T=Math.max(T,0===x.length?0:x[x.length-1]);return new be(e.hasOwnProperty("name")?e.name:"animation_"+t,T,w,O,P)}(s,a,e.accessors,n,t,e.meshes);return o&&o(s,i),i}))},ct=function(e,t,n,s,r,o){const a=r&&r.global&&r.global.preprocess,i=r&&r.global&&r.global.postprocess;a&&a(t);const l=t.asset&&"PlayCanvas"===t.asset.generator,c=function(e,t){if(!e.hasOwnProperty("nodes")||0===e.nodes.length)return[];const n=t&&t.node&&t.node.preprocess,s=t&&t.node&&t.node.process||rt,r=t&&t.node&&t.node.postprocess,o=e.nodes.map((function(e,t){n&&n(e);const o=s(e,t);return r&&r(e,o),o}));for(let t=0;t<e.nodes.length;++t){const n=e.nodes[t];if(n.hasOwnProperty("children")){const e=o[t],s={};for(let t=0;t<n.children.length;++t){const r=o[n.children[t]];r.parent||(s.hasOwnProperty(r.name)?r.name+=s[r.name]++:s[r.name]=1,e.addChild(r))}}}return o}(t,r),u=function(e,t){var n;const s=[],r=e.scenes.length;if(1===r&&1===(null==(n=e.scenes[0].nodes)?void 0:n.length)){const n=e.scenes[0].nodes[0];s.push(t[n])}else for(let n=0;n<r;n++){const r=e.scenes[n];if(r.nodes){const e=new pe(r.name);for(let n=0;n<r.nodes.length;n++){const s=t[r.nodes[n]];e.addChild(s)}s.push(e)}}return s}(t,c),f=function(e,t,n){let s=null;if(e.hasOwnProperty("nodes")&&e.hasOwnProperty("extensions")&&e.extensions.hasOwnProperty("KHR_lights_punctual")&&e.extensions.KHR_lights_punctual.hasOwnProperty("lights")){const r=e.extensions.KHR_lights_punctual.lights;if(r.length){const o=n&&n.light&&n.light.preprocess,a=n&&n.light&&n.light.process||at,i=n&&n.light&&n.light.postprocess;e.nodes.forEach((function(e,n){if(e.hasOwnProperty("extensions")&&e.extensions.hasOwnProperty("KHR_lights_punctual")&&e.extensions.KHR_lights_punctual.hasOwnProperty("light")){const l=e.extensions.KHR_lights_punctual.light,c=r[l];if(c){o&&o(c);const r=a(c,t[n]);i&&i(c,r),r&&(s||(s=new Map),s.set(e,r))}}}))}}return s}(t,c,r),p=function(e,t,n){let s=null;if(e.hasOwnProperty("nodes")&&e.hasOwnProperty("cameras")&&e.cameras.length>0){const r=n&&n.camera&&n.camera.preprocess,o=n&&n.camera&&n.camera.process||ot,a=n&&n.camera&&n.camera.postprocess;e.nodes.forEach((function(n,i){if(n.hasOwnProperty("camera")){const l=e.cameras[n.camera];if(l){r&&r(l);const e=o(l,t[i]);a&&a(l,e),e&&(s||(s=new Map),s.set(n,e))}}}))}return s}(t,c,r),h=lt(t,c,n,r),m=function(e,t,n,s){if(!e.hasOwnProperty("materials")||0===e.materials.length)return[];const r=n&&n.material&&n.material.preprocess,o=n&&n.material&&n.material.process||st,a=n&&n.material&&n.material.postprocess;return e.materials.map((function(e){r&&r(e);const n=o(e,t,s);return a&&a(e,n),n}))}(t,s.map((function(e){return e.resource})),r,l),d=function(e){if(!e.hasOwnProperty("extensions")||!e.extensions.hasOwnProperty("KHR_materials_variants"))return null;const t=e.extensions.KHR_materials_variants.variants,n={};for(let e=0;e<t.length;e++)n[t[e].name]=e;return n}(t),y={},g={},w=function(e,t,n,s,r,o,a){if(!t.hasOwnProperty("meshes")||0===t.meshes.length||!t.hasOwnProperty("accessors")||0===t.accessors.length||!t.hasOwnProperty("bufferViews")||0===t.bufferViews.length)return[];const i={};return t.meshes.map((function(l){return $e(e,l,t.accessors,n,s,r,i,o,a)}))}(e,t,n,o,l,y,g),O=it(e,t,c,n),P=[];for(let e=0;e<w.length;e++)P[e]=new we,P[e].meshes=w[e];!function(e,t,n){e.nodes.forEach((e=>{e.hasOwnProperty("mesh")&&e.hasOwnProperty("skin")&&t[e.mesh].meshes.forEach((t=>{t.skin=n[e.skin]}))}))}(t,P,O);const x=new Ge(t);x.nodes=c,x.scenes=u,x.animations=h,x.textures=s,x.materials=m,x.variants=d,x.meshVariants=y,x.meshDefaultMaterials=g,x.renders=P,x.skins=O,x.lights=f,x.cameras=p,i&&i(t,x),o(null,x)};let ut=0;const ft=function(t,n,s,r,o,a,i){const l=a&&a.image&&a.image.preprocess,c=a&&a.image&&a.image.processAsync||function(e,t){t(null,null)},u=a&&a.image&&a.image.postprocess,f=function(e){u&&u(t,e),i(null,e)},p={"image/png":"png","image/jpeg":"jpg","image/basis":"basis","image/ktx":"ktx","image/ktx2":"ktx2","image/vnd-ms.dds":"dds"},h=function(e,n,s,r){const a=(t.name||"gltf-texture")+"-"+ut++,l={url:e||a};if(n&&(l.contents=n.slice(0).buffer),s){const e=p[s];e&&(l.filename=l.url+"."+e)}const c=new _e(a,"texture",l,null,r);c.on("load",f),c.on("error",i),o.add(c),o.load(c)};l&&l(t),c(t,(function(o,a){var l;o?i(o):a?f(a):t.hasOwnProperty("uri")?Fe(t.uri)?h(t.uri,null,(l=t.uri).substring(l.indexOf(":")+1,l.indexOf(";")),null):h(e.join(r,t.uri),null,null,{crossOrigin:"anonymous"}):t.hasOwnProperty("bufferView")&&t.hasOwnProperty("mimeType")?h(null,s[t.bufferView],t.mimeType,null):i("Invalid image found in gltf (neither uri or bufferView found). index="+n)}))},pt=function(e,t,n,s,r,o){if(!e.hasOwnProperty("images")||0===e.images.length||!e.hasOwnProperty("textures")||0===e.textures.length)return void o(null,[]);const a=r&&r.texture&&r.texture.preprocess,i=r&&r.texture&&r.texture.processAsync||function(e,t,n){n(null,null)},l=r&&r.texture&&r.texture.postprocess,c=[],u=[];let f=e.textures.length;const p=function(t,n){if(u[n]||(u[n]=[]),u[n].push(t),0==--f){const t=[];u.forEach((function(n,s){n.forEach((function(n,r){const o=0===r?c[s]:Ne(c[s]);!function(e,t){const n=function(e,t){switch(e){case 9728:return v;case 9729:return A;case 9984:return _;case 9985:return C;case 9986:return M;case 9987:return T;default:return t}},s=function(e,t){switch(e){case 33071:return G;case 33648:return E;case 10497:return R;default:return t}};e&&(t=t||{},e.minFilter=n(t.minFilter,T),e.magFilter=n(t.magFilter,A),e.addressU=s(t.wrapS,R),e.addressV=s(t.wrapT,R))}(o.resource,(e.samplers||[])[e.textures[n].sampler]),t[n]=o,l&&l(e.textures[n],o)}))})),o(null,t)}};for(let l=0;l<e.textures.length;++l){const u=e.textures[l];a&&a(u),i(u,e.images,function(a,i,l,u){if(l)o(l);else{var f,h;if(null==u)void 0===(u=null==i||null==(f=i.extensions)||null==(h=f.KHR_texture_basisu)?void 0:h.source)&&(u=i.source);if(c[u])p(a,u);else{const i=e.images[u];ft(i,a,t,n,s,r,(function(e,t){e?o(e):(c[u]=t,p(a,u))}))}}}.bind(null,l,u))}},ht=function(e,t){const n=JSON.parse(function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return decodeURIComponent(escape(t))}(e));if(n.asset&&n.asset.version&&parseFloat(n.asset.version)<2)return void t(`Invalid gltf version. Expected version 2.0 or above but found version '${n.asset.version}'.`);const s=(null==n?void 0:n.extensionsRequired)||[];Re||Ee()||-1===s.indexOf("KHR_draco_mesh_compression")?t(null,n):ve.getInstance("DracoDecoderModule",(e=>{Re=e,t(null,n)}))},mt=function(e,t,n){e&&e.toLowerCase().endsWith(".glb")?function(e,t){const n=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),s=n.getUint32(0,!0),r=n.getUint32(4,!0),o=n.getUint32(8,!0);if(1179937895!==s)return void t("Invalid magic number found in glb header. Expected 0x46546C67, found 0x"+s.toString(16));if(2!==r)return void t("Invalid version number found in glb header. Expected 2, found "+r);if(o<=0||o>n.byteLength)return void t("Invalid length found in glb header. Found "+o);const a=[];let i=12;for(;i<o;){const e=n.getUint32(i,!0);if(i+e+8>n.byteLength)throw new Error("Invalid chunk length found in glb. Found "+e);const t=n.getUint32(i+4,!0),s=new Uint8Array(n.buffer,n.byteOffset+i+8,e);a.push({length:e,type:t,data:s}),i+=e+8}1===a.length||2===a.length?1313821514===a[0].type?a.length>1&&5130562!==a[1].type?t("Invalid chunk type found in glb file. Expected 0x004E4942, found 0x"+a[1].type.toString(16)):t(null,{gltfChunk:a[0].data,binaryChunk:2===a.length?a[1].data:null}):t("Invalid chunk type found in glb file. Expected 0x4E4F534A, found 0x"+a[0].type.toString(16)):t("Invalid number of chunks found in glb file.")}(t,n):n(null,{gltfChunk:t,binaryChunk:null})},dt=function(e,t,n,s){const r=[],o=n&&n.bufferView&&n.bufferView.preprocess,a=n&&n.bufferView&&n.bufferView.processAsync||function(e,t,n){n(null,null)},i=n&&n.bufferView&&n.bufferView.postprocess;let l=e.bufferViews?e.bufferViews.length:0;if(!l)return void s(null,null);const c=function(t,n){const o=e.bufferViews[t];o.hasOwnProperty("byteStride")&&(n.byteStride=o.byteStride),r[t]=n,i&&i(o,n),0==--l&&s(null,r)};for(let n=0;n<e.bufferViews.length;++n){const r=e.bufferViews[n];o&&o(r),a(r,t,function(e,n,r,o){if(r)s(r);else if(o)c(e,o);else{const s=t[n.buffer],r=new Uint8Array(s.buffer,s.byteOffset+(n.byteOffset||0),n.byteLength);c(e,r)}}.bind(null,n,r))}};class yt{static parseAsync(n,s,r,o,a,i,l){mt(n,r,(function(n,r){n?l(n):ht(r.gltfChunk,(function(n,c){n?l(n):function(n,s,r,o,a){const i=[];if(!n.buffers||0===n.buffers.length)return void a(null,i);const l=o&&o.buffer&&o.buffer.preprocess,c=o&&o.buffer&&o.buffer.processAsync||function(e,t){t(null,null)},u=o&&o.buffer&&o.buffer.postprocess;let f=n.buffers.length;const p=function(e,t){i[e]=t,u&&u(n.buffers[e],t),0==--f&&a(null,i)};for(let o=0;o<n.buffers.length;++o){const i=n.buffers[o];l&&l(i),c(i,function(n,o,i,l){if(i)a(i);else if(l)p(n,new Uint8Array(l));else if(o.hasOwnProperty("uri"))if(Fe(o.uri)){const e=atob(o.uri.split(",")[1]),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);p(n,t)}else t.get(e.join(r,o.uri),{cache:!0,responseType:"arraybuffer",retry:!1},function(e,t,n){t?a(t):p(e,new Uint8Array(n))}.bind(null,n));else p(n,s)}.bind(null,o,i))}}(c,r.binaryChunk,s,i,(function(e,t){e?l(e):dt(c,t,i,(function(e,t){e?l(e):pt(c,t,s,a,i,(function(e,n){e?l(e):ct(o,c,t,n,i,l)}))}))}))}))}))}static parse(e,t,n,s){let r=null;return s=s||{},mt(e,t,(function(e,t){e?console.error(e):ht(t.gltfChunk,(function(e,o){e?console.error(e):dt(o,[t.binaryChunk],s,(function(e,t){e?console.error(e):ct(n,o,t,[],s,(function(e,t){e?console.error(e):r=t}))}))}))})),r}constructor(e,t,n){this._device=e,this._assets=t,this._defaultMaterial=st({name:"defaultGlbMaterial"},[]),this.maxRetries=n}_getUrlWithoutParams(e){return e.indexOf("?")>=0?e.split("?")[0]:e}load(t,n,s){_e.fetchArrayBuffer(t.load,((r,o)=>{r?n(r):yt.parseAsync(this._getUrlWithoutParams(t.original),e.extractPath(t.load),o,this._device,s.registry,s.options,((e,t)=>{e?n(e):n(null,new Ae(t,s,this._assets,this._defaultMaterial))}))}),s,this.maxRetries)}open(e,t,n){return t}patch(e,t){}}export{yt as GlbParser};
