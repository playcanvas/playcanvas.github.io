/**
 * @license
 * PlayCanvas Engine v1.62.0 revision 818511d2b (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { Color } from '../../core/math/color.js';
import { PIXELFORMAT_RGBA8, FILTER_NEAREST, ADDRESS_CLAMP_TO_EDGE, CLEARFLAG_DEPTH } from '../../platform/graphics/constants.js';
import { GraphicsDevice } from '../../platform/graphics/graphics-device.js';
import { RenderTarget } from '../../platform/graphics/render-target.js';
import { Texture } from '../../platform/graphics/texture.js';
import { DebugGraphics } from '../../platform/graphics/debug-graphics.js';
import { SHADER_PICK, SORTMODE_NONE } from '../../scene/constants.js';
import { Camera } from '../../scene/camera.js';
import { Command } from '../../scene/mesh-instance.js';
import { Layer } from '../../scene/layer.js';
import { LayerComposition } from '../../scene/composition/layer-composition.js';
import { getApplication } from '../globals.js';
import { Entity } from '../entity.js';
import { Debug } from '../../core/debug.js';
import { BlendState } from '../../platform/graphics/blend-state.js';

const tempSet = new Set();
const clearDepthOptions = {
  depth: 1.0,
  flags: CLEARFLAG_DEPTH
};

/**
 * Picker object used to select mesh instances from screen coordinates.
 *
 * @property {number} width Width of the pick buffer in pixels (read-only).
 * @property {number} height Height of the pick buffer in pixels (read-only).
 * @property {RenderTarget} renderTarget The render target used by the picker internally
 * (read-only).
 */
class Picker {
  // internal render target

  /**
   * Create a new Picker instance.
   *
   * @param {import('../app-base.js').AppBase} app - The application managing this picker
   * instance.
   * @param {number} width - The width of the pick buffer in pixels.
   * @param {number} height - The height of the pick buffer in pixels.
   */
  constructor(app, width, height) {
    this.renderTarget = null;
    if (app instanceof GraphicsDevice) {
      app = getApplication();
      Debug.deprecated('pc.Picker now takes pc.AppBase as first argument. Passing pc.GraphicsDevice is deprecated.');
    }
    this.app = app;
    this.device = app.graphicsDevice;

    // uniform for the mesh index encoded into rgba
    this.pickColor = new Float32Array(4);
    this.pickColor[3] = 1;

    // mapping table from ids to meshInstances
    this.mapping = [];

    // create layer composition with the layer and camera
    this.cameraEntity = null;
    this.layer = null;
    this.layerComp = null;
    this.initLayerComposition();

    // clear command user to simulate layer clearing, required due to storing meshes from multiple layers on a singe layer
    const device = this.device;
    this.clearDepthCommand = new Command(0, 0, function () {
      device.clear(clearDepthOptions);
    });
    this.width = 0;
    this.height = 0;
    this.resize(width, height);
  }

  /**
   * Return the list of mesh instances selected by the specified rectangle in the previously
   * prepared pick buffer.The rectangle using top-left coordinate system.
   *
   * @param {number} x - The left edge of the rectangle.
   * @param {number} y - The top edge of the rectangle.
   * @param {number} [width] - The width of the rectangle.
   * @param {number} [height] - The height of the rectangle.
   * @returns {import('../../scene/mesh-instance.js').MeshInstance[]} An array of mesh instances
   * that are in the selection.
   * @example
   * // Get the selection at the point (10,20)
   * var selection = picker.getSelection(10, 20);
   * @example
   * // Get all models in rectangle with corners at (10,20) and (20,40)
   * var selection = picker.getSelection(10, 20, 10, 20);
   */
  getSelection(x, y, width, height) {
    const device = this.device;
    if (typeof x === 'object') {
      Debug.deprecated('Picker.getSelection:param \'rect\' is deprecated, use \'x, y, width, height\' instead.');
      const rect = x;
      x = rect.x;
      y = rect.y;
      width = rect.width;
      height = rect.height;
    } else {
      y = this.renderTarget.height - (y + (height || 1));
    }

    // make sure we have nice numbers to work with
    x = Math.floor(x);
    y = Math.floor(y);
    width = Math.floor(Math.max(width || 1, 1));
    height = Math.floor(Math.max(height || 1, 1));

    // backup active render target
    const origRenderTarget = device.renderTarget;
    DebugGraphics.pushGpuMarker(device, 'PICKER');

    // Ready the device for rendering to the pick buffer
    device.setRenderTarget(this.renderTarget);
    device.updateBegin();
    const pixels = new Uint8Array(4 * width * height);
    device.readPixels(x, y, width, height, pixels);
    device.updateEnd();

    // Restore render target
    device.setRenderTarget(origRenderTarget);
    DebugGraphics.popGpuMarker(device);
    const mapping = this.mapping;
    for (let i = 0; i < width * height; i++) {
      const r = pixels[4 * i + 0];
      const g = pixels[4 * i + 1];
      const b = pixels[4 * i + 2];
      const index = r << 16 | g << 8 | b;

      // White is 'no selection'
      if (index !== 0xffffff) {
        tempSet.add(mapping[index]);
      }
    }

    // return the content of the set as an array
    const selection = [];
    tempSet.forEach(meshInstance => selection.push(meshInstance));
    tempSet.clear();
    return selection;
  }
  allocateRenderTarget() {
    const colorBuffer = new Texture(this.device, {
      format: PIXELFORMAT_RGBA8,
      width: this.width,
      height: this.height,
      mipmaps: false,
      minFilter: FILTER_NEAREST,
      magFilter: FILTER_NEAREST,
      addressU: ADDRESS_CLAMP_TO_EDGE,
      addressV: ADDRESS_CLAMP_TO_EDGE,
      name: 'pick'
    });
    this.renderTarget = new RenderTarget({
      colorBuffer: colorBuffer,
      depth: true
    });
  }
  releaseRenderTarget() {
    // unset it from the camera
    this.cameraEntity.camera.renderTarget = null;
    if (this.renderTarget) {
      this.renderTarget.destroyTextureBuffers();
      this.renderTarget.destroy();
      this.renderTarget = null;
    }
  }
  initLayerComposition() {
    const device = this.device;
    const self = this;
    const pickColorId = device.scope.resolve('uColor');

    // camera
    this.cameraEntity = new Entity();
    this.cameraEntity.addComponent('camera');

    // layer all meshes rendered for picking at added to
    this.layer = new Layer({
      name: 'Picker',
      shaderPass: SHADER_PICK,
      opaqueSortMode: SORTMODE_NONE,
      // executes just before the mesh is rendered. And index encoded in rgb is assigned to it
      onDrawCall: function (meshInstance, index) {
        self.pickColor[0] = (index >> 16 & 0xff) / 255;
        self.pickColor[1] = (index >> 8 & 0xff) / 255;
        self.pickColor[2] = (index & 0xff) / 255;
        pickColorId.setValue(self.pickColor);
        device.setBlendState(BlendState.DEFAULT);

        // keep the index -> meshInstance index mapping
        self.mapping[index] = meshInstance;
      }
    });
    this.layer.addCamera(this.cameraEntity.camera);

    // composition
    this.layerComp = new LayerComposition('picker');
    this.layerComp.pushOpaque(this.layer);
  }

  /**
   * Primes the pick buffer with a rendering of the specified models from the point of view of
   * the supplied camera. Once the pick buffer has been prepared, {@link Picker#getSelection} can
   * be called multiple times on the same picker object. Therefore, if the models or camera do
   * not change in any way, {@link Picker#prepare} does not need to be called again.
   *
   * @param {import('../components/camera/component.js').CameraComponent} camera - The camera
   * component used to render the scene.
   * @param {import('../../scene/scene.js').Scene} scene - The scene containing the pickable mesh
   * instances.
   * @param {Layer[]} [layers] - Layers from which objects will be picked. If not supplied, all layers of the specified camera will be used.
   */
  prepare(camera, scene, layers) {
    // handle deprecated arguments
    if (camera instanceof Camera) {
      Debug.deprecated('pc.Picker#prepare now takes pc.CameraComponent as first argument. Passing pc.Camera is deprecated.');

      // Get the camera component
      camera = camera.node.camera;
    }
    if (layers instanceof Layer) {
      layers = [layers];
    }

    // populate the layer with meshes and depth clear commands
    this.layer.clearMeshInstances();
    const destMeshInstances = this.layer.opaqueMeshInstances;

    // source mesh instances
    const srcLayers = scene.layers.layerList;
    const subLayerEnabled = scene.layers.subLayerEnabled;
    const isTransparent = scene.layers.subLayerList;
    for (let i = 0; i < srcLayers.length; i++) {
      const srcLayer = srcLayers[i];

      // skip the layer if it does not match the provided ones
      if (layers && layers.indexOf(srcLayer) < 0) {
        continue;
      }
      if (srcLayer.enabled && subLayerEnabled[i]) {
        // if the layer is rendered by the camera
        const layerCamId = srcLayer.cameras.indexOf(camera);
        if (layerCamId >= 0) {
          // if the layer clears the depth, add command to clear it
          if (srcLayer._clearDepthBuffer) {
            destMeshInstances.push(this.clearDepthCommand);
          }

          // copy all pickable mesh instances
          const meshInstances = isTransparent[i] ? srcLayer.instances.transparentMeshInstances : srcLayer.instances.opaqueMeshInstances;
          for (let j = 0; j < meshInstances.length; j++) {
            const meshInstance = meshInstances[j];
            if (meshInstance.pick) {
              destMeshInstances.push(meshInstance);
            }
          }
        }
      }
    }

    // make the render target the right size
    if (!this.renderTarget || this.width !== this.renderTarget.width || this.height !== this.renderTarget.height) {
      this.releaseRenderTarget();
      this.allocateRenderTarget();
    }

    // prepare the rendering camera
    this.updateCamera(camera);

    // clear registered meshes mapping
    this.mapping.length = 0;

    // render
    this.app.renderComposition(this.layerComp);
  }
  updateCamera(srcCamera) {
    // copy transform
    this.cameraEntity.copy(srcCamera.entity);
    this.cameraEntity.name = 'PickerCamera';

    // copy camera component properties - which overwrites few properties we change to what is needed later
    const destCamera = this.cameraEntity.camera;
    destCamera.copy(srcCamera);

    // set up clears
    destCamera.clearColorBuffer = true;
    destCamera.clearDepthBuffer = true;
    destCamera.clearStencilBuffer = true;
    destCamera.clearColor = Color.WHITE;

    // render target
    destCamera.renderTarget = this.renderTarget;

    // layers
    this.layer.clearCameras();
    this.layer.addCamera(destCamera);
    destCamera.layers = [this.layer.id];
  }

  /**
   * Sets the resolution of the pick buffer. The pick buffer resolution does not need to match
   * the resolution of the corresponding frame buffer use for general rendering of the 3D scene.
   * However, the lower the resolution of the pick buffer, the less accurate the selection
   * results returned by {@link Picker#getSelection}. On the other hand, smaller pick buffers
   * will yield greater performance, so there is a trade off.
   *
   * @param {number} width - The width of the pick buffer in pixels.
   * @param {number} height - The height of the pick buffer in pixels.
   */
  resize(width, height) {
    this.width = Math.floor(width);
    this.height = Math.floor(height);
  }
}

export { Picker };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGlja2VyLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2dyYXBoaWNzL3BpY2tlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb2xvciB9IGZyb20gJy4uLy4uL2NvcmUvbWF0aC9jb2xvci5qcyc7XG5cbmltcG9ydCB7IEFERFJFU1NfQ0xBTVBfVE9fRURHRSwgQ0xFQVJGTEFHX0RFUFRILCBGSUxURVJfTkVBUkVTVCwgUElYRUxGT1JNQVRfUkdCQTggfSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgR3JhcGhpY3NEZXZpY2UgfSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9ncmFwaGljcy1kZXZpY2UuanMnO1xuaW1wb3J0IHsgUmVuZGVyVGFyZ2V0IH0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvcmVuZGVyLXRhcmdldC5qcyc7XG5pbXBvcnQgeyBUZXh0dXJlIH0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvdGV4dHVyZS5qcyc7XG5pbXBvcnQgeyBEZWJ1Z0dyYXBoaWNzIH0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvZGVidWctZ3JhcGhpY3MuanMnO1xuXG5pbXBvcnQgeyBTSEFERVJfUElDSywgU09SVE1PREVfTk9ORSB9IGZyb20gJy4uLy4uL3NjZW5lL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBDYW1lcmEgfSBmcm9tICcuLi8uLi9zY2VuZS9jYW1lcmEuanMnO1xuaW1wb3J0IHsgQ29tbWFuZCB9IGZyb20gJy4uLy4uL3NjZW5lL21lc2gtaW5zdGFuY2UuanMnO1xuaW1wb3J0IHsgTGF5ZXIgfSBmcm9tICcuLi8uLi9zY2VuZS9sYXllci5qcyc7XG5pbXBvcnQgeyBMYXllckNvbXBvc2l0aW9uIH0gZnJvbSAnLi4vLi4vc2NlbmUvY29tcG9zaXRpb24vbGF5ZXItY29tcG9zaXRpb24uanMnO1xuXG5pbXBvcnQgeyBnZXRBcHBsaWNhdGlvbiB9IGZyb20gJy4uL2dsb2JhbHMuanMnO1xuaW1wb3J0IHsgRW50aXR5IH0gZnJvbSAnLi4vZW50aXR5LmpzJztcbmltcG9ydCB7IERlYnVnIH0gZnJvbSAnLi4vLi4vY29yZS9kZWJ1Zy5qcyc7XG5pbXBvcnQgeyBCbGVuZFN0YXRlIH0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvYmxlbmQtc3RhdGUuanMnO1xuXG5jb25zdCB0ZW1wU2V0ID0gbmV3IFNldCgpO1xuXG5jb25zdCBjbGVhckRlcHRoT3B0aW9ucyA9IHtcbiAgICBkZXB0aDogMS4wLFxuICAgIGZsYWdzOiBDTEVBUkZMQUdfREVQVEhcbn07XG5cbi8qKlxuICogUGlja2VyIG9iamVjdCB1c2VkIHRvIHNlbGVjdCBtZXNoIGluc3RhbmNlcyBmcm9tIHNjcmVlbiBjb29yZGluYXRlcy5cbiAqXG4gKiBAcHJvcGVydHkge251bWJlcn0gd2lkdGggV2lkdGggb2YgdGhlIHBpY2sgYnVmZmVyIGluIHBpeGVscyAocmVhZC1vbmx5KS5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBoZWlnaHQgSGVpZ2h0IG9mIHRoZSBwaWNrIGJ1ZmZlciBpbiBwaXhlbHMgKHJlYWQtb25seSkuXG4gKiBAcHJvcGVydHkge1JlbmRlclRhcmdldH0gcmVuZGVyVGFyZ2V0IFRoZSByZW5kZXIgdGFyZ2V0IHVzZWQgYnkgdGhlIHBpY2tlciBpbnRlcm5hbGx5XG4gKiAocmVhZC1vbmx5KS5cbiAqL1xuY2xhc3MgUGlja2VyIHtcbiAgICAvLyBpbnRlcm5hbCByZW5kZXIgdGFyZ2V0XG4gICAgcmVuZGVyVGFyZ2V0ID0gbnVsbDtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBQaWNrZXIgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vYXBwLWJhc2UuanMnKS5BcHBCYXNlfSBhcHAgLSBUaGUgYXBwbGljYXRpb24gbWFuYWdpbmcgdGhpcyBwaWNrZXJcbiAgICAgKiBpbnN0YW5jZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gd2lkdGggLSBUaGUgd2lkdGggb2YgdGhlIHBpY2sgYnVmZmVyIGluIHBpeGVscy5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiB0aGUgcGljayBidWZmZXIgaW4gcGl4ZWxzLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFwcCwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICBpZiAoYXBwIGluc3RhbmNlb2YgR3JhcGhpY3NEZXZpY2UpIHtcbiAgICAgICAgICAgIGFwcCA9IGdldEFwcGxpY2F0aW9uKCk7XG4gICAgICAgICAgICBEZWJ1Zy5kZXByZWNhdGVkKCdwYy5QaWNrZXIgbm93IHRha2VzIHBjLkFwcEJhc2UgYXMgZmlyc3QgYXJndW1lbnQuIFBhc3NpbmcgcGMuR3JhcGhpY3NEZXZpY2UgaXMgZGVwcmVjYXRlZC4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYXBwID0gYXBwO1xuICAgICAgICB0aGlzLmRldmljZSA9IGFwcC5ncmFwaGljc0RldmljZTtcblxuICAgICAgICAvLyB1bmlmb3JtIGZvciB0aGUgbWVzaCBpbmRleCBlbmNvZGVkIGludG8gcmdiYVxuICAgICAgICB0aGlzLnBpY2tDb2xvciA9IG5ldyBGbG9hdDMyQXJyYXkoNCk7XG4gICAgICAgIHRoaXMucGlja0NvbG9yWzNdID0gMTtcblxuICAgICAgICAvLyBtYXBwaW5nIHRhYmxlIGZyb20gaWRzIHRvIG1lc2hJbnN0YW5jZXNcbiAgICAgICAgdGhpcy5tYXBwaW5nID0gW107XG5cbiAgICAgICAgLy8gY3JlYXRlIGxheWVyIGNvbXBvc2l0aW9uIHdpdGggdGhlIGxheWVyIGFuZCBjYW1lcmFcbiAgICAgICAgdGhpcy5jYW1lcmFFbnRpdHkgPSBudWxsO1xuICAgICAgICB0aGlzLmxheWVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5sYXllckNvbXAgPSBudWxsO1xuICAgICAgICB0aGlzLmluaXRMYXllckNvbXBvc2l0aW9uKCk7XG5cbiAgICAgICAgLy8gY2xlYXIgY29tbWFuZCB1c2VyIHRvIHNpbXVsYXRlIGxheWVyIGNsZWFyaW5nLCByZXF1aXJlZCBkdWUgdG8gc3RvcmluZyBtZXNoZXMgZnJvbSBtdWx0aXBsZSBsYXllcnMgb24gYSBzaW5nZSBsYXllclxuICAgICAgICBjb25zdCBkZXZpY2UgPSB0aGlzLmRldmljZTtcbiAgICAgICAgdGhpcy5jbGVhckRlcHRoQ29tbWFuZCA9IG5ldyBDb21tYW5kKDAsIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRldmljZS5jbGVhcihjbGVhckRlcHRoT3B0aW9ucyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMud2lkdGggPSAwO1xuICAgICAgICB0aGlzLmhlaWdodCA9IDA7XG4gICAgICAgIHRoaXMucmVzaXplKHdpZHRoLCBoZWlnaHQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0aGUgbGlzdCBvZiBtZXNoIGluc3RhbmNlcyBzZWxlY3RlZCBieSB0aGUgc3BlY2lmaWVkIHJlY3RhbmdsZSBpbiB0aGUgcHJldmlvdXNseVxuICAgICAqIHByZXBhcmVkIHBpY2sgYnVmZmVyLlRoZSByZWN0YW5nbGUgdXNpbmcgdG9wLWxlZnQgY29vcmRpbmF0ZSBzeXN0ZW0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSBsZWZ0IGVkZ2Ugb2YgdGhlIHJlY3RhbmdsZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB0b3AgZWRnZSBvZiB0aGUgcmVjdGFuZ2xlLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGhdIC0gVGhlIHdpZHRoIG9mIHRoZSByZWN0YW5nbGUuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtoZWlnaHRdIC0gVGhlIGhlaWdodCBvZiB0aGUgcmVjdGFuZ2xlLlxuICAgICAqIEByZXR1cm5zIHtpbXBvcnQoJy4uLy4uL3NjZW5lL21lc2gtaW5zdGFuY2UuanMnKS5NZXNoSW5zdGFuY2VbXX0gQW4gYXJyYXkgb2YgbWVzaCBpbnN0YW5jZXNcbiAgICAgKiB0aGF0IGFyZSBpbiB0aGUgc2VsZWN0aW9uLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogLy8gR2V0IHRoZSBzZWxlY3Rpb24gYXQgdGhlIHBvaW50ICgxMCwyMClcbiAgICAgKiB2YXIgc2VsZWN0aW9uID0gcGlja2VyLmdldFNlbGVjdGlvbigxMCwgMjApO1xuICAgICAqIEBleGFtcGxlXG4gICAgICogLy8gR2V0IGFsbCBtb2RlbHMgaW4gcmVjdGFuZ2xlIHdpdGggY29ybmVycyBhdCAoMTAsMjApIGFuZCAoMjAsNDApXG4gICAgICogdmFyIHNlbGVjdGlvbiA9IHBpY2tlci5nZXRTZWxlY3Rpb24oMTAsIDIwLCAxMCwgMjApO1xuICAgICAqL1xuICAgIGdldFNlbGVjdGlvbih4LCB5LCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgIGNvbnN0IGRldmljZSA9IHRoaXMuZGV2aWNlO1xuXG4gICAgICAgIGlmICh0eXBlb2YgeCA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIERlYnVnLmRlcHJlY2F0ZWQoJ1BpY2tlci5nZXRTZWxlY3Rpb246cGFyYW0gXFwncmVjdFxcJyBpcyBkZXByZWNhdGVkLCB1c2UgXFwneCwgeSwgd2lkdGgsIGhlaWdodFxcJyBpbnN0ZWFkLicpO1xuXG4gICAgICAgICAgICBjb25zdCByZWN0ID0geDtcbiAgICAgICAgICAgIHggPSByZWN0Lng7XG4gICAgICAgICAgICB5ID0gcmVjdC55O1xuICAgICAgICAgICAgd2lkdGggPSByZWN0LndpZHRoO1xuICAgICAgICAgICAgaGVpZ2h0ID0gcmVjdC5oZWlnaHQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB5ID0gdGhpcy5yZW5kZXJUYXJnZXQuaGVpZ2h0IC0gKHkgKyAoaGVpZ2h0IHx8IDEpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSBoYXZlIG5pY2UgbnVtYmVycyB0byB3b3JrIHdpdGhcbiAgICAgICAgeCA9IE1hdGguZmxvb3IoeCk7XG4gICAgICAgIHkgPSBNYXRoLmZsb29yKHkpO1xuICAgICAgICB3aWR0aCA9IE1hdGguZmxvb3IoTWF0aC5tYXgod2lkdGggfHwgMSwgMSkpO1xuICAgICAgICBoZWlnaHQgPSBNYXRoLmZsb29yKE1hdGgubWF4KGhlaWdodCB8fCAxLCAxKSk7XG5cbiAgICAgICAgLy8gYmFja3VwIGFjdGl2ZSByZW5kZXIgdGFyZ2V0XG4gICAgICAgIGNvbnN0IG9yaWdSZW5kZXJUYXJnZXQgPSBkZXZpY2UucmVuZGVyVGFyZ2V0O1xuXG4gICAgICAgIERlYnVnR3JhcGhpY3MucHVzaEdwdU1hcmtlcihkZXZpY2UsICdQSUNLRVInKTtcblxuICAgICAgICAvLyBSZWFkeSB0aGUgZGV2aWNlIGZvciByZW5kZXJpbmcgdG8gdGhlIHBpY2sgYnVmZmVyXG4gICAgICAgIGRldmljZS5zZXRSZW5kZXJUYXJnZXQodGhpcy5yZW5kZXJUYXJnZXQpO1xuICAgICAgICBkZXZpY2UudXBkYXRlQmVnaW4oKTtcblxuICAgICAgICBjb25zdCBwaXhlbHMgPSBuZXcgVWludDhBcnJheSg0ICogd2lkdGggKiBoZWlnaHQpO1xuICAgICAgICBkZXZpY2UucmVhZFBpeGVscyh4LCB5LCB3aWR0aCwgaGVpZ2h0LCBwaXhlbHMpO1xuXG4gICAgICAgIGRldmljZS51cGRhdGVFbmQoKTtcblxuICAgICAgICAvLyBSZXN0b3JlIHJlbmRlciB0YXJnZXRcbiAgICAgICAgZGV2aWNlLnNldFJlbmRlclRhcmdldChvcmlnUmVuZGVyVGFyZ2V0KTtcblxuICAgICAgICBEZWJ1Z0dyYXBoaWNzLnBvcEdwdU1hcmtlcihkZXZpY2UpO1xuXG4gICAgICAgIGNvbnN0IG1hcHBpbmcgPSB0aGlzLm1hcHBpbmc7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2lkdGggKiBoZWlnaHQ7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgciA9IHBpeGVsc1s0ICogaSArIDBdO1xuICAgICAgICAgICAgY29uc3QgZyA9IHBpeGVsc1s0ICogaSArIDFdO1xuICAgICAgICAgICAgY29uc3QgYiA9IHBpeGVsc1s0ICogaSArIDJdO1xuICAgICAgICAgICAgY29uc3QgaW5kZXggPSByIDw8IDE2IHwgZyA8PCA4IHwgYjtcblxuICAgICAgICAgICAgLy8gV2hpdGUgaXMgJ25vIHNlbGVjdGlvbidcbiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gMHhmZmZmZmYpIHtcbiAgICAgICAgICAgICAgICB0ZW1wU2V0LmFkZChtYXBwaW5nW2luZGV4XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyByZXR1cm4gdGhlIGNvbnRlbnQgb2YgdGhlIHNldCBhcyBhbiBhcnJheVxuICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBbXTtcbiAgICAgICAgdGVtcFNldC5mb3JFYWNoKG1lc2hJbnN0YW5jZSA9PiBzZWxlY3Rpb24ucHVzaChtZXNoSW5zdGFuY2UpKTtcbiAgICAgICAgdGVtcFNldC5jbGVhcigpO1xuXG4gICAgICAgIHJldHVybiBzZWxlY3Rpb247XG4gICAgfVxuXG4gICAgYWxsb2NhdGVSZW5kZXJUYXJnZXQoKSB7XG5cbiAgICAgICAgY29uc3QgY29sb3JCdWZmZXIgPSBuZXcgVGV4dHVyZSh0aGlzLmRldmljZSwge1xuICAgICAgICAgICAgZm9ybWF0OiBQSVhFTEZPUk1BVF9SR0JBOCxcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxuICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodCxcbiAgICAgICAgICAgIG1pcG1hcHM6IGZhbHNlLFxuICAgICAgICAgICAgbWluRmlsdGVyOiBGSUxURVJfTkVBUkVTVCxcbiAgICAgICAgICAgIG1hZ0ZpbHRlcjogRklMVEVSX05FQVJFU1QsXG4gICAgICAgICAgICBhZGRyZXNzVTogQUREUkVTU19DTEFNUF9UT19FREdFLFxuICAgICAgICAgICAgYWRkcmVzc1Y6IEFERFJFU1NfQ0xBTVBfVE9fRURHRSxcbiAgICAgICAgICAgIG5hbWU6ICdwaWNrJ1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnJlbmRlclRhcmdldCA9IG5ldyBSZW5kZXJUYXJnZXQoe1xuICAgICAgICAgICAgY29sb3JCdWZmZXI6IGNvbG9yQnVmZmVyLFxuICAgICAgICAgICAgZGVwdGg6IHRydWVcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmVsZWFzZVJlbmRlclRhcmdldCgpIHtcblxuICAgICAgICAvLyB1bnNldCBpdCBmcm9tIHRoZSBjYW1lcmFcbiAgICAgICAgdGhpcy5jYW1lcmFFbnRpdHkuY2FtZXJhLnJlbmRlclRhcmdldCA9IG51bGw7XG5cbiAgICAgICAgaWYgKHRoaXMucmVuZGVyVGFyZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlclRhcmdldC5kZXN0cm95VGV4dHVyZUJ1ZmZlcnMoKTtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyVGFyZ2V0LmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyVGFyZ2V0ID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGluaXRMYXllckNvbXBvc2l0aW9uKCkge1xuXG4gICAgICAgIGNvbnN0IGRldmljZSA9IHRoaXMuZGV2aWNlO1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICAgICAgY29uc3QgcGlja0NvbG9ySWQgPSBkZXZpY2Uuc2NvcGUucmVzb2x2ZSgndUNvbG9yJyk7XG5cbiAgICAgICAgLy8gY2FtZXJhXG4gICAgICAgIHRoaXMuY2FtZXJhRW50aXR5ID0gbmV3IEVudGl0eSgpO1xuICAgICAgICB0aGlzLmNhbWVyYUVudGl0eS5hZGRDb21wb25lbnQoJ2NhbWVyYScpO1xuXG4gICAgICAgIC8vIGxheWVyIGFsbCBtZXNoZXMgcmVuZGVyZWQgZm9yIHBpY2tpbmcgYXQgYWRkZWQgdG9cbiAgICAgICAgdGhpcy5sYXllciA9IG5ldyBMYXllcih7XG4gICAgICAgICAgICBuYW1lOiAnUGlja2VyJyxcbiAgICAgICAgICAgIHNoYWRlclBhc3M6IFNIQURFUl9QSUNLLFxuICAgICAgICAgICAgb3BhcXVlU29ydE1vZGU6IFNPUlRNT0RFX05PTkUsXG5cbiAgICAgICAgICAgIC8vIGV4ZWN1dGVzIGp1c3QgYmVmb3JlIHRoZSBtZXNoIGlzIHJlbmRlcmVkLiBBbmQgaW5kZXggZW5jb2RlZCBpbiByZ2IgaXMgYXNzaWduZWQgdG8gaXRcbiAgICAgICAgICAgIG9uRHJhd0NhbGw6IGZ1bmN0aW9uIChtZXNoSW5zdGFuY2UsIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgc2VsZi5waWNrQ29sb3JbMF0gPSAoKGluZGV4ID4+IDE2KSAmIDB4ZmYpIC8gMjU1O1xuICAgICAgICAgICAgICAgIHNlbGYucGlja0NvbG9yWzFdID0gKChpbmRleCA+PiA4KSAmIDB4ZmYpIC8gMjU1O1xuICAgICAgICAgICAgICAgIHNlbGYucGlja0NvbG9yWzJdID0gKGluZGV4ICYgMHhmZikgLyAyNTU7XG4gICAgICAgICAgICAgICAgcGlja0NvbG9ySWQuc2V0VmFsdWUoc2VsZi5waWNrQ29sb3IpO1xuICAgICAgICAgICAgICAgIGRldmljZS5zZXRCbGVuZFN0YXRlKEJsZW5kU3RhdGUuREVGQVVMVCk7XG5cbiAgICAgICAgICAgICAgICAvLyBrZWVwIHRoZSBpbmRleCAtPiBtZXNoSW5zdGFuY2UgaW5kZXggbWFwcGluZ1xuICAgICAgICAgICAgICAgIHNlbGYubWFwcGluZ1tpbmRleF0gPSBtZXNoSW5zdGFuY2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmxheWVyLmFkZENhbWVyYSh0aGlzLmNhbWVyYUVudGl0eS5jYW1lcmEpO1xuXG4gICAgICAgIC8vIGNvbXBvc2l0aW9uXG4gICAgICAgIHRoaXMubGF5ZXJDb21wID0gbmV3IExheWVyQ29tcG9zaXRpb24oJ3BpY2tlcicpO1xuICAgICAgICB0aGlzLmxheWVyQ29tcC5wdXNoT3BhcXVlKHRoaXMubGF5ZXIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFByaW1lcyB0aGUgcGljayBidWZmZXIgd2l0aCBhIHJlbmRlcmluZyBvZiB0aGUgc3BlY2lmaWVkIG1vZGVscyBmcm9tIHRoZSBwb2ludCBvZiB2aWV3IG9mXG4gICAgICogdGhlIHN1cHBsaWVkIGNhbWVyYS4gT25jZSB0aGUgcGljayBidWZmZXIgaGFzIGJlZW4gcHJlcGFyZWQsIHtAbGluayBQaWNrZXIjZ2V0U2VsZWN0aW9ufSBjYW5cbiAgICAgKiBiZSBjYWxsZWQgbXVsdGlwbGUgdGltZXMgb24gdGhlIHNhbWUgcGlja2VyIG9iamVjdC4gVGhlcmVmb3JlLCBpZiB0aGUgbW9kZWxzIG9yIGNhbWVyYSBkb1xuICAgICAqIG5vdCBjaGFuZ2UgaW4gYW55IHdheSwge0BsaW5rIFBpY2tlciNwcmVwYXJlfSBkb2VzIG5vdCBuZWVkIHRvIGJlIGNhbGxlZCBhZ2Fpbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi9jb21wb25lbnRzL2NhbWVyYS9jb21wb25lbnQuanMnKS5DYW1lcmFDb21wb25lbnR9IGNhbWVyYSAtIFRoZSBjYW1lcmFcbiAgICAgKiBjb21wb25lbnQgdXNlZCB0byByZW5kZXIgdGhlIHNjZW5lLlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi8uLi9zY2VuZS9zY2VuZS5qcycpLlNjZW5lfSBzY2VuZSAtIFRoZSBzY2VuZSBjb250YWluaW5nIHRoZSBwaWNrYWJsZSBtZXNoXG4gICAgICogaW5zdGFuY2VzLlxuICAgICAqIEBwYXJhbSB7TGF5ZXJbXX0gW2xheWVyc10gLSBMYXllcnMgZnJvbSB3aGljaCBvYmplY3RzIHdpbGwgYmUgcGlja2VkLiBJZiBub3Qgc3VwcGxpZWQsIGFsbCBsYXllcnMgb2YgdGhlIHNwZWNpZmllZCBjYW1lcmEgd2lsbCBiZSB1c2VkLlxuICAgICAqL1xuICAgIHByZXBhcmUoY2FtZXJhLCBzY2VuZSwgbGF5ZXJzKSB7XG5cbiAgICAgICAgLy8gaGFuZGxlIGRlcHJlY2F0ZWQgYXJndW1lbnRzXG4gICAgICAgIGlmIChjYW1lcmEgaW5zdGFuY2VvZiBDYW1lcmEpIHtcbiAgICAgICAgICAgIERlYnVnLmRlcHJlY2F0ZWQoJ3BjLlBpY2tlciNwcmVwYXJlIG5vdyB0YWtlcyBwYy5DYW1lcmFDb21wb25lbnQgYXMgZmlyc3QgYXJndW1lbnQuIFBhc3NpbmcgcGMuQ2FtZXJhIGlzIGRlcHJlY2F0ZWQuJyk7XG5cbiAgICAgICAgICAgIC8vIEdldCB0aGUgY2FtZXJhIGNvbXBvbmVudFxuICAgICAgICAgICAgY2FtZXJhID0gY2FtZXJhLm5vZGUuY2FtZXJhO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxheWVycyBpbnN0YW5jZW9mIExheWVyKSB7XG4gICAgICAgICAgICBsYXllcnMgPSBbbGF5ZXJzXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHBvcHVsYXRlIHRoZSBsYXllciB3aXRoIG1lc2hlcyBhbmQgZGVwdGggY2xlYXIgY29tbWFuZHNcbiAgICAgICAgdGhpcy5sYXllci5jbGVhck1lc2hJbnN0YW5jZXMoKTtcbiAgICAgICAgY29uc3QgZGVzdE1lc2hJbnN0YW5jZXMgPSB0aGlzLmxheWVyLm9wYXF1ZU1lc2hJbnN0YW5jZXM7XG5cbiAgICAgICAgLy8gc291cmNlIG1lc2ggaW5zdGFuY2VzXG4gICAgICAgIGNvbnN0IHNyY0xheWVycyA9IHNjZW5lLmxheWVycy5sYXllckxpc3Q7XG4gICAgICAgIGNvbnN0IHN1YkxheWVyRW5hYmxlZCA9IHNjZW5lLmxheWVycy5zdWJMYXllckVuYWJsZWQ7XG4gICAgICAgIGNvbnN0IGlzVHJhbnNwYXJlbnQgPSBzY2VuZS5sYXllcnMuc3ViTGF5ZXJMaXN0O1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3JjTGF5ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBzcmNMYXllciA9IHNyY0xheWVyc1tpXTtcblxuICAgICAgICAgICAgLy8gc2tpcCB0aGUgbGF5ZXIgaWYgaXQgZG9lcyBub3QgbWF0Y2ggdGhlIHByb3ZpZGVkIG9uZXNcbiAgICAgICAgICAgIGlmIChsYXllcnMgJiYgbGF5ZXJzLmluZGV4T2Yoc3JjTGF5ZXIpIDwgMCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc3JjTGF5ZXIuZW5hYmxlZCAmJiBzdWJMYXllckVuYWJsZWRbaV0pIHtcblxuICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBsYXllciBpcyByZW5kZXJlZCBieSB0aGUgY2FtZXJhXG4gICAgICAgICAgICAgICAgY29uc3QgbGF5ZXJDYW1JZCA9IHNyY0xheWVyLmNhbWVyYXMuaW5kZXhPZihjYW1lcmEpO1xuICAgICAgICAgICAgICAgIGlmIChsYXllckNhbUlkID49IDApIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgbGF5ZXIgY2xlYXJzIHRoZSBkZXB0aCwgYWRkIGNvbW1hbmQgdG8gY2xlYXIgaXRcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNyY0xheWVyLl9jbGVhckRlcHRoQnVmZmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXN0TWVzaEluc3RhbmNlcy5wdXNoKHRoaXMuY2xlYXJEZXB0aENvbW1hbmQpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY29weSBhbGwgcGlja2FibGUgbWVzaCBpbnN0YW5jZXNcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWVzaEluc3RhbmNlcyA9IGlzVHJhbnNwYXJlbnRbaV0gPyBzcmNMYXllci5pbnN0YW5jZXMudHJhbnNwYXJlbnRNZXNoSW5zdGFuY2VzIDogc3JjTGF5ZXIuaW5zdGFuY2VzLm9wYXF1ZU1lc2hJbnN0YW5jZXM7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbWVzaEluc3RhbmNlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWVzaEluc3RhbmNlID0gbWVzaEluc3RhbmNlc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZXNoSW5zdGFuY2UucGljaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RNZXNoSW5zdGFuY2VzLnB1c2gobWVzaEluc3RhbmNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG1ha2UgdGhlIHJlbmRlciB0YXJnZXQgdGhlIHJpZ2h0IHNpemVcbiAgICAgICAgaWYgKCF0aGlzLnJlbmRlclRhcmdldCB8fCAodGhpcy53aWR0aCAhPT0gdGhpcy5yZW5kZXJUYXJnZXQud2lkdGggfHwgdGhpcy5oZWlnaHQgIT09IHRoaXMucmVuZGVyVGFyZ2V0LmhlaWdodCkpIHtcbiAgICAgICAgICAgIHRoaXMucmVsZWFzZVJlbmRlclRhcmdldCgpO1xuICAgICAgICAgICAgdGhpcy5hbGxvY2F0ZVJlbmRlclRhcmdldCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcHJlcGFyZSB0aGUgcmVuZGVyaW5nIGNhbWVyYVxuICAgICAgICB0aGlzLnVwZGF0ZUNhbWVyYShjYW1lcmEpO1xuXG4gICAgICAgIC8vIGNsZWFyIHJlZ2lzdGVyZWQgbWVzaGVzIG1hcHBpbmdcbiAgICAgICAgdGhpcy5tYXBwaW5nLmxlbmd0aCA9IDA7XG5cbiAgICAgICAgLy8gcmVuZGVyXG4gICAgICAgIHRoaXMuYXBwLnJlbmRlckNvbXBvc2l0aW9uKHRoaXMubGF5ZXJDb21wKTtcbiAgICB9XG5cbiAgICB1cGRhdGVDYW1lcmEoc3JjQ2FtZXJhKSB7XG5cbiAgICAgICAgLy8gY29weSB0cmFuc2Zvcm1cbiAgICAgICAgdGhpcy5jYW1lcmFFbnRpdHkuY29weShzcmNDYW1lcmEuZW50aXR5KTtcbiAgICAgICAgdGhpcy5jYW1lcmFFbnRpdHkubmFtZSA9ICdQaWNrZXJDYW1lcmEnO1xuXG4gICAgICAgIC8vIGNvcHkgY2FtZXJhIGNvbXBvbmVudCBwcm9wZXJ0aWVzIC0gd2hpY2ggb3ZlcndyaXRlcyBmZXcgcHJvcGVydGllcyB3ZSBjaGFuZ2UgdG8gd2hhdCBpcyBuZWVkZWQgbGF0ZXJcbiAgICAgICAgY29uc3QgZGVzdENhbWVyYSA9IHRoaXMuY2FtZXJhRW50aXR5LmNhbWVyYTtcbiAgICAgICAgZGVzdENhbWVyYS5jb3B5KHNyY0NhbWVyYSk7XG5cbiAgICAgICAgLy8gc2V0IHVwIGNsZWFyc1xuICAgICAgICBkZXN0Q2FtZXJhLmNsZWFyQ29sb3JCdWZmZXIgPSB0cnVlO1xuICAgICAgICBkZXN0Q2FtZXJhLmNsZWFyRGVwdGhCdWZmZXIgPSB0cnVlO1xuICAgICAgICBkZXN0Q2FtZXJhLmNsZWFyU3RlbmNpbEJ1ZmZlciA9IHRydWU7XG4gICAgICAgIGRlc3RDYW1lcmEuY2xlYXJDb2xvciA9IENvbG9yLldISVRFO1xuXG4gICAgICAgIC8vIHJlbmRlciB0YXJnZXRcbiAgICAgICAgZGVzdENhbWVyYS5yZW5kZXJUYXJnZXQgPSB0aGlzLnJlbmRlclRhcmdldDtcblxuICAgICAgICAvLyBsYXllcnNcbiAgICAgICAgdGhpcy5sYXllci5jbGVhckNhbWVyYXMoKTtcbiAgICAgICAgdGhpcy5sYXllci5hZGRDYW1lcmEoZGVzdENhbWVyYSk7XG4gICAgICAgIGRlc3RDYW1lcmEubGF5ZXJzID0gW3RoaXMubGF5ZXIuaWRdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHJlc29sdXRpb24gb2YgdGhlIHBpY2sgYnVmZmVyLiBUaGUgcGljayBidWZmZXIgcmVzb2x1dGlvbiBkb2VzIG5vdCBuZWVkIHRvIG1hdGNoXG4gICAgICogdGhlIHJlc29sdXRpb24gb2YgdGhlIGNvcnJlc3BvbmRpbmcgZnJhbWUgYnVmZmVyIHVzZSBmb3IgZ2VuZXJhbCByZW5kZXJpbmcgb2YgdGhlIDNEIHNjZW5lLlxuICAgICAqIEhvd2V2ZXIsIHRoZSBsb3dlciB0aGUgcmVzb2x1dGlvbiBvZiB0aGUgcGljayBidWZmZXIsIHRoZSBsZXNzIGFjY3VyYXRlIHRoZSBzZWxlY3Rpb25cbiAgICAgKiByZXN1bHRzIHJldHVybmVkIGJ5IHtAbGluayBQaWNrZXIjZ2V0U2VsZWN0aW9ufS4gT24gdGhlIG90aGVyIGhhbmQsIHNtYWxsZXIgcGljayBidWZmZXJzXG4gICAgICogd2lsbCB5aWVsZCBncmVhdGVyIHBlcmZvcm1hbmNlLCBzbyB0aGVyZSBpcyBhIHRyYWRlIG9mZi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgcGljayBidWZmZXIgaW4gcGl4ZWxzLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0IG9mIHRoZSBwaWNrIGJ1ZmZlciBpbiBwaXhlbHMuXG4gICAgICovXG4gICAgcmVzaXplKHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgdGhpcy53aWR0aCA9IE1hdGguZmxvb3Iod2lkdGgpO1xuICAgICAgICB0aGlzLmhlaWdodCA9IE1hdGguZmxvb3IoaGVpZ2h0KTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFBpY2tlciB9O1xuIl0sIm5hbWVzIjpbInRlbXBTZXQiLCJTZXQiLCJjbGVhckRlcHRoT3B0aW9ucyIsImRlcHRoIiwiZmxhZ3MiLCJDTEVBUkZMQUdfREVQVEgiLCJQaWNrZXIiLCJjb25zdHJ1Y3RvciIsImFwcCIsIndpZHRoIiwiaGVpZ2h0IiwicmVuZGVyVGFyZ2V0IiwiR3JhcGhpY3NEZXZpY2UiLCJnZXRBcHBsaWNhdGlvbiIsIkRlYnVnIiwiZGVwcmVjYXRlZCIsImRldmljZSIsImdyYXBoaWNzRGV2aWNlIiwicGlja0NvbG9yIiwiRmxvYXQzMkFycmF5IiwibWFwcGluZyIsImNhbWVyYUVudGl0eSIsImxheWVyIiwibGF5ZXJDb21wIiwiaW5pdExheWVyQ29tcG9zaXRpb24iLCJjbGVhckRlcHRoQ29tbWFuZCIsIkNvbW1hbmQiLCJjbGVhciIsInJlc2l6ZSIsImdldFNlbGVjdGlvbiIsIngiLCJ5IiwicmVjdCIsIk1hdGgiLCJmbG9vciIsIm1heCIsIm9yaWdSZW5kZXJUYXJnZXQiLCJEZWJ1Z0dyYXBoaWNzIiwicHVzaEdwdU1hcmtlciIsInNldFJlbmRlclRhcmdldCIsInVwZGF0ZUJlZ2luIiwicGl4ZWxzIiwiVWludDhBcnJheSIsInJlYWRQaXhlbHMiLCJ1cGRhdGVFbmQiLCJwb3BHcHVNYXJrZXIiLCJpIiwiciIsImciLCJiIiwiaW5kZXgiLCJhZGQiLCJzZWxlY3Rpb24iLCJmb3JFYWNoIiwibWVzaEluc3RhbmNlIiwicHVzaCIsImFsbG9jYXRlUmVuZGVyVGFyZ2V0IiwiY29sb3JCdWZmZXIiLCJUZXh0dXJlIiwiZm9ybWF0IiwiUElYRUxGT1JNQVRfUkdCQTgiLCJtaXBtYXBzIiwibWluRmlsdGVyIiwiRklMVEVSX05FQVJFU1QiLCJtYWdGaWx0ZXIiLCJhZGRyZXNzVSIsIkFERFJFU1NfQ0xBTVBfVE9fRURHRSIsImFkZHJlc3NWIiwibmFtZSIsIlJlbmRlclRhcmdldCIsInJlbGVhc2VSZW5kZXJUYXJnZXQiLCJjYW1lcmEiLCJkZXN0cm95VGV4dHVyZUJ1ZmZlcnMiLCJkZXN0cm95Iiwic2VsZiIsInBpY2tDb2xvcklkIiwic2NvcGUiLCJyZXNvbHZlIiwiRW50aXR5IiwiYWRkQ29tcG9uZW50IiwiTGF5ZXIiLCJzaGFkZXJQYXNzIiwiU0hBREVSX1BJQ0siLCJvcGFxdWVTb3J0TW9kZSIsIlNPUlRNT0RFX05PTkUiLCJvbkRyYXdDYWxsIiwic2V0VmFsdWUiLCJzZXRCbGVuZFN0YXRlIiwiQmxlbmRTdGF0ZSIsIkRFRkFVTFQiLCJhZGRDYW1lcmEiLCJMYXllckNvbXBvc2l0aW9uIiwicHVzaE9wYXF1ZSIsInByZXBhcmUiLCJzY2VuZSIsImxheWVycyIsIkNhbWVyYSIsIm5vZGUiLCJjbGVhck1lc2hJbnN0YW5jZXMiLCJkZXN0TWVzaEluc3RhbmNlcyIsIm9wYXF1ZU1lc2hJbnN0YW5jZXMiLCJzcmNMYXllcnMiLCJsYXllckxpc3QiLCJzdWJMYXllckVuYWJsZWQiLCJpc1RyYW5zcGFyZW50Iiwic3ViTGF5ZXJMaXN0IiwibGVuZ3RoIiwic3JjTGF5ZXIiLCJpbmRleE9mIiwiZW5hYmxlZCIsImxheWVyQ2FtSWQiLCJjYW1lcmFzIiwiX2NsZWFyRGVwdGhCdWZmZXIiLCJtZXNoSW5zdGFuY2VzIiwiaW5zdGFuY2VzIiwidHJhbnNwYXJlbnRNZXNoSW5zdGFuY2VzIiwiaiIsInBpY2siLCJ1cGRhdGVDYW1lcmEiLCJyZW5kZXJDb21wb3NpdGlvbiIsInNyY0NhbWVyYSIsImNvcHkiLCJlbnRpdHkiLCJkZXN0Q2FtZXJhIiwiY2xlYXJDb2xvckJ1ZmZlciIsImNsZWFyRGVwdGhCdWZmZXIiLCJjbGVhclN0ZW5jaWxCdWZmZXIiLCJjbGVhckNvbG9yIiwiQ29sb3IiLCJXSElURSIsImNsZWFyQ2FtZXJhcyIsImlkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFtQkEsTUFBTUEsT0FBTyxHQUFHLElBQUlDLEdBQUcsRUFBRSxDQUFBO0FBRXpCLE1BQU1DLGlCQUFpQixHQUFHO0FBQ3RCQyxFQUFBQSxLQUFLLEVBQUUsR0FBRztBQUNWQyxFQUFBQSxLQUFLLEVBQUVDLGVBQUFBO0FBQ1gsQ0FBQyxDQUFBOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQyxNQUFNLENBQUM7QUFDVDs7QUFHQTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLFdBQVcsQ0FBQ0MsR0FBRyxFQUFFQyxLQUFLLEVBQUVDLE1BQU0sRUFBRTtJQUFBLElBVmhDQyxDQUFBQSxZQUFZLEdBQUcsSUFBSSxDQUFBO0lBV2YsSUFBSUgsR0FBRyxZQUFZSSxjQUFjLEVBQUU7TUFDL0JKLEdBQUcsR0FBR0ssY0FBYyxFQUFFLENBQUE7QUFDdEJDLE1BQUFBLEtBQUssQ0FBQ0MsVUFBVSxDQUFDLDRGQUE0RixDQUFDLENBQUE7QUFDbEgsS0FBQTtJQUVBLElBQUksQ0FBQ1AsR0FBRyxHQUFHQSxHQUFHLENBQUE7QUFDZCxJQUFBLElBQUksQ0FBQ1Es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
