/**
 * @license
 * PlayCanvas Engine v1.57.1 revision 256dd83c2 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { path } from '../core/path.js';
import { Tags } from '../core/tags.js';
import { EventHandler } from '../core/event-handler.js';
import { findAvailableLocale } from '../i18n/utils.js';
import { ABSOLUTE_URL } from './constants.js';
import { AssetFile } from './asset-file.js';
import { getApplication } from '../framework/globals.js';
import { http } from '../net/http.js';

let assetIdCounter = -1;
const VARIANT_SUPPORT = {
  pvr: 'extCompressedTexturePVRTC',
  dxt: 'extCompressedTextureS3TC',
  etc2: 'extCompressedTextureETC',
  etc1: 'extCompressedTextureETC1',
  basis: 'canvas'
};
const VARIANT_DEFAULT_PRIORITY = ['pvr', 'dxt', 'etc2', 'etc1', 'basis'];

class Asset extends EventHandler {
  constructor(name, type, file, data, options) {
    super();
    this._id = assetIdCounter--;
    this.name = name || '';
    this.type = type;
    this.tags = new Tags(this);
    this._preload = false;
    this._file = null;
    this._data = data || {};
    this.options = options || {};
    this._resources = [];
    this._i18n = {};
    this.loaded = false;
    this.loading = false;
    this.registry = null;
    if (file) this.file = file;
  }

  set id(value) {
    this._id = value;
  }

  get id() {
    return this._id;
  }

  set file(value) {
    if (value && value.variants && ['texture', 'textureatlas', 'bundle'].indexOf(this.type) !== -1) {
      var _this$registry, _this$registry$_loade;

      const app = ((_this$registry = this.registry) == null ? void 0 : (_this$registry$_loade = _this$registry._loader) == null ? void 0 : _this$registry$_loade._app) || getApplication();
      const device = app == null ? void 0 : app.graphicsDevice;

      if (device) {
        for (let i = 0, len = VARIANT_DEFAULT_PRIORITY.length; i < len; i++) {
          const variant = VARIANT_DEFAULT_PRIORITY[i];

          if (value.variants[variant] && device[VARIANT_SUPPORT[variant]]) {
            value = value.variants[variant];
            break;
          }

          if (app.enableBundles) {
            const bundles = app.bundles.listBundlesForAsset(this);

            if (bundles && bundles.find(b => {
              var _b$file;

              return b == null ? void 0 : (_b$file = b.file) == null ? void 0 : _b$file.variants[variant];
            })) {
              break;
            }
          }
        }
      }
    }

    const oldFile = this._file;
    const newFile = value ? new AssetFile(value.url, value.filename, value.hash, value.size, value.opt, value.contents) : null;

    if (!!newFile !== !!oldFile || newFile && !newFile.equals(oldFile)) {
      this._file = newFile;
      this.fire('change', this, 'file', newFile, oldFile);
      this.reload();
    }
  }

  get file() {
    return this._file;
  }

  set data(value) {
    const old = this._data;
    this._data = value;

    if (value !== old) {
      this.fire('change', this, 'data', value, old);
      if (this.loaded) this.registry._loader.patch(this, this.registry);
    }
  }

  get data() {
    return this._data;
  }

  set resource(value) {
    const _old = this._resources[0];
    this._resources[0] = value;
    this.fire('change', this, 'resource', value, _old);
  }

  get resource() {
    return this._resources[0];
  }

  set resources(value) {
    const _old = this._resources;
    this._resources = value;
    this.fire('change', this, 'resources', value, _old);
  }

  get resources() {
    return this._resources;
  }

  set preload(value) {
    value = !!value;
    if (this._preload === value) return;
    this._preload = value;
    if (this._preload && !this.loaded && !this.loading && this.registry) this.registry.load(this);
  }

  get preload() {
    return this._preload;
  }

  set loadFaces(value) {
    value = !!value;

    if (!this.hasOwnProperty('_loadFaces') || value !== this._loadFaces) {
      this._loadFaces = value;
      if (this.loaded) this.registry._loader.patch(this, this.registry);
    }
  }

  get loadFaces() {
    return this._loadFaces;
  }

  getFileUrl() {
    const file = this.file;
    if (!file || !file.url) return null;
    let url = file.url;
    if (this.registry && this.registry.prefix && !ABSOLUTE_URL.test(url)) url = this.registry.prefix + url;

    if (this.type !== 'script' && file.hash) {
      const separator = url.indexOf('?') !== -1 ? '&' : '?';
      url += separator + 't=' + file.hash;
    }

    return url;
  }

  getAbsoluteUrl(relativePath) {
    if (relativePath.startsWith('blob:') || relativePath.startsWith('data:')) {
      return relativePath;
    }

    const base = path.getDirectory(this.file.url);
    return path.join(base, relativePath);
  }

  getLocalizedAssetId(locale) {
    locale = findAvailableLocale(locale, this._i18n);
    return this._i18n[locale] || null;
  }

  addLocalizedAssetId(locale, assetId) {
    this._i18n[locale] = assetId;
    this.fire('add:localized', locale, assetId);
  }

  removeLocalizedAssetId(locale) {
    const assetId = this._i18n[locale];

    if (assetId) {
      delete this._i18n[locale];
      this.fire('remove:localized', locale, assetId);
    }
  }

  ready(callback, scope) {
    scope = scope || this;

    if (this.loaded) {
      callback.call(scope, this);
    } else {
      this.once('load', function (asset) {
        callback.call(scope, asset);
      });
    }
  }

  reload() {
    if (this.loaded) {
      this.loaded = false;
      this.registry.load(this);
    }
  }

  unload() {
    if (!this.loaded && this._resources.length === 0) return;
    this.fire('unload', this);
    this.registry.fire('unload:' + this.id, this);
    const old = this._resources;
    this.resources = [];
    this.loaded = false;

    if (this.file) {
      this.registry._loader.clearCache(this.getFileUrl(), this.type);
    }

    for (let i = 0; i < old.length; ++i) {
      const resource = old[i];

      if (resource && resource.destroy) {
        resource.destroy();
      }
    }
  }

  static fetchArrayBuffer(loadUrl, callback, asset, maxRetries = 0) {
    var _asset$file;

    if (asset != null && (_asset$file = asset.file) != null && _asset$file.contents) {
      setTimeout(() => {
        callback(null, asset.file.contents);
      });
    } else {
      http.get(loadUrl, {
        cache: true,
        responseType: 'arraybuffer',
        retry: maxRetries > 0,
        maxRetries: maxRetries
      }, callback);
    }
  }

}

export { Asset };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hc3NldC9hc3NldC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwYXRoIH0gZnJvbSAnLi4vY29yZS9wYXRoLmpzJztcbmltcG9ydCB7IFRhZ3MgfSBmcm9tICcuLi9jb3JlL3RhZ3MuanMnO1xuXG5pbXBvcnQgeyBFdmVudEhhbmRsZXIgfSBmcm9tICcuLi9jb3JlL2V2ZW50LWhhbmRsZXIuanMnO1xuXG5pbXBvcnQgeyBmaW5kQXZhaWxhYmxlTG9jYWxlIH0gZnJvbSAnLi4vaTE4bi91dGlscy5qcyc7XG5cbmltcG9ydCB7IEFCU09MVVRFX1VSTCB9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IEFzc2V0RmlsZSB9IGZyb20gJy4vYXNzZXQtZmlsZS5qcyc7XG5pbXBvcnQgeyBnZXRBcHBsaWNhdGlvbiB9IGZyb20gJy4uL2ZyYW1ld29yay9nbG9iYWxzLmpzJztcbmltcG9ydCB7IGh0dHAgfSBmcm9tICcuLi9uZXQvaHR0cC5qcyc7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2Fzc2V0LXJlZ2lzdHJ5LmpzJykuQXNzZXRSZWdpc3RyeX0gQXNzZXRSZWdpc3RyeSAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uL3Jlc291cmNlcy9sb2FkZXIuanMnKS5SZXNvdXJjZUxvYWRlckNhbGxiYWNrfSBSZXNvdXJjZUxvYWRlckNhbGxiYWNrICovXG5cbi8vIGF1dG8gaW5jcmVtZW50aW5nIG51bWJlciBmb3IgYXNzZXQgaWRzXG5sZXQgYXNzZXRJZENvdW50ZXIgPSAtMTtcblxuY29uc3QgVkFSSUFOVF9TVVBQT1JUID0ge1xuICAgIHB2cjogJ2V4dENvbXByZXNzZWRUZXh0dXJlUFZSVEMnLFxuICAgIGR4dDogJ2V4dENvbXByZXNzZWRUZXh0dXJlUzNUQycsXG4gICAgZXRjMjogJ2V4dENvbXByZXNzZWRUZXh0dXJlRVRDJyxcbiAgICBldGMxOiAnZXh0Q29tcHJlc3NlZFRleHR1cmVFVEMxJyxcbiAgICBiYXNpczogJ2NhbnZhcycgLy8gZHVtbXksIGJhc2lzIGlzIGFsd2F5cyBzdXBwb3J0ZWRcbn07XG5cbmNvbnN0IFZBUklBTlRfREVGQVVMVF9QUklPUklUWSA9IFsncHZyJywgJ2R4dCcsICdldGMyJywgJ2V0YzEnLCAnYmFzaXMnXTtcblxuLyoqXG4gKiBDYWxsYmFjayB1c2VkIGJ5IHtAbGluayBBc3NldCNyZWFkeX0gYW5kIGNhbGxlZCB3aGVuIGFuIGFzc2V0IGlzIHJlYWR5LlxuICpcbiAqIEBjYWxsYmFjayBBc3NldFJlYWR5Q2FsbGJhY2tcbiAqIEBwYXJhbSB7QXNzZXR9IGFzc2V0IC0gVGhlIHJlYWR5IGFzc2V0LlxuICovXG5cbi8qKlxuICogQW4gYXNzZXQgcmVjb3JkIG9mIGEgZmlsZSBvciBkYXRhIHJlc291cmNlIHRoYXQgY2FuIGJlIGxvYWRlZCBieSB0aGUgZW5naW5lLiBUaGUgYXNzZXQgY29udGFpbnNcbiAqIGZvdXIgaW1wb3J0YW50IGZpZWxkczpcbiAqXG4gKiAtIGBmaWxlYDogY29udGFpbnMgdGhlIGRldGFpbHMgb2YgYSBmaWxlIChmaWxlbmFtZSwgdXJsKSB3aGljaCBjb250YWlucyB0aGUgcmVzb3VyY2UgZGF0YSwgZS5nLlxuICogYW4gaW1hZ2UgZmlsZSBmb3IgYSB0ZXh0dXJlIGFzc2V0LlxuICogLSBgZGF0YWA6IGNvbnRhaW5zIGEgSlNPTiBibG9iIHdoaWNoIGNvbnRhaW5zIGVpdGhlciB0aGUgcmVzb3VyY2UgZGF0YSBmb3IgdGhlIGFzc2V0IChlLmcuXG4gKiBtYXRlcmlhbCBkYXRhKSBvciBhZGRpdGlvbmFsIGRhdGEgZm9yIHRoZSBmaWxlIChlLmcuIG1hdGVyaWFsIG1hcHBpbmdzIGZvciBhIG1vZGVsKS5cbiAqIC0gYG9wdGlvbnNgOiBjb250YWlucyBhIEpTT04gYmxvYiB3aXRoIGhhbmRsZXItc3BlY2lmaWMgbG9hZCBvcHRpb25zLlxuICogLSBgcmVzb3VyY2VgOiBjb250YWlucyB0aGUgZmluYWwgcmVzb3VyY2Ugd2hlbiBpdCBpcyBsb2FkZWQuIChlLmcuIGEge0BsaW5rIFN0YW5kYXJkTWF0ZXJpYWx9IG9yXG4gKiBhIHtAbGluayBUZXh0dXJlfSkuXG4gKlxuICogU2VlIHRoZSB7QGxpbmsgQXNzZXRSZWdpc3RyeX0gZm9yIGRldGFpbHMgb24gbG9hZGluZyByZXNvdXJjZXMgZnJvbSBhc3NldHMuXG4gKlxuICogQGF1Z21lbnRzIEV2ZW50SGFuZGxlclxuICovXG5jbGFzcyBBc3NldCBleHRlbmRzIEV2ZW50SGFuZGxlciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IEFzc2V0IHJlY29yZC4gR2VuZXJhbGx5LCBBc3NldHMgYXJlIGNyZWF0ZWQgaW4gdGhlIGxvYWRpbmcgcHJvY2VzcyBhbmQgeW91XG4gICAgICogd29uJ3QgbmVlZCB0byBjcmVhdGUgdGhlbSBieSBoYW5kLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBBIG5vbi11bmlxdWUgYnV0IGh1bWFuLXJlYWRhYmxlIG5hbWUgd2hpY2ggY2FuIGJlIGxhdGVyIHVzZWQgdG9cbiAgICAgKiByZXRyaWV2ZSB0aGUgYXNzZXQuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUeXBlIG9mIGFzc2V0LiBPbmUgb2YgW1wiYW5pbWF0aW9uXCIsIFwiYXVkaW9cIiwgXCJiaW5hcnlcIiwgXCJjb250YWluZXJcIixcbiAgICAgKiBcImN1YmVtYXBcIiwgXCJjc3NcIiwgXCJmb250XCIsIFwianNvblwiLCBcImh0bWxcIiwgXCJtYXRlcmlhbFwiLCBcIm1vZGVsXCIsIFwic2NyaXB0XCIsIFwic2hhZGVyXCIsIFwic3ByaXRlXCIsXG4gICAgICogXCJ0ZW1wbGF0ZVwiLCB0ZXh0XCIsIFwidGV4dHVyZVwiXVxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbZmlsZV0gLSBEZXRhaWxzIGFib3V0IHRoZSBmaWxlIHRoZSBhc3NldCBpcyBtYWRlIGZyb20uIEF0IHRoZSBsZWFzdCBtdXN0XG4gICAgICogY29udGFpbiB0aGUgJ3VybCcgZmllbGQuIEZvciBhc3NldHMgdGhhdCBkb24ndCBjb250YWluIGZpbGUgZGF0YSB1c2UgbnVsbC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2ZpbGUudXJsXSAtIFRoZSBVUkwgb2YgdGhlIHJlc291cmNlIGZpbGUgdGhhdCBjb250YWlucyB0aGUgYXNzZXQgZGF0YS5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2ZpbGUuZmlsZW5hbWVdIC0gVGhlIGZpbGVuYW1lIG9mIHRoZSByZXNvdXJjZSBmaWxlIG9yIG51bGwgaWYgbm8gZmlsZW5hbWVcbiAgICAgKiB3YXMgc2V0IChlLmcgZnJvbSB1c2luZyB7QGxpbmsgQXNzZXRSZWdpc3RyeSNsb2FkRnJvbVVybH0pLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbZmlsZS5zaXplXSAtIFRoZSBzaXplIG9mIHRoZSByZXNvdXJjZSBmaWxlIG9yIG51bGwgaWYgbm8gc2l6ZSB3YXMgc2V0XG4gICAgICogKGUuZy4gZnJvbSB1c2luZyB7QGxpbmsgQXNzZXRSZWdpc3RyeSNsb2FkRnJvbVVybH0pLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbZmlsZS5oYXNoXSAtIFRoZSBNRDUgaGFzaCBvZiB0aGUgcmVzb3VyY2UgZmlsZSBkYXRhIGFuZCB0aGUgQXNzZXQgZGF0YVxuICAgICAqIGZpZWxkIG9yIG51bGwgaWYgaGFzaCB3YXMgc2V0IChlLmcgZnJvbSB1c2luZyB7QGxpbmsgQXNzZXRSZWdpc3RyeSNsb2FkRnJvbVVybH0pLlxuICAgICAqIEBwYXJhbSB7QXJyYXlCdWZmZXJ9IFtmaWxlLmNvbnRlbnRzXSAtIE9wdGlvbmFsIGZpbGUgY29udGVudHMuIFRoaXMgaXMgZmFzdGVyIHRoYW4gd3JhcHBpbmdcbiAgICAgKiB0aGUgZGF0YSBpbiBhIChiYXNlNjQgZW5jb2RlZCkgYmxvYi4gQ3VycmVudGx5IG9ubHkgdXNlZCBieSBjb250YWluZXIgYXNzZXRzLlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fHN0cmluZ30gW2RhdGFdIC0gSlNPTiBvYmplY3Qgb3Igc3RyaW5nIHdpdGggYWRkaXRpb25hbCBkYXRhIGFib3V0IHRoZSBhc3NldC5cbiAgICAgKiAoZS5nLiBmb3IgdGV4dHVyZSBhbmQgbW9kZWwgYXNzZXRzKSBvciBjb250YWlucyB0aGUgYXNzZXQgZGF0YSBpdHNlbGYgKGUuZy4gaW4gdGhlIGNhc2Ugb2ZcbiAgICAgKiBtYXRlcmlhbHMpLlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbb3B0aW9uc10gLSBUaGUgYXNzZXQgaGFuZGxlciBvcHRpb25zLiBGb3IgY29udGFpbmVyIG9wdGlvbnMgc2VlXG4gICAgICoge0BsaW5rIENvbnRhaW5lckhhbmRsZXJ9LlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW29wdGlvbnMuY3Jvc3NPcmlnaW5dIC0gRm9yIHVzZSB3aXRoIHRleHR1cmUgcmVzb3VyY2VzLiBGb3JcbiAgICAgKiBicm93c2VyLXN1cHBvcnRlZCBpbWFnZSBmb3JtYXRzIG9ubHksIGVuYWJsZSBjcm9zcyBvcmlnaW4uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgYXNzZXQgPSBuZXcgcGMuQXNzZXQoXCJhIHRleHR1cmVcIiwgXCJ0ZXh0dXJlXCIsIHtcbiAgICAgKiAgICAgdXJsOiBcImh0dHA6Ly9leGFtcGxlLmNvbS9teS9hc3NldHMvaGVyZS90ZXh0dXJlLnBuZ1wiXG4gICAgICogfSk7XG4gICAgICovXG4gICAgY29uc3RydWN0b3IobmFtZSwgdHlwZSwgZmlsZSwgZGF0YSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMuX2lkID0gYXNzZXRJZENvdW50ZXItLTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG5hbWUgb2YgdGhlIGFzc2V0LlxuICAgICAgICAgKlxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZSB8fCAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHR5cGUgb2YgdGhlIGFzc2V0LiBPbmUgb2YgW1wiYW5pbWF0aW9uXCIsIFwiYXVkaW9cIiwgXCJiaW5hcnlcIiwgXCJjb250YWluZXJcIiwgXCJjdWJlbWFwXCIsXG4gICAgICAgICAqIFwiY3NzXCIsIFwiZm9udFwiLCBcImpzb25cIiwgXCJodG1sXCIsIFwibWF0ZXJpYWxcIiwgXCJtb2RlbFwiLCBcInJlbmRlclwiLCBcInNjcmlwdFwiLCBcInNoYWRlclwiLCBcInNwcml0ZVwiLFxuICAgICAgICAgKiBcInRlbXBsYXRlXCIsIFwidGV4dFwiLCBcInRleHR1cmVcIl1cbiAgICAgICAgICpcbiAgICAgICAgICogQHR5cGUgeyhcImFuaW1hdGlvblwifFwiYXVkaW9cInxcImJpbmFyeVwifFwiY29udGFpbmVyXCJ8XCJjdWJlbWFwXCJ8XCJjc3NcInxcImZvbnRcInxcImpzb25cInxcImh0bWxcInxcIm1hdGVyaWFsXCJ8XCJtb2RlbFwifFwicmVuZGVyXCJ8XCJzY3JpcHRcInxcInNoYWRlclwifFwic3ByaXRlXCJ8XCJ0ZW1wbGF0ZVwifFwidGV4dFwifFwidGV4dHVyZVwiKX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFzc2V0IHRhZ3MuIEVuYWJsZXMgZmluZGluZyBvZiBhc3NldHMgYnkgdGFncyB1c2luZyB0aGUge0BsaW5rIEFzc2V0UmVnaXN0cnkjZmluZEJ5VGFnfSBtZXRob2QuXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIHtUYWdzfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50YWdzID0gbmV3IFRhZ3ModGhpcyk7XG5cbiAgICAgICAgdGhpcy5fcHJlbG9hZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9maWxlID0gbnVsbDtcbiAgICAgICAgdGhpcy5fZGF0YSA9IGRhdGEgfHwgeyB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPcHRpb25hbCBKU09OIGRhdGEgdGhhdCBjb250YWlucyB0aGUgYXNzZXQgaGFuZGxlciBvcHRpb25zLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAdHlwZSB7b2JqZWN0fVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCB7IH07XG5cbiAgICAgICAgLy8gVGhpcyBpcyB3aGVyZSB0aGUgbG9hZGVkIHJlc291cmNlKHMpIHdpbGwgYmVcbiAgICAgICAgdGhpcy5fcmVzb3VyY2VzID0gW107XG5cbiAgICAgICAgLy8gYSBzdHJpbmctYXNzZXRJZCBkaWN0aW9uYXJ5IHRoYXQgbWFwc1xuICAgICAgICAvLyBsb2NhbGUgdG8gYXNzZXQgaWRcbiAgICAgICAgdGhpcy5faTE4biA9IHt9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUcnVlIGlmIHRoZSBhc3NldCBoYXMgZmluaXNoZWQgYXR0ZW1wdGluZyB0byBsb2FkIHRoZSByZXNvdXJjZS4gSXQgaXMgbm90IGd1YXJhbnRlZWRcbiAgICAgICAgICogdGhhdCB0aGUgcmVzb3VyY2VzIGFyZSBhdmFpbGFibGUgYXMgdGhlcmUgY291bGQgaGF2ZSBiZWVuIGEgbmV0d29yayBlcnJvci5cbiAgICAgICAgICpcbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxvYWRlZCA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUcnVlIGlmIHRoZSByZXNvdXJjZSBpcyBjdXJyZW50bHkgYmVpbmcgbG9hZGVkLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgYXNzZXQgcmVnaXN0cnkgdGhhdCB0aGlzIEFzc2V0IGJlbG9uZ3MgdG8uXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIHtBc3NldFJlZ2lzdHJ5fVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZWdpc3RyeSA9IG51bGw7XG5cbiAgICAgICAgaWYgKGZpbGUpIHRoaXMuZmlsZSA9IGZpbGU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbiB0aGUgYXNzZXQgaGFzIGNvbXBsZXRlZCBsb2FkaW5nLlxuICAgICAqXG4gICAgICogQGV2ZW50IEFzc2V0I2xvYWRcbiAgICAgKiBAcGFyYW0ge0Fzc2V0fSBhc3NldCAtIFRoZSBhc3NldCB0aGF0IHdhcyBsb2FkZWQuXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCBqdXN0IGJlZm9yZSB0aGUgYXNzZXQgdW5sb2FkcyB0aGUgcmVzb3VyY2UuIFRoaXMgYWxsb3dzIGZvciB0aGUgb3Bwb3J0dW5pdHkgdG8gcHJlcGFyZVxuICAgICAqIGZvciBhbiBhc3NldCB0aGF0IHdpbGwgYmUgdW5sb2FkZWQuIEUuZy4gQ2hhbmdpbmcgdGhlIHRleHR1cmUgb2YgYSBtb2RlbCB0byBhIGRlZmF1bHQgYmVmb3JlXG4gICAgICogdGhlIG9uZSBpdCB3YXMgdXNpbmcgaXMgdW5sb2FkZWQuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgQXNzZXQjdW5sb2FkXG4gICAgICogQHBhcmFtIHtBc3NldH0gYXNzZXQgLSBUaGUgYXNzZXQgdGhhdCBpcyBkdWUgdG8gYmUgdW5sb2FkZWQuXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIHRoZSBhc3NldCBpcyByZW1vdmVkIGZyb20gdGhlIGFzc2V0IHJlZ2lzdHJ5LlxuICAgICAqXG4gICAgICogQGV2ZW50IEFzc2V0I3JlbW92ZVxuICAgICAqIEBwYXJhbSB7QXNzZXR9IGFzc2V0IC0gVGhlIGFzc2V0IHRoYXQgd2FzIHJlbW92ZWQuXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCBpZiB0aGUgYXNzZXQgZW5jb3VudGVycyBhbiBlcnJvciB3aGlsZSBsb2FkaW5nLlxuICAgICAqXG4gICAgICogQGV2ZW50IEFzc2V0I2Vycm9yXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGVyciAtIFRoZSBlcnJvciBtZXNzYWdlLlxuICAgICAqIEBwYXJhbSB7QXNzZXR9IGFzc2V0IC0gVGhlIGFzc2V0IHRoYXQgZ2VuZXJhdGVkIHRoZSBlcnJvci5cbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gb25lIG9mIHRoZSBhc3NldCBwcm9wZXJ0aWVzIGBmaWxlYCwgYGRhdGFgLCBgcmVzb3VyY2VgIG9yIGByZXNvdXJjZXNgIGlzIGNoYW5nZWQuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgQXNzZXQjY2hhbmdlXG4gICAgICogQHBhcmFtIHtBc3NldH0gYXNzZXQgLSBUaGUgYXNzZXQgdGhhdCB3YXMgbG9hZGVkLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wZXJ0eSAtIFRoZSBuYW1lIG9mIHRoZSBwcm9wZXJ0eSB0aGF0IGNoYW5nZWQuXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSAtIFRoZSBuZXcgcHJvcGVydHkgdmFsdWUuXG4gICAgICogQHBhcmFtIHsqfSBvbGRWYWx1ZSAtIFRoZSBvbGQgcHJvcGVydHkgdmFsdWUuXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIHdlIGFkZCBhIG5ldyBsb2NhbGl6ZWQgYXNzZXQgaWQgdG8gdGhlIGFzc2V0LlxuICAgICAqXG4gICAgICogQGV2ZW50IEFzc2V0I2FkZDpsb2NhbGl6ZWRcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbG9jYWxlIC0gVGhlIGxvY2FsZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gYXNzZXRJZCAtIFRoZSBhc3NldCBpZCB3ZSBhZGRlZC5cbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gd2UgcmVtb3ZlIGEgbG9jYWxpemVkIGFzc2V0IGlkIGZyb20gdGhlIGFzc2V0LlxuICAgICAqXG4gICAgICogQGV2ZW50IEFzc2V0I3JlbW92ZTpsb2NhbGl6ZWRcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbG9jYWxlIC0gVGhlIGxvY2FsZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gYXNzZXRJZCAtIFRoZSBhc3NldCBpZCB3ZSByZW1vdmVkLlxuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogVGhlIGFzc2V0IGlkLlxuICAgICAqXG4gICAgICogQHR5cGUge251bWJlcn1cbiAgICAgKi9cbiAgICBzZXQgaWQodmFsdWUpIHtcbiAgICAgICAgdGhpcy5faWQgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBnZXQgaWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgZmlsZSBkZXRhaWxzIG9yIG51bGwgaWYgbm8gZmlsZS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtvYmplY3R9XG4gICAgICovXG4gICAgc2V0IGZpbGUodmFsdWUpIHtcbiAgICAgICAgLy8gaWYgdmFsdWUgY29udGFpbnMgdmFyaWFudHMsIGNob29zZSB0aGUgY29ycmVjdCB2YXJpYW50IGZpcnN0XG4gICAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS52YXJpYW50cyAmJiBbJ3RleHR1cmUnLCAndGV4dHVyZWF0bGFzJywgJ2J1bmRsZSddLmluZGV4T2YodGhpcy50eXBlKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIC8vIHNlYXJjaCBmb3IgYWN0aXZlIHZhcmlhbnRcbiAgICAgICAgICAgIGNvbnN0IGFwcCA9IHRoaXMucmVnaXN0cnk/Ll9sb2FkZXI/Ll9hcHAgfHwgZ2V0QXBwbGljYXRpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGRldmljZSA9IGFwcD8uZ3JhcGhpY3NEZXZpY2U7XG4gICAgICAgICAgICBpZiAoZGV2aWNlKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IFZBUklBTlRfREVGQVVMVF9QUklPUklUWS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXJpYW50ID0gVkFSSUFOVF9ERUZBVUxUX1BSSU9SSVRZW2ldO1xuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgZGV2aWNlIHN1cHBvcnRzIHRoZSB2YXJpYW50XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS52YXJpYW50c1t2YXJpYW50XSAmJiBkZXZpY2VbVkFSSUFOVF9TVVBQT1JUW3ZhcmlhbnRdXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS52YXJpYW50c1t2YXJpYW50XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIHZhcmlhbnQgZG9lcyBub3QgZXhpc3QgYnV0IHRoZSBhc3NldCBpcyBpbiBhIGJ1bmRsZVxuICAgICAgICAgICAgICAgICAgICAvLyBhbmQgdGhlIGJ1bmRsZSBjb250YWluIGFzc2V0cyB3aXRoIHRoaXMgdmFyaWFudCB0aGVuIHJldHVybiB0aGUgZGVmYXVsdFxuICAgICAgICAgICAgICAgICAgICAvLyBmaWxlIGZvciB0aGUgYXNzZXRcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFwcC5lbmFibGVCdW5kbGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBidW5kbGVzID0gYXBwLmJ1bmRsZXMubGlzdEJ1bmRsZXNGb3JBc3NldCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChidW5kbGVzICYmIGJ1bmRsZXMuZmluZCgoYikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiPy5maWxlPy52YXJpYW50c1t2YXJpYW50XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBvbGRGaWxlID0gdGhpcy5fZmlsZTtcbiAgICAgICAgY29uc3QgbmV3RmlsZSA9IHZhbHVlID8gbmV3IEFzc2V0RmlsZSh2YWx1ZS51cmwsIHZhbHVlLmZpbGVuYW1lLCB2YWx1ZS5oYXNoLCB2YWx1ZS5zaXplLCB2YWx1ZS5vcHQsIHZhbHVlLmNvbnRlbnRzKSA6IG51bGw7XG5cbiAgICAgICAgaWYgKCEhbmV3RmlsZSAhPT0gISFvbGRGaWxlIHx8IChuZXdGaWxlICYmICFuZXdGaWxlLmVxdWFscyhvbGRGaWxlKSkpIHtcbiAgICAgICAgICAgIHRoaXMuX2ZpbGUgPSBuZXdGaWxlO1xuICAgICAgICAgICAgdGhpcy5maXJlKCdjaGFuZ2UnLCB0aGlzLCAnZmlsZScsIG5ld0ZpbGUsIG9sZEZpbGUpO1xuICAgICAgICAgICAgdGhpcy5yZWxvYWQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBmaWxlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZmlsZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcHRpb25hbCBKU09OIGRhdGEgdGhhdCBjb250YWlucyBlaXRoZXIgdGhlIGNvbXBsZXRlIHJlc291cmNlIGRhdGEuIChlLmcuIGluIHRoZSBjYXNlIG9mIGFcbiAgICAgKiBtYXRlcmlhbCkgb3IgYWRkaXRpb25hbCBkYXRhIChlLmcuIGluIHRoZSBjYXNlIG9mIGEgbW9kZWwgaXQgY29udGFpbnMgbWFwcGluZ3MgZnJvbSBtZXNoIHRvXG4gICAgICogbWF0ZXJpYWwpLlxuICAgICAqXG4gICAgICogQHR5cGUge29iamVjdH1cbiAgICAgKi9cbiAgICBzZXQgZGF0YSh2YWx1ZSkge1xuICAgICAgICAvLyBmaXJlIGNoYW5nZSBldmVudCB3aGVuIGRhdGEgY2hhbmdlc1xuICAgICAgICAvLyBiZWNhdXNlIHRoZSBhc3NldCBtaWdodCBuZWVkIHJlbG9hZGluZyBpZiB0aGF0IGhhcHBlbnNcbiAgICAgICAgY29uc3Qgb2xkID0gdGhpcy5fZGF0YTtcbiAgICAgICAgdGhpcy5fZGF0YSA9IHZhbHVlO1xuICAgICAgICBpZiAodmFsdWUgIT09IG9sZCkge1xuICAgICAgICAgICAgdGhpcy5maXJlKCdjaGFuZ2UnLCB0aGlzLCAnZGF0YScsIHZhbHVlLCBvbGQpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5sb2FkZWQpXG4gICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RyeS5fbG9hZGVyLnBhdGNoKHRoaXMsIHRoaXMucmVnaXN0cnkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IGRhdGEoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kYXRhO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgcmVmZXJlbmNlIHRvIHRoZSByZXNvdXJjZSB3aGVuIHRoZSBhc3NldCBpcyBsb2FkZWQuIGUuZy4gYSB7QGxpbmsgVGV4dHVyZX0gb3IgYSB7QGxpbmsgTW9kZWx9LlxuICAgICAqXG4gICAgICogQHR5cGUge29iamVjdH1cbiAgICAgKi9cbiAgICBzZXQgcmVzb3VyY2UodmFsdWUpIHtcbiAgICAgICAgY29uc3QgX29sZCA9IHRoaXMuX3Jlc291cmNlc1swXTtcbiAgICAgICAgdGhpcy5fcmVzb3VyY2VzWzBdID0gdmFsdWU7XG4gICAgICAgIHRoaXMuZmlyZSgnY2hhbmdlJywgdGhpcywgJ3Jlc291cmNlJywgdmFsdWUsIF9vbGQpO1xuICAgIH1cblxuICAgIGdldCByZXNvdXJjZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc291cmNlc1swXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBIHJlZmVyZW5jZSB0byB0aGUgcmVzb3VyY2VzIG9mIHRoZSBhc3NldCB3aGVuIGl0J3MgbG9hZGVkLiBBbiBhc3NldCBjYW4gaG9sZCBtb3JlIHJ1bnRpbWVcbiAgICAgKiByZXNvdXJjZXMgdGhhbiBvbmUgZS5nLiBjdWJlbWFwcy5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtvYmplY3RbXX1cbiAgICAgKi9cbiAgICBzZXQgcmVzb3VyY2VzKHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IF9vbGQgPSB0aGlzLl9yZXNvdXJjZXM7XG4gICAgICAgIHRoaXMuX3Jlc291cmNlcyA9IHZhbHVlO1xuICAgICAgICB0aGlzLmZpcmUoJ2NoYW5nZScsIHRoaXMsICdyZXNvdXJjZXMnLCB2YWx1ZSwgX29sZCk7XG4gICAgfVxuXG4gICAgZ2V0IHJlc291cmNlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc291cmNlcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJZiB0cnVlIHRoZSBhc3NldCB3aWxsIGJlIGxvYWRlZCBkdXJpbmcgdGhlIHByZWxvYWQgcGhhc2Ugb2YgYXBwbGljYXRpb24gc2V0IHVwLlxuICAgICAqXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICovXG4gICAgc2V0IHByZWxvYWQodmFsdWUpIHtcbiAgICAgICAgdmFsdWUgPSAhIXZhbHVlO1xuICAgICAgICBpZiAodGhpcy5fcHJlbG9hZCA9PT0gdmFsdWUpXG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgdGhpcy5fcHJlbG9hZCA9IHZhbHVlO1xuICAgICAgICBpZiAodGhpcy5fcHJlbG9hZCAmJiAhdGhpcy5sb2FkZWQgJiYgIXRoaXMubG9hZGluZyAmJiB0aGlzLnJlZ2lzdHJ5KVxuICAgICAgICAgICAgdGhpcy5yZWdpc3RyeS5sb2FkKHRoaXMpO1xuICAgIH1cblxuICAgIGdldCBwcmVsb2FkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcHJlbG9hZDtcbiAgICB9XG5cbiAgICBzZXQgbG9hZEZhY2VzKHZhbHVlKSB7XG4gICAgICAgIHZhbHVlID0gISF2YWx1ZTtcbiAgICAgICAgaWYgKCF0aGlzLmhhc093blByb3BlcnR5KCdfbG9hZEZhY2VzJykgfHwgdmFsdWUgIT09IHRoaXMuX2xvYWRGYWNlcykge1xuICAgICAgICAgICAgdGhpcy5fbG9hZEZhY2VzID0gdmFsdWU7XG5cbiAgICAgICAgICAgIC8vIHRoZSBsb2FkRmFjZXMgcHJvcGVydHkgc2hvdWxkIGJlIHBhcnQgb2YgdGhlIGFzc2V0IGRhdGEgYmxvY2tcbiAgICAgICAgICAgIC8vIGJlY2F1c2UgY2hhbmdpbmcgdGhlIGZsYWcgc2hvdWxkIHJlc3VsdCBpbiBhc3NldCBwYXRjaCBiZWluZyBpbnZva2VkLlxuICAgICAgICAgICAgLy8gaGVyZSB3ZSBtdXN0IGludm9rZSBpdCBtYW51YWxseSBpbnN0ZWFkLlxuICAgICAgICAgICAgaWYgKHRoaXMubG9hZGVkKVxuICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0cnkuX2xvYWRlci5wYXRjaCh0aGlzLCB0aGlzLnJlZ2lzdHJ5KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBsb2FkRmFjZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sb2FkRmFjZXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRoZSBVUkwgcmVxdWlyZWQgdG8gZmV0Y2ggdGhlIGZpbGUgZm9yIHRoaXMgYXNzZXQuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfG51bGx9IFRoZSBVUkwuIFJldHVybnMgbnVsbCBpZiB0aGUgYXNzZXQgaGFzIG5vIGFzc29jaWF0ZWQgZmlsZS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHZhciBhc3NldHMgPSBhcHAuYXNzZXRzLmZpbmQoXCJNeSBJbWFnZVwiLCBcInRleHR1cmVcIik7XG4gICAgICogdmFyIGltZyA9IFwiJmx0O2ltZyBzcmM9J1wiICsgYXNzZXRzWzBdLmdldEZpbGVVcmwoKSArIFwiJyZndDtcIjtcbiAgICAgKi9cbiAgICBnZXRGaWxlVXJsKCkge1xuICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5maWxlO1xuXG4gICAgICAgIGlmICghZmlsZSB8fCAhZmlsZS51cmwpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcblxuICAgICAgICBsZXQgdXJsID0gZmlsZS51cmw7XG5cbiAgICAgICAgaWYgKHRoaXMucmVnaXN0cnkgJiYgdGhpcy5yZWdpc3RyeS5wcmVmaXggJiYgIUFCU09MVVRFX1VSTC50ZXN0KHVybCkpXG4gICAgICAgICAgICB1cmwgPSB0aGlzLnJlZ2lzdHJ5LnByZWZpeCArIHVybDtcblxuICAgICAgICAvLyBhZGQgZmlsZSBoYXNoIHRvIGF2b2lkIGhhcmQtY2FjaGluZyBwcm9ibGVtc1xuICAgICAgICBpZiAodGhpcy50eXBlICE9PSAnc2NyaXB0JyAmJiBmaWxlLmhhc2gpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlcGFyYXRvciA9IHVybC5pbmRleE9mKCc/JykgIT09IC0xID8gJyYnIDogJz8nO1xuICAgICAgICAgICAgdXJsICs9IHNlcGFyYXRvciArICd0PScgKyBmaWxlLmhhc2g7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdXJsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdCBhbiBhc3NldCBVUkwgZnJvbSB0aGlzIGFzc2V0J3MgbG9jYXRpb24gYW5kIGEgcmVsYXRpdmUgcGF0aC4gSWYgdGhlIHJlbGF0aXZlUGF0aFxuICAgICAqIGlzIGEgYmxvYiBvciBCYXNlNjQgVVJJLCB0aGVuIHJldHVybiB0aGF0IGluc3RlYWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcmVsYXRpdmVQYXRoIC0gVGhlIHJlbGF0aXZlIHBhdGggdG8gYmUgY29uY2F0ZW5hdGVkIHRvIHRoaXMgYXNzZXQncyBiYXNlIHVybC5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXN1bHRpbmcgVVJMIG9mIHRoZSBhc3NldC5cbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgZ2V0QWJzb2x1dGVVcmwocmVsYXRpdmVQYXRoKSB7XG4gICAgICAgIGlmIChyZWxhdGl2ZVBhdGguc3RhcnRzV2l0aCgnYmxvYjonKSB8fCByZWxhdGl2ZVBhdGguc3RhcnRzV2l0aCgnZGF0YTonKSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlbGF0aXZlUGF0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGJhc2UgPSBwYXRoLmdldERpcmVjdG9yeSh0aGlzLmZpbGUudXJsKTtcbiAgICAgICAgcmV0dXJuIHBhdGguam9pbihiYXNlLCByZWxhdGl2ZVBhdGgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIGFzc2V0IGlkIG9mIHRoZSBhc3NldCB0aGF0IGNvcnJlc3BvbmRzIHRvIHRoZSBzcGVjaWZpZWQgbG9jYWxlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGxvY2FsZSAtIFRoZSBkZXNpcmVkIGxvY2FsZSBlLmcuIEFyLUFSLlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IEFuIGFzc2V0IGlkIG9yIG51bGwgaWYgdGhlcmUgaXMgbm8gYXNzZXQgc3BlY2lmaWVkIGZvciB0aGUgZGVzaXJlZCBsb2NhbGUuXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGdldExvY2FsaXplZEFzc2V0SWQobG9jYWxlKSB7XG4gICAgICAgIC8vIHRyaWVzIHRvIGZpbmQgZWl0aGVyIHRoZSBkZXNpcmVkIGxvY2FsZSBvciBhIGZhbGxiYWNrIGxvY2FsZVxuICAgICAgICBsb2NhbGUgPSBmaW5kQXZhaWxhYmxlTG9jYWxlKGxvY2FsZSwgdGhpcy5faTE4bik7XG4gICAgICAgIHJldHVybiB0aGlzLl9pMThuW2xvY2FsZV0gfHwgbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGRzIGEgcmVwbGFjZW1lbnQgYXNzZXQgaWQgZm9yIHRoZSBzcGVjaWZpZWQgbG9jYWxlLiBXaGVuIHRoZSBsb2NhbGUgaW5cbiAgICAgKiB7QGxpbmsgQXBwbGljYXRpb24jaTE4bn0gY2hhbmdlcyB0aGVuIHJlZmVyZW5jZXMgdG8gdGhpcyBhc3NldCB3aWxsIGJlIHJlcGxhY2VkIHdpdGggdGhlXG4gICAgICogc3BlY2lmaWVkIGFzc2V0IGlkLiAoQ3VycmVudGx5IG9ubHkgc3VwcG9ydGVkIGJ5IHRoZSB7QGxpbmsgRWxlbWVudENvbXBvbmVudH0pLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGxvY2FsZSAtIFRoZSBsb2NhbGUgZS5nLiBBci1BUi5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gYXNzZXRJZCAtIFRoZSBhc3NldCBpZC5cbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgYWRkTG9jYWxpemVkQXNzZXRJZChsb2NhbGUsIGFzc2V0SWQpIHtcbiAgICAgICAgdGhpcy5faTE4bltsb2NhbGVdID0gYXNzZXRJZDtcbiAgICAgICAgdGhpcy5maXJlKCdhZGQ6bG9jYWxpemVkJywgbG9jYWxlLCBhc3NldElkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGEgbG9jYWxpemVkIGFzc2V0LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGxvY2FsZSAtIFRoZSBsb2NhbGUgZS5nLiBBci1BUi5cbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgcmVtb3ZlTG9jYWxpemVkQXNzZXRJZChsb2NhbGUpIHtcbiAgICAgICAgY29uc3QgYXNzZXRJZCA9IHRoaXMuX2kxOG5bbG9jYWxlXTtcbiAgICAgICAgaWYgKGFzc2V0SWQpIHtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9pMThuW2xvY2FsZV07XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ3JlbW92ZTpsb2NhbGl6ZWQnLCBsb2NhbGUsIGFzc2V0SWQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGFrZSBhIGNhbGxiYWNrIHdoaWNoIGlzIGNhbGxlZCBhcyBzb29uIGFzIHRoZSBhc3NldCBpcyBsb2FkZWQuIElmIHRoZSBhc3NldCBpcyBhbHJlYWR5XG4gICAgICogbG9hZGVkIHRoZSBjYWxsYmFjayBpcyBjYWxsZWQgc3RyYWlnaHQgYXdheS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7QXNzZXRSZWFkeUNhbGxiYWNrfSBjYWxsYmFjayAtIFRoZSBmdW5jdGlvbiBjYWxsZWQgd2hlbiB0aGUgYXNzZXQgaXMgcmVhZHkuIFBhc3NlZFxuICAgICAqIHRoZSAoYXNzZXQpIGFyZ3VtZW50cy5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gW3Njb3BlXSAtIFNjb3BlIG9iamVjdCB0byB1c2Ugd2hlbiBjYWxsaW5nIHRoZSBjYWxsYmFjay5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHZhciBhc3NldCA9IGFwcC5hc3NldHMuZmluZChcIk15IEFzc2V0XCIpO1xuICAgICAqIGFzc2V0LnJlYWR5KGZ1bmN0aW9uIChhc3NldCkge1xuICAgICAqICAgLy8gYXNzZXQgbG9hZGVkXG4gICAgICogfSk7XG4gICAgICogYXBwLmFzc2V0cy5sb2FkKGFzc2V0KTtcbiAgICAgKi9cbiAgICByZWFkeShjYWxsYmFjaywgc2NvcGUpIHtcbiAgICAgICAgc2NvcGUgPSBzY29wZSB8fCB0aGlzO1xuXG4gICAgICAgIGlmICh0aGlzLmxvYWRlZCkge1xuICAgICAgICAgICAgY2FsbGJhY2suY2FsbChzY29wZSwgdGhpcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm9uY2UoJ2xvYWQnLCBmdW5jdGlvbiAoYXNzZXQpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKHNjb3BlLCBhc3NldCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJlbG9hZCgpIHtcbiAgICAgICAgLy8gbm8gbmVlZCB0byBiZSByZWxvYWRlZFxuICAgICAgICBpZiAodGhpcy5sb2FkZWQpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnJlZ2lzdHJ5LmxvYWQodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXN0cm95cyB0aGUgYXNzb2NpYXRlZCByZXNvdXJjZSBhbmQgbWFya3MgYXNzZXQgYXMgdW5sb2FkZWQuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHZhciBhc3NldCA9IGFwcC5hc3NldHMuZmluZChcIk15IEFzc2V0XCIpO1xuICAgICAqIGFzc2V0LnVubG9hZCgpO1xuICAgICAqIC8vIGFzc2V0LnJlc291cmNlIGlzIG51bGxcbiAgICAgKi9cbiAgICB1bmxvYWQoKSB7XG4gICAgICAgIGlmICghdGhpcy5sb2FkZWQgJiYgdGhpcy5fcmVzb3VyY2VzLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICB0aGlzLmZpcmUoJ3VubG9hZCcsIHRoaXMpO1xuICAgICAgICB0aGlzLnJlZ2lzdHJ5LmZpcmUoJ3VubG9hZDonICsgdGhpcy5pZCwgdGhpcyk7XG5cbiAgICAgICAgY29uc3Qgb2xkID0gdGhpcy5fcmVzb3VyY2VzO1xuXG4gICAgICAgIC8vIGNsZWFyIHJlc291cmNlcyBvbiB0aGUgYXNzZXRcbiAgICAgICAgdGhpcy5yZXNvdXJjZXMgPSBbXTtcbiAgICAgICAgdGhpcy5sb2FkZWQgPSBmYWxzZTtcblxuICAgICAgICAvLyByZW1vdmUgcmVzb3VyY2UgZnJvbSBsb2FkZXIgY2FjaGVcbiAgICAgICAgaWYgKHRoaXMuZmlsZSkge1xuICAgICAgICAgICAgdGhpcy5yZWdpc3RyeS5fbG9hZGVyLmNsZWFyQ2FjaGUodGhpcy5nZXRGaWxlVXJsKCksIHRoaXMudHlwZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBkZXN0cm95IHJlc291cmNlc1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9sZC5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgY29uc3QgcmVzb3VyY2UgPSBvbGRbaV07XG4gICAgICAgICAgICBpZiAocmVzb3VyY2UgJiYgcmVzb3VyY2UuZGVzdHJveSkge1xuICAgICAgICAgICAgICAgIHJlc291cmNlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhlbHBlciBmdW5jdGlvbiB0byByZXNvbHZlIGFzc2V0IGZpbGUgZGF0YSBhbmQgcmV0dXJuIHRoZSBjb250ZW50cyBhcyBhbiBBcnJheUJ1ZmZlci4gSWYgdGhlXG4gICAgICogYXNzZXQgZmlsZSBjb250ZW50cyBhcmUgcHJlc2VudCwgdGhhdCBpcyByZXR1cm5lZC4gT3RoZXJ3aXNlIHRoZSBmaWxlIGRhdGEgaXMgYmUgZG93bmxvYWRlZFxuICAgICAqIHZpYSBodHRwLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGxvYWRVcmwgLSBUaGUgVVJMIGFzIHBhc3NlZCBpbnRvIHRoZSBoYW5kbGVyXG4gICAgICogQHBhcmFtIHtSZXNvdXJjZUxvYWRlckNhbGxiYWNrfSBjYWxsYmFjayAtIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB0byByZWNlaXZlIHJlc3VsdHMuXG4gICAgICogQHBhcmFtIHtBc3NldH0gW2Fzc2V0XSAtIFRoZSBhc3NldFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBtYXhSZXRyaWVzIC0gTnVtYmVyIG9mIHJldHJpZXMgaWYgaHR0cCBkb3dubG9hZCBpcyByZXF1aXJlZFxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBzdGF0aWMgZmV0Y2hBcnJheUJ1ZmZlcihsb2FkVXJsLCBjYWxsYmFjaywgYXNzZXQsIG1heFJldHJpZXMgPSAwKSB7XG4gICAgICAgIGlmIChhc3NldD8uZmlsZT8uY29udGVudHMpIHtcbiAgICAgICAgICAgIC8vIGFzc2V0IGZpbGUgY29udGVudHMgd2VyZSBwcm92aWRlZFxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgYXNzZXQuZmlsZS5jb250ZW50cyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGFzc2V0IGNvbnRlbnRzIG11c3QgYmUgZG93bmxvYWRlZFxuICAgICAgICAgICAgaHR0cC5nZXQobG9hZFVybCwge1xuICAgICAgICAgICAgICAgIGNhY2hlOiB0cnVlLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ2FycmF5YnVmZmVyJyxcbiAgICAgICAgICAgICAgICByZXRyeTogbWF4UmV0cmllcyA+IDAsXG4gICAgICAgICAgICAgICAgbWF4UmV0cmllczogbWF4UmV0cmllc1xuICAgICAgICAgICAgfSwgY2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgeyBBc3NldCB9O1xuIl0sIm5hbWVzIjpbImFzc2V0SWRDb3VudGVyIiwiVkFSSUFOVF9TVVBQT1JUIiwicHZyIiwiZHh0IiwiZXRjMiIsImV0YzEiLCJiYXNpcyIsIlZBUklBTlRfREVGQVVMVF9QUklPUklUWSIsIkFzc2V0IiwiRXZlbnRIYW5kbGVyIiwiY29uc3RydWN0b3IiLCJuYW1lIiwidHlwZSIsImZpbGUiLCJkYXRhIiwib3B0aW9ucyIsIl9pZCIsInRhZ3MiLCJUYWdzIiwiX3ByZWxvYWQiLCJfZmlsZSIsIl9kYXRhIiwiX3Jlc291cmNlcyIsIl9pMThuIiwibG9hZGVkIiwibG9hZGluZyIsInJlZ2lzdHJ5IiwiaWQiLCJ2YWx1ZSIsInZhcmlhbnRzIiwiaW5kZXhPZiIsImFwcCIsIl9sb2FkZXIiLCJfYXBwIiwiZ2V0QXBwbGljYXRpb24iLCJkZXZpY2UiLCJncmFwaGljc0RldmljZSIsImkiLCJsZW4iLCJsZW5ndGgiLCJ2YXJpYW50IiwiZW5hYmxlQnVuZGxlcyIsImJ1bmRsZXMiLCJsaXN0QnVuZGxlc0ZvckFzc2V0IiwiZmluZCIsImIiLCJvbGRGaWxlIiwibmV3RmlsZSIsIkFzc2V0RmlsZSIsInVybCIsImZpbGVuYW1lIiwiaGFzaCIsInNpemUiLCJvcHQiLCJjb250ZW50cyIsImVxdWFscyIsImZpcmUiLCJyZWxvYWQiLCJvbGQiLCJwYXRjaCIsInJlc291cmNlIiwiX29sZCIsInJlc291cmNlcyIsInByZWxvYWQiLCJsb2FkIiwibG9hZEZhY2VzIiwiaGFzT3duUHJvcGVydHkiLCJfbG9hZEZhY2VzIiwiZ2V0RmlsZVVybCIsInByZWZpeCIsIkFCU09MVVRFX1VSTCIsInRlc3QiLCJzZXBhcmF0b3IiLCJnZXRBYnNvbHV0ZVVybCIsInJlbGF0aXZlUGF0aCIsInN0YXJ0c1dpdGgiLCJiYXNlIiwicGF0aCIsImdldERpcmVjdG9yeSIsImpvaW4iLCJnZXRMb2NhbGl6ZWRBc3NldElkIiwibG9jYWxlIiwiZmluZEF2YWlsYWJsZUxvY2FsZSIsImFkZExvY2FsaXplZEFzc2V0SWQiLCJhc3NldElkIiwicmVtb3ZlTG9jYWxpemVkQXNzZXRJZCIsInJlYWR5IiwiY2FsbGJhY2siLCJzY29wZSIsImNhbGwiLCJvbmNlIiwiYXNzZXQiLCJ1bmxvYWQiLCJjbGVhckNhY2hlIiwiZGVzdHJveSIsImZldGNoQXJyYXlCdWZmZXIiLCJsb2FkVXJsIiwibWF4UmV0cmllcyIsInNldFRpbWVvdXQiLCJodHRwIiwiZ2V0IiwiY2FjaGUiLCJyZXNwb25zZVR5cGUiLCJyZXRyeSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFnQkEsSUFBSUEsY0FBYyxHQUFHLENBQUMsQ0FBdEIsQ0FBQTtBQUVBLE1BQU1DLGVBQWUsR0FBRztBQUNwQkMsRUFBQUEsR0FBRyxFQUFFLDJCQURlO0FBRXBCQyxFQUFBQSxHQUFHLEVBQUUsMEJBRmU7QUFHcEJDLEVBQUFBLElBQUksRUFBRSx5QkFIYztBQUlwQkMsRUFBQUEsSUFBSSxFQUFFLDBCQUpjO0FBS3BCQyxFQUFBQSxLQUFLLEVBQUUsUUFBQTtBQUxhLENBQXhCLENBQUE7QUFRQSxNQUFNQyx3QkFBd0IsR0FBRyxDQUFDLEtBQUQsRUFBUSxLQUFSLEVBQWUsTUFBZixFQUF1QixNQUF2QixFQUErQixPQUEvQixDQUFqQyxDQUFBOztBQXlCQSxNQUFNQyxLQUFOLFNBQW9CQyxZQUFwQixDQUFpQztFQWlDN0JDLFdBQVcsQ0FBQ0MsSUFBRCxFQUFPQyxJQUFQLEVBQWFDLElBQWIsRUFBbUJDLElBQW5CLEVBQXlCQyxPQUF6QixFQUFrQztBQUN6QyxJQUFBLEtBQUEsRUFBQSxDQUFBO0lBRUEsSUFBS0MsQ0FBQUEsR0FBTCxHQUFXaEIsY0FBYyxFQUF6QixDQUFBO0FBT0EsSUFBQSxJQUFBLENBQUtXLElBQUwsR0FBWUEsSUFBSSxJQUFJLEVB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
