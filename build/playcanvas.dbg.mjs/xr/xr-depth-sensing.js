/**
 * @license
 * PlayCanvas Engine v1.58.0-dev revision e102f2b2a (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { platform } from '../core/platform.js';
import { EventHandler } from '../core/event-handler.js';
import { Mat4 } from '../math/mat4.js';
import { Texture } from '../graphics/texture.js';
import { PIXELFORMAT_L8_A8, ADDRESS_CLAMP_TO_EDGE, FILTER_LINEAR } from '../graphics/constants.js';
import { XRDEPTHSENSINGUSAGE_CPU, XRDEPTHSENSINGUSAGE_GPU } from './constants.js';

class XrDepthSensing extends EventHandler {
  constructor(manager) {
    super();
    this._manager = void 0;
    this._available = false;
    this._depthInfoCpu = null;
    this._depthInfoGpu = null;
    this._usage = null;
    this._dataFormat = null;
    this._matrixDirty = false;
    this._matrix = new Mat4();
    this._emptyBuffer = new Uint8Array(32);
    this._depthBuffer = null;
    this._texture = void 0;
    this._manager = manager;
    this._texture = new Texture(this._manager.app.graphicsDevice, {
      format: PIXELFORMAT_L8_A8,
      mipmaps: false,
      addressU: ADDRESS_CLAMP_TO_EDGE,
      addressV: ADDRESS_CLAMP_TO_EDGE,
      minFilter: FILTER_LINEAR,
      magFilter: FILTER_LINEAR,
      name: 'XRDepthSensing'
    });

    if (this.supported) {
      this._manager.on('start', this._onSessionStart, this);

      this._manager.on('end', this._onSessionEnd, this);
    }
  }

  destroy() {
    this._texture.destroy();

    this._texture = null;
  }

  _onSessionStart() {
    const session = this._manager.session;

    try {
      this._usage = session.depthUsage;
      this._dataFormat = session.depthDataFormat;
    } catch (ex) {
      this._usage = null;
      this._dataFormat = null;
      this._available = false;
      this.fire('error', ex);
    }
  }

  _onSessionEnd() {
    this._depthInfoCpu = null;
    this._depthInfoGpu = null;
    this._usage = null;
    this._dataFormat = null;

    if (this._available) {
      this._available = false;
      this.fire('unavailable');
    }

    this._depthBuffer = null;
    this._texture._width = 4;
    this._texture._height = 4;
    this._texture._levels[0] = this._emptyBuffer;

    this._texture.upload();
  }

  _updateTexture() {
    const depthInfo = this._depthInfoCpu || this._depthInfoGpu;

    if (depthInfo) {
      let resized = false;

      if (depthInfo.width !== this._texture.width || depthInfo.height !== this._texture.height) {
        this._texture._width = depthInfo.width;
        this._texture._height = depthInfo.height;
        this._matrixDirty = true;
        resized = true;
      }

      if (this._depthInfoCpu) {
        const dataBuffer = this._depthInfoCpu.data;
        this._depthBuffer = new Uint8Array(dataBuffer);
        this._texture._levels[0] = this._depthBuffer;

        this._texture.upload();
      } else if (this._depthInfoGpu) {
        this._texture._levels[0] = this._depthInfoGpu.texture;

        this._texture.upload();
      }

      if (resized) this.fire('resize', depthInfo.width, depthInfo.height);
    } else if (this._depthBuffer) {
      this._depthBuffer = null;
      this._texture._width = 4;
      this._texture._height = 4;
      this._texture._levels[0] = this._emptyBuffer;

      this._texture.upload();
    }
  }

  update(frame, view) {
    if (!this._usage) return;
    let depthInfoCpu = null;
    let depthInfoGpu = null;

    if (this._usage === XRDEPTHSENSINGUSAGE_CPU && view) {
      depthInfoCpu = frame.getDepthInformation(view);
    } else if (this._usage === XRDEPTHSENSINGUSAGE_GPU && view) {
      depthInfoGpu = frame.getDepthInformation(view);
    }

    if (this._depthInfoCpu && !depthInfoCpu || !this._depthInfoCpu && depthInfoCpu || this.depthInfoGpu && !depthInfoGpu || !this._depthInfoGpu && depthInfoGpu) {
      this._matrixDirty = true;
    }

    this._depthInfoCpu = depthInfoCpu;
    this._depthInfoGpu = depthInfoGpu;

    this._updateTexture();

    if (this._matrixDirty) {
      this._matrixDirty = false;
      const depthInfo = this._depthInfoCpu || this._depthInfoGpu;

      if (depthInfo) {
        this._matrix.data.set(depthInfo.normDepthBufferFromNormView.matrix);
      } else {
        this._matrix.setIdentity();
      }
    }

    if ((this._depthInfoCpu || this._depthInfoGpu) && !this._available) {
      this._available = true;
      this.fire('available');
    } else if (!this._depthInfoCpu && !this._depthInfoGpu && this._available) {
      this._available = false;
      this.fire('unavailable');
    }
  }

  getDepth(u, v) {
    if (!this._depthInfoCpu) return null;
    return this._depthInfoCpu.getDepthInMeters(u, v);
  }

  get supported() {
    return platform.browser && !!window.XRDepthInformation;
  }

  get available() {
    return this._available;
  }

  get usage() {
    return this._usage;
  }

  get dataFormat() {
    return this._dataFormat;
  }

  get width() {
    const depthInfo = this._depthInfoCpu || this._depthInfoGpu;
    return depthInfo && depthInfo.width || 0;
  }

  get height() {
    const depthInfo = this._depthInfoCpu || this._depthInfoGpu;
    return depthInfo && depthInfo.height || 0;
  }

  get texture() {
    return this._texture;
  }

  get uvMatrix() {
    return this._matrix;
  }

  get rawValueToMeters() {
    const depthInfo = this._depthInfoCpu || this._depthInfoGpu;
    return depthInfo && depthInfo.rawValueToMeters || 0;
  }

}

export { XrDepthSensing };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieHItZGVwdGgtc2Vuc2luZy5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3hyL3hyLWRlcHRoLXNlbnNpbmcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGxhdGZvcm0gfSBmcm9tICcuLi9jb3JlL3BsYXRmb3JtLmpzJztcbmltcG9ydCB7IEV2ZW50SGFuZGxlciB9IGZyb20gJy4uL2NvcmUvZXZlbnQtaGFuZGxlci5qcyc7XG5pbXBvcnQgeyBNYXQ0IH0gZnJvbSAnLi4vbWF0aC9tYXQ0LmpzJztcbmltcG9ydCB7IFRleHR1cmUgfSBmcm9tICcuLi9ncmFwaGljcy90ZXh0dXJlLmpzJztcbmltcG9ydCB7IEFERFJFU1NfQ0xBTVBfVE9fRURHRSwgUElYRUxGT1JNQVRfTDhfQTgsIEZJTFRFUl9MSU5FQVIgfSBmcm9tICcuLi9ncmFwaGljcy9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgWFJERVBUSFNFTlNJTkdVU0FHRV9DUFUsIFhSREVQVEhTRU5TSU5HVVNBR0VfR1BVIH0gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi94ci1tYW5hZ2VyLmpzJykuWHJNYW5hZ2VyfSBYck1hbmFnZXIgKi9cblxuLyoqXG4gKiBEZXB0aCBTZW5zaW5nIHByb3ZpZGVzIGRlcHRoIGluZm9ybWF0aW9uIHdoaWNoIGlzIHJlY29uc3RydWN0ZWQgdXNpbmcgdGhlIHVuZGVybHlpbmcgQVIgc3lzdGVtLlxuICogSXQgcHJvdmlkZXMgdGhlIGFiaWxpdHkgdG8gcXVlcnkgZGVwdGggdmFsdWVzIChDUFUgcGF0aCkgb3IgYWNjZXNzIGEgZGVwdGggdGV4dHVyZSAoR1BVIHBhdGgpLlxuICogRGVwdGggaW5mb3JtYXRpb24gY2FuIGJlIHVzZWQgKG5vdCBsaW1pdGVkIHRvKSBmb3IgcmVjb25zdHJ1Y3RpbmcgcmVhbCB3b3JsZCBnZW9tZXRyeSwgdmlydHVhbFxuICogb2JqZWN0IHBsYWNlbWVudCwgb2NjbHVzaW9uIG9mIHZpcnR1YWwgb2JqZWN0cyBieSByZWFsIHdvcmxkIGdlb21ldHJ5IGFuZCBtb3JlLlxuICpcbiAqIGBgYGphdmFzY3JpcHRcbiAqIC8vIENQVSBwYXRoXG4gKiB2YXIgZGVwdGhTZW5zaW5nID0gYXBwLnhyLmRlcHRoU2Vuc2luZztcbiAqIGlmIChkZXB0aFNlbnNpbmcuYXZhaWxhYmxlKSB7XG4gKiAgICAgLy8gZ2V0IGRlcHRoIGluIHRoZSBtaWRkbGUgb2YgdGhlIHNjcmVlbiwgdmFsdWUgaXMgaW4gbWV0ZXJzXG4gKiAgICAgdmFyIGRlcHRoID0gZGVwdGhTZW5zaW5nLmdldERlcHRoKGRlcHRoU2Vuc2luZy53aWR0aCAvIDIsIGRlcHRoU2Vuc2luZy5oZWlnaHQgLyAyKTtcbiAqIH1cbiAqIGBgYFxuICpcbiAqIGBgYGphdmFzY3JpcHRcbiAqIC8vIEdQVSBwYXRoLCBhdHRhY2hpbmcgdGV4dHVyZSB0byBtYXRlcmlhbFxuICogbWF0ZXJpYWwuZGlmZnVzZU1hcCA9IGRlcHRoU2Vuc2luZy50ZXh0dXJlO1xuICogbWF0ZXJpYWwuc2V0UGFyYW1ldGVyKCdtYXRyaXhfZGVwdGhfdXYnLCBkZXB0aFNlbnNpbmcudXZNYXRyaXguZGF0YSk7XG4gKiBtYXRlcmlhbC5zZXRQYXJhbWV0ZXIoJ2RlcHRoX3Jhd190b19tZXRlcnMnLCBkZXB0aFNlbnNpbmcucmF3VmFsdWVUb01ldGVycyk7XG4gKiBtYXRlcmlhbC51cGRhdGUoKTtcbiAqXG4gKiAvLyB1cGRhdGUgVVYgdHJhbnNmb3JtYXRpb24gbWF0cml4IG9uIGRlcHRoIHRleHR1cmUgcmVzaXplXG4gKiBkZXB0aFNlbnNpbmcub24oJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHtcbiAqICAgICBtYXRlcmlhbC5zZXRQYXJhbWV0ZXIoJ21hdHJpeF9kZXB0aF91dicsIGRlcHRoU2Vuc2luZy51dk1hdHJpeC5kYXRhKTtcbiAqICAgICBtYXRlcmlhbC5zZXRQYXJhbWV0ZXIoJ2RlcHRoX3Jhd190b19tZXRlcnMnLCBkZXB0aFNlbnNpbmcucmF3VmFsdWVUb01ldGVycyk7XG4gKiB9KTtcbiAqIGBgYFxuICpcbiAqIGBgYGphdmFzY3JpcHRcbiAqIC8vIEdMU0wgc2hhZGVyIHRvIHVucGFjayBkZXB0aCB0ZXh0dXJlXG4gKiB2YXJ5aW5nIHZlYzIgdlV2MDtcbiAqXG4gKiB1bmlmb3JtIHNhbXBsZXIyRCB0ZXh0dXJlX2RlcHRoU2Vuc2luZ01hcDtcbiAqIHVuaWZvcm0gbWF0NCBtYXRyaXhfZGVwdGhfdXY7XG4gKiB1bmlmb3JtIGZsb2F0IGRlcHRoX3Jhd190b19tZXRlcnM7XG4gKlxuICogdm9pZCBtYWluKHZvaWQpIHtcbiAqICAgICAvLyB0cmFuc2Zvcm0gVVZzIHVzaW5nIGRlcHRoIG1hdHJpeFxuICogICAgIHZlYzIgdGV4Q29vcmQgPSAobWF0cml4X2RlcHRoX3V2ICogdmVjNCh2VXYwLnh5LCAwLjAsIDEuMCkpLnh5O1xuICpcbiAqICAgICAvLyBnZXQgbHVtaW5hbmNlIGFscGhhIGNvbXBvbmVudHMgZnJvbSBkZXB0aCB0ZXh0dXJlXG4gKiAgICAgdmVjMiBwYWNrZWREZXB0aCA9IHRleHR1cmUyRCh0ZXh0dXJlX2RlcHRoU2Vuc2luZ01hcCwgdGV4Q29vcmQpLnJhO1xuICpcbiAqICAgICAvLyB1bnBhY2sgaW50byBzaW5nbGUgdmFsdWUgaW4gbWlsbGltZXRlcnNcbiAqICAgICBmbG9hdCBkZXB0aCA9IGRvdChwYWNrZWREZXB0aCwgdmVjMigyNTUuMCwgMjU2LjAgKiAyNTUuMCkpICogZGVwdGhfcmF3X3RvX21ldGVyczsgLy8gbVxuICpcbiAqICAgICAvLyBub3JtYWxpemU6IDBtIHRvIDhtIGRpc3RhbmNlXG4gKiAgICAgZGVwdGggPSBtaW4oZGVwdGggLyA4LjAsIDEuMCk7IC8vIDAuLjEgPSAwLi44XG4gKlxuICogICAgIC8vIHBhaW50IHNjZW5lIGZyb20gYmxhY2sgdG8gd2hpdGUgYmFzZWQgb24gZGlzdGFuY2VcbiAqICAgICBnbF9GcmFnQ29sb3IgPSB2ZWM0KGRlcHRoLCBkZXB0aCwgZGVwdGgsIDEuMCk7XG4gKiB9XG4gKiBgYGBcbiAqXG4gKiBAYXVnbWVudHMgRXZlbnRIYW5kbGVyXG4gKi9cbmNsYXNzIFhyRGVwdGhTZW5zaW5nIGV4dGVuZHMgRXZlbnRIYW5kbGVyIHtcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7WHJNYW5hZ2VyfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX21hbmFnZXI7XG5cbiAgICAgLyoqXG4gICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgKiBAcHJpdmF0ZVxuICAgICAgKi9cbiAgICBfYXZhaWxhYmxlID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7WFJDUFVEZXB0aEluZm9ybWF0aW9ufG51bGx9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZGVwdGhJbmZvQ3B1ID0gbnVsbDtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtYUkNQVURlcHRoSW5mb3JtYXRpb258bnVsbH1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9kZXB0aEluZm9HcHUgPSBudWxsO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge3N0cmluZ3xudWxsfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3VzYWdlID0gbnVsbDtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtzdHJpbmd8bnVsbH1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9kYXRhRm9ybWF0ID0gbnVsbDtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX21hdHJpeERpcnR5ID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7TWF0NH1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9tYXRyaXggPSBuZXcgTWF0NCgpO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge1VpbnQ4QXJyYXl9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZW1wdHlCdWZmZXIgPSBuZXcgVWludDhBcnJheSgzMik7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7VWludDhBcnJheXxudWxsfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2RlcHRoQnVmZmVyID0gbnVsbDtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtUZXh0dXJlfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3RleHR1cmU7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgWHJEZXB0aFNlbnNpbmcgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1hyTWFuYWdlcn0gbWFuYWdlciAtIFdlYlhSIE1hbmFnZXIuXG4gICAgICogQGhpZGVjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKG1hbmFnZXIpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLl9tYW5hZ2VyID0gbWFuYWdlcjtcblxuICAgICAgICAvLyBUT0RPOiBkYXRhIGZvcm1hdCBjYW4gYmUgZGlmZmVyZW50XG4gICAgICAgIHRoaXMuX3RleHR1cmUgPSBuZXcgVGV4dHVyZSh0aGlzLl9tYW5hZ2VyLmFwcC5ncmFwaGljc0RldmljZSwge1xuICAgICAgICAgICAgZm9ybWF0OiBQSVhFTEZPUk1BVF9MOF9BOCxcbiAgICAgICAgICAgIG1pcG1hcHM6IGZhbHNlLFxuICAgICAgICAgICAgYWRkcmVzc1U6IEFERFJFU1NfQ0xBTVBfVE9fRURHRSxcbiAgICAgICAgICAgIGFkZHJlc3NWOiBBRERSRVNTX0NMQU1QX1RPX0VER0UsXG4gICAgICAgICAgICBtaW5GaWx0ZXI6IEZJTFRFUl9MSU5FQVIsXG4gICAgICAgICAgICBtYWdGaWx0ZXI6IEZJTFRFUl9MSU5FQVIsXG4gICAgICAgICAgICBuYW1lOiAnWFJEZXB0aFNlbnNpbmcnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICh0aGlzLnN1cHBvcnRlZCkge1xuICAgICAgICAgICAgdGhpcy5fbWFuYWdlci5vbignc3RhcnQnLCB0aGlzLl9vblNlc3Npb25TdGFydCwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLl9tYW5hZ2VyLm9uKCdlbmQnLCB0aGlzLl9vblNlc3Npb25FbmQsIHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbiBkZXB0aCBzZW5zaW5nIGRhdGEgYmVjb21lcyBhdmFpbGFibGUuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgWHJEZXB0aFNlbnNpbmcjYXZhaWxhYmxlXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIGRlcHRoIHNlbnNpbmcgZGF0YSBiZWNvbWVzIHVuYXZhaWxhYmxlLlxuICAgICAqXG4gICAgICogQGV2ZW50IFhyRGVwdGhTZW5zaW5nI3VuYXZhaWxhYmxlXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIHRoZSBkZXB0aCBzZW5zaW5nIHRleHR1cmUgYmVlbiByZXNpemVkLiBUaGUge0BsaW5rIFhyRGVwdGhTZW5zaW5nI3V2TWF0cml4fSBuZWVkc1xuICAgICAqIHRvIGJlIHVwZGF0ZWQgZm9yIHJlbGV2YW50IHNoYWRlcnMuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgWHJEZXB0aFNlbnNpbmcjcmVzaXplXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIG5ldyB3aWR0aCBvZiB0aGUgZGVwdGggdGV4dHVyZSBpbiBwaXhlbHMuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCAtIFRoZSBuZXcgaGVpZ2h0IG9mIHRoZSBkZXB0aCB0ZXh0dXJlIGluIHBpeGVscy5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGRlcHRoU2Vuc2luZy5vbigncmVzaXplJywgZnVuY3Rpb24gKCkge1xuICAgICAqICAgICBtYXRlcmlhbC5zZXRQYXJhbWV0ZXIoJ21hdHJpeF9kZXB0aF91dicsIGRlcHRoU2Vuc2luZy51dk1hdHJpeCk7XG4gICAgICogfSk7XG4gICAgICovXG5cbiAgICAvKiogQGlnbm9yZSAqL1xuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuX3RleHR1cmUuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLl90ZXh0dXJlID0gbnVsbDtcbiAgICB9XG5cbiAgICAvKiogQHByaXZhdGUgKi9cbiAgICBfb25TZXNzaW9uU3RhcnQoKSB7XG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzLl9tYW5hZ2VyLnNlc3Npb247XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuX3VzYWdlID0gc2Vzc2lvbi5kZXB0aFVzYWdlO1xuICAgICAgICAgICAgdGhpcy5fZGF0YUZvcm1hdCA9IHNlc3Npb24uZGVwdGhEYXRhRm9ybWF0O1xuICAgICAgICB9IGNhdGNoIChleCkge1xuICAgICAgICAgICAgdGhpcy5fdXNhZ2UgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5fZGF0YUZvcm1hdCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLl9hdmFpbGFibGUgPSBmYWxzZTtcblxuICAgICAgICAgICAgdGhpcy5maXJlKCdlcnJvcicsIGV4KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBAcHJpdmF0ZSAqL1xuICAgIF9vblNlc3Npb25FbmQoKSB7XG4gICAgICAgIHRoaXMuX2RlcHRoSW5mb0NwdSA9IG51bGw7XG4gICAgICAgIHRoaXMuX2RlcHRoSW5mb0dwdSA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5fdXNhZ2UgPSBudWxsO1xuICAgICAgICB0aGlzLl9kYXRhRm9ybWF0ID0gbnVsbDtcblxuICAgICAgICBpZiAodGhpcy5fYXZhaWxhYmxlKSB7XG4gICAgICAgICAgICB0aGlzLl9hdmFpbGFibGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuZmlyZSgndW5hdmFpbGFibGUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2RlcHRoQnVmZmVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5fdGV4dHVyZS5fd2lkdGggPSA0O1xuICAgICAgICB0aGlzLl90ZXh0dXJlLl9oZWlnaHQgPSA0O1xuICAgICAgICB0aGlzLl90ZXh0dXJlLl9sZXZlbHNbMF0gPSB0aGlzLl9lbXB0eUJ1ZmZlcjtcbiAgICAgICAgdGhpcy5fdGV4dHVyZS51cGxvYWQoKTtcbiAgICB9XG5cbiAgICAvKiogQHByaXZhdGUgKi9cbiAgICBfdXBkYXRlVGV4dHVyZSgpIHtcbiAgICAgICAgY29uc3QgZGVwdGhJbmZvID0gdGhpcy5fZGVwdGhJbmZvQ3B1IHx8IHRoaXMuX2RlcHRoSW5mb0dwdTtcblxuICAgICAgICBpZiAoZGVwdGhJbmZvKSB7XG4gICAgICAgICAgICBsZXQgcmVzaXplZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAvLyBjaGFuZ2VkIHJlc29sdXRpb25cbiAgICAgICAgICAgIGlmIChkZXB0aEluZm8ud2lkdGggIT09IHRoaXMuX3RleHR1cmUud2lkdGggfHwgZGVwdGhJbmZvLmhlaWdodCAhPT0gdGhpcy5fdGV4dHVyZS5oZWlnaHQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZXh0dXJlLl93aWR0aCA9IGRlcHRoSW5mby53aWR0aDtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZXh0dXJlLl9oZWlnaHQgPSBkZXB0aEluZm8uaGVpZ2h0O1xuICAgICAgICAgICAgICAgIHRoaXMuX21hdHJpeERpcnR5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXNpemVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMuX2RlcHRoSW5mb0NwdSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFCdWZmZXIgPSB0aGlzLl9kZXB0aEluZm9DcHUuZGF0YTtcbiAgICAgICAgICAgICAgICB0aGlzLl9kZXB0aEJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KGRhdGFCdWZmZXIpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RleHR1cmUuX2xldmVsc1swXSA9IHRoaXMuX2RlcHRoQnVmZmVyO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RleHR1cmUudXBsb2FkKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2RlcHRoSW5mb0dwdSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3RleHR1cmUuX2xldmVsc1swXSA9IHRoaXMuX2RlcHRoSW5mb0dwdS50ZXh0dXJlO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RleHR1cmUudXBsb2FkKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZXNpemVkKSB0aGlzLmZpcmUoJ3Jlc2l6ZScsIGRlcHRoSW5mby53aWR0aCwgZGVwdGhJbmZvLmhlaWdodCk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fZGVwdGhCdWZmZXIpIHtcbiAgICAgICAgICAgIC8vIGRlcHRoIGluZm8gbm90IGF2YWlsYWJsZSBhbnltb3JlXG4gICAgICAgICAgICB0aGlzLl9kZXB0aEJ1ZmZlciA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLl90ZXh0dXJlLl93aWR0aCA9IDQ7XG4gICAgICAgICAgICB0aGlzLl90ZXh0dXJlLl9oZWlnaHQgPSA0O1xuICAgICAgICAgICAgdGhpcy5fdGV4dHVyZS5fbGV2ZWxzWzBdID0gdGhpcy5fZW1wdHlCdWZmZXI7XG4gICAgICAgICAgICB0aGlzLl90ZXh0dXJlLnVwbG9hZCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHsqfSBmcmFtZSAtIFhSRnJhbWUgZnJvbSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgY2FsbGJhY2suXG4gICAgICogQHBhcmFtIHsqfSB2aWV3IC0gRmlyc3QgWFJWaWV3IG9mIHZpZXdlciBYUlBvc2UuXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIHVwZGF0ZShmcmFtZSwgdmlldykge1xuICAgICAgICBpZiAoIXRoaXMuX3VzYWdlKVxuICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIGxldCBkZXB0aEluZm9DcHUgPSBudWxsO1xuICAgICAgICBsZXQgZGVwdGhJbmZvR3B1ID0gbnVsbDtcbiAgICAgICAgaWYgKHRoaXMuX3VzYWdlID09PSBYUkRFUFRIU0VOU0lOR1VTQUdFX0NQVSAmJiB2aWV3KSB7XG4gICAgICAgICAgICBkZXB0aEluZm9DcHUgPSBmcmFtZS5nZXREZXB0aEluZm9ybWF0aW9uKHZpZXcpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX3VzYWdlID09PSBYUkRFUFRIU0VOU0lOR1VTQUdFX0dQVSAmJiB2aWV3KSB7XG4gICAgICAgICAgICBkZXB0aEluZm9HcHUgPSBmcmFtZS5nZXREZXB0aEluZm9ybWF0aW9uKHZpZXcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCh0aGlzLl9kZXB0aEluZm9DcHUgJiYgIWRlcHRoSW5mb0NwdSkgfHwgKCF0aGlzLl9kZXB0aEluZm9DcHUgJiYgZGVwdGhJbmZvQ3B1KSB8fCAodGhpcy5kZXB0aEluZm9HcHUgJiYgIWRlcHRoSW5mb0dwdSkgfHwgKCF0aGlzLl9kZXB0aEluZm9HcHUgJiYgZGVwdGhJbmZvR3B1KSkge1xuICAgICAgICAgICAgdGhpcy5fbWF0cml4RGlydHkgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2RlcHRoSW5mb0NwdSA9IGRlcHRoSW5mb0NwdTtcbiAgICAgICAgdGhpcy5fZGVwdGhJbmZvR3B1ID0gZGVwdGhJbmZvR3B1O1xuXG4gICAgICAgIHRoaXMuX3VwZGF0ZVRleHR1cmUoKTtcblxuICAgICAgICBpZiAodGhpcy5fbWF0cml4RGlydHkpIHtcbiAgICAgICAgICAgIHRoaXMuX21hdHJpeERpcnR5ID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGNvbnN0IGRlcHRoSW5mbyA9IHRoaXMuX2RlcHRoSW5mb0NwdSB8fCB0aGlzLl9kZXB0aEluZm9HcHU7XG5cbiAgICAgICAgICAgIGlmIChkZXB0aEluZm8pIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9tYXRyaXguZGF0YS5zZXQoZGVwdGhJbmZvLm5vcm1EZXB0aEJ1ZmZlckZyb21Ob3JtVmlldy5tYXRyaXgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9tYXRyaXguc2V0SWRlbnRpdHkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgodGhpcy5fZGVwdGhJbmZvQ3B1IHx8IHRoaXMuX2RlcHRoSW5mb0dwdSkgJiYgIXRoaXMuX2F2YWlsYWJsZSkge1xuICAgICAgICAgICAgdGhpcy5fYXZhaWxhYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuZmlyZSgnYXZhaWxhYmxlJyk7XG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuX2RlcHRoSW5mb0NwdSAmJiAhdGhpcy5fZGVwdGhJbmZvR3B1ICYmIHRoaXMuX2F2YWlsYWJsZSkge1xuICAgICAgICAgICAgdGhpcy5fYXZhaWxhYmxlID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ3VuYXZhaWxhYmxlJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgZGVwdGggdmFsdWUgZnJvbSBkZXB0aCBpbmZvcm1hdGlvbiBpbiBtZXRlcnMuIFVWIGlzIGluIHJhbmdlIG9mIDAuLjEsIHdpdGggb3JpZ2luIGluXG4gICAgICogdG9wLWxlZnQgY29ybmVyIG9mIGEgdGV4dHVyZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB1IC0gVSBjb29yZGluYXRlIG9mIHBpeGVsIGluIGRlcHRoIHRleHR1cmUsIHdoaWNoIGlzIGluIHJhbmdlIGZyb20gMC4wIHRvXG4gICAgICogMS4wIChsZWZ0IHRvIHJpZ2h0KS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gdiAtIFYgY29vcmRpbmF0ZSBvZiBwaXhlbCBpbiBkZXB0aCB0ZXh0dXJlLCB3aGljaCBpcyBpbiByYW5nZSBmcm9tIDAuMCB0b1xuICAgICAqIDEuMCAodG9wIHRvIGJvdHRvbSkuXG4gICAgICogQHJldHVybnMge251bWJlcnxudWxsfSBEZXB0aCBpbiBtZXRlcnMgb3IgbnVsbCBpZiBkZXB0aCBpbmZvcm1hdGlvbiBpcyBjdXJyZW50bHkgbm90XG4gICAgICogYXZhaWxhYmxlLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogdmFyIGRlcHRoID0gYXBwLnhyLmRlcHRoU2Vuc2luZy5nZXREZXB0aCh1LCB2KTtcbiAgICAgKiBpZiAoZGVwdGggIT09IG51bGwpIHtcbiAgICAgKiAgICAgLy8gZGVwdGggaW4gbWV0ZXJzXG4gICAgICogfVxuICAgICAqL1xuICAgIGdldERlcHRoKHUsIHYpIHtcbiAgICAgICAgLy8gVE9ET1xuICAgICAgICAvLyBHUFUgdXNhZ2VcblxuICAgICAgICBpZiAoIXRoaXMuX2RlcHRoSW5mb0NwdSlcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuXG4gICAgICAgIHJldHVybiB0aGlzLl9kZXB0aEluZm9DcHUuZ2V0RGVwdGhJbk1ldGVycyh1LCB2KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcnVlIGlmIERlcHRoIFNlbnNpbmcgaXMgc3VwcG9ydGVkLlxuICAgICAqXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICovXG4gICAgZ2V0IHN1cHBvcnRlZCgpIHtcbiAgICAgICAgcmV0dXJuIHBsYXRmb3JtLmJyb3dzZXIgJiYgISF3aW5kb3cuWFJEZXB0aEluZm9ybWF0aW9uO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRydWUgaWYgZGVwdGggc2Vuc2luZyBpbmZvcm1hdGlvbiBpcyBhdmFpbGFibGUuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGlmIChhcHAueHIuZGVwdGhTZW5zaW5nLmF2YWlsYWJsZSkge1xuICAgICAqICAgICB2YXIgZGVwdGggPSBhcHAueHIuZGVwdGhTZW5zaW5nLmdldERlcHRoKHgsIHkpO1xuICAgICAqIH1cbiAgICAgKi9cbiAgICBnZXQgYXZhaWxhYmxlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXZhaWxhYmxlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdGhlIHVzYWdlIGlzIENQVSBvciBHUFUuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBnZXQgdXNhZ2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl91c2FnZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgZGVwdGggc2Vuc2luZyBkYXRhIGZvcm1hdC5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGdldCBkYXRhRm9ybWF0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZGF0YUZvcm1hdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBXaWR0aCBvZiBkZXB0aCB0ZXh0dXJlIG9yIDAgaWYgbm90IGF2YWlsYWJsZS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICovXG4gICAgZ2V0IHdpZHRoKCkge1xuICAgICAgICBjb25zdCBkZXB0aEluZm8gPSB0aGlzLl9kZXB0aEluZm9DcHUgfHwgdGhpcy5fZGVwdGhJbmZvR3B1O1xuICAgICAgICByZXR1cm4gZGVwdGhJbmZvICYmIGRlcHRoSW5mby53aWR0aCB8fCAwO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhlaWdodCBvZiBkZXB0aCB0ZXh0dXJlIG9yIDAgaWYgbm90IGF2YWlsYWJsZS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICovXG4gICAgZ2V0IGhlaWdodCgpIHtcbiAgICAgICAgY29uc3QgZGVwdGhJbmZvID0gdGhpcy5fZGVwdGhJbmZvQ3B1IHx8IHRoaXMuX2RlcHRoSW5mb0dwdTtcbiAgICAgICAgcmV0dXJuIGRlcHRoSW5mbyAmJiBkZXB0aEluZm8uaGVpZ2h0IHx8IDA7XG4gICAgfVxuXG4gICAgLyogZXNsaW50LWRpc2FibGUganNkb2MvY2hlY2stZXhhbXBsZXMgKi9cbiAgICAvKipcbiAgICAgKiBUZXh0dXJlIHRoYXQgY29udGFpbnMgcGFja2VkIGRlcHRoIGluZm9ybWF0aW9uLiBUaGUgZm9ybWF0IG9mIHRoaXMgdGV4dHVyZSBpc1xuICAgICAqIHtAbGluayBQSVhFTEZPUk1BVF9MOF9BOH0uIEl0IGlzIFVWIHRyYW5zZm9ybWVkIGJhc2VkIG9uIHRoZSB1bmRlcmx5aW5nIEFSIHN5c3RlbSB3aGljaCBjYW5cbiAgICAgKiBiZSBub3JtYWxpemVkIHVzaW5nIHtAbGluayBYckRlcHRoU2Vuc2luZyN1dk1hdHJpeH0uXG4gICAgICpcbiAgICAgKiBAdHlwZSB7VGV4dHVyZX1cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIG1hdGVyaWFsLmRpZmZ1c2VNYXAgPSBkZXB0aFNlbnNpbmcudGV4dHVyZTtcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIC8vIEdMU0wgc2hhZGVyIHRvIHVucGFjayBkZXB0aCB0ZXh0dXJlXG4gICAgICogdmFyeWluZyB2ZWMyIHZVdjA7XG4gICAgICpcbiAgICAgKiB1bmlmb3JtIHNhbXBsZXIyRCB0ZXh0dXJlX2RlcHRoU2Vuc2luZ01hcDtcbiAgICAgKiB1bmlmb3JtIG1hdDQgbWF0cml4X2RlcHRoX3V2O1xuICAgICAqIHVuaWZvcm0gZmxvYXQgZGVwdGhfcmF3X3RvX21ldGVycztcbiAgICAgKlxuICAgICAqIHZvaWQgbWFpbih2b2lkKSB7XG4gICAgICogICAgIC8vIHRyYW5zZm9ybSBVVnMgdXNpbmcgZGVwdGggbWF0cml4XG4gICAgICogICAgIHZlYzIgdGV4Q29vcmQgPSAobWF0cml4X2RlcHRoX3V2ICogdmVjNCh2VXYwLnh5LCAwLjAsIDEuMCkpLnh5O1xuICAgICAqXG4gICAgICogICAgIC8vIGdldCBsdW1pbmFuY2UgYWxwaGEgY29tcG9uZW50cyBmcm9tIGRlcHRoIHRleHR1cmVcbiAgICAgKiAgICAgdmVjMiBwYWNrZWREZXB0aCA9IHRleHR1cmUyRCh0ZXh0dXJlX2RlcHRoU2Vuc2luZ01hcCwgdGV4Q29vcmQpLnJhO1xuICAgICAqXG4gICAgICogICAgIC8vIHVucGFjayBpbnRvIHNpbmdsZSB2YWx1ZSBpbiBtaWxsaW1ldGVyc1xuICAgICAqICAgICBmbG9hdCBkZXB0aCA9IGRvdChwYWNrZWREZXB0aCwgdmVjMigyNTUuMCwgMjU2LjAgKiAyNTUuMCkpICogZGVwdGhfcmF3X3RvX21ldGVyczsgLy8gbVxuICAgICAqXG4gICAgICogICAgIC8vIG5vcm1hbGl6ZTogMG0gdG8gOG0gZGlzdGFuY2VcbiAgICAgKiAgICAgZGVwdGggPSBtaW4oZGVwdGggLyA4LjAsIDEuMCk7IC8vIDAuLjEgPSAwbS4uOG1cbiAgICAgKlxuICAgICAqICAgICAvLyBwYWludCBzY2VuZSBmcm9tIGJsYWNrIHRvIHdoaXRlIGJhc2VkIG9uIGRpc3RhbmNlXG4gICAgICogICAgIGdsX0ZyYWdDb2xvciA9IHZlYzQoZGVwdGgsIGRlcHRoLCBkZXB0aCwgMS4wKTtcbiAgICAgKiB9XG4gICAgICovXG4gICAgZ2V0IHRleHR1cmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90ZXh0dXJlO1xuICAgIH1cbiAgICAvKiBlc2xpbnQtZW5hYmxlIGpzZG9jL2NoZWNrLWV4YW1wbGVzICovXG5cbiAgICAvKipcbiAgICAgKiA0eDQgbWF0cml4IHRoYXQgc2hvdWxkIGJlIHVzZWQgdG8gdHJhbnNmb3JtIGRlcHRoIHRleHR1cmUgVVZzIHRvIG5vcm1hbGl6ZWQgVVZzIGluIGEgc2hhZGVyLlxuICAgICAqIEl0IGlzIHVwZGF0ZWQgd2hlbiB0aGUgZGVwdGggdGV4dHVyZSBpcyByZXNpemVkLiBSZWZlciB0byB7QGxpbmsgWHJEZXB0aFNlbnNpbmcjcmVzaXplfS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtNYXQ0fVxuICAgICAqIEBleGFtcGxlXG4gICAgICogbWF0ZXJpYWwuc2V0UGFyYW1ldGVyKCdtYXRyaXhfZGVwdGhfdXYnLCBkZXB0aFNlbnNpbmcudXZNYXRyaXguZGF0YSk7XG4gICAgICovXG4gICAgZ2V0IHV2TWF0cml4KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbWF0cml4O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE11bHRpcGx5IHRoaXMgY29lZmZpY2llbnQgbnVtYmVyIGJ5IHJhdyBkZXB0aCB2YWx1ZSB0byBnZXQgZGVwdGggaW4gbWV0ZXJzLlxuICAgICAqXG4gICAgICogQHR5cGUge251bWJlcn1cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIG1hdGVyaWFsLnNldFBhcmFtZXRlcignZGVwdGhfcmF3X3RvX21ldGVycycsIGRlcHRoU2Vuc2luZy5yYXdWYWx1ZVRvTWV0ZXJzKTtcbiAgICAgKi9cbiAgICBnZXQgcmF3VmFsdWVUb01ldGVycygpIHtcbiAgICAgICAgY29uc3QgZGVwdGhJbmZvID0gdGhpcy5fZGVwdGhJbmZvQ3B1IHx8IHRoaXMuX2RlcHRoSW5mb0dwdTtcbiAgICAgICAgcmV0dXJuIGRlcHRoSW5mbyAmJiBkZXB0aEluZm8ucmF3VmFsdWVUb01ldGVycyB8fCAwO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgWHJEZXB0aFNlbnNpbmcgfTtcbiJdLCJuYW1lcyI6WyJYckRlcHRoU2Vuc2luZyIsIkV2ZW50SGFuZGxlciIsImNvbnN0cnVjdG9yIiwibWFuYWdlciIsIl9tYW5hZ2VyIiwiX2F2YWlsYWJsZSIsIl9kZXB0aEluZm9DcHUiLCJfZGVwdGhJbmZvR3B1IiwiX3VzYWdlIiwiX2RhdGFGb3JtYXQiLCJfbWF0cml4RGlydHkiLCJfbWF0cml4IiwiTWF0NCIsIl9lbXB0eUJ1ZmZlciIsIlVpbnQ4QXJyYXkiLCJfZGVwdGhCdWZmZXIiLCJfdGV4dHVyZSIsIlRleHR1cmUiLCJhcHAiLCJncmFwaGljc0RldmljZSIsImZvcm1hdCIsIlBJWEVMRk9STUFUX0w4X0E4IiwibWlwbWFwcyIsImFkZHJlc3NVIiwiQUREUkVTU19DTEFNUF9UT19FREdFIiwiYWRkcmVzc1YiLCJtaW5GaWx0ZXIiLCJGSUxURVJfTElORUFSIiwibWFnRmlsdGVyIiwibmFtZSIsInN1cHBvcnRlZCIsIm9uIiwiX29uU2Vzc2lvblN0YXJ0IiwiX29uU2Vzc2lvbkVuZCIsImRlc3Ryb3kiLCJzZXNzaW9uIiwiZGVwdGhVc2FnZSIsImRlcHRoRGF0YUZvcm1hdCIsImV4IiwiZmlyZSIsIl93aWR0aCIsIl9oZWlnaHQiLCJfbGV2ZWxzIiwidXBsb2FkIiwiX3VwZGF0ZVRleHR1cmUiLCJkZXB0aEluZm8iLCJyZXNpemVkIiwid2lkdGgiLCJoZWlnaHQiLCJkYXRhQnVmZmVyIiwiZGF0YSIsInRleHR1cmUiLCJ1cGRhdGUiLCJmcmFtZSIsInZpZXciLCJkZXB0aEluZm9DcHUiLCJkZXB0aEluZm9HcHUiLCJYUkRFUFRIU0VOU0lOR1VTQUdFX0NQVSIsImdldERlcHRoSW5mb3JtYXRpb24iLCJYUkRFUFRIU0VOU0lOR1VTQUdFX0dQVSIsInNldCIsIm5vcm1EZXB0aEJ1ZmZlckZyb21Ob3JtVmlldyIsIm1hdHJpeCIsInNldElkZW50aXR5IiwiZ2V0RGVwdGgiLCJ1IiwidiIsImdldERlcHRoSW5NZXRlcnMiLCJwbGF0Zm9ybSIsImJyb3dzZXIiLCJ3aW5kb3ciLCJYUkRlcHRoSW5mb3JtYXRpb24iLCJhdmFpbGFibGUiLCJ1c2FnZSIsImRhdGFGb3JtYXQiLCJ1dk1hdHJpeCIsInJhd1ZhbHVlVG9NZXRlcnMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQWtFQSxNQUFNQSxjQUFOLFNBQTZCQyxZQUE3QixDQUEwQztFQXlFdENDLFdBQVcsQ0FBQ0MsT0FBRCxFQUFVO0FBQ2pCLElBQUEsS0FBQSxFQUFBLENBQUE7QUFEaUIsSUFBQSxJQUFBLENBcEVyQkMsUUFvRXFCLEdBQUEsS0FBQSxDQUFBLENBQUE7SUFBQSxJQTlEckJDLENBQUFBLFVBOERxQixHQTlEUixLQThEUSxDQUFBO0lBQUEsSUF4RHJCQyxDQUFBQSxhQXdEcUIsR0F4REwsSUF3REssQ0FBQTtJQUFBLElBbERyQkMsQ0FBQUEsYUFrRHFCLEdBbERMLElBa0RLLENBQUE7SUFBQSxJQTVDckJDLENBQUFBLE1BNENxQixHQTVDWixJQTRDWSxDQUFBO0lBQUEsSUF0Q3JCQyxDQUFBQSxXQXNDcUIsR0F0Q1AsSUFzQ08sQ0FBQTtJQUFBLElBaENy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
