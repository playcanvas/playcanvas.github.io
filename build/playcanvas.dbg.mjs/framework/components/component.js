import { EventHandler } from '../../core/event-handler.js';

/**
 * Components are used to attach functionality on a {@link Entity}. Components can receive update
 * events each frame, and expose properties to the PlayCanvas Editor.
 *
 * @property {boolean} enabled Enables or disables the component.
 * @augments EventHandler
 */
class Component extends EventHandler {
  /**
   * The ComponentSystem used to create this Component.
   *
   * @type {import('./system.js').ComponentSystem}
   */

  /**
   * The Entity that this Component is attached to.
   *
   * @type {import('../entity.js').Entity}
   */

  /**
   * Base constructor for a Component.
   *
   * @param {import('./system.js').ComponentSystem} system - The ComponentSystem used to create
   * this Component.
   * @param {import('../entity.js').Entity} entity - The Entity that this Component is attached
   * to.
   */
  constructor(system, entity) {
    super();
    this.system = void 0;
    this.entity = void 0;
    this.system = system;
    this.entity = entity;
    if (this.system.schema && !this._accessorsBuilt) {
      this.buildAccessors(this.system.schema);
    }
    this.on('set', function (name, oldValue, newValue) {
      this.fire('set_' + name, name, oldValue, newValue);
    });
    this.on('set_enabled', this.onSetEnabled, this);
  }

  /** @ignore */
  static _buildAccessors(obj, schema) {
    // Create getter/setter pairs for each property defined in the schema
    schema.forEach(function (descriptor) {
      // If the property descriptor is an object, it should have a `name`
      // member. If not, it should just be the plain property name.
      const name = typeof descriptor === 'object' ? descriptor.name : descriptor;
      Object.defineProperty(obj, name, {
        get: function () {
          return this.data[name];
        },
        set: function (value) {
          const data = this.data;
          const oldValue = data[name];
          data[name] = value;
          this.fire('set', name, oldValue, value);
        },
        configurable: true
      });
    });
    obj._accessorsBuilt = true;
  }

  /** @ignore */
  buildAccessors(schema) {
    Component._buildAccessors(this, schema);
  }

  /** @ignore */
  onSetEnabled(name, oldValue, newValue) {
    if (oldValue !== newValue) {
      if (this.entity.enabled) {
        if (newValue) {
          this.onEnable();
        } else {
          this.onDisable();
        }
      }
    }
  }

  /** @ignore */
  onEnable() {}

  /** @ignore */
  onDisable() {}

  /** @ignore */
  onPostStateChange() {}

  /**
   * Access the component data directly. Usually you should access the data properties via the
   * individual properties as modifying this data directly will not fire 'set' events.
   *
   * @type {*}
   * @ignore
   */
  get data() {
    const record = this.system.store[this.entity.getGuid()];
    return record ? record.data : null;
  }
}

export { Component };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2NvbXBvbmVudHMvY29tcG9uZW50LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50SGFuZGxlciB9IGZyb20gJy4uLy4uL2NvcmUvZXZlbnQtaGFuZGxlci5qcyc7XG5cbi8qKlxuICogQ29tcG9uZW50cyBhcmUgdXNlZCB0byBhdHRhY2ggZnVuY3Rpb25hbGl0eSBvbiBhIHtAbGluayBFbnRpdHl9LiBDb21wb25lbnRzIGNhbiByZWNlaXZlIHVwZGF0ZVxuICogZXZlbnRzIGVhY2ggZnJhbWUsIGFuZCBleHBvc2UgcHJvcGVydGllcyB0byB0aGUgUGxheUNhbnZhcyBFZGl0b3IuXG4gKlxuICogQHByb3BlcnR5IHtib29sZWFufSBlbmFibGVkIEVuYWJsZXMgb3IgZGlzYWJsZXMgdGhlIGNvbXBvbmVudC5cbiAqIEBhdWdtZW50cyBFdmVudEhhbmRsZXJcbiAqL1xuY2xhc3MgQ29tcG9uZW50IGV4dGVuZHMgRXZlbnRIYW5kbGVyIHtcbiAgICAvKipcbiAgICAgKiBUaGUgQ29tcG9uZW50U3lzdGVtIHVzZWQgdG8gY3JlYXRlIHRoaXMgQ29tcG9uZW50LlxuICAgICAqXG4gICAgICogQHR5cGUge2ltcG9ydCgnLi9zeXN0ZW0uanMnKS5Db21wb25lbnRTeXN0ZW19XG4gICAgICovXG4gICAgc3lzdGVtO1xuXG4gICAgLyoqXG4gICAgICogVGhlIEVudGl0eSB0aGF0IHRoaXMgQ29tcG9uZW50IGlzIGF0dGFjaGVkIHRvLlxuICAgICAqXG4gICAgICogQHR5cGUge2ltcG9ydCgnLi4vZW50aXR5LmpzJykuRW50aXR5fVxuICAgICAqL1xuICAgIGVudGl0eTtcblxuICAgIC8qKlxuICAgICAqIEJhc2UgY29uc3RydWN0b3IgZm9yIGEgQ29tcG9uZW50LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4vc3lzdGVtLmpzJykuQ29tcG9uZW50U3lzdGVtfSBzeXN0ZW0gLSBUaGUgQ29tcG9uZW50U3lzdGVtIHVzZWQgdG8gY3JlYXRlXG4gICAgICogdGhpcyBDb21wb25lbnQuXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uL2VudGl0eS5qcycpLkVudGl0eX0gZW50aXR5IC0gVGhlIEVudGl0eSB0aGF0IHRoaXMgQ29tcG9uZW50IGlzIGF0dGFjaGVkXG4gICAgICogdG8uXG4gICAgICovXG4gICAgY29uc3RydWN0b3Ioc3lzdGVtLCBlbnRpdHkpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLnN5c3RlbSA9IHN5c3RlbTtcbiAgICAgICAgdGhpcy5lbnRpdHkgPSBlbnRpdHk7XG5cbiAgICAgICAgaWYgKHRoaXMuc3lzdGVtLnNjaGVtYSAmJiAhdGhpcy5fYWNjZXNzb3JzQnVpbHQpIHtcbiAgICAgICAgICAgIHRoaXMuYnVpbGRBY2Nlc3NvcnModGhpcy5zeXN0ZW0uc2NoZW1hKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMub24oJ3NldCcsIGZ1bmN0aW9uIChuYW1lLCBvbGRWYWx1ZSwgbmV3VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuZmlyZSgnc2V0XycgKyBuYW1lLCBuYW1lLCBvbGRWYWx1ZSwgbmV3VmFsdWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLm9uKCdzZXRfZW5hYmxlZCcsIHRoaXMub25TZXRFbmFibGVkLCB0aGlzKTtcbiAgICB9XG5cbiAgICAvKiogQGlnbm9yZSAqL1xuICAgIHN0YXRpYyBfYnVpbGRBY2Nlc3NvcnMob2JqLCBzY2hlbWEpIHtcbiAgICAgICAgLy8gQ3JlYXRlIGdldHRlci9zZXR0ZXIgcGFpcnMgZm9yIGVhY2ggcHJvcGVydHkgZGVmaW5lZCBpbiB0aGUgc2NoZW1hXG4gICAgICAgIHNjaGVtYS5mb3JFYWNoKGZ1bmN0aW9uIChkZXNjcmlwdG9yKSB7XG4gICAgICAgICAgICAvLyBJZiB0aGUgcHJvcGVydHkgZGVzY3JpcHRvciBpcyBhbiBvYmplY3QsIGl0IHNob3VsZCBoYXZlIGEgYG5hbWVgXG4gICAgICAgICAgICAvLyBtZW1iZXIuIElmIG5vdCwgaXQgc2hvdWxkIGp1c3QgYmUgdGhlIHBsYWluIHByb3BlcnR5IG5hbWUuXG4gICAgICAgICAgICBjb25zdCBuYW1lID0gKHR5cGVvZiBkZXNjcmlwdG9yID09PSAnb2JqZWN0JykgPyBkZXNjcmlwdG9yLm5hbWUgOiBkZXNjcmlwdG9yO1xuXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBuYW1lLCB7XG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRhdGFbbmFtZV07XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IGRhdGFbbmFtZV07XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKCdzZXQnLCBuYW1lLCBvbGRWYWx1ZSwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgb2JqLl9hY2Nlc3NvcnNCdWlsdCA9IHRydWU7XG4gICAgfVxuXG4gICAgLyoqIEBpZ25vcmUgKi9cbiAgICBidWlsZEFjY2Vzc29ycyhzY2hlbWEpIHtcbiAgICAgICAgQ29tcG9uZW50Ll9idWlsZEFjY2Vzc29ycyh0aGlzLCBzY2hlbWEpO1xuICAgIH1cblxuICAgIC8qKiBAaWdub3JlICovXG4gICAgb25TZXRFbmFibGVkKG5hbWUsIG9sZFZhbHVlLCBuZXdWYWx1ZSkge1xuICAgICAgICBpZiAob2xkVmFsdWUgIT09IG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5lbnRpdHkuZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uRW5hYmxlKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkRpc2FibGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogQGlnbm9yZSAqL1xuICAgIG9uRW5hYmxlKCkge1xuICAgIH1cblxuICAgIC8qKiBAaWdub3JlICovXG4gICAgb25EaXNhYmxlKCkge1xuICAgIH1cblxuICAgIC8qKiBAaWdub3JlICovXG4gICAgb25Qb3N0U3RhdGVDaGFuZ2UoKSB7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWNjZXNzIHRoZSBjb21wb25lbnQgZGF0YSBkaXJlY3RseS4gVXN1YWxseSB5b3Ugc2hvdWxkIGFjY2VzcyB0aGUgZGF0YSBwcm9wZXJ0aWVzIHZpYSB0aGVcbiAgICAgKiBpbmRpdmlkdWFsIHByb3BlcnRpZXMgYXMgbW9kaWZ5aW5nIHRoaXMgZGF0YSBkaXJlY3RseSB3aWxsIG5vdCBmaXJlICdzZXQnIGV2ZW50cy5cbiAgICAgKlxuICAgICAqIEB0eXBlIHsqfVxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBnZXQgZGF0YSgpIHtcbiAgICAgICAgY29uc3QgcmVjb3JkID0gdGhpcy5zeXN0ZW0uc3RvcmVbdGhpcy5lbnRpdHkuZ2V0R3VpZCgpXTtcbiAgICAgICAgcmV0dXJuIHJlY29yZCA/IHJlY29yZC5kYXRhIDogbnVsbDtcbiAgICB9XG59XG5cbmV4cG9ydCB7IENvbXBvbmVudCB9O1xuIl0sIm5hbWVzIjpbIkNvbXBvbmVudCIsIkV2ZW50SGFuZGxlciIsImNvbnN0cnVjdG9yIiwic3lzdGVtIiwiZW50aXR5Iiwic2NoZW1hIiwiX2FjY2Vzc29yc0J1aWx0IiwiYnVpbGRBY2Nlc3NvcnMiLCJvbiIsIm5hbWUiLCJvbGRWYWx1ZSIsIm5ld1ZhbHVlIiwiZmlyZSIsIm9uU2V0RW5hYmxlZCIsIl9idWlsZEFjY2Vzc29ycyIsIm9iaiIsImZvckVhY2giLCJkZXNjcmlwdG9yIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXQiLCJkYXRhIiwic2V0IiwidmFsdWUiLCJjb25maWd1cmFibGUiLCJlbmFibGVkIiwib25FbmFibGUiLCJvbkRpc2FibGUiLCJvblBvc3RTdGF0ZUNoYW5nZSIsInJlY29yZCIsInN0b3JlIiwiZ2V0R3VpZCJdLCJtYXBwaW5ncyI6Ijs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1BLFNBQVMsU0FBU0MsWUFBWSxDQUFDO0FBQ2pDO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBR0k7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFHSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLFdBQVdBLENBQUNDLE1BQU0sRUFBRUMsTUFBTSxFQUFFO0FBQ3hCLElBQUEsS0FBSyxFQUFFLENBQUE7QUFBQyxJQUFBLElBQUEsQ0FsQlpELE1BQU0sR0FBQSxLQUFBLENBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQU9OQyxNQUFNLEdBQUEsS0FBQSxDQUFBLENBQUE7SUFhRixJQUFJLENBQUNELE1BQU0sR0FBR0EsTUFBTSxDQUFBO0lBQ3BCLElBQUksQ0FBQ0MsTUFBTSxHQUFHQSxNQUFNLENBQUE7SUFFcEIsSUFBSSxJQUFJLENBQUNELE1BQU0sQ0FBQ0UsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDQyxlQUFlLEVBQUU7TUFDN0MsSUFBSSxDQUFDQyxjQUFjLENBQUMsSUFBSSxDQUFDSixNQUFNLENBQUNFLE1BQU0sQ0FBQyxDQUFBO0FBQzNDLEtBQUE7SUFFQSxJQUFJLENBQUNHLEVBQUUsQ0FBQyxLQUFLLEVBQUUsVUFBVUMsSUFBSSxFQUFFQyxRQUFR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
