/**
 * @license
 * PlayCanvas Engine v1.58.0-dev revision e102f2b2a (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../core/debug.js';
import { uniformTypeToName, UNIFORMTYPE_FLOAT, UNIFORMTYPE_VEC2, UNIFORMTYPE_VEC3, UNIFORMTYPE_VEC4, UNIFORMTYPE_INT, UNIFORMTYPE_IVEC2, UNIFORMTYPE_IVEC3, UNIFORMTYPE_IVEC4, UNIFORMTYPE_MAT2, UNIFORMTYPE_MAT3 } from './constants.js';

const _updateFunctions = [];

_updateFunctions[UNIFORMTYPE_FLOAT] = function (uniformBuffer, value, offset) {
  const dst = uniformBuffer.storageFloat32;
  dst[offset] = value;
};

_updateFunctions[UNIFORMTYPE_VEC2] = (uniformBuffer, value, offset) => {
  const dst = uniformBuffer.storageFloat32;
  dst[offset] = value[0];
  dst[offset + 1] = value[1];
};

_updateFunctions[UNIFORMTYPE_VEC3] = (uniformBuffer, value, offset) => {
  const dst = uniformBuffer.storageFloat32;
  dst[offset] = value[0];
  dst[offset + 1] = value[1];
  dst[offset + 2] = value[2];
};

_updateFunctions[UNIFORMTYPE_VEC4] = (uniformBuffer, value, offset) => {
  const dst = uniformBuffer.storageFloat32;
  dst[offset] = value[0];
  dst[offset + 1] = value[1];
  dst[offset + 2] = value[2];
  dst[offset + 3] = value[3];
};

_updateFunctions[UNIFORMTYPE_INT] = function (uniformBuffer, value, offset) {
  const dst = uniformBuffer.storageInt32;
  dst[offset] = value;
};

_updateFunctions[UNIFORMTYPE_IVEC2] = function (uniformBuffer, value, offset) {
  const dst = uniformBuffer.storageInt32;
  dst[offset] = value[0];
  dst[offset + 1] = value[1];
};

_updateFunctions[UNIFORMTYPE_IVEC3] = function (uniformBuffer, value, offset) {
  const dst = uniformBuffer.storageInt32;
  dst[offset] = value[0];
  dst[offset + 1] = value[1];
  dst[offset + 2] = value[2];
};

_updateFunctions[UNIFORMTYPE_IVEC4] = function (uniformBuffer, value, offset) {
  const dst = uniformBuffer.storageInt32;
  dst[offset] = value[0];
  dst[offset + 1] = value[1];
  dst[offset + 2] = value[2];
  dst[offset + 3] = value[3];
};

_updateFunctions[UNIFORMTYPE_MAT2] = (uniformBuffer, value, offset) => {
  const dst = uniformBuffer.storageFloat32;
  dst[offset] = value[0];
  dst[offset + 1] = value[1];
  dst[offset + 4] = value[2];
  dst[offset + 5] = value[3];
  dst[offset + 8] = value[4];
  dst[offset + 9] = value[5];
};

_updateFunctions[UNIFORMTYPE_MAT3] = (uniformBuffer, value, offset) => {
  const dst = uniformBuffer.storageFloat32;
  dst[offset] = value[0];
  dst[offset + 1] = value[1];
  dst[offset + 2] = value[2];
  dst[offset + 4] = value[3];
  dst[offset + 5] = value[4];
  dst[offset + 6] = value[5];
  dst[offset + 8] = value[6];
  dst[offset + 9] = value[7];
  dst[offset + 10] = value[8];
};

class UniformBuffer {
  constructor(graphicsDevice, format) {
    this.device = graphicsDevice;
    this.format = format;
    Debug.assert(format);
    this.impl = graphicsDevice.createUniformBufferImpl(this);
    this.storage = new ArrayBuffer(format.byteSize);
    this.storageFloat32 = new Float32Array(this.storage);
    this.storageInt32 = new Int32Array(this.storage);
    graphicsDevice._vram.ub += this.format.byteSize;
  }

  destroy() {
    const device = this.device;
    this.impl.destroy(device);
    device._vram.ub -= this.format.byteSize;
  }

  loseContext() {
    this.impl.loseContext();
  }

  setUniform(uniformFormat) {
    Debug.assert(uniformFormat);
    const offset = uniformFormat.offset;
    const value = uniformFormat.scopeId.value;

    if (value !== null && value !== undefined) {
      const updateFunction = _updateFunctions[uniformFormat.type];

      if (updateFunction) {
        updateFunction(this, value, offset);
      } else {
        this.storageFloat32.set(value, offset);
      }
    } else {
      Debug.warnOnce(`Value was not set when assigning to uniform [${uniformFormat.name}]` + `, expected type ${uniformTypeToName[uniformFormat.type]}`);
    }
  }

  set(name) {
    const uniformFormat = this.format.map.get(name);
    Debug.assert(uniformFormat, `Uniform name [${name}] is not part of the Uniform buffer.`);

    if (uniformFormat) {
      this.setUniform(uniformFormat);
    }
  }

  update() {
    const uniforms = this.format.uniforms;

    for (let i = 0; i < uniforms.length; i++) {
      this.setUniform(uniforms[i]);
    }

    this.impl.unlock(this);
  }

}

export { UniformBuffer };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5pZm9ybS1idWZmZXIuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9ncmFwaGljcy91bmlmb3JtLWJ1ZmZlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uL2NvcmUvZGVidWcuanMnO1xuaW1wb3J0IHtcbiAgICB1bmlmb3JtVHlwZVRvTmFtZSxcbiAgICBVTklGT1JNVFlQRV9JTlQsIFVOSUZPUk1UWVBFX0ZMT0FULCBVTklGT1JNVFlQRV9WRUMyLCBVTklGT1JNVFlQRV9WRUMzLFxuICAgIFVOSUZPUk1UWVBFX1ZFQzQsIFVOSUZPUk1UWVBFX0lWRUMyLCBVTklGT1JNVFlQRV9JVkVDMywgVU5JRk9STVRZUEVfSVZFQzQsXG4gICAgVU5JRk9STVRZUEVfTUFUMiwgVU5JRk9STVRZUEVfTUFUM1xufSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2dyYXBoaWNzLWRldmljZS5qcycpLkdyYXBoaWNzRGV2aWNlfSBHcmFwaGljc0RldmljZSAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vdW5pZm9ybS1idWZmZXItZm9ybWF0LmpzJykuVW5pZm9ybUJ1ZmZlckZvcm1hdH0gVW5pZm9ybUJ1ZmZlckZvcm1hdCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vdW5pZm9ybS1idWZmZXItZm9ybWF0LmpzJykuVW5pZm9ybUZvcm1hdH0gVW5pZm9ybUZvcm1hdCAqL1xuXG4vLyBVbmlmb3JtIGJ1ZmZlciBzZXQgZnVuY3Rpb25zIC0gb25seSBpbXBsZW1lbnRlZCBmb3IgdHlwZXMgZm9yIHdoaWNoIHRoZSBkZWZhdWx0XG4vLyBhcnJheSB0byBidWZmZXIgY29weSBkb2VzIG5vdCB3b3JrLCBvciBjb3VsZCBiZSBzbG93ZXIuXG5jb25zdCBfdXBkYXRlRnVuY3Rpb25zID0gW107XG5cbl91cGRhdGVGdW5jdGlvbnNbVU5JRk9STVRZUEVfRkxPQVRdID0gZnVuY3Rpb24gKHVuaWZvcm1CdWZmZXIsIHZhbHVlLCBvZmZzZXQpIHtcbiAgICBjb25zdCBkc3QgPSB1bmlmb3JtQnVmZmVyLnN0b3JhZ2VGbG9hdDMyO1xuICAgIGRzdFtvZmZzZXRdID0gdmFsdWU7XG59O1xuXG5fdXBkYXRlRnVuY3Rpb25zW1VOSUZPUk1UWVBFX1ZFQzJdID0gKHVuaWZvcm1CdWZmZXIsIHZhbHVlLCBvZmZzZXQpID0+IHtcbiAgICBjb25zdCBkc3QgPSB1bmlmb3JtQnVmZmVyLnN0b3JhZ2VGbG9hdDMyO1xuICAgIGRzdFtvZmZzZXRdID0gdmFsdWVbMF07XG4gICAgZHN0W29mZnNldCArIDFdID0gdmFsdWVbMV07XG59O1xuXG5fdXBkYXRlRnVuY3Rpb25zW1VOSUZPUk1UWVBFX1ZFQzNdID0gKHVuaWZvcm1CdWZmZXIsIHZhbHVlLCBvZmZzZXQpID0+IHtcbiAgICBjb25zdCBkc3QgPSB1bmlmb3JtQnVmZmVyLnN0b3JhZ2VGbG9hdDMyO1xuICAgIGRzdFtvZmZzZXRdID0gdmFsdWVbMF07XG4gICAgZHN0W29mZnNldCArIDFdID0gdmFsdWVbMV07XG4gICAgZHN0W29mZnNldCArIDJdID0gdmFsdWVbMl07XG59O1xuXG5fdXBkYXRlRnVuY3Rpb25zW1VOSUZPUk1UWVBFX1ZFQzRdID0gKHVuaWZvcm1CdWZmZXIsIHZhbHVlLCBvZmZzZXQpID0+IHtcbiAgICBjb25zdCBkc3QgPSB1bmlmb3JtQnVmZmVyLnN0b3JhZ2VGbG9hdDMyO1xuICAgIGRzdFtvZmZzZXRdID0gdmFsdWVbMF07XG4gICAgZHN0W29mZnNldCArIDFdID0gdmFsdWVbMV07XG4gICAgZHN0W29mZnNldCArIDJdID0gdmFsdWVbMl07XG4gICAgZHN0W29mZnNldCArIDNdID0gdmFsdWVbM107XG59O1xuXG5fdXBkYXRlRnVuY3Rpb25zW1VOSUZPUk1UWVBFX0lOVF0gPSBmdW5jdGlvbiAodW5pZm9ybUJ1ZmZlciwgdmFsdWUsIG9mZnNldCkge1xuICAgIGNvbnN0IGRzdCA9IHVuaWZvcm1CdWZmZXIuc3RvcmFnZUludDMyO1xuICAgIGRzdFtvZmZzZXRdID0gdmFsdWU7XG59O1xuXG5fdXBkYXRlRnVuY3Rpb25zW1VOSUZPUk1UWVBFX0lWRUMyXSA9IGZ1bmN0aW9uICh1bmlmb3JtQnVmZmVyLCB2YWx1ZSwgb2Zmc2V0KSB7XG4gICAgY29uc3QgZHN0ID0gdW5pZm9ybUJ1ZmZlci5zdG9yYWdlSW50MzI7XG4gICAgZHN0W29mZnNldF0gPSB2YWx1ZVswXTtcbiAgICBkc3Rbb2Zmc2V0ICsgMV0gPSB2YWx1ZVsxXTtcbn07XG5cbl91cGRhdGVGdW5jdGlvbnNbVU5JRk9STVRZUEVfSVZFQzNdID0gZnVuY3Rpb24gKHVuaWZvcm1CdWZmZXIsIHZhbHVlLCBvZmZzZXQpIHtcbiAgICBjb25zdCBkc3QgPSB1bmlmb3JtQnVmZmVyLnN0b3JhZ2VJbnQzMjtcbiAgICBkc3Rbb2Zmc2V0XSA9IHZhbHVlWzBdO1xuICAgIGRzdFtvZmZzZXQgKyAxXSA9IHZhbHVlWzFdO1xuICAgIGRzdFtvZmZzZXQgKyAyXSA9IHZhbHVlWzJdO1xufTtcblxuX3VwZGF0ZUZ1bmN0aW9uc1tVTklGT1JNVFlQRV9JVkVDNF0gPSBmdW5jdGlvbiAodW5pZm9ybUJ1ZmZlciwgdmFsdWUsIG9mZnNldCkge1xuICAgIGNvbnN0IGRzdCA9IHVuaWZvcm1CdWZmZXIuc3RvcmFnZUludDMyO1xuICAgIGRzdFtvZmZzZXRdID0gdmFsdWVbMF07XG4gICAgZHN0W29mZnNldCArIDFdID0gdmFsdWVbMV07XG4gICAgZHN0W29mZnNldCArIDJdID0gdmFsdWVbMl07XG4gICAgZHN0W29mZnNldCArIDNdID0gdmFsdWVbM107XG59O1xuXG4vLyBjb252ZXJ0IGZyb20gY29udGludW91cyBhcnJheSB0byB2ZWMyWzNdIHdpdGggcGFkZGluZyB0byB2ZWM0WzJdXG5fdXBkYXRlRnVuY3Rpb25zW1VOSUZPUk1UWVBFX01BVDJdID0gKHVuaWZvcm1CdWZmZXIsIHZhbHVlLCBvZmZzZXQpID0+IHtcbiAgICBjb25zdCBkc3QgPSB1bmlmb3JtQnVmZmVyLnN0b3JhZ2VGbG9hdDMyO1xuICAgIGRzdFtvZmZzZXRdID0gdmFsdWVbMF07XG4gICAgZHN0W29mZnNldCArIDFdID0gdmFsdWVbMV07XG5cbiAgICBkc3Rbb2Zmc2V0ICsgNF0gPSB2YWx1ZVsyXTtcbiAgICBkc3Rbb2Zmc2V0ICsgNV0gPSB2YWx1ZVszXTtcblxuICAgIGRzdFtvZmZzZXQgKyA4XSA9IHZhbHVlWzRdO1xuICAgIGRzdFtvZmZzZXQgKyA5XSA9IHZhbHVlWzVdO1xufTtcblxuLy8gY29udmVydCBmcm9tIGNvbnRpbnVvdXMgYXJyYXkgdG8gdmVjM1szXSB3aXRoIHBhZGRpbmcgdG8gdmVjNFszXVxuX3VwZGF0ZUZ1bmN0aW9uc1tVTklGT1JNVFlQRV9NQVQzXSA9ICh1bmlmb3JtQnVmZmVyLCB2YWx1ZSwgb2Zmc2V0KSA9PiB7XG4gICAgY29uc3QgZHN0ID0gdW5pZm9ybUJ1ZmZlci5zdG9yYWdlRmxvYXQzMjtcbiAgICBkc3Rbb2Zmc2V0XSA9IHZhbHVlWzBdO1xuICAgIGRzdFtvZmZzZXQgKyAxXSA9IHZhbHVlWzFdO1xuICAgIGRzdFtvZmZzZXQgKyAyXSA9IHZhbHVlWzJdO1xuXG4gICAgZHN0W29mZnNldCArIDRdID0gdmFsdWVbM107XG4gICAgZHN0W29mZnNldCArIDVdID0gdmFsdWVbNF07XG4gICAgZHN0W29mZnNldCArIDZdID0gdmFsdWVbNV07XG5cbiAgICBkc3Rbb2Zmc2V0ICsgOF0gPSB2YWx1ZVs2XTtcbiAgICBkc3Rbb2Zmc2V0ICsgOV0gPSB2YWx1ZVs3XTtcbiAgICBkc3Rbb2Zmc2V0ICsgMTBdID0gdmFsdWVbOF07XG59O1xuXG4vKipcbiAqIEEgdW5pZm9ybSBidWZmZXIgcmVwcmVzZW50cyBhIEdQVSBtZW1vcnkgYnVmZmVyIHN0b3JpbmcgdGhlIHVuaWZvcm1zLlxuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgVW5pZm9ybUJ1ZmZlciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IFVuaWZvcm1CdWZmZXIgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0dyYXBoaWNzRGV2aWNlfSBncmFwaGljc0RldmljZSAtIFRoZSBncmFwaGljcyBkZXZpY2UgdXNlZCB0byBtYW5hZ2UgdGhpcyB1bmlmb3JtIGJ1ZmZlci5cbiAgICAgKiBAcGFyYW0ge1VuaWZvcm1CdWZmZXJGb3JtYXR9IGZvcm1hdCAtIEZvcm1hdCBvZiB0aGUgdW5pZm9ybSBidWZmZXJcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihncmFwaGljc0RldmljZSwgZm9ybWF0KSB7XG4gICAgICAgIHRoaXMuZGV2aWNlID0gZ3JhcGhpY3NEZXZpY2U7XG4gICAgICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0O1xuICAgICAgICBEZWJ1Zy5hc3NlcnQoZm9ybWF0KTtcblxuICAgICAgICB0aGlzLmltcGwgPSBncmFwaGljc0RldmljZS5jcmVhdGVVbmlmb3JtQnVmZmVySW1wbCh0aGlzKTtcblxuICAgICAgICB0aGlzLnN0b3JhZ2UgPSBuZXcgQXJyYXlCdWZmZXIoZm9ybWF0LmJ5dGVTaXplKTtcbiAgICAgICAgdGhpcy5zdG9yYWdlRmxvYXQzMiA9IG5ldyBGbG9hdDMyQXJyYXkodGhpcy5zdG9yYWdlKTtcbiAgICAgICAgdGhpcy5zdG9yYWdlSW50MzIgPSBuZXcgSW50MzJBcnJheSh0aGlzLnN0b3JhZ2UpO1xuXG4gICAgICAgIGdyYXBoaWNzRGV2aWNlLl92cmFtLnViICs9IHRoaXMuZm9ybWF0LmJ5dGVTaXplO1xuXG4gICAgICAgIC8vIFRPRE86IHJlZ2lzdGVyIHdpdGggdGhlIGRldmljZSBhbmQgaGFuZGxlIGxvc3QgY29udGV4dFxuICAgICAgICAvLyB0aGlzLmRldmljZS5idWZmZXJzLnB1c2godGhpcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRnJlZXMgcmVzb3VyY2VzIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHVuaWZvcm0gYnVmZmVyLlxuICAgICAqL1xuICAgIGRlc3Ryb3koKSB7XG5cbiAgICAgICAgLy8gLy8gc3RvcCB0cmFja2luZyB0aGUgdmVydGV4IGJ1ZmZlclxuICAgICAgICBjb25zdCBkZXZpY2UgPSB0aGlzLmRldmljZTtcblxuICAgICAgICAvLyBUT0RPOiByZW1vdmUgdGhlIGJ1ZmZlciBmcm9tIHRoZSBsaXN0IG9uIHRoZSBkZXZpY2UgKGxvc3QgY29udGV4dCBoYW5kbGluZylcblxuICAgICAgICB0aGlzLmltcGwuZGVzdHJveShkZXZpY2UpO1xuXG4gICAgICAgIGRldmljZS5fdnJhbS51YiAtPSB0aGlzLmZvcm1hdC5ieXRlU2l6ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxsZWQgd2hlbiB0aGUgcmVuZGVyaW5nIGNvbnRleHQgd2FzIGxvc3QuIEl0IHJlbGVhc2VzIGFsbCBjb250ZXh0IHJlbGF0ZWQgcmVzb3VyY2VzLlxuICAgICAqXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGxvc2VDb250ZXh0KCkge1xuICAgICAgICB0aGlzLmltcGwubG9zZUNvbnRleHQoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBc3NpZ24gYSB2YWx1ZSB0byB0aGUgdW5pZm9ybSBzcGVjaWZpZWQgYnkgaXRzIGZvcm1hdC4gVGhpcyBpcyB0aGUgZmFzdCB2ZXJzaW9uIG9mIGFzc2lnbmluZ1xuICAgICAqIGEgdmFsdWUgdG8gYSB1bmlmb3JtLCBhdm9pZGluZyBhbnkgbG9va3Vwcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7VW5pZm9ybUZvcm1hdH0gdW5pZm9ybUZvcm1hdCAtIFRoZSBmb3JtYXQgb2YgdGhlIHVuaWZvcm0uXG4gICAgICovXG4gICAgc2V0VW5pZm9ybSh1bmlmb3JtRm9ybWF0KSB7XG4gICAgICAgIERlYnVnLmFzc2VydCh1bmlmb3JtRm9ybWF0KTtcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gdW5pZm9ybUZvcm1hdC5vZmZzZXQ7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdW5pZm9ybUZvcm1hdC5zY29wZUlkLnZhbHVlO1xuXG4gICAgICAgIGlmICh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVGdW5jdGlvbiA9IF91cGRhdGVGdW5jdGlvbnNbdW5pZm9ybUZvcm1hdC50eXBlXTtcbiAgICAgICAgICAgIGlmICh1cGRhdGVGdW5jdGlvbikge1xuICAgICAgICAgICAgICAgIHVwZGF0ZUZ1bmN0aW9uKHRoaXMsIHZhbHVlLCBvZmZzZXQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3JhZ2VGbG9hdDMyLnNldCh2YWx1ZSwgb2Zmc2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIERlYnVnLndhcm5PbmNlKGBWYWx1ZSB3YXMgbm90IHNldCB3aGVuIGFzc2lnbmluZyB0byB1bmlmb3JtIFske3VuaWZvcm1Gb3JtYXQubmFtZX1dYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYCwgZXhwZWN0ZWQgdHlwZSAke3VuaWZvcm1UeXBlVG9OYW1lW3VuaWZvcm1Gb3JtYXQudHlwZV19YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBc3NpZ24gYSB2YWx1ZSB0byB0aGUgdW5pZm9ybSBzcGVjaWZpZWQgYnkgbmFtZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHVuaWZvcm0uXG4gICAgICovXG4gICAgc2V0KG5hbWUpIHtcbiAgICAgICAgY29uc3QgdW5pZm9ybUZvcm1hdCA9IHRoaXMuZm9ybWF0Lm1hcC5nZXQobmFtZSk7XG4gICAgICAgIERlYnVnLmFzc2VydCh1bmlmb3JtRm9ybWF0LCBgVW5pZm9ybSBuYW1lIFske25hbWV9XSBpcyBub3QgcGFydCBvZiB0aGUgVW5pZm9ybSBidWZmZXIuYCk7XG4gICAgICAgIGlmICh1bmlmb3JtRm9ybWF0KSB7XG4gICAgICAgICAgICB0aGlzLnNldFVuaWZvcm0odW5pZm9ybUZvcm1hdCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB1cGRhdGUoKSB7XG5cbiAgICAgICAgLy8gc2V0IG5ldyB2YWx1ZXNcbiAgICAgICAgY29uc3QgdW5pZm9ybXMgPSB0aGlzLmZvcm1hdC51bmlmb3JtcztcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1bmlmb3Jtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5zZXRVbmlmb3JtKHVuaWZvcm1zW2ldKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwbG9hZCB0aGUgbmV3IGRhdGFcbiAgICAgICAgdGhpcy5pbXBsLnVubG9jayh0aGlzKTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFVuaWZvcm1CdWZmZXIgfTtcbiJdLCJuYW1lcyI6WyJfdXBkYXRlRnVuY3Rpb25zIiwiVU5JRk9STVRZUEVfRkxPQVQiLCJ1bmlmb3JtQnVmZmVyIiwidmFsdWUiLCJvZmZzZXQiLCJkc3QiLCJzdG9yYWdlRmxvYXQzMiIsIlVOSUZPUk1UWVBFX1ZFQzIiLCJVTklGT1JNVFlQRV9WRUMzIiwiVU5JRk9STVRZUEVfVkVDNCIsIlVOSUZPUk1UWVBFX0lOVCIsInN0b3JhZ2VJbnQzMiIsIlVOSUZPUk1UWVBFX0lWRUMyIiwiVU5JRk9STVRZUEVfSVZFQzMiLCJVTklGT1JNVFlQRV9JVkVDNCIsIlVOSUZPUk1UWVBFX01BVDIiLCJVTklGT1JNVFlQRV9NQVQzIiwiVW5pZm9ybUJ1ZmZlciIsImNvbnN0cnVjdG9yIiwiZ3JhcGhpY3NEZXZpY2UiLCJmb3JtYXQiLCJkZXZpY2UiLCJEZWJ1ZyIsImFzc2VydCIsImltcGwiLCJjcmVhdGVVbmlmb3JtQnVmZmVySW1wbCIsInN0b3JhZ2UiLCJBcnJheUJ1ZmZlciIsImJ5dGVTaXplIiwiRmxvYXQzMkFycmF5IiwiSW50MzJBcnJheSIsIl92cmFtIiwidWIiLCJkZXN0cm95IiwibG9zZUNvbnRleHQiLCJzZXRVbmlmb3JtIiwidW5pZm9ybUZvcm1hdCIsInNjb3BlSWQiLCJ1bmRlZmluZWQiLCJ1cGRhdGVGdW5jdGlvbiIsInR5cGUiLCJzZXQiLCJ3YXJuT25jZSIsIm5hbWUiLCJ1bmlmb3JtVHlwZVRvTmFtZSIsIm1hcCIsImdldCIsInVwZGF0ZSIsInVuaWZvcm1zIiwiaSIsImxlbmd0aCIsInVubG9jayJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFjQSxNQUFNQSxnQkFBZ0IsR0FBRyxFQUF6QixDQUFBOztBQUVBQSxnQkFBZ0IsQ0FBQ0MsaUJBQUQsQ0FBaEIsR0FBc0MsVUFBVUMsYUFBVixFQUF5QkMsS0FBekIsRUFBZ0NDLE1BQWhDLEVBQXdDO0FBQzFFLEVBQUEsTUFBTUMsR0FBRyxHQUFHSCxhQUFhLENBQUNJLGNBQTFCLENBQUE7QUFDQUQsRUFBQUEsR0FBRyxDQUFDRCxNQUFELENBQUgsR0FBY0QsS0FBZCxDQUFBO0FBQ0gsQ0FIRCxDQUFBOztBQUtBSCxnQkFBZ0IsQ0FBQ08sZ0JBQUQsQ0FBaEIsR0FBcUMsQ0FBQ0wsYUFBRCxFQUFnQkMsS0FBaEIsRUFBdUJDLE1BQXZCLEtBQWtDO0FBQ25FLEVBQUEsTUFBTUMsR0FBRyxHQUFHSCxhQUFhLENBQUNJLGNBQTFCLENBQUE7QUFDQUQsRUFBQUEsR0FBRyxDQUFDRCxNQUFELENBQUgsR0FBY0QsS0FBSyxDQUFDLENBQUQsQ0FBbkIsQ0FBQTtFQUNBRSxHQUFHLENBQUNELE1BQU0sR0FBRyxDQUFWLENBQUgsR0FBa0JELEtBQUssQ0FBQyxDQUFELENBQXZCLENBQUE7QUFDSCxDQUpELENBQUE7O0FBTUFILGdCQUFnQixDQUFDUSxnQkFBRCxDQUFoQixHQUFxQyxDQUFDTixhQUFELEVBQWdCQyxLQUFoQixFQUF1QkMsTUFBdkIsS0FBa0M7QUFDbkUsRUFBQSxNQUFNQyxHQUFHLEdBQUdILGFBQWEsQ0FBQ0ksY0FBMUIsQ0FBQTtBQUNBRCxFQUFBQSxHQUFHLENBQUNELE1BQUQsQ0FBSCxHQUFjRCxLQUFLLENBQUMsQ0FBRCxDQUFuQixDQUFBO0VBQ0FFLEdBQUcsQ0FBQ0QsTUFBTSxHQUFHLENBQVYsQ0FBSCxHQUFrQkQsS0FBSyxDQUFDLENBQUQsQ0FBdkIsQ0FBQTtFQUNBRSxHQUFHLENBQUNE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
