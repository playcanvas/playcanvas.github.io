/**
 * @license
 * PlayCanvas Engine v1.58.0-preview revision 1fec26519 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { script } from '../script.js';
import { ScriptTypes } from '../script/script-types.js';

class ScriptHandler {

  constructor(app) {
    this.handlerType = "script";
    this._app = app;
    this._scripts = {};
    this._cache = {};
  }
  load(url, callback) {
    if (typeof url === 'string') {
      url = {
        load: url,
        original: url
      };
    }
    const self = this;
    script.app = this._app;
    this._loadScript(url.load, (err, url, extra) => {
      if (!err) {
        if (script.legacy) {
          let Type = null;
          if (ScriptTypes._types.length) {
            Type = ScriptTypes._types.pop();
          }
          if (Type) {
            this._scripts[url] = Type;
          } else {
            Type = null;
          }

          callback(null, Type, extra);
        } else {
          const obj = {};
          for (let i = 0; i < ScriptTypes._types.length; i++) obj[ScriptTypes._types[i].name] = ScriptTypes._types[i];
          ScriptTypes._types.length = 0;
          callback(null, obj, extra);

          delete self._loader._cache[url + 'script'];
        }
      } else {
        callback(err);
      }
    });
  }
  open(url, data) {
    return data;
  }
  patch(asset, assets) {}
  _loadScript(url, callback) {
    const head = document.head;
    const element = document.createElement('script');
    this._cache[url] = element;

    element.async = false;
    element.addEventListener('error', function (e) {
      callback(`Script: ${e.target.src} failed to load`);
    }, false);
    let done = false;
    element.onload = element.onreadystatechange = function () {
      if (!done && (!this.readyState || this.readyState === 'loaded' || this.readyState === 'complete')) {
        done = true;
        callback(null, url, element);
      }
    };
    element.src = url;
    head.appendChild(element);
  }
}

export { ScriptHandler };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2hhbmRsZXJzL3NjcmlwdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzY3JpcHQgfSBmcm9tICcuLi8uLi9mcmFtZXdvcmsvc2NyaXB0LmpzJztcbmltcG9ydCB7IFNjcmlwdFR5cGVzIH0gZnJvbSAnLi4vc2NyaXB0L3NjcmlwdC10eXBlcy5qcyc7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuLi8uLi9mcmFtZXdvcmsvYXBwLWJhc2UuanMnKS5BcHBCYXNlfSBBcHBCYXNlICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9oYW5kbGVyLmpzJykuUmVzb3VyY2VIYW5kbGVyfSBSZXNvdXJjZUhhbmRsZXIgKi9cblxuLyoqXG4gKiBSZXNvdXJjZSBoYW5kbGVyIGZvciBsb2FkaW5nIEphdmFTY3JpcHQgZmlsZXMgZHluYW1pY2FsbHkuICBUd28gdHlwZXMgb2YgSmF2YVNjcmlwdCBmaWxlcyBjYW4gYmVcbiAqIGxvYWRlZCwgUGxheUNhbnZhcyBzY3JpcHRzIHdoaWNoIGNvbnRhaW4gY2FsbHMgdG8ge0BsaW5rIGNyZWF0ZVNjcmlwdH0sIG9yIHJlZ3VsYXIgSmF2YVNjcmlwdFxuICogZmlsZXMsIHN1Y2ggYXMgdGhpcmQtcGFydHkgbGlicmFyaWVzLlxuICpcbiAqIEBpbXBsZW1lbnRzIHtSZXNvdXJjZUhhbmRsZXJ9XG4gKi9cbmNsYXNzIFNjcmlwdEhhbmRsZXIge1xuICAgIC8qKlxuICAgICAqIFR5cGUgb2YgdGhlIHJlc291cmNlIHRoZSBoYW5kbGVyIGhhbmRsZXMuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAqL1xuICAgIGhhbmRsZXJUeXBlID0gXCJzY3JpcHRcIjtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBTY3JpcHRIYW5kbGVyIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtBcHBCYXNlfSBhcHAgLSBUaGUgcnVubmluZyB7QGxpbmsgQXBwQmFzZX0uXG4gICAgICogQGhpZGVjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFwcCkge1xuICAgICAgICB0aGlzLl9hcHAgPSBhcHA7XG4gICAgICAgIHRoaXMuX3NjcmlwdHMgPSB7IH07XG4gICAgICAgIHRoaXMuX2NhY2hlID0geyB9O1xuICAgIH1cblxuICAgIGxvYWQodXJsLCBjYWxsYmFjaykge1xuICAgICAgICAvLyBTY3JpcHRzIGRvbid0IHN1cHBvcnQgYnVuZGxpbmcgc2luY2Ugd2UgY29uY2F0ZW5hdGUgdGhlbS4gQmVsb3cgaXMgZm9yIGNvbnNpc3RlbmN5LlxuICAgICAgICBpZiAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHVybCA9IHtcbiAgICAgICAgICAgICAgICBsb2FkOiB1cmwsXG4gICAgICAgICAgICAgICAgb3JpZ2luYWw6IHVybFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgICBzY3JpcHQuYXBwID0gdGhpcy5fYXBwO1xuXG4gICAgICAgIHRoaXMuX2xvYWRTY3JpcHQodXJsLmxvYWQsIChlcnIsIHVybCwgZXh0cmEpID0+IHtcbiAgICAgICAgICAgIGlmICghZXJyKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNjcmlwdC5sZWdhY3kpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IFR5cGUgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAvLyBwb3AgdGhlIHR5cGUgZnJvbSB0aGUgbG9hZGluZyBzdGFja1xuICAgICAgICAgICAgICAgICAgICBpZiAoU2NyaXB0VHlwZXMuX3R5cGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgVHlwZSA9IFNjcmlwdFR5cGVzLl90eXBlcy5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzdG9yZSBpbmRleGVkIGJ5IFVSTFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2NyaXB0c1t1cmxdID0gVHlwZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFR5cGUgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIHRoZSByZXNvdXJjZVxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBUeXBlLCBleHRyYSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqID0geyB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgU2NyaXB0VHlwZXMuX3R5cGVzLmxlbmd0aDsgaSsrKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1NjcmlwdFR5cGVzLl90eXBlc1tpXS5uYW1lXSA9IFNjcmlwdFR5cGVzLl90eXBlc1tpXTtcblxuICAgICAgICAgICAgICAgICAgICBTY3JpcHRUeXBlcy5fdHlwZXMubGVuZ3RoID0gMDtcblxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBvYmosIGV4dHJhKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBubyBjYWNoZSBmb3Igc2NyaXB0c1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgc2VsZi5fbG9hZGVyLl9jYWNoZVt1cmwgKyAnc2NyaXB0J107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBvcGVuKHVybCwgZGF0YSkge1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG5cbiAgICBwYXRjaChhc3NldCwgYXNzZXRzKSB7IH1cblxuICAgIF9sb2FkU2NyaXB0KHVybCwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgaGVhZCA9IGRvY3VtZW50LmhlYWQ7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgICAgdGhpcy5fY2FjaGVbdXJsXSA9IGVsZW1lbnQ7XG5cbiAgICAgICAgLy8gdXNlIGFzeW5jPWZhbHNlIHRvIGZvcmNlIHNjcmlwdHMgdG8gZXhlY3V0ZSBpbiBvcmRlclxuICAgICAgICBlbGVtZW50LmFzeW5jID0gZmFsc2U7XG5cbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhgU2NyaXB0OiAke2UudGFyZ2V0LnNyY30gZmFpbGVkIHRvIGxvYWRgKTtcbiAgICAgICAgfSwgZmFsc2UpO1xuXG4gICAgICAgIGxldCBkb25lID0gZmFsc2U7XG4gICAgICAgIGVsZW1lbnQub25sb2FkID0gZWxlbWVudC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIWRvbmUgJiYgKCF0aGlzLnJlYWR5U3RhdGUgfHwgKHRoaXMucmVhZHlTdGF0ZSA9PT0gJ2xvYWRlZCcgfHwgdGhpcy5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKSkpIHtcbiAgICAgICAgICAgICAgICBkb25lID0gdHJ1ZTsgLy8gcHJldmVudCBkb3VibGUgZXZlbnQgZmlyaW5nXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdXJsLCBlbGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLy8gc2V0IHRoZSBzcmMgYXR0cmlidXRlIGFmdGVyIHRoZSBvbmxvYWQgY2FsbGJhY2sgaXMgc2V0LCB0byBhdm9pZCBhbiBpbnN0YW50IGxvYWRpbmcgZmFpbGluZyB0byBmaXJlIHRoZSBjYWxsYmFja1xuICAgICAgICBlbGVtZW50LnNyYyA9IHVybDtcblxuICAgICAgICBoZWFkLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgU2NyaXB0SGFuZGxlciB9O1xuIl0sIm5hbWVzIjpbIlNjcmlwdEhhbmRsZXIiLCJjb25zdHJ1Y3RvciIsImFwcCIsImhhbmRsZXJUeXBlIiwiX2FwcCIsIl9zY3JpcHRzIiwiX2NhY2hlIiwibG9hZCIsInVybCIsImNhbGxiYWNrIiwib3JpZ2luYWwiLCJzZWxmIiwic2NyaXB0IiwiX2xvYWRTY3JpcHQiLCJlcnIiLCJleHRyYSIsImxlZ2FjeSIsIlR5cGUiLCJTY3JpcHRUeXBlcyIsIl90eXBlcyIsImxlbmd0aCIsInBvcCIsIm9iaiIsImkiLCJuYW1lIiwiX2xvYWRlciIsIm9wZW4iLCJkYXRhIiwicGF0Y2giLCJhc3NldCIsImFzc2V0cyIsImhlYWQiLCJkb2N1bWVudCIsImVsZW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiYXN5bmMiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsInRhcmdldCIsInNyYyIsImRvbmUiLCJvbmxvYWQiLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwiYXBwZW5kQ2hpbGQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBYUEsTUFBTUEsYUFBYSxDQUFDOztFQWNoQkMsV0FBVyxDQUFDQyxHQUFHLEVBQUU7SUFBQSxJQVJqQkMsQ0FBQUEsV0FBVyxHQUFHLFFBQVEsQ0FBQTtJQVNsQixJQUFJLENBQUNDLElBQUksR0FBR0YsR0FBRyxDQUFBO0FBQ2YsSUFBQSxJQUFJLENBQUNHLFFBQVEsR0FBRyxFQUFHLENBQUE7QUFDbkIsSUFBQSxJQUFJLENBQUNDLE1BQU0sR0FBRyxFQUFHLENBQUE7QUFDckIsR0FBQTtBQUVBQyxFQUFBQSxJQUFJLENBQUNDLEdBQUcsRUFBRUMsUUFBUSxFQUFFO0FBRWhCLElBQUEsSUFBSSxPQUFPRCxHQUFHLEtBQUssUUFBUSxFQUFFO0FBQ3pC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
