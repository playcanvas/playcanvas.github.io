/**
 * @license
 * PlayCanvas Engine v1.58.0-preview revision 1fec26519 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { EventHandler } from '../core/event-handler.js';
import { Vec2 } from '../core/math/vec2.js';
import { SPRITE_RENDERMODE_SIMPLE, SPRITE_RENDERMODE_SLICED, SPRITE_RENDERMODE_TILED } from './constants.js';
import { createMesh } from './procedural.js';

const spriteNormals = [0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1];

const spriteIndices = [0, 1, 3, 2, 3, 1];

class Sprite extends EventHandler {
  constructor(device, options) {
    super();
    this._device = device;
    this._pixelsPerUnit = options && options.pixelsPerUnit !== undefined ? options.pixelsPerUnit : 1;
    this._renderMode = options && options.renderMode !== undefined ? options.renderMode : SPRITE_RENDERMODE_SIMPLE;
    this._atlas = options && options.atlas !== undefined ? options.atlas : null;
    this._frameKeys = options && options.frameKeys !== undefined ? options.frameKeys : null;
    this._meshes = [];

    this._updatingProperties = false;
    this._meshesDirty = false;
    if (this._atlas && this._frameKeys) {
      this._createMeshes();
    }
  }

  set frameKeys(value) {
    this._frameKeys = value;
    if (this._atlas && this._frameKeys) {
      if (this._updatingProperties) {
        this._meshesDirty = true;
      } else {
        this._createMeshes();
      }
    }
    this.fire('set:frameKeys', value);
  }
  get frameKeys() {
    return this._frameKeys;
  }

  set atlas(value) {
    if (value === this._atlas) return;
    if (this._atlas) {
      this._atlas.off('set:frames', this._onSetFrames, this);
      this._atlas.off('set:frame', this._onFrameChanged, this);
      this._atlas.off('remove:frame', this._onFrameRemoved, this);
    }
    this._atlas = value;
    if (this._atlas && this._frameKeys) {
      this._atlas.on('set:frames', this._onSetFrames, this);
      this._atlas.on('set:frame', this._onFrameChanged, this);
      this._atlas.on('remove:frame', this._onFrameRemoved, this);
      if (this._updatingProperties) {
        this._meshesDirty = true;
      } else {
        this._createMeshes();
      }
    }
    this.fire('set:atlas', value);
  }
  get atlas() {
    return this._atlas;
  }

  set pixelsPerUnit(value) {
    if (this._pixelsPerUnit === value) return;
    this._pixelsPerUnit = value;
    this.fire('set:pixelsPerUnit', value);

    if (this._atlas && this._frameKeys && this.renderMode === SPRITE_RENDERMODE_SIMPLE) {
      if (this._updatingProperties) {
        this._meshesDirty = true;
      } else {
        this._createMeshes();
      }
    }
  }
  get pixelsPerUnit() {
    return this._pixelsPerUnit;
  }

  set renderMode(value) {
    if (this._renderMode === value) return;
    const prev = this._renderMode;
    this._renderMode = value;
    this.fire('set:renderMode', value);

    if (prev === SPRITE_RENDERMODE_SIMPLE || value === SPRITE_RENDERMODE_SIMPLE) {
      if (this._atlas && this._frameKeys) {
        if (this._updatingProperties) {
          this._meshesDirty = true;
        } else {
          this._createMeshes();
        }
      }
    }
  }
  get renderMode() {
    return this._renderMode;
  }

  get meshes() {
    return this._meshes;
  }
  _createMeshes() {
    const len = this._meshes.length;
    for (let i = 0; i < len; i++) {
      const mesh = this._meshes[i];
      if (mesh) {
        mesh.destroy();
      }
    }

    const count = this._frameKeys.length;
    this._meshes = new Array(count);

    const createMeshFunc = this.renderMode === SPRITE_RENDERMODE_SLICED || this._renderMode === SPRITE_RENDERMODE_TILED ? this._create9SliceMesh : this._createSimpleMesh;

    for (let i = 0; i < count; i++) {
      const frame = this._atlas.frames[this._frameKeys[i]];
      this._meshes[i] = frame ? createMeshFunc.call(this, frame) : null;
    }
    this.fire('set:meshes');
  }
  _createSimpleMesh(frame) {
    const rect = frame.rect;
    const texWidth = this._atlas.texture.width;
    const texHeight = this._atlas.texture.height;
    const w = rect.z / this._pixelsPerUnit;
    const h = rect.w / this._pixelsPerUnit;
    const hp = frame.pivot.x;
    const vp = frame.pivot.y;

    const positions = [-hp * w, -vp * h, 0, (1 - hp) * w, -vp * h, 0, (1 - hp) * w, (1 - vp) * h, 0, -hp * w, (1 - vp) * h, 0];

    const lu = rect.x / texWidth;
    const bv = 1.0 - rect.y / texHeight;
    const ru = (rect.x + rect.z) / texWidth;
    const tv = 1.0 - (rect.y + rect.w) / texHeight;
    const uvs = [lu, bv, ru, bv, ru, tv, lu, tv];
    const mesh = createMesh(this._device, positions, {
      uvs: uvs,
      normals: spriteNormals,
      indices: spriteIndices
    });
    return mesh;
  }
  _create9SliceMesh() {
    const he = Vec2.ONE;
    const ws = 3;
    const ls = 3;

    const positions = [];
    const normals = [];
    const uvs = [];
    const indices = [];

    let vcounter = 0;
    for (let i = 0; i <= ws; i++) {
      const u = i === 0 || i === ws ? 0 : 1;
      for (let j = 0; j <= ls; j++) {
        const x = -he.x + 2.0 * he.x * (i <= 1 ? 0 : 3) / ws;
        const y = 0.0;
        const z = -(-he.y + 2.0 * he.y * (j <= 1 ? 0 : 3) / ls);
        const v = j === 0 || j === ls ? 0 : 1;
        positions.push(-x, y, z);
        normals.push(0.0, 1.0, 0.0);
        uvs.push(u, v);
        if (i < ws && j < ls) {
          indices.push(vcounter + ls + 1, vcounter + 1, vcounter);
          indices.push(vcounter + ls + 1, vcounter + ls + 2, vcounter + 1);
        }
        vcounter++;
      }
    }
    const options = {
      normals: normals,
      uvs: uvs,
      indices: indices
    };
    return createMesh(this._device, positions, options);
  }
  _onSetFrames(frames) {
    if (this._updatingProperties) {
      this._meshesDirty = true;
    } else {
      this._createMeshes();
    }
  }
  _onFrameChanged(frameKey, frame) {
    const idx = this._frameKeys.indexOf(frameKey);
    if (idx < 0) return;
    if (frame) {
      if (this.renderMode === SPRITE_RENDERMODE_SIMPLE) {
        this._meshes[idx] = this._createSimpleMesh(frame);
      }
    } else {
      this._meshes[idx] = null;
    }
    this.fire('set:meshes');
  }
  _onFrameRemoved(frameKey) {
    const idx = this._frameKeys.indexOf(frameKey);
    if (idx < 0) return;
    this._meshes[idx] = null;
    this.fire('set:meshes');
  }
  startUpdate() {
    this._updatingProperties = true;
    this._meshesDirty = false;
  }
  endUpdate() {
    this._updatingProperties = false;
    if (this._meshesDirty && this._atlas && this._frameKeys) {
      this._createMeshes();
    }
    this._meshesDirty = false;
  }

  destroy() {
    for (const mesh of this._meshes) {
      if (mesh) mesh.destroy();
    }
    this._meshes.length = 0;
  }
}

export { Sprite };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ByaXRlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc2NlbmUvc3ByaXRlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50SGFuZGxlciB9IGZyb20gJy4uL2NvcmUvZXZlbnQtaGFuZGxlci5qcyc7XG5cbmltcG9ydCB7IFZlYzIgfSBmcm9tICcuLi9jb3JlL21hdGgvdmVjMi5qcyc7XG5cbmltcG9ydCB7IFNQUklURV9SRU5ERVJNT0RFX1NJTVBMRSwgU1BSSVRFX1JFTkRFUk1PREVfU0xJQ0VELCBTUFJJVEVfUkVOREVSTU9ERV9USUxFRCB9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IGNyZWF0ZU1lc2ggfSBmcm9tICcuL3Byb2NlZHVyYWwuanMnO1xuXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi4vcGxhdGZvcm0vZ3JhcGhpY3MvZ3JhcGhpY3MtZGV2aWNlLmpzJykuR3JhcGhpY3NEZXZpY2V9IEdyYXBoaWNzRGV2aWNlICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9tZXNoLmpzJykuTWVzaH0gTWVzaCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vdGV4dHVyZS1hdGxhcy5qcycpLlRleHR1cmVBdGxhc30gVGV4dHVyZUF0bGFzICovXG5cbi8vIG5vcm1hbHMgYXJlIHRoZSBzYW1lIGZvciBldmVyeSBtZXNoXG5jb25zdCBzcHJpdGVOb3JtYWxzID0gW1xuICAgIDAsIDAsIDEsXG4gICAgMCwgMCwgMSxcbiAgICAwLCAwLCAxLFxuICAgIDAsIDAsIDFcbl07XG5cbi8vIGluZGljZXMgYXJlIHRoZSBzYW1lIGZvciBldmVyeSBtZXNoXG5jb25zdCBzcHJpdGVJbmRpY2VzID0gW1xuICAgIDAsIDEsIDMsXG4gICAgMiwgMywgMVxuXTtcblxuLyoqXG4gKiBBIFNwcml0ZSBjb250YWlucyByZWZlcmVuY2VzIHRvIG9uZSBvciBtb3JlIGZyYW1lcyBvZiBhIHtAbGluayBUZXh0dXJlQXRsYXN9LiBJdCBjYW4gYmUgdXNlZCBieVxuICogdGhlIHtAbGluayBTcHJpdGVDb21wb25lbnR9IG9yIHRoZSB7QGxpbmsgRWxlbWVudENvbXBvbmVudH0gdG8gcmVuZGVyIGEgc2luZ2xlIGZyYW1lIG9yIGEgc3ByaXRlXG4gKiBhbmltYXRpb24uXG4gKlxuICogQGF1Z21lbnRzIEV2ZW50SGFuZGxlclxuICovXG5jbGFzcyBTcHJpdGUgZXh0ZW5kcyBFdmVudEhhbmRsZXIge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBTcHJpdGUgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0dyYXBoaWNzRGV2aWNlfSBkZXZpY2UgLSBUaGUgZ3JhcGhpY3MgZGV2aWNlIG9mIHRoZSBhcHBsaWNhdGlvbi5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gW29wdGlvbnNdIC0gT3B0aW9ucyBmb3IgY3JlYXRpbmcgdGhlIFNwcml0ZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMucGl4ZWxzUGVyVW5pdF0gLSBUaGUgbnVtYmVyIG9mIHBpeGVscyB0aGF0IG1hcCB0byBvbmUgUGxheUNhbnZhc1xuICAgICAqIHVuaXQuIERlZmF1bHRzIHRvIDEuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLnJlbmRlck1vZGVdIC0gVGhlIHJlbmRlcmluZyBtb2RlIG9mIHRoZSBzcHJpdGUuIENhbiBiZTpcbiAgICAgKlxuICAgICAqIC0ge0BsaW5rIFNQUklURV9SRU5ERVJNT0RFX1NJTVBMRX1cbiAgICAgKiAtIHtAbGluayBTUFJJVEVfUkVOREVSTU9ERV9TTElDRUR9XG4gICAgICogLSB7QGxpbmsgU1BSSVRFX1JFTkRFUk1PREVfVElMRUR9XG4gICAgICpcbiAgICAgKiBEZWZhdWx0cyB0byB7QGxpbmsgU1BSSVRFX1JFTkRFUk1PREVfU0lNUExFfS5cbiAgICAgKiBAcGFyYW0ge1RleHR1cmVBdGxhc30gW29wdGlvbnMuYXRsYXNdIC0gVGhlIHRleHR1cmUgYXRsYXMuIERlZmF1bHRzIHRvIG51bGwuXG4gICAgICogQHBhcmFtIHtzdHJpbmdbXX0gW29wdGlvbnMuZnJhbWVLZXlzXSAtIFRoZSBrZXlzIG9mIHRoZSBmcmFtZXMgaW4gdGhlIHNwcml0ZSBhdGxhcyB0aGF0IHRoaXNcbiAgICAgKiBzcHJpdGUgaXMgdXNpbmcuIERlZmF1bHRzIHRvIG51bGwuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZGV2aWNlLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5fZGV2aWNlID0gZGV2aWNlO1xuICAgICAgICB0aGlzLl9waXhlbHNQZXJVbml0ID0gb3B0aW9ucyAmJiBvcHRpb25zLnBpeGVsc1BlclVuaXQgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucGl4ZWxzUGVyVW5pdCA6IDE7XG4gICAgICAgIHRoaXMuX3JlbmRlck1vZGUgPSBvcHRpb25zICYmIG9wdGlvbnMucmVuZGVyTW9kZSAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5yZW5kZXJNb2RlIDogU1BSSVRFX1JFTkRFUk1PREVfU0lNUExFO1xuICAgICAgICB0aGlzLl9hdGxhcyA9IG9wdGlvbnMgJiYgb3B0aW9ucy5hdGxhcyAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5hdGxhcyA6IG51bGw7XG4gICAgICAgIHRoaXMuX2ZyYW1lS2V5cyA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mcmFtZUtleXMgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuZnJhbWVLZXlzIDogbnVsbDtcbiAgICAgICAgdGhpcy5fbWVzaGVzID0gW107XG5cbiAgICAgICAgLy8gc2V0IHRvIHRydWUgdG8gdXBkYXRlIG11bHRpcGxlXG4gICAgICAgIC8vIHByb3BlcnRpZXMgd2l0aG91dCByZS1jcmVhdGluZyBtZXNoZXNcbiAgICAgICAgdGhpcy5fdXBkYXRpbmdQcm9wZXJ0aWVzID0gZmFsc2U7XG4gICAgICAgIC8vIGlmIHRydWUsIGVuZFVwZGF0ZSgpIHdpbGwgcmUtY3JlYXRlIG1lc2hlcyB3aGVuIGl0J3MgY2FsbGVkXG4gICAgICAgIHRoaXMuX21lc2hlc0RpcnR5ID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKHRoaXMuX2F0bGFzICYmIHRoaXMuX2ZyYW1lS2V5cykge1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlTWVzaGVzKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUga2V5cyBvZiB0aGUgZnJhbWVzIGluIHRoZSBzcHJpdGUgYXRsYXMgdGhhdCB0aGlzIHNwcml0ZSBpcyB1c2luZy5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtzdHJpbmdbXX1cbiAgICAgKi9cbiAgICBzZXQgZnJhbWVLZXlzKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX2ZyYW1lS2V5cyA9IHZhbHVlO1xuXG4gICAgICAgIGlmICh0aGlzLl9hdGxhcyAmJiB0aGlzLl9mcmFtZUtleXMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl91cGRhdGluZ1Byb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9tZXNoZXNEaXJ0eSA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZU1lc2hlcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5maXJlKCdzZXQ6ZnJhbWVLZXlzJywgdmFsdWUpO1xuICAgIH1cblxuICAgIGdldCBmcmFtZUtleXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9mcmFtZUtleXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIHRleHR1cmUgYXRsYXMuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7VGV4dHVyZUF0bGFzfVxuICAgICAqL1xuICAgIHNldCBhdGxhcyh2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgPT09IHRoaXMuX2F0bGFzKSByZXR1cm47XG5cbiAgICAgICAgaWYgKHRoaXMuX2F0bGFzKSB7XG4gICAgICAgICAgICB0aGlzLl9hdGxhcy5vZmYoJ3NldDpmcmFtZXMnLCB0aGlzLl9vblNldEZyYW1lcywgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLl9hdGxhcy5vZmYoJ3NldDpmcmFtZScsIHRoaXMuX29uRnJhbWVDaGFuZ2VkLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuX2F0bGFzLm9mZigncmVtb3ZlOmZyYW1lJywgdGhpcy5fb25GcmFtZVJlbW92ZWQsIHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fYXRsYXMgPSB2YWx1ZTtcbiAgICAgICAgaWYgKHRoaXMuX2F0bGFzICYmIHRoaXMuX2ZyYW1lS2V5cykge1xuICAgICAgICAgICAgdGhpcy5fYXRsYXMub24oJ3NldDpmcmFtZXMnLCB0aGlzLl9vblNldEZyYW1lcywgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLl9hdGxhcy5vbignc2V0OmZyYW1lJywgdGhpcy5fb25GcmFtZUNoYW5nZWQsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5fYXRsYXMub24oJ3JlbW92ZTpmcmFtZScsIHRoaXMuX29uRnJhbWVSZW1vdmVkLCB0aGlzKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuX3VwZGF0aW5nUHJvcGVydGllcykge1xuICAgICAgICAgICAgICAgIHRoaXMuX21lc2hlc0RpcnR5ID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlTWVzaGVzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmZpcmUoJ3NldDphdGxhcycsIHZhbHVlKTtcbiAgICB9XG5cbiAgICBnZXQgYXRsYXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9hdGxhcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgbnVtYmVyIG9mIHBpeGVscyB0aGF0IG1hcCB0byBvbmUgUGxheUNhbnZhcyB1bml0LlxuICAgICAqXG4gICAgICogQHR5cGUge251bWJlcn1cbiAgICAgKi9cbiAgICBzZXQgcGl4ZWxzUGVyVW5pdCh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy5fcGl4ZWxzUGVyVW5pdCA9PT0gdmFsdWUpIHJldHVybjtcblxuICAgICAgICB0aGlzLl9waXhlbHNQZXJVbml0ID0gdmFsdWU7XG4gICAgICAgIHRoaXMuZmlyZSgnc2V0OnBpeGVsc1BlclVuaXQnLCB2YWx1ZSk7XG5cbiAgICAgICAgLy8gc2ltcGxlIG1vZGUgdXNlcyBwaXhlbHNQZXJVbml0IHRvIGNyZWF0ZSB0aGUgbWVzaCBzbyByZS1jcmVhdGUgdGhvc2UgbWVzaGVzXG4gICAgICAgIGlmICh0aGlzLl9hdGxhcyAmJiB0aGlzLl9mcmFtZUtleXMgJiYgdGhpcy5yZW5kZXJNb2RlID09PSBTUFJJVEVfUkVOREVSTU9ERV9TSU1QTEUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl91cGRhdGluZ1Byb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9tZXNoZXNEaXJ0eSA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZU1lc2hlcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IHBpeGVsc1BlclVuaXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9waXhlbHNQZXJVbml0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSByZW5kZXJpbmcgbW9kZSBvZiB0aGUgc3ByaXRlLiBDYW4gYmU6XG4gICAgICpcbiAgICAgKiAtIHtAbGluayBTUFJJVEVfUkVOREVSTU9ERV9TSU1QTEV9XG4gICAgICogLSB7QGxpbmsgU1BSSVRFX1JFTkRFUk1PREVfU0xJQ0VEfVxuICAgICAqIC0ge0BsaW5rIFNQUklURV9SRU5ERVJNT0RFX1RJTEVEfVxuICAgICAqXG4gICAgICogQHR5cGUge251bWJlcn1cbiAgICAgKi9cbiAgICBzZXQgcmVuZGVyTW9kZSh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy5fcmVuZGVyTW9kZSA9PT0gdmFsdWUpXG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgY29uc3QgcHJldiA9IHRoaXMuX3JlbmRlck1vZGU7XG4gICAgICAgIHRoaXMuX3JlbmRlck1vZGUgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5maXJlKCdzZXQ6cmVuZGVyTW9kZScsIHZhbHVlKTtcblxuICAgICAgICAvLyByZS1jcmVhdGUgdGhlIG1lc2hlcyBpZiB3ZSdyZSBnb2luZyBmcm9tIHNpbXBsZSB0byA5LXNsaWNlZCBvciB2aWNlIHZlcnNhXG4gICAgICAgIGlmIChwcmV2ID09PSBTUFJJVEVfUkVOREVSTU9ERV9TSU1QTEUgfHwgdmFsdWUgPT09IFNQUklURV9SRU5ERVJNT0RFX1NJTVBMRSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2F0bGFzICYmIHRoaXMuX2ZyYW1lS2V5cykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl91cGRhdGluZ1Byb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWVzaGVzRGlydHkgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZU1lc2hlcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCByZW5kZXJNb2RlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyTW9kZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBbiBhcnJheSB0aGF0IGNvbnRhaW5zIGEgbWVzaCBmb3IgZWFjaCBmcmFtZS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtNZXNoW119XG4gICAgICovXG4gICAgZ2V0IG1lc2hlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX21lc2hlcztcbiAgICB9XG5cbiAgICBfY3JlYXRlTWVzaGVzKCkge1xuICAgICAgICAvLyBkZXN0cm95IG9sZCBtZXNoZXNcbiAgICAgICAgY29uc3QgbGVuID0gdGhpcy5fbWVzaGVzLmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgY29uc3QgbWVzaCA9IHRoaXMuX21lc2hlc1tpXTtcbiAgICAgICAgICAgIGlmIChtZXNoKSB7XG4gICAgICAgICAgICAgICAgbWVzaC5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjbGVhciBtZXNoZXMgYXJyYXlcbiAgICAgICAgY29uc3QgY291bnQgPSB0aGlzLl9mcmFtZUtleXMubGVuZ3RoO1xuICAgICAgICB0aGlzLl9tZXNoZXMgPSBuZXcgQXJyYXkoY291bnQpO1xuXG4gICAgICAgIC8vIGdldCBmdW5jdGlvbiB0byBjcmVhdGUgbWVzaGVzXG4gICAgICAgIGNvbnN0IGNyZWF0ZU1lc2hGdW5jID0gKHRoaXMucmVuZGVyTW9kZSA9PT0gU1BSSVRFX1JFTkRFUk1PREVfU0xJQ0VEIHx8IHRoaXMuX3JlbmRlck1vZGUgPT09IFNQUklURV9SRU5ERVJNT0RFX1RJTEVEID8gdGhpcy5fY3JlYXRlOVNsaWNlTWVzaCA6IHRoaXMuX2NyZWF0ZVNpbXBsZU1lc2gpO1xuXG4gICAgICAgIC8vIGNyZWF0ZSBhIG1lc2ggZm9yIGVhY2ggZnJhbWUgaW4gdGhlIHNwcml0ZVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGZyYW1lID0gdGhpcy5fYXRsYXMuZnJhbWVzW3RoaXMuX2ZyYW1lS2V5c1tpXV07XG4gICAgICAgICAgICB0aGlzLl9tZXNoZXNbaV0gPSBmcmFtZSA/IGNyZWF0ZU1lc2hGdW5jLmNhbGwodGhpcywgZnJhbWUpIDogbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZmlyZSgnc2V0Om1lc2hlcycpO1xuICAgIH1cblxuICAgIF9jcmVhdGVTaW1wbGVNZXNoKGZyYW1lKSB7XG4gICAgICAgIGNvbnN0IHJlY3QgPSBmcmFtZS5yZWN0O1xuICAgICAgICBjb25zdCB0ZXhXaWR0aCA9IHRoaXMuX2F0bGFzLnRleHR1cmUud2lkdGg7XG4gICAgICAgIGNvbnN0IHRleEhlaWdodCA9IHRoaXMuX2F0bGFzLnRleHR1cmUuaGVpZ2h0O1xuXG4gICAgICAgIGNvbnN0IHcgPSByZWN0LnogLyB0aGlzLl9waXhlbHNQZXJVbml0O1xuICAgICAgICBjb25zdCBoID0gcmVjdC53IC8gdGhpcy5fcGl4ZWxzUGVyVW5pdDtcbiAgICAgICAgY29uc3QgaHAgPSBmcmFtZS5waXZvdC54O1xuICAgICAgICBjb25zdCB2cCA9IGZyYW1lLnBpdm90Lnk7XG5cbiAgICAgICAgLy8gcG9zaXRpb25zIGJhc2VkIG9uIHBpdm90IGFuZCBzaXplIG9mIGZyYW1lXG4gICAgICAgIGNvbnN0IHBvc2l0aW9ucyA9IFtcbiAgICAgICAgICAgIC1ocCAqIHcsICAgICAgLXZwICogaCwgICAgICAwLFxuICAgICAgICAgICAgKDEgLSBocCkgKiB3LCAtdnAgKiBoLCAgICAgIDAsXG4gICAgICAgICAgICAoMSAtIGhwKSAqIHcsICgxIC0gdnApICogaCwgMCxcbiAgICAgICAgICAgIC1ocCAqIHcsICAgICAgKDEgLSB2cCkgKiBoLCAwXG4gICAgICAgIF07XG5cbiAgICAgICAgLy8gdXZzIGJhc2VkIG9uIGZyYW1lIHJlY3RcbiAgICAgICAgLy8gdXZzXG4gICAgICAgIGNvbnN0IGx1ID0gcmVjdC54IC8gdGV4V2lkdGg7XG4gICAgICAgIGNvbnN0IGJ2ID0gMS4wIC0gcmVjdC55IC8gdGV4SGVpZ2h0O1xuICAgICAgICBjb25zdCBydSA9IChyZWN0LnggKyByZWN0LnopIC8gdGV4V2lkdGg7XG4gICAgICAgIGNvbnN0IHR2ID0gMS4wIC0gKHJlY3QueSArIHJlY3QudykgLyB0ZXhIZWlnaHQ7XG5cbiAgICAgICAgY29uc3QgdXZzID0gW1xuICAgICAgICAgICAgbHUsIGJ2LFxuICAgICAgICAgICAgcnUsIGJ2LFxuICAgICAgICAgICAgcnUsIHR2LFxuICAgICAgICAgICAgbHUsIHR2XG4gICAgICAgIF07XG5cbiAgICAgICAgY29uc3QgbWVzaCA9IGNyZWF0ZU1lc2godGhpcy5fZGV2aWNlLCBwb3NpdGlvbnMsIHtcbiAgICAgICAgICAgIHV2czogdXZzLFxuICAgICAgICAgICAgbm9ybWFsczogc3ByaXRlTm9ybWFscyxcbiAgICAgICAgICAgIGluZGljZXM6IHNwcml0ZUluZGljZXNcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIG1lc2g7XG4gICAgfVxuXG4gICAgX2NyZWF0ZTlTbGljZU1lc2goKSB7XG4gICAgICAgIC8vIENoZWNrIHRoZSBzdXBwbGllZCBvcHRpb25zIGFuZCBwcm92aWRlIGRlZmF1bHRzIGZvciB1bnNwZWNpZmllZCBvbmVzXG4gICAgICAgIGNvbnN0IGhlID0gVmVjMi5PTkU7XG4gICAgICAgIGNvbnN0IHdzID0gMztcbiAgICAgICAgY29uc3QgbHMgPSAzO1xuXG4gICAgICAgIC8vIFZhcmlhYmxlIGRlY2xhcmF0aW9uc1xuICAgICAgICBjb25zdCBwb3NpdGlvbnMgPSBbXTtcbiAgICAgICAgY29uc3Qgbm9ybWFscyA9IFtdO1xuICAgICAgICBjb25zdCB1dnMgPSBbXTtcbiAgICAgICAgY29uc3QgaW5kaWNlcyA9IFtdO1xuXG4gICAgICAgIC8vIEdlbmVyYXRlIHBsYW5lIGFzIGZvbGxvd3MgKGFzc2lnbmVkIFVWcyBkZW5vdGVkIGF0IGNvcm5lcnMpOlxuICAgICAgICAvLyAoMCwxKXgtLS0tLS0tLS14KDEsMSlcbiAgICAgICAgLy8gICAgICB8ICAgICAgICAgfFxuICAgICAgICAvLyAgICAgIHwgICAgICAgICB8XG4gICAgICAgIC8vICAgICAgfCAgICBPLS1YIHxsZW5ndGhcbiAgICAgICAgLy8gICAgICB8ICAgIHwgICAgfFxuICAgICAgICAvLyAgICAgIHwgICAgWiAgICB8XG4gICAgICAgIC8vICgwLDApeC0tLS0tLS0tLXgoMSwwKVxuICAgICAgICAvLyB3aWR0aFxuICAgICAgICBsZXQgdmNvdW50ZXIgPSAwO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB3czsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCB1ID0gKGkgPT09IDAgfHwgaSA9PT0gd3MpID8gMCA6IDE7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IGxzOyBqKyspIHtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHggPSAtaGUueCArIDIuMCAqIGhlLnggKiAoaSA8PSAxID8gMCA6IDMpIC8gd3M7XG4gICAgICAgICAgICAgICAgY29uc3QgeSA9IDAuMDtcbiAgICAgICAgICAgICAgICBjb25zdCB6ID0gLSgtaGUueSArIDIuMCAqIGhlLnkgKiAoaiA8PSAxID8gMCA6IDMpIC8gbHMpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgdiA9IChqID09PSAwIHx8IGogPT09IGxzKSA/IDAgOiAxO1xuXG4gICAgICAgICAgICAgICAgcG9zaXRpb25zLnB1c2goLXgsIHksIHopO1xuICAgICAgICAgICAgICAgIG5vcm1hbHMucHVzaCgwLjAsIDEuMCwgMC4wKTtcbiAgICAgICAgICAgICAgICB1dnMucHVzaCh1LCB2KTtcblxuICAgICAgICAgICAgICAgIGlmICgoaSA8IHdzKSAmJiAoaiA8IGxzKSkge1xuICAgICAgICAgICAgICAgICAgICBpbmRpY2VzLnB1c2godmNvdW50ZXIgKyBscyArIDEsIHZjb3VudGVyICsgMSwgdmNvdW50ZXIpO1xuICAgICAgICAgICAgICAgICAgICBpbmRpY2VzLnB1c2godmNvdW50ZXIgKyBscyArIDEsIHZjb3VudGVyICsgbHMgKyAyLCB2Y291bnRlciArIDEpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZjb3VudGVyKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgICAgbm9ybWFsczogbm9ybWFscywgLy8gY3Jhc2hlcyB3aXRob3V0IG5vcm1hbHMgb24gbWFjP1xuICAgICAgICAgICAgdXZzOiB1dnMsXG4gICAgICAgICAgICBpbmRpY2VzOiBpbmRpY2VzXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGNyZWF0ZU1lc2godGhpcy5fZGV2aWNlLCBwb3NpdGlvbnMsIG9wdGlvbnMpO1xuICAgIH1cblxuICAgIF9vblNldEZyYW1lcyhmcmFtZXMpIHtcbiAgICAgICAgaWYgKHRoaXMuX3VwZGF0aW5nUHJvcGVydGllcykge1xuICAgICAgICAgICAgdGhpcy5fbWVzaGVzRGlydHkgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlTWVzaGVzKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfb25GcmFtZUNoYW5nZWQoZnJhbWVLZXksIGZyYW1lKSB7XG4gICAgICAgIGNvbnN0IGlkeCA9IHRoaXMuX2ZyYW1lS2V5cy5pbmRleE9mKGZyYW1lS2V5KTtcbiAgICAgICAgaWYgKGlkeCA8IDApIHJldHVybjtcblxuICAgICAgICBpZiAoZnJhbWUpIHtcbiAgICAgICAgICAgIC8vIG9ubHkgcmUtY3JlYXRlIGZyYW1lIGZvciBzaW1wbGUgcmVuZGVyIG1vZGUsIHNpbmNlXG4gICAgICAgICAgICAvLyA5LXNsaWNlZCBtZXNoZXMgZG9uJ3QgbmVlZCBmcmFtZSBpbmZvIHRvIGNyZWF0ZSB0aGVpciBtZXNoXG4gICAgICAgICAgICBpZiAodGhpcy5yZW5kZXJNb2RlID09PSBTUFJJVEVfUkVOREVSTU9ERV9TSU1QTEUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9tZXNoZXNbaWR4XSA9IHRoaXMuX2NyZWF0ZVNpbXBsZU1lc2goZnJhbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fbWVzaGVzW2lkeF0gPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5maXJlKCdzZXQ6bWVzaGVzJyk7XG4gICAgfVxuXG4gICAgX29uRnJhbWVSZW1vdmVkKGZyYW1lS2V5KSB7XG4gICAgICAgIGNvbnN0IGlkeCA9IHRoaXMuX2ZyYW1lS2V5cy5pbmRleE9mKGZyYW1lS2V5KTtcbiAgICAgICAgaWYgKGlkeCA8IDApIHJldHVybjtcblxuICAgICAgICB0aGlzLl9tZXNoZXNbaWR4XSA9IG51bGw7XG4gICAgICAgIHRoaXMuZmlyZSgnc2V0Om1lc2hlcycpO1xuICAgIH1cblxuICAgIHN0YXJ0VXBkYXRlKCkge1xuICAgICAgICB0aGlzLl91cGRhdGluZ1Byb3BlcnRpZXMgPSB0cnVlO1xuICAgICAgICB0aGlzLl9tZXNoZXNEaXJ0eSA9IGZhbHNlO1xuICAgIH1cblxuICAgIGVuZFVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy5fdXBkYXRpbmdQcm9wZXJ0aWVzID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLl9tZXNoZXNEaXJ0eSAmJiB0aGlzLl9hdGxhcyAmJiB0aGlzLl9mcmFtZUtleXMpIHtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZU1lc2hlcygpO1xuXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbWVzaGVzRGlydHkgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGcmVlIHVwIHRoZSBtZXNoZXMgY3JlYXRlZCBieSB0aGUgc3ByaXRlLlxuICAgICAqL1xuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIGZvciAoY29uc3QgbWVzaCBvZiB0aGlzLl9tZXNoZXMpIHtcbiAgICAgICAgICAgIGlmIChtZXNoKVxuICAgICAgICAgICAgICAgIG1lc2guZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX21lc2hlcy5sZW5ndGggPSAwO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgU3ByaXRlIH07XG4iXSwibmFtZXMiOlsic3ByaXRlTm9ybWFscyIsInNwcml0ZUluZGljZXMiLCJTcHJpdGUiLCJFdmVudEhhbmRsZXIiLCJjb25zdHJ1Y3RvciIsImRldmljZSIsIm9wdGlvbnMiLCJfZGV2aWNlIiwiX3BpeGVsc1BlclVuaXQiLCJwaXhlbHNQZXJVbml0IiwidW5kZWZpbmVkIiwiX3JlbmRlck1vZGUiLCJyZW5kZXJNb2RlIiwiU1BSSVRFX1JFTkRFUk1PREVfU0lNUExFIiwiX2F0bGFzIiwiYXRsYXMiLCJfZnJhbWVLZXlzIiwiZnJhbWVLZXlzIiwiX21lc2hlcyIsIl91cGRhdGluZ1Byb3BlcnRpZXMiLCJfbWVzaGVzRGlydHkiLCJfY3JlYXRlTWVzaGVzIiwidmFsdWUiLCJmaXJlIiwib2ZmIiwiX29uU2V0RnJhbWVzIiwiX29uRnJhbWVDaGFuZ2VkIiwiX29uRnJhbWVSZW1vdmVkIiwib24iLCJwcmV2IiwibWVzaGVzIiwibGVuIiwibGVuZ3RoIiwiaSIsIm1lc2giLCJkZXN0cm95IiwiY291bnQiLCJBcnJheSIsImNyZWF0ZU1lc2hGdW5jIiwiU1BSSVRFX1JFTkRFUk1PREVfU0xJQ0VEIiwiU1BSSVRFX1JFTkRFUk1PREVfVElMRUQiLCJfY3JlYXRlOVNsaWNlTWVzaCIsIl9jcmVhdGVTaW1wbGVNZXNoIiwiZnJhbWUiLCJmcmFtZXMiLCJjYWxsIiwicmVjdCIsInRleFdpZHRoIiwidGV4dHVyZSIsIndpZHRoIiwidGV4SGVpZ2h0IiwiaGVpZ2h0IiwidyIsInoiLCJoIiwiaHAiLCJwaXZvdCIsIngiLCJ2cCIsInkiLCJwb3NpdGlvbnMiLCJsdSIsImJ2IiwicnUiLCJ0diIsInV2cyIsImNyZWF0ZU1lc2giLCJub3JtYWxzIiwiaW5kaWNlcyIsImhlIiwiVmVjMiIsIk9ORSIsIndzIiwibHMiLCJ2Y291bnRlciIsInUiLCJqIiwidiIsInB1c2giLCJmcmFtZUtleSIsImlkeCIsImluZGV4T2YiLCJzdGFydFVwZGF0ZSIsImVuZFVwZGF0ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQVlBLE1BQU1BLGFBQWEsR0FBRyxDQUNsQixDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFDUCxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFDUCxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFDUCxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FDVixDQUFBOztBQUdELE1BQU1DLGFBQWEsR0FBRyxDQUNsQixD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
