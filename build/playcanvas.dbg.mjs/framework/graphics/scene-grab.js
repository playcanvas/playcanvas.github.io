/**
 * @license
 * PlayCanvas Engine v1.59.0-dev revision f64bb6d28 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { DEVICETYPE_WEBGPU, FILTER_NEAREST, FILTER_LINEAR_MIPMAP_LINEAR, FILTER_LINEAR, ADDRESS_CLAMP_TO_EDGE, PIXELFORMAT_DEPTHSTENCIL, PIXELFORMAT_RGBA8 } from '../../platform/graphics/constants.js';
import { RenderTarget } from '../../platform/graphics/render-target.js';
import { Texture } from '../../platform/graphics/texture.js';
import { DebugGraphics } from '../../platform/graphics/debug-graphics.js';
import { LAYERID_DEPTH, SHADER_DEPTH, LAYERID_WORLD } from '../../scene/constants.js';
import { Layer } from '../../scene/layer.js';

const _depthUniformNames = ['uSceneDepthMap', 'uDepthMap'];
const _colorUniformNames = ['uSceneColorMap', 'texture_grabPass'];

class SceneGrab {
  constructor(application) {
    this.application = application;

    this.device = application.graphicsDevice;

    this.layer = null;

    if (this.device.webgl2 || this.device.deviceType === DEVICETYPE_WEBGPU) {
      this.initMainPath();
    } else {
      this.initFallbackPath();
    }
  }
  setupUniform(device, depth, buffer) {
    const names = depth ? _depthUniformNames : _colorUniformNames;
    names.forEach(name => device.scope.resolve(name).setValue(buffer));
  }
  allocateTexture(device, source, name, format, isDepth, mipmaps) {
    return new Texture(device, {
      name,
      format,
      width: source ? source.colorBuffer.width : device.width,
      height: source ? source.colorBuffer.height : device.height,
      mipmaps,
      minFilter: isDepth ? FILTER_NEAREST : mipmaps ? FILTER_LINEAR_MIPMAP_LINEAR : FILTER_LINEAR,
      magFilter: isDepth ? FILTER_NEAREST : FILTER_LINEAR,
      addressU: ADDRESS_CLAMP_TO_EDGE,
      addressV: ADDRESS_CLAMP_TO_EDGE
    });
  }

  getSourceColorFormat(texture) {
    var _texture$format;
    return (_texture$format = texture == null ? void 0 : texture.format) != null ? _texture$format : this.device.framebufferFormat;
  }
  shouldReallocate(targetRT, sourceTexture, testFormat) {
    if (testFormat) {
      const targetFormat = targetRT == null ? void 0 : targetRT.colorBuffer.format;
      const sourceFormat = this.getSourceColorFormat(sourceTexture);
      if (targetFormat !== sourceFormat) return true;
    }

    const width = (sourceTexture == null ? void 0 : sourceTexture.width) || this.device.width;
    const height = (sourceTexture == null ? void 0 : sourceTexture.height) || this.device.height;
    return !targetRT || width !== targetRT.width || height !== targetRT.height;
  }
  allocateRenderTarget(renderTarget, sourceRenderTarget, device, format, isDepth, mipmaps, isDepthUniforms) {
    const names = isDepthUniforms ? _depthUniformNames : _colorUniformNames;

    const buffer = this.allocateTexture(device, sourceRenderTarget, names[0], format, isDepth, mipmaps);
    if (renderTarget) {
      renderTarget.destroyFrameBuffers();

      if (isDepth) {
        renderTarget._depthBuffer = buffer;
      } else {
        renderTarget._colorBuffer = buffer;
      }
    } else {
      renderTarget = new RenderTarget({
        name: 'renderTargetSceneGrab',
        colorBuffer: isDepth ? null : buffer,
        depthBuffer: isDepth ? buffer : null,
        depth: !isDepth,
        stencil: device.supportsStencil,
        autoResolve: false
      });
    }
    return renderTarget;
  }
  releaseRenderTarget(rt) {
    if (rt) {
      rt.destroyTextureBuffers();
      rt.destroy();
    }
  }

  initMainPath() {
    const app = this.application;
    const self = this;

    this.layer = new Layer({
      enabled: false,
      name: "Depth",
      id: LAYERID_DEPTH,
      onDisable: function () {
        self.releaseRenderTarget(this.depthRenderTarget);
        this.depthRenderTarget = null;
        self.releaseRenderTarget(this.colorRenderTarget);
        this.colorRenderTarget = null;
      },
      onPreRenderOpaque: function (cameraPass) {

        const device = app.graphicsDevice;

        const camera = this.cameras[cameraPass];
        if (camera.renderSceneColorMap) {
          var _camera$renderTarget;
          if (self.shouldReallocate(this.colorRenderTarget, (_camera$renderTarget = camera.renderTarget) == null ? void 0 : _camera$renderTarget.colorBuffer, true)) {
            var _camera$renderTarget2;
            self.releaseRenderTarget(this.colorRenderTarget);
            const format = self.getSourceColorFormat((_camera$renderTarget2 = camera.renderTarget) == null ? void 0 : _camera$renderTarget2.colorBuffer);
            this.colorRenderTarget = self.allocateRenderTarget(this.colorRenderTarget, camera.renderTarget, device, format, false, true, false);
          }

          DebugGraphics.pushGpuMarker(device, 'GRAB-COLOR');
          const colorBuffer = this.colorRenderTarget.colorBuffer;
          if (device.deviceType === DEVICETYPE_WEBGPU) {
            device.copyRenderTarget(camera.renderTarget, this.colorRenderTarget, true, false);
          } else {
            device.copyRenderTarget(device.renderTarget, this.colorRenderTarget, true, false);

            device.activeTexture(device.maxCombinedTextures - 1);
            device.bindTexture(colorBuffer);
            device.gl.generateMipmap(colorBuffer.impl._glTarget);
          }
          DebugGraphics.popGpuMarker(device);

          self.setupUniform(device, false, colorBuffer);
        }
        if (camera.renderSceneDepthMap) {
          var _camera$renderTarget3;
          if (self.shouldReallocate(this.depthRenderTarget, (_camera$renderTarget3 = camera.renderTarget) == null ? void 0 : _camera$renderTarget3.depthBuffer)) {
            self.releaseRenderTarget(this.depthRenderTarget);
            this.depthRenderTarget = self.allocateRenderTarget(this.depthRenderTarget, camera.renderTarget, device, PIXELFORMAT_DEPTHSTENCIL, true, false, true);
          }

          DebugGraphics.pushGpuMarker(device, 'GRAB-DEPTH');
          device.copyRenderTarget(device.renderTarget, this.depthRenderTarget, false, true);
          DebugGraphics.popGpuMarker(device);

          self.setupUniform(device, true, this.depthRenderTarget.depthBuffer);
        }
      },
      onPostRenderOpaque: function (cameraPass) {}
    });
  }

  initFallbackPath() {
    const app = this.application;
    const self = this;

    this.layer = new Layer({
      enabled: false,
      name: "Depth",
      id: LAYERID_DEPTH,
      shaderPass: SHADER_DEPTH,
      onEnable: function () {
        this.depthRenderTarget = new RenderTarget({
          name: 'depthRenderTarget-webgl1',
          depth: true,
          stencil: app.graphicsDevice.supportsStencil,
          autoResolve: false,
          graphicsDevice: app.graphicsDevice
        });

        this.renderTarget = this.depthRenderTarget;
      },
      onDisable: function () {
        this.depthRenderTarget.destroyTextureBuffers();
        this.renderTarget = null;
        self.releaseRenderTarget(this.colorRenderTarget);
        this.colorRenderTarget = null;
      },
      onPostCull: function (cameraPass) {
        const device = app.graphicsDevice;

        const camera = this.cameras[cameraPass];
        if (camera.renderSceneDepthMap) {
          var _camera$renderTarget4;
          if (!this.depthRenderTarget.depthBuffer || self.shouldReallocate(this.depthRenderTarget, (_camera$renderTarget4 = camera.renderTarget) == null ? void 0 : _camera$renderTarget4.depthBuffer)) {
            this.depthRenderTarget.destroyTextureBuffers();
            this.depthRenderTarget = self.allocateRenderTarget(this.depthRenderTarget, camera.renderTarget, device, PIXELFORMAT_RGBA8, false, false, true);
          }

          const visibleObjects = this.instances.visibleOpaque[cameraPass];
          const visibleList = visibleObjects.list;
          const layerComposition = app.scene.layers;
          const subLayerEnabled = layerComposition.subLayerEnabled;
          const isTransparent = layerComposition.subLayerList;

          const rt = app.scene.layers.getLayerById(LAYERID_WORLD).renderTarget;
          const cam = this.cameras[cameraPass];
          let visibleLength = 0;
          const layers = layerComposition.layerList;
          for (let i = 0; i < layers.length; i++) {
            const layer = layers[i];
            if (layer === this) break;
            if (layer.renderTarget !== rt || !layer.enabled || !subLayerEnabled[i]) continue;
            const layerCamId = layer.cameras.indexOf(cam);
            if (layerCamId < 0) continue;
            const transparent = isTransparent[i];
            let layerVisibleList = transparent ? layer.instances.visibleTransparent[layerCamId] : layer.instances.visibleOpaque[layerCamId];
            const layerVisibleListLength = layerVisibleList.length;
            layerVisibleList = layerVisibleList.list;
            for (let j = 0; j < layerVisibleListLength; j++) {
              const drawCall = layerVisibleList[j];
              if (drawCall.material && drawCall.material.depthWrite && !drawCall._noDepthDrawGl1) {
                visibleList[visibleLength] = drawCall;
                visibleLength++;
              }
            }
          }
          visibleObjects.length = visibleLength;
        }
      },
      onPreRenderOpaque: function (cameraPass) {
        const device = app.graphicsDevice;

        const camera = this.cameras[cameraPass];
        if (camera.renderSceneColorMap) {
          var _camera$renderTarget5;
          if (self.shouldReallocate(this.colorRenderTarget, (_camera$renderTarget5 = camera.renderTarget) == null ? void 0 : _camera$renderTarget5.colorBuffer)) {
            var _camera$renderTarget6;
            self.releaseRenderTarget(this.colorRenderTarget);
            const format = self.getSourceColorFormat((_camera$renderTarget6 = camera.renderTarget) == null ? void 0 : _camera$renderTarget6.colorBuffer);
            this.colorRenderTarget = self.allocateRenderTarget(this.colorRenderTarget, camera.renderTarget, device, format, false, false, false);
          }

          DebugGraphics.pushGpuMarker(device, 'GRAB-COLOR');

          const colorBuffer = this.colorRenderTarget._colorBuffer;
          if (!colorBuffer.impl._glTexture) {
            colorBuffer.impl.initialize(device, colorBuffer);
          }

          device.bindTexture(colorBuffer);
          const gl = device.gl;
          gl.copyTexImage2D(gl.TEXTURE_2D, 0, colorBuffer.impl._glFormat, 0, 0, colorBuffer.width, colorBuffer.height, 0);

          colorBuffer._needsUpload = false;
          colorBuffer._needsMipmapsUpload = false;
          DebugGraphics.popGpuMarker(device);

          self.setupUniform(device, false, colorBuffer);
        }
        if (camera.renderSceneDepthMap) {
          self.setupUniform(device, true, this.depthRenderTarget.colorBuffer);
        }
      },
      onDrawCall: function () {
        app.graphicsDevice.setColorWrite(true, true, true, true);
      },
      onPostRenderOpaque: function (cameraPass) {
        const camera = this.cameras[cameraPass];
        if (camera.renderSceneDepthMap) {
          const visibleObjects = this.instances.visibleOpaque[cameraPass];
          visibleObjects.length = 0;
        }
      }
    });
  }

  patch(layer) {
    layer.onEnable = this.layer.onEnable;
    layer.onDisable = this.layer.onDisable;
    layer.onPreRenderOpaque = this.layer.onPreRenderOpaque;
    layer.onPostRenderOpaque = this.layer.onPostRenderOpaque;
    layer.shaderPass = this.layer.shaderPass;
    layer.onPostCull = this.layer.onPostCull;
    layer.onDrawCall = this.layer.onDrawCall;
  }
}

export { SceneGrab };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NlbmUtZ3JhYi5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay9ncmFwaGljcy9zY2VuZS1ncmFiLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgREVWSUNFVFlQRV9XRUJHUFUsXG4gICAgQUREUkVTU19DTEFNUF9UT19FREdFLFxuICAgIEZJTFRFUl9ORUFSRVNULCBGSUxURVJfTElORUFSLCBGSUxURVJfTElORUFSX01JUE1BUF9MSU5FQVIsXG4gICAgUElYRUxGT1JNQVRfREVQVEhTVEVOQ0lMLCBQSVhFTEZPUk1BVF9SR0JBOFxufSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9jb25zdGFudHMuanMnO1xuXG5pbXBvcnQgeyBSZW5kZXJUYXJnZXQgfSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9yZW5kZXItdGFyZ2V0LmpzJztcbmltcG9ydCB7IFRleHR1cmUgfSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy90ZXh0dXJlLmpzJztcbmltcG9ydCB7IERlYnVnR3JhcGhpY3MgfSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9kZWJ1Zy1ncmFwaGljcy5qcyc7XG5cbmltcG9ydCB7XG4gICAgTEFZRVJJRF9ERVBUSCwgTEFZRVJJRF9XT1JMRCxcbiAgICBTSEFERVJfREVQVEhcbn0gZnJvbSAnLi4vLi4vc2NlbmUvY29uc3RhbnRzLmpzJztcblxuaW1wb3J0IHsgTGF5ZXIgfSBmcm9tICcuLi8uLi9zY2VuZS9sYXllci5qcyc7XG5cbi8vIHVuaWZvcm0gbmFtZXMgKGZpcnN0IGlzIGN1cnJlbnQgbmFtZSwgc2Vjb25kIG9uZSBpcyBkZXByZWNhdGVkIG5hbWUgZm9yIGNvbXBhdGliaWxpdHkpXG5jb25zdCBfZGVwdGhVbmlmb3JtTmFtZXMgPSBbJ3VTY2VuZURlcHRoTWFwJywgJ3VEZXB0aE1hcCddO1xuY29uc3QgX2NvbG9yVW5pZm9ybU5hbWVzID0gWyd1U2NlbmVDb2xvck1hcCcsICd0ZXh0dXJlX2dyYWJQYXNzJ107XG5cbi8qKlxuICogSW50ZXJuYWwgY2xhc3MgYWJzdHJhY3RpbmcgdGhlIGFjY2VzcyB0byB0aGUgZGVwdGggYW5kIGNvbG9yIHRleHR1cmUgb2YgdGhlIHNjZW5lLlxuICogY29sb3IgZnJhbWUgYnVmZmVyIGlzIGNvcGllZCB0byBhIHRleHR1cmVcbiAqIEZvciB3ZWJnbCAyIGRldmljZXMsIHRoZSBkZXB0aCBidWZmZXIgaXMgY29waWVkIHRvIGEgdGV4dHVyZVxuICogZm9yIHdlYmdsIDEgZGV2aWNlcywgdGhlIHNjZW5lJ3MgZGVwdGggaXMgcmVuZGVyZWQgdG8gYSBzZXBhcmF0ZSBSR0JBIHRleHR1cmVcbiAqXG4gKiBUT0RPOiBpbXBsZW1lbnQgbWlwbWFwcGVkIGNvbG9yIGJ1ZmZlciBzdXBwb3J0IGZvciBXZWJHTCAxIGFzIHdlbGwsIHdoaWNoIHJlcXVpcmVzXG4gKiB0aGUgdGV4dHVyZSB0byBiZSBhIHBvd2VyIG9mIHR3bywgYnkgZmlyc3QgZG93bnNjYWxpbmcgdGhlIGNhcHR1cmVkIGZyYW1lYnVmZmVyXG4gKiB0ZXh0dXJlIHRvIHNtYWxsZXIgcG93ZXIgb2YgMiB0ZXh0dXJlLCBhbmQgdGhlbiBnZW5lcmF0ZSBtaXBtYXBzIGFuZCB1c2UgaXQgZm9yIHJlbmRlcmluZ1xuICogVE9ETzogb3IgZXZlbiBiZXR0ZXIsIGltcGxlbWVudCBibHVyIGZpbHRlciB0byBoYXZlIHNtb290aGVyIGxvd2VyIGxldmVsc1xuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgU2NlbmVHcmFiIHtcbiAgICBjb25zdHJ1Y3RvcihhcHBsaWNhdGlvbikge1xuICAgICAgICB0aGlzLmFwcGxpY2F0aW9uID0gYXBwbGljYXRpb247XG5cbiAgICAgICAgLyoqIEB0eXBlIHtpbXBvcnQoJy4uLy4uL3BsYXRmb3JtL2dyYXBoaWNzL2dyYXBoaWNzLWRldmljZS5qcycpLkdyYXBoaWNzRGV2aWNlfSAqL1xuICAgICAgICB0aGlzLmRldmljZSA9IGFwcGxpY2F0aW9uLmdyYXBoaWNzRGV2aWNlO1xuXG4gICAgICAgIC8vIGNyZWF0ZSBkZXB0aCBsYXllclxuICAgICAgICB0aGlzLmxheWVyID0gbnVsbDtcblxuICAgICAgICAvLyBjcmVhdGUgYSBkZXB0aCBsYXllciwgd2hpY2ggaXMgYSBkZWZhdWx0IGRlcHRoIGxheWVyLCBidXQgYWxzbyBhIHRlbXBsYXRlIHVzZWRcbiAgICAgICAgLy8gdG8gcGF0Y2ggYXBwbGljYXRpb24gY3JlYXRlZCBkZXB0aCBsYXllcnMgdG8gYmVoYXZlIGFzIG9uZVxuICAgICAgICBpZiAodGhpcy5kZXZpY2Uud2ViZ2wyIHx8IHRoaXMuZGV2aWNlLmRldmljZVR5cGUgPT09IERFVklDRVRZUEVfV0VCR1BVKSB7XG4gICAgICAgICAgICB0aGlzLmluaXRNYWluUGF0aCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbml0RmFsbGJhY2tQYXRoKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZXR1cFVuaWZvcm0oZGV2aWNlLCBkZXB0aCwgYnVmZmVyKSB7XG5cbiAgICAgICAgLy8gYXNzaWduIGl0IHRvIHNjb3BlcyB0byBleHBvc2UgaXQgdG8gc2hhZGVyc1xuICAgICAgICBjb25zdCBuYW1lcyA9IGRlcHRoID8gX2RlcHRoVW5pZm9ybU5hbWVzIDogX2NvbG9yVW5pZm9ybU5hbWVzO1xuICAgICAgICBuYW1lcy5mb3JFYWNoKG5hbWUgPT4gZGV2aWNlLnNjb3BlLnJlc29sdmUobmFtZSkuc2V0VmFsdWUoYnVmZmVyKSk7XG4gICAgfVxuXG4gICAgYWxsb2NhdGVUZXh0dXJlKGRldmljZSwgc291cmNlLCBuYW1lLCBmb3JtYXQsIGlzRGVwdGgsIG1pcG1hcHMpIHtcblxuICAgICAgICAvLyBhbGxvY2F0ZSB0ZXh0dXJlIHRoYXQgd2lsbCBzdG9yZSB0aGUgZGVwdGhcbiAgICAgICAgcmV0dXJuIG5ldyBUZXh0dXJlKGRldmljZSwge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGZvcm1hdCxcbiAgICAgICAgICAgIHdpZHRoOiBzb3VyY2UgPyBzb3VyY2UuY29sb3JCdWZmZXIud2lkdGggOiBkZXZpY2Uud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IHNvdXJjZSA/IHNvdXJjZS5jb2xvckJ1ZmZlci5oZWlnaHQgOiBkZXZpY2UuaGVpZ2h0LFxuICAgICAgICAgICAgbWlwbWFwcyxcbiAgICAgICAgICAgIG1pbkZpbHRlcjogaXNEZXB0aCA/IEZJTFRFUl9ORUFSRVNUIDogKG1pcG1hcHMgPyBGSUxURVJfTElORUFSX01JUE1BUF9MSU5FQVIgOiBGSUxURVJfTElORUFSKSxcbiAgICAgICAgICAgIG1hZ0ZpbHRlcjogaXNEZXB0aCA/IEZJTFRFUl9ORUFSRVNUIDogRklMVEVSX0xJTkVBUixcbiAgICAgICAgICAgIGFkZHJlc3NVOiBBRERSRVNTX0NMQU1QX1RPX0VER0UsXG4gICAgICAgICAgICBhZGRyZXNzVjogQUREUkVTU19DTEFNUF9UT19FREdFXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIHRleHR1cmUgZm9ybWF0IG9mIHRoZSBzb3VyY2UgdGV4dHVyZSB0aGUgZ3JhYiBwYXNzIG5lZWRzIHRvIGNvcHlcbiAgICBnZXRTb3VyY2VDb2xvckZvcm1hdCh0ZXh0dXJlKSB7XG4gICAgICAgIC8vIGJhc2VkIG9uIHRoZSBSVCB0aGUgY2FtZXJhIHJlbmRlcnMgdG8sIG90aGVyd2lzZSBmcmFtZWJ1ZmZlclxuICAgICAgICByZXR1cm4gdGV4dHVyZT8uZm9ybWF0ID8/IHRoaXMuZGV2aWNlLmZyYW1lYnVmZmVyRm9ybWF0O1xuICAgIH1cblxuICAgIHNob3VsZFJlYWxsb2NhdGUodGFyZ2V0UlQsIHNvdXJjZVRleHR1cmUsIHRlc3RGb3JtYXQpIHtcblxuICAgICAgICAvLyBuZWVkIHRvIHJlYWxsb2NhdGUgaWYgZm9ybWF0IGRvZXMgbm90IG1hdGNoXG4gICAgICAgIGlmICh0ZXN0Rm9ybWF0KSB7XG4gICAgICAgICAgICBjb25zdCB0YXJnZXRGb3JtYXQgPSB0YXJnZXRSVD8uY29sb3JCdWZmZXIuZm9ybWF0O1xuICAgICAgICAgICAgY29uc3Qgc291cmNlRm9ybWF0ID0gdGhpcy5nZXRTb3VyY2VDb2xvckZvcm1hdChzb3VyY2VUZXh0dXJlKTtcbiAgICAgICAgICAgIGlmICh0YXJnZXRGb3JtYXQgIT09IHNvdXJjZUZvcm1hdClcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG5lZWQgdG8gcmVhbGxvY2F0ZSBpZiBkaW1lbnNpb25zIGRvbid0IG1hdGNoXG4gICAgICAgIGNvbnN0IHdpZHRoID0gc291cmNlVGV4dHVyZT8ud2lkdGggfHwgdGhpcy5kZXZpY2Uud2lkdGg7XG4gICAgICAgIGNvbnN0IGhlaWdodCA9IHNvdXJjZVRleHR1cmU/LmhlaWdodCB8fCB0aGlzLmRldmljZS5oZWlnaHQ7XG4gICAgICAgIHJldHVybiAhdGFyZ2V0UlQgfHwgd2lkdGggIT09IHRhcmdldFJULndpZHRoIHx8IGhlaWdodCAhPT0gdGFyZ2V0UlQuaGVpZ2h0O1xuICAgIH1cblxuICAgIGFsbG9jYXRlUmVuZGVyVGFyZ2V0KHJlbmRlclRhcmdldCwgc291cmNlUmVuZGVyVGFyZ2V0LCBkZXZpY2UsIGZvcm1hdCwgaXNEZXB0aCwgbWlwbWFwcywgaXNEZXB0aFVuaWZvcm1zKSB7XG5cbiAgICAgICAgLy8gdGV4dHVyZSAvIHVuaWZvcm0gbmFtZXM6IG5ldyBvbmUgKGZpcnN0KSwgYXMgd2VsbCBhcyBvbGQgb25lICAoc2Vjb25kKSBmb3IgY29tcGF0aWJpbGl0eVxuICAgICAgICBjb25zdCBuYW1lcyA9IGlzRGVwdGhVbmlmb3JtcyA/IF9kZXB0aFVuaWZvcm1OYW1lcyA6IF9jb2xvclVuaWZvcm1OYW1lcztcblxuICAgICAgICAvLyBhbGxvY2F0ZSB0ZXh0dXJlIGJ1ZmZlclxuICAgICAgICBjb25zdCBidWZmZXIgPSB0aGlzLmFsbG9jYXRlVGV4dHVyZShkZXZpY2UsIHNvdXJjZVJlbmRlclRhcmdldCwgbmFtZXNbMF0sIGZvcm1hdCwgaXNEZXB0aCwgbWlwbWFwcyk7XG5cbiAgICAgICAgaWYgKHJlbmRlclRhcmdldCkge1xuXG4gICAgICAgICAgICAvLyBpZiByZWFsbG9jYXRpbmcgUlQgc2l6ZSwgcmVsZWFzZSBwcmV2aW91cyBmcmFtZWJ1ZmZlclxuICAgICAgICAgICAgcmVuZGVyVGFyZ2V0LmRlc3Ryb3lGcmFtZUJ1ZmZlcnMoKTtcblxuICAgICAgICAgICAgLy8gYXNzaWduIG5ldyB0ZXh0dXJlXG4gICAgICAgICAgICBpZiAoaXNEZXB0aCkge1xuICAgICAgICAgICAgICAgIHJlbmRlclRhcmdldC5fZGVwdGhCdWZmZXIgPSBidWZmZXI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlbmRlclRhcmdldC5fY29sb3JCdWZmZXIgPSBidWZmZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIC8vIGNyZWF0ZSBuZXcgcmVuZGVyIHRhcmdldCB3aXRoIHRoZSB0ZXh0dXJlXG4gICAgICAgICAgICByZW5kZXJUYXJnZXQgPSBuZXcgUmVuZGVyVGFyZ2V0KHtcbiAgICAgICAgICAgICAgICBuYW1lOiAncmVuZGVyVGFyZ2V0U2NlbmVHcmFiJyxcbiAgICAgICAgICAgICAgICBjb2xvckJ1ZmZlcjogaXNEZXB0aCA/IG51bGwgOiBidWZmZXIsXG4gICAgICAgICAgICAgICAgZGVwdGhCdWZmZXI6IGlzRGVwdGggPyBidWZmZXIgOiBudWxsLFxuICAgICAgICAgICAgICAgIGRlcHRoOiAhaXNEZXB0aCxcbiAgICAgICAgICAgICAgICBzdGVuY2lsOiBkZXZpY2Uuc3VwcG9ydHNTdGVuY2lsLFxuICAgICAgICAgICAgICAgIGF1dG9SZXNvbHZlOiBmYWxzZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVuZGVyVGFyZ2V0O1xuICAgIH1cblxuICAgIHJlbGVhc2VSZW5kZXJUYXJnZXQocnQpIHtcblxuICAgICAgICBpZiAocnQpIHtcbiAgICAgICAgICAgIHJ0LmRlc3Ryb3lUZXh0dXJlQnVmZmVycygpO1xuICAgICAgICAgICAgcnQuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gbWFpbiBwYXRoIHdoZXJlIGJvdGggY29sb3IgYW5kIGRlcHRoIGlzIGNvcGllZCBmcm9tIGV4aXN0aW5nIHN1cmZhY2VcbiAgICBpbml0TWFpblBhdGgoKSB7XG5cbiAgICAgICAgY29uc3QgYXBwID0gdGhpcy5hcHBsaWNhdGlvbjtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLy8gV2ViR0wgMiBkZXB0aCBsYXllciBqdXN0IGNvcGllcyBleGlzdGluZyBjb2xvciBvciBkZXB0aFxuICAgICAgICB0aGlzLmxheWVyID0gbmV3IExheWVyKHtcbiAgICAgICAgICAgIGVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICAgICAgbmFtZTogXCJEZXB0aFwiLFxuICAgICAgICAgICAgaWQ6IExBWUVSSURfREVQVEgsXG5cbiAgICAgICAgICAgIG9uRGlzYWJsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNlbGYucmVsZWFzZVJlbmRlclRhcmdldCh0aGlzLmRlcHRoUmVuZGVyVGFyZ2V0KTtcbiAgICAgICAgICAgICAgICB0aGlzLmRlcHRoUmVuZGVyVGFyZ2V0ID0gbnVsbDtcblxuICAgICAgICAgICAgICAgIHNlbGYucmVsZWFzZVJlbmRlclRhcmdldCh0aGlzLmNvbG9yUmVuZGVyVGFyZ2V0KTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbG9yUmVuZGVyVGFyZ2V0ID0gbnVsbDtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIG9uUHJlUmVuZGVyT3BhcXVlOiBmdW5jdGlvbiAoY2FtZXJhUGFzcykgeyAvLyByZXNpemUgZGVwdGggbWFwIGlmIG5lZWRlZFxuXG4gICAgICAgICAgICAgICAgLyoqIEB0eXBlIHtpbXBvcnQoJy4uLy4uL3BsYXRmb3JtL2dyYXBoaWNzL2dyYXBoaWNzLWRldmljZS5qcycpLkdyYXBoaWNzRGV2aWNlfSAqL1xuICAgICAgICAgICAgICAgIGNvbnN0IGRldmljZSA9IGFwcC5ncmFwaGljc0RldmljZTtcblxuICAgICAgICAgICAgICAgIC8qKiBAdHlwZSB7aW1wb3J0KCcuLi9jb21wb25lbnRzL2NhbWVyYS9jb21wb25lbnQuanMnKS5DYW1lcmFDb21wb25lbnR9ICovXG4gICAgICAgICAgICAgICAgY29uc3QgY2FtZXJhID0gdGhpcy5jYW1lcmFzW2NhbWVyYVBhc3NdO1xuXG4gICAgICAgICAgICAgICAgaWYgKGNhbWVyYS5yZW5kZXJTY2VuZUNvbG9yTWFwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gYWxsb2NhdGUgLyByZXNpemUgZXhpc3RpbmcgUlQgYXMgbmVlZGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLnNob3VsZFJlYWxsb2NhdGUodGhpcy5jb2xvclJlbmRlclRhcmdldCwgY2FtZXJhLnJlbmRlclRhcmdldD8uY29sb3JCdWZmZXIsIHRydWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbGVhc2VSZW5kZXJUYXJnZXQodGhpcy5jb2xvclJlbmRlclRhcmdldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmb3JtYXQgPSBzZWxmLmdldFNvdXJjZUNvbG9yRm9ybWF0KGNhbWVyYS5yZW5kZXJUYXJnZXQ/LmNvbG9yQnVmZmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sb3JSZW5kZXJUYXJnZXQgPSBzZWxmLmFsbG9jYXRlUmVuZGVyVGFyZ2V0KHRoaXMuY29sb3JSZW5kZXJUYXJnZXQsIGNhbWVyYS5yZW5kZXJUYXJnZXQsIGRldmljZSwgZm9ybWF0LCBmYWxzZSwgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY29weSBjb2xvciBmcm9tIHRoZSBjdXJyZW50IHJlbmRlciB0YXJnZXRcbiAgICAgICAgICAgICAgICAgICAgRGVidWdHcmFwaGljcy5wdXNoR3B1TWFya2VyKGRldmljZSwgJ0dSQUItQ09MT1InKTtcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2xvckJ1ZmZlciA9IHRoaXMuY29sb3JSZW5kZXJUYXJnZXQuY29sb3JCdWZmZXI7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGRldmljZS5kZXZpY2VUeXBlID09PSBERVZJQ0VUWVBFX1dFQkdQVSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UuY29weVJlbmRlclRhcmdldChjYW1lcmEucmVuZGVyVGFyZ2V0LCB0aGlzLmNvbG9yUmVuZGVyVGFyZ2V0LCB0cnVlLCBmYWxzZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmNvcHlSZW5kZXJUYXJnZXQoZGV2aWNlLnJlbmRlclRhcmdldCwgdGhpcy5jb2xvclJlbmRlclRhcmdldCwgdHJ1ZSwgZmFsc2UpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBnZW5lcmF0ZSBtaXBtYXBzXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UuYWN0aXZlVGV4dHVyZShkZXZpY2UubWF4Q29tYmluZWRUZXh0dXJlcyAtIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmJpbmRUZXh0dXJlKGNvbG9yQnVmZmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5nbC5nZW5lcmF0ZU1pcG1hcChjb2xvckJ1ZmZlci5pbXBsLl9nbFRhcmdldCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBEZWJ1Z0dyYXBoaWNzLnBvcEdwdU1hcmtlcihkZXZpY2UpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGFzc2lnbiB1bmlmcm9tXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBVbmlmb3JtKGRldmljZSwgZmFsc2UsIGNvbG9yQnVmZmVyKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoY2FtZXJhLnJlbmRlclNjZW5lRGVwdGhNYXApIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyByZWFsbG9jYXRlIFJUIGlmIG5lZWRlZFxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5zaG91bGRSZWFsbG9jYXRlKHRoaXMuZGVwdGhSZW5kZXJUYXJnZXQsIGNhbWVyYS5yZW5kZXJUYXJnZXQ/LmRlcHRoQnVmZmVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5yZWxlYXNlUmVuZGVyVGFyZ2V0KHRoaXMuZGVwdGhSZW5kZXJUYXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXB0aFJlbmRlclRhcmdldCA9IHNlbGYuYWxsb2NhdGVSZW5kZXJUYXJnZXQodGhpcy5kZXB0aFJlbmRlclRhcmdldCwgY2FtZXJhLnJlbmRlclRhcmdldCwgZGV2aWNlLCBQSVhFTEZPUk1BVF9ERVBUSFNURU5DSUwsIHRydWUsIGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvcHkgZGVwdGhcbiAgICAgICAgICAgICAgICAgICAgRGVidWdHcmFwaGljcy5wdXNoR3B1TWFya2VyKGRldmljZSwgJ0dSQUItREVQVEgnKTtcbiAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmNvcHlSZW5kZXJUYXJnZXQoZGV2aWNlLnJlbmRlclRhcmdldCwgdGhpcy5kZXB0aFJlbmRlclRhcmdldCwgZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBEZWJ1Z0dyYXBoaWNzLnBvcEdwdU1hcmtlcihkZXZpY2UpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGFzc2lnbiB1bmlmcm9tXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBVbmlmb3JtKGRldmljZSwgdHJ1ZSwgdGhpcy5kZXB0aFJlbmRlclRhcmdldC5kZXB0aEJ1ZmZlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgb25Qb3N0UmVuZGVyT3BhcXVlOiBmdW5jdGlvbiAoY2FtZXJhUGFzcykge1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBmYWxsYmFjayBwYXRoLCB3aGVyZSBjb3B5IGlzIG5vdCBwb3NzaWJsZSBhbmQgdGhlIHNjZW5lIGdldHMgcmUtcmVuZGVyZWRcbiAgICBpbml0RmFsbGJhY2tQYXRoKCkge1xuXG4gICAgICAgIGNvbnN0IGFwcCA9IHRoaXMuYXBwbGljYXRpb247XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8vIFdlYkdMIDEgZGVwdGggbGF5ZXIgcmVuZGVycyB0aGUgc2FtZSBvYmplY3RzIGFzIGluIFdvcmxkLCBidXQgd2l0aCBSR0JBLWVuY29kZWQgZGVwdGggc2hhZGVyIHRvIGdldCBkZXB0aFxuICAgICAgICB0aGlzLmxheWVyID0gbmV3IExheWVyKHtcbiAgICAgICAgICAgIGVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICAgICAgbmFtZTogXCJEZXB0aFwiLFxuICAgICAgICAgICAgaWQ6IExBWUVSSURfREVQVEgsXG4gICAgICAgICAgICBzaGFkZXJQYXNzOiBTSEFERVJfREVQVEgsXG5cbiAgICAgICAgICAgIG9uRW5hYmxlOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgUlQgd2l0aG91dCB0ZXh0dXJlcywgdGhvc2Ugd2lsbCBiZSBjcmVhdGVkIGFzIG5lZWRlZCBsYXRlclxuICAgICAgICAgICAgICAgIHRoaXMuZGVwdGhSZW5kZXJUYXJnZXQgPSBuZXcgUmVuZGVyVGFyZ2V0KHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2RlcHRoUmVuZGVyVGFyZ2V0LXdlYmdsMScsXG4gICAgICAgICAgICAgICAgICAgIGRlcHRoOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBzdGVuY2lsOiBhcHAuZ3JhcGhpY3NEZXZpY2Uuc3VwcG9ydHNTdGVuY2lsLFxuICAgICAgICAgICAgICAgICAgICBhdXRvUmVzb2x2ZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGdyYXBoaWNzRGV2aWNlOiBhcHAuZ3JhcGhpY3NEZXZpY2VcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIGFzc2lnbiBpdCBzbyB0aGUgcmVuZGVyIGFjdGlvbnMga25vd3MgdG8gcmVuZGVyIHRvIGl0XG4gICAgICAgICAgICAgICAgLy8gVE9ETzogYXZvaWQgdGhpcyBhcyB0aGlzIEFQSSBpcyBkZXByZWNhdGVkXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJUYXJnZXQgPSB0aGlzLmRlcHRoUmVuZGVyVGFyZ2V0O1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgb25EaXNhYmxlOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBvbmx5IHJlbGVhc2UgZGVwdGggdGV4dHVyZSwgYnV0IG5vdCB0aGUgcmVuZGVyIHRhcmdldCBpdHNlbGZcbiAgICAgICAgICAgICAgICB0aGlzLmRlcHRoUmVuZGVyVGFyZ2V0LmRlc3Ryb3lUZXh0dXJlQnVmZmVycygpO1xuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyVGFyZ2V0ID0gbnVsbDtcblxuICAgICAgICAgICAgICAgIHNlbGYucmVsZWFzZVJlbmRlclRhcmdldCh0aGlzLmNvbG9yUmVuZGVyVGFyZ2V0KTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbG9yUmVuZGVyVGFyZ2V0ID0gbnVsbDtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIG9uUG9zdEN1bGw6IGZ1bmN0aW9uIChjYW1lcmFQYXNzKSB7XG5cbiAgICAgICAgICAgICAgICAvKiogQHR5cGUge2ltcG9ydCgnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvZ3JhcGhpY3MtZGV2aWNlLmpzJykuR3JhcGhpY3NEZXZpY2V9ICovXG4gICAgICAgICAgICAgICAgY29uc3QgZGV2aWNlID0gYXBwLmdyYXBoaWNzRGV2aWNlO1xuXG4gICAgICAgICAgICAgICAgLyoqIEB0eXBlIHtpbXBvcnQoJy4uL2NvbXBvbmVudHMvY2FtZXJhL2NvbXBvbmVudC5qcycpLkNhbWVyYUNvbXBvbmVudH0gKi9cbiAgICAgICAgICAgICAgICBjb25zdCBjYW1lcmEgPSB0aGlzLmNhbWVyYXNbY2FtZXJhUGFzc107XG5cbiAgICAgICAgICAgICAgICBpZiAoY2FtZXJhLnJlbmRlclNjZW5lRGVwdGhNYXApIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyByZWFsbG9jYXRlIFJUIGlmIG5lZWRlZFxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZGVwdGhSZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgfHwgc2VsZi5zaG91bGRSZWFsbG9jYXRlKHRoaXMuZGVwdGhSZW5kZXJUYXJnZXQsIGNhbWVyYS5yZW5kZXJUYXJnZXQ/LmRlcHRoQnVmZmVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXB0aFJlbmRlclRhcmdldC5kZXN0cm95VGV4dHVyZUJ1ZmZlcnMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGVwdGhSZW5kZXJUYXJnZXQgPSBzZWxmLmFsbG9jYXRlUmVuZGVyVGFyZ2V0KHRoaXMuZGVwdGhSZW5kZXJUYXJnZXQsIGNhbWVyYS5yZW5kZXJUYXJnZXQsIGRldmljZSwgUElYRUxGT1JNQVRfUkdCQTgsIGZhbHNlLCBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBDb2xsZWN0IGFsbCByZW5kZXJlZCBtZXNoIGluc3RhbmNlcyB3aXRoIHRoZSBzYW1lIHJlbmRlciB0YXJnZXQgYXMgV29ybGQgaGFzLCBkZXB0aFdyaXRlID09IHRydWUgYW5kIHByaW9yIHRvIHRoaXMgbGF5ZXIgdG8gcmVwbGljYXRlIGJsaXRGcmFtZWJ1ZmZlciBvbiBXZWJHTDJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmlzaWJsZU9iamVjdHMgPSB0aGlzLmluc3RhbmNlcy52aXNpYmxlT3BhcXVlW2NhbWVyYVBhc3NdO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2aXNpYmxlTGlzdCA9IHZpc2libGVPYmplY3RzLmxpc3Q7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyQ29tcG9zaXRpb24gPSBhcHAuc2NlbmUubGF5ZXJzO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdWJMYXllckVuYWJsZWQgPSBsYXllckNvbXBvc2l0aW9uLnN1YkxheWVyRW5hYmxlZDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNUcmFuc3BhcmVudCA9IGxheWVyQ29tcG9zaXRpb24uc3ViTGF5ZXJMaXN0O1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNhbid0IHVzZSBzZWxmLmRlZmF1bHRMYXllcldvcmxkLnJlbmRlclRhcmdldCBiZWNhdXNlIHByb2plY3RzIHRoYXQgdXNlIHRoZSBlZGl0b3Igb3ZlcnJpZGUgZGVmYXVsdCBsYXllcnNcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcnQgPSBhcHAuc2NlbmUubGF5ZXJzLmdldExheWVyQnlJZChMQVlFUklEX1dPUkxEKS5yZW5kZXJUYXJnZXQ7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhbSA9IHRoaXMuY2FtZXJhc1tjYW1lcmFQYXNzXTtcblxuICAgICAgICAgICAgICAgICAgICBsZXQgdmlzaWJsZUxlbmd0aCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxheWVycyA9IGxheWVyQ29tcG9zaXRpb24ubGF5ZXJMaXN0O1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxheWVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSBsYXllcnNbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobGF5ZXIgPT09IHRoaXMpIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxheWVyLnJlbmRlclRhcmdldCAhPT0gcnQgfHwgIWxheWVyLmVuYWJsZWQgfHwgIXN1YkxheWVyRW5hYmxlZFtpXSkgY29udGludWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyQ2FtSWQgPSBsYXllci5jYW1lcmFzLmluZGV4T2YoY2FtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYXllckNhbUlkIDwgMCkgY29udGludWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zcGFyZW50ID0gaXNUcmFuc3BhcmVudFtpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBsYXllclZpc2libGVMaXN0ID0gdHJhbnNwYXJlbnQgPyBsYXllci5pbnN0YW5jZXMudmlzaWJsZVRyYW5zcGFyZW50W2xheWVyQ2FtSWRdIDogbGF5ZXIuaW5zdGFuY2VzLnZpc2libGVPcGFxdWVbbGF5ZXJDYW1JZF07XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXllclZpc2libGVMaXN0TGVuZ3RoID0gbGF5ZXJWaXNpYmxlTGlzdC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXllclZpc2libGVMaXN0ID0gbGF5ZXJWaXNpYmxlTGlzdC5saXN0O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGxheWVyVmlzaWJsZUxpc3RMZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRyYXdDYWxsID0gbGF5ZXJWaXNpYmxlTGlzdFtqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZHJhd0NhbGwubWF0ZXJpYWwgJiYgZHJhd0NhbGwubWF0ZXJpYWwuZGVwdGhXcml0ZSAmJiAhZHJhd0NhbGwuX25vRGVwdGhEcmF3R2wxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVMaXN0W3Zpc2libGVMZW5ndGhdID0gZHJhd0NhbGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVMZW5ndGgrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZU9iamVjdHMubGVuZ3RoID0gdmlzaWJsZUxlbmd0aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBvblByZVJlbmRlck9wYXF1ZTogZnVuY3Rpb24gKGNhbWVyYVBhc3MpIHtcblxuICAgICAgICAgICAgICAgIC8qKiBAdHlwZSB7aW1wb3J0KCcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9ncmFwaGljcy1kZXZpY2UuanMnKS5HcmFwaGljc0RldmljZX0gKi9cbiAgICAgICAgICAgICAgICBjb25zdCBkZXZpY2UgPSBhcHAuZ3JhcGhpY3NEZXZpY2U7XG5cbiAgICAgICAgICAgICAgICAvKiogQHR5cGUge2ltcG9ydCgnLi4vY29tcG9uZW50cy9jYW1lcmEvY29tcG9uZW50LmpzJykuQ2FtZXJhQ29tcG9uZW50fSAqL1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhbWVyYSA9IHRoaXMuY2FtZXJhc1tjYW1lcmFQYXNzXTtcblxuICAgICAgICAgICAgICAgIGlmIChjYW1lcmEucmVuZGVyU2NlbmVDb2xvck1hcCkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlYWxsb2NhdGUgUlQgaWYgbmVlZGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLnNob3VsZFJlYWxsb2NhdGUodGhpcy5jb2xvclJlbmRlclRhcmdldCwgY2FtZXJhLnJlbmRlclRhcmdldD8uY29sb3JCdWZmZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbGVhc2VSZW5kZXJUYXJnZXQodGhpcy5jb2xvclJlbmRlclRhcmdldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmb3JtYXQgPSBzZWxmLmdldFNvdXJjZUNvbG9yRm9ybWF0KGNhbWVyYS5yZW5kZXJUYXJnZXQ/LmNvbG9yQnVmZmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sb3JSZW5kZXJUYXJnZXQgPSBzZWxmLmFsbG9jYXRlUmVuZGVyVGFyZ2V0KHRoaXMuY29sb3JSZW5kZXJUYXJnZXQsIGNhbWVyYS5yZW5kZXJUYXJnZXQsIGRldmljZSwgZm9ybWF0LCBmYWxzZSwgZmFsc2UsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvcHkgb3V0IHRoZSBjb2xvciBidWZmZXJcbiAgICAgICAgICAgICAgICAgICAgRGVidWdHcmFwaGljcy5wdXNoR3B1TWFya2VyKGRldmljZSwgJ0dSQUItQ09MT1InKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBpbml0aWFsaXplIHRoZSB0ZXh0dXJlXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yQnVmZmVyID0gdGhpcy5jb2xvclJlbmRlclRhcmdldC5fY29sb3JCdWZmZXI7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY29sb3JCdWZmZXIuaW1wbC5fZ2xUZXh0dXJlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvckJ1ZmZlci5pbXBsLmluaXRpYWxpemUoZGV2aWNlLCBjb2xvckJ1ZmZlcik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBjb3B5IGZyYW1lYnVmZmVyIHRvIGl0XG4gICAgICAgICAgICAgICAgICAgIGRldmljZS5iaW5kVGV4dHVyZShjb2xvckJ1ZmZlcik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGdsID0gZGV2aWNlLmdsO1xuICAgICAgICAgICAgICAgICAgICBnbC5jb3B5VGV4SW1hZ2UyRChnbC5URVhUVVJFXzJELCAwLCBjb2xvckJ1ZmZlci5pbXBsLl9nbEZvcm1hdCwgMCwgMCwgY29sb3JCdWZmZXIud2lkdGgsIGNvbG9yQnVmZmVyLmhlaWdodCwgMCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gc3RvcCB0aGUgZGV2aWNlIGZyb20gdXBkYXRpbmcgdGhpcyB0ZXh0dXJlIGZ1cnRoZXJcbiAgICAgICAgICAgICAgICAgICAgY29sb3JCdWZmZXIuX25lZWRzVXBsb2FkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yQnVmZmVyLl9uZWVkc01pcG1hcHNVcGxvYWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICBEZWJ1Z0dyYXBoaWNzLnBvcEdwdU1hcmtlcihkZXZpY2UpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGFzc2lnbiB1bmlmcm9tXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBVbmlmb3JtKGRldmljZSwgZmFsc2UsIGNvbG9yQnVmZmVyKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoY2FtZXJhLnJlbmRlclNjZW5lRGVwdGhNYXApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gYXNzaWduIHVuaWZyb21cbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXR1cFVuaWZvcm0oZGV2aWNlLCB0cnVlLCB0aGlzLmRlcHRoUmVuZGVyVGFyZ2V0LmNvbG9yQnVmZmVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBvbkRyYXdDYWxsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgYXBwLmdyYXBoaWNzRGV2aWNlLnNldENvbG9yV3JpdGUodHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBvblBvc3RSZW5kZXJPcGFxdWU6IGZ1bmN0aW9uIChjYW1lcmFQYXNzKSB7XG5cbiAgICAgICAgICAgICAgICAvKiogQHR5cGUge2ltcG9ydCgnLi4vY29tcG9uZW50cy9jYW1lcmEvY29tcG9uZW50LmpzJykuQ2FtZXJhQ29tcG9uZW50fSAqL1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhbWVyYSA9IHRoaXMuY2FtZXJhc1tjYW1lcmFQYXNzXTtcblxuICAgICAgICAgICAgICAgIGlmIChjYW1lcmEucmVuZGVyU2NlbmVEZXB0aE1hcCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBqdXN0IGNsZWFyIHRoZSBsaXN0IG9mIHZpc2libGUgb2JqZWN0cyB0byBhdm9pZCBrZWVwaW5nIHJlZmVyZW5jZXNcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmlzaWJsZU9iamVjdHMgPSB0aGlzLmluc3RhbmNlcy52aXNpYmxlT3BhcXVlW2NhbWVyYVBhc3NdO1xuICAgICAgICAgICAgICAgICAgICB2aXNpYmxlT2JqZWN0cy5sZW5ndGggPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gZnVuY3Rpb24gd2hpY2ggcGF0Y2hlcyBhIGxheWVyIHRvIHVzZSBkZXB0aCBsYXllciBzZXQgdXAgaW4gdGhpcyBjbGFzc1xuICAgIHBhdGNoKGxheWVyKSB7XG5cbiAgICAgICAgbGF5ZXIub25FbmFibGUgPSB0aGlzLmxheWVyLm9uRW5hYmxlO1xuICAgICAgICBsYXllci5vbkRpc2FibGUgPSB0aGlzLmxheWVyLm9uRGlzYWJsZTtcbiAgICAgICAgbGF5ZXIub25QcmVSZW5kZXJPcGFxdWUgPSB0aGlzLmxheWVyLm9uUHJlUmVuZGVyT3BhcXVlO1xuICAgICAgICBsYXllci5vblBvc3RSZW5kZXJPcGFxdWUgPSB0aGlzLmxheWVyLm9uUG9zdFJlbmRlck9wYXF1ZTtcbiAgICAgICAgbGF5ZXIuc2hhZGVyUGFzcyA9IHRoaXMubGF5ZXIuc2hhZGVyUGFzcztcbiAgICAgICAgbGF5ZXIub25Qb3N0Q3VsbCA9IHRoaXMubGF5ZXIub25Qb3N0Q3VsbDtcbiAgICAgICAgbGF5ZXIub25EcmF3Q2FsbCA9IHRoaXMubGF5ZXIub25EcmF3Q2FsbDtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFNjZW5lR3JhYiB9O1xuIl0sIm5hbWVzIjpbIl9kZXB0aFVuaWZvcm1OYW1lcyIsIl9jb2xvclVuaWZvcm1OYW1lcyIsIlNjZW5lR3JhYiIsImNvbnN0cnVjdG9yIiwiYXBwbGljYXRpb24iLCJkZXZpY2UiLCJncmFwaGljc0RldmljZSIsImxheWVyIiwid2ViZ2wyIiwiZGV2aWNlVHlwZSIsIkRFVklDRVRZUEVfV0VCR1BVIiwiaW5pdE1haW5QYXRoIiwiaW5pdEZhbGxiYWNrUGF0aCIsInNldHVwVW5pZm9ybSIsImRlcHRoIiwiYnVmZmVyIiwibmFtZXMiLCJmb3JFYWNoIiwibmFtZSIsInNjb3BlIiwicmVzb2x2ZSIsInNldFZhbHVlIiwiYWxsb2NhdGVUZXh0dXJlIiwic291cmNlIiwiZm9ybWF0IiwiaXNEZXB0aCIsIm1pcG1hcHMiLCJUZXh0dXJlIiwid2lkdGgiLCJjb2xvckJ1ZmZlciIsImhlaWdodCIsIm1pbkZpbHRlciIsIkZJTFRFUl9ORUFSRVNUIiwiRklMVEVSX0xJTkVBUl9NSVBNQVBfTElORUFSIiwiRklMVEVSX0xJTkVBUiIsIm1hZ0ZpbHRlciIsImFkZHJlc3NVIiwiQUREUkVTU19DTEFNUF9UT19FREdFIiwiYWRkcmVzc1YiLCJnZXRTb3VyY2VDb2xvckZvcm1hdCIsInRleHR1cmUiLCJmcmFtZWJ1ZmZlckZvcm1hdCIsInNob3VsZFJlYWxsb2NhdGUiLCJ0YXJnZXRSVCIsInNvdXJjZVRleHR1cmUiLCJ0ZXN0Rm9ybWF0IiwidGFyZ2V0Rm9ybWF0Iiwic291cmNlRm9ybWF0IiwiYWxsb2NhdGVSZW5kZXJUYXJnZXQiLCJyZW5kZXJUYXJnZXQiLCJzb3VyY2VSZW5kZXJUYXJnZXQiLCJpc0RlcHRoVW5pZm9ybXMiLCJkZXN0cm95RnJhbWVCdWZmZXJzIiwiX2RlcHRoQnVmZmVyIiwiX2NvbG9yQnVmZmVyIiwiUmVuZGVyVGFyZ2V0IiwiZGVwdGhCdWZmZXIiLCJzdGVuY2lsIiwic3VwcG9ydHNTdGVuY2lsIiwiYXV0b1Jlc29sdmUiLCJyZWxlYXNlUmVuZGVyVGFyZ2V0IiwicnQiLCJkZXN0cm95VGV4dHVyZUJ1ZmZlcnMiLCJkZXN0cm95IiwiYXBwIiwic2VsZiIsIkxheWVyIiwiZW5hYmxlZCIsImlkIiwiTEFZRVJJRF9ERVBUSCIsIm9uRGlzYWJsZSIsImRlcHRoUmVuZGVyVGFyZ2V0IiwiY29sb3JSZW5kZXJUYXJnZXQiLCJvblByZVJlbmRlck9wYXF1ZSIsImNhbWVyYVBhc3MiLCJjYW1lcmEiLCJjYW1lcmFzIiwicmVuZGVyU2NlbmVDb2xvck1hcCIsIkRlYnVnR3JhcGhpY3MiLCJwdXNoR3B1TWFya2VyIiwiY29weVJlbmRlclRhcmdldCIsImFjdGl2ZVRleHR1cmUiLCJtYXhDb21iaW5lZFRleHR1cmVzIiwiYmluZFRleHR1cmUiLCJnbCIsImdlbmVyYXRlTWlwbWFwIiwiaW1wbCIsIl9nbFRhcmdldCIsInBvcEdwdU1hcmtlciIsInJlbmRlclNjZW5lRGVwdGhNYXAiLCJQSVhFTEZPUk1BVF9ERVBUSFNURU5DSUwiLCJvblBvc3RSZW5kZXJPcGFxdWUiLCJzaGFkZXJQYXNzIiwiU0hBREVSX0RFUFRIIiwib25FbmFibGUiLCJvblBvc3RDdWxsIiwiUElYRUxGT1JNQVRfUkdCQTgiLCJ2aXNpYmxlT2JqZWN0cyIsImluc3RhbmNlcyIsInZpc2libGVPcGFxdWUiLCJ2aXNpYmxlTGlzdCIsImxpc3QiLCJsYXllckNvbXBvc2l0aW9uIiwic2NlbmUiLCJsYXllcnMiLCJzdWJMYXllckVuYWJsZWQiLCJpc1RyYW5zcGFyZW50Iiwic3ViTGF5ZXJMaXN0IiwiZ2V0TGF5ZXJCeUlkIiwiTEFZRVJJRF9XT1JMRCIsImNhbSIsInZpc2libGVMZW5ndGgiLCJsYXllckxpc3QiLCJpIiwibGVuZ3RoIiwibGF5ZXJDYW1JZCIsImluZGV4T2YiLCJ0cmFuc3BhcmVudCIsImxheWVyVmlzaWJsZUxpc3QiLCJ2aXNpYmxlVHJhbnNwYXJlbnQiLCJsYXllclZpc2libGVMaXN0TGVuZ3RoIiwiaiIsImRyYXdDYWxsIiwibWF0ZXJpYWwiLCJkZXB0aFdyaXRlIiwiX25vRGVwdGhEcmF3R2wxIiwiX2dsVGV4dHVyZSIsImluaXRpYWxpemUiLCJjb3B5VGV4SW1hZ2UyRCIsIlRFWFRVUkVfMkQiLCJfZ2xGb3JtYXQiLCJfbmVlZHNVcGxvYWQiLCJfbmVlZHNNaXBtYXBzVXBsb2FkIiwib25EcmF3Q2FsbCIsInNldENvbG9yV3JpdGUiLCJwYXRjaCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBbUJBLE1BQU1BLGtCQUFrQixHQUFHLENBQUMsZ0JBQWdCLEVBQUUsV0FBVyxDQUFDLENBQUE7QUFDMUQsTUFBTUMsa0JBQWtCLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxrQkFBa0IsQ0FBQyxDQUFBOztBQWVqRSxNQUFNQyxTQUFTLENBQUM7RUFDWkMsV0FBVyxDQUFDQyxXQUFXLEVBQUU7SUFDckIsSUFBSSxDQUFDQSxXQUFXLEdBQUdBLFdBQVcsQ0FBQTs7QUFHOUIsSUFBQSxJQUFJLENBQUNDLE1BQU0sR0FBR0QsV0FBVyxDQUFDRSxjQUFjLENBQUE7O0lBR3hDLElBQUksQ0FBQ0MsS0FBSyxHQUFHLElBQUksQ0FBQTs7QUFJakIsSUFBQSxJQUFJLElBQUksQ0FBQ0YsTUFBTSxDQUFDRyxNQUFNLElBQUksSUFBSSxDQUFDSCxNQUFNLENBQUNJLFVBQVUsS0FBS0MsaUJBQWlCLEVBQUU7TUFDcEUsSUFBSSxDQUFDQyxZQUFZLEVBQUUsQ0FBQTtBQUN2QixLQUFDLE1BQU07TUFDSCxJQUFJLENBQUNDLGdCQUFnQixFQUFFLENBQUE7QUFDM0IsS0FBQTtBQUNKLEdBQUE7QUFFQUMsRUFBQUEsWUFBWSxDQUFDUixNQUFNLEVBQUVTLEtBQUssRUFBRUMsTUFBTSxFQUFFO0FBR2hDLElBQUEsTUFBTUMsS0FBSyxHQUFHRixLQUFLLEdBQUdkLGtCQUFrQixHQUFHQyxrQkFBa0IsQ0FBQTtBQUM3RGUsSUFBQUEsS0FBSyxD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
