/**
 * @license
 * PlayCanvas Engine v1.57.1 revision 256dd83c2 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { math } from '../../math/math.js';
import { AnimBlendTree } from './anim-blend-tree.js';

class AnimBlendTree1D extends AnimBlendTree {
  constructor(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter) {
    children.sort((a, b) => a.point - b.point);
    super(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter);
  }

  calculateWeights() {
    if (this.updateParameterValues()) return;
    let weightedDurationSum = 0.0;
    this._children[0].weight = 0.0;

    for (let i = 0; i < this._children.length; i++) {
      const c1 = this._children[i];

      if (i !== this._children.length - 1) {
        const c2 = this._children[i + 1];

        if (c1.point === c2.point) {
          c1.weight = 0.5;
          c2.weight = 0.5;
        } else if (math.between(this._parameterValues[0], c1.point, c2.point, true)) {
          const child2Distance = Math.abs(c1.point - c2.point);
          const parameterDistance = Math.abs(c1.point - this._parameterValues[0]);
          const weight = (child2Distance - parameterDistance) / child2Distance;
          c1.weight = weight;
          c2.weight = 1.0 - weight;
        } else {
          c2.weight = 0.0;
        }
      }

      if (this._syncAnimations) {
        weightedDurationSum += c1.animTrack.duration / c1.absoluteSpeed * c1.weight;
      }
    }

    if (this._syncAnimations) {
      for (let i = 0; i < this._children.length; i++) {
        const child = this._children[i];
        child.weightedSpeed = child.animTrack.duration / child.absoluteSpeed / weightedDurationSum;
      }
    }
  }

}

export { AnimBlendTree1D };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5pbS1ibGVuZC10cmVlLTFkLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvYW5pbS9jb250cm9sbGVyL2FuaW0tYmxlbmQtdHJlZS0xZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBtYXRoIH0gZnJvbSAnLi4vLi4vbWF0aC9tYXRoLmpzJztcblxuaW1wb3J0IHsgQW5pbUJsZW5kVHJlZSB9IGZyb20gJy4vYW5pbS1ibGVuZC10cmVlLmpzJztcblxuLyoqXG4gKiBBbiBBbmltQmxlbmRUcmVlIHRoYXQgY2FsY3VsYXRlcyBpdHMgd2VpZ2h0cyB1c2luZyBhIDFEIGFsZ29yaXRobSBiYXNlZCBvbiB0aGUgdGhlc2lzXG4gKiBodHRwOi8vcnVuZXZpc2lvbi5jb20vdGhlc2lzL3J1bmVfc2tvdmJvX2pvaGFuc2VuX3RoZXNpcy5wZGYgQ2hhcHRlciA2LlxuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgQW5pbUJsZW5kVHJlZTFEIGV4dGVuZHMgQW5pbUJsZW5kVHJlZSB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IEJsZW5kVHJlZTFEIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtBbmltU3RhdGV9IHN0YXRlIC0gVGhlIEFuaW1TdGF0ZSB0aGF0IHRoaXMgQW5pbUJsZW5kVHJlZSBiZWxvbmdzIHRvLlxuICAgICAqIEBwYXJhbSB7QW5pbUJsZW5kVHJlZXxudWxsfSBwYXJlbnQgLSBUaGUgcGFyZW50IG9mIHRoZSBBbmltQmxlbmRUcmVlLiBJZiBub3QgbnVsbCwgdGhlXG4gICAgICogQW5pbU5vZGUgaXMgc3RvcmVkIGFzIHBhcnQgb2YgYSB7QGxpbmsgQW5pbUJsZW5kVHJlZX0gaGllcmFyY2h5LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIEJsZW5kVHJlZS4gVXNlZCB3aGVuIGFzc2lnbmluZyBhIHtAbGluayBBbmltVHJhY2t9IHRvXG4gICAgICogaXRzIGNoaWxkcmVuLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfFZlYzJ9IHBvaW50IC0gVGhlIGNvb3JkaW5hdGUvdmVjdG9yIHRoYXRzIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSB3ZWlnaHQgb2YgdGhpc1xuICAgICAqIG5vZGUgd2hlbiBpdCdzIHBhcnQgb2YgYSB7QGxpbmsgQW5pbUJsZW5kVHJlZX0uXG4gICAgICogQHBhcmFtIHtzdHJpbmdbXX0gcGFyYW1ldGVycyAtIFRoZSBhbmltIGNvbXBvbmVudCBwYXJhbWV0ZXJzIHdoaWNoIGFyZSB1c2VkIHRvIGNhbGN1bGF0ZSB0aGVcbiAgICAgKiBjdXJyZW50IHdlaWdodHMgb2YgdGhlIGJsZW5kIHRyZWVzIGNoaWxkcmVuLlxuICAgICAqIEBwYXJhbSB7b2JqZWN0W119IGNoaWxkcmVuIC0gVGhlIGNoaWxkIG5vZGVzIHRoYXQgdGhpcyBibGVuZCB0cmVlIHNob3VsZCBjcmVhdGUuIENhbiBlaXRoZXJcbiAgICAgKiBiZSBvZiB0eXBlIHtAbGluayBBbmltTm9kZX0gb3Ige0BsaW5rIEJsZW5kVHJlZX0uXG4gICAgICogQHBhcmFtIHtib29sZWFufSBzeW5jQW5pbWF0aW9ucyAtIElmIHRydWUsIHRoZSBzcGVlZCBvZiBlYWNoIGJsZW5kZWQgYW5pbWF0aW9uIHdpbGwgYmVcbiAgICAgKiBzeW5jaHJvbml6ZWQuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY3JlYXRlVHJlZSAtIFVzZWQgdG8gY3JlYXRlIGNoaWxkIGJsZW5kIHRyZWVzIG9mIHZhcnlpbmcgdHlwZXMuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZmluZFBhcmFtZXRlciAtIFVzZWQgYXQgcnVudGltZSB0byBnZXQgdGhlIGN1cnJlbnQgcGFyYW1ldGVyIHZhbHVlcy5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihzdGF0ZSwgcGFyZW50LCBuYW1lLCBwb2ludCwgcGFyYW1ldGVycywgY2hpbGRyZW4sIHN5bmNBbmltYXRpb25zLCBjcmVhdGVUcmVlLCBmaW5kUGFyYW1ldGVyKSB7XG4gICAgICAgIGNoaWxkcmVuLnNvcnQoKGEsIGIpID0+IGEucG9pbnQgLSBiLnBvaW50KTtcbiAgICAgICAgc3VwZXIoc3RhdGUsIHBhcmVudCwgbmFtZSwgcG9pbnQsIHBhcmFtZXRlcnMsIGNoaWxkcmVuLCBzeW5jQW5pbWF0aW9ucywgY3JlYXRlVHJlZSwgZmluZFBhcmFtZXRlcik7XG4gICAgfVxuXG4gICAgY2FsY3VsYXRlV2VpZ2h0cygpIHtcbiAgICAgICAgaWYgKHRoaXMudXBkYXRlUGFyYW1ldGVyVmFsdWVzKCkpIHJldHVybjtcbiAgICAgICAgbGV0IHdlaWdodGVkRHVyYXRpb25TdW0gPSAwLjA7XG4gICAgICAgIHRoaXMuX2NoaWxkcmVuWzBdLndlaWdodCA9IDAuMDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgYzEgPSB0aGlzLl9jaGlsZHJlbltpXTtcbiAgICAgICAgICAgIGlmIChpICE9PSB0aGlzLl9jaGlsZHJlbi5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYzIgPSB0aGlzLl9jaGlsZHJlbltpICsgMV07XG4gICAgICAgICAgICAgICAgaWYgKGMxLnBvaW50ID09PSBjMi5wb2ludCkge1xuICAgICAgICAgICAgICAgICAgICBjMS53ZWlnaHQgPSAwLjU7XG4gICAgICAgICAgICAgICAgICAgIGMyLndlaWdodCA9IDAuNTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1hdGguYmV0d2Vlbih0aGlzLl9wYXJhbWV0ZXJWYWx1ZXNbMF0sIGMxLnBvaW50LCBjMi5wb2ludCwgdHJ1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGQyRGlzdGFuY2UgPSBNYXRoLmFicyhjMS5wb2ludCAtIGMyLnBvaW50KTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyYW1ldGVyRGlzdGFuY2UgPSBNYXRoLmFicyhjMS5wb2ludCAtIHRoaXMuX3BhcmFtZXRlclZhbHVlc1swXSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHdlaWdodCA9IChjaGlsZDJEaXN0YW5jZSAtIHBhcmFtZXRlckRpc3RhbmNlKSAvIGNoaWxkMkRpc3RhbmNlO1xuICAgICAgICAgICAgICAgICAgICBjMS53ZWlnaHQgPSB3ZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIGMyLndlaWdodCA9ICgxLjAgLSB3ZWlnaHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGMyLndlaWdodCA9IDAuMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5fc3luY0FuaW1hdGlvbnMpIHtcbiAgICAgICAgICAgICAgICB3ZWlnaHRlZER1cmF0aW9uU3VtICs9IGMxLmFuaW1UcmFjay5kdXJhdGlvbiAvIGMxLmFic29sdXRlU3BlZWQgKiBjMS53ZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX3N5bmNBbmltYXRpb25zKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX2NoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2hpbGQgPSB0aGlzLl9jaGlsZHJlbltpXTtcbiAgICAgICAgICAgICAgICBjaGlsZC53ZWlnaHRlZFNwZWVkID0gY2hpbGQuYW5pbVRyYWNrLmR1cmF0aW9uIC8gY2hpbGQuYWJzb2x1dGVTcGVlZCAvIHdlaWdodGVkRHVyYXRpb25TdW07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnQgeyBBbmltQmxlbmRUcmVlMUQgfTtcbiJdLCJuYW1lcyI6WyJBbmltQmxlbmRUcmVlMUQiLCJBbmltQmxlbmRUcmVlIiwiY29uc3RydWN0b3IiLCJzdGF0ZSIsInBhcmVudCIsIm5hbWUiLCJwb2ludCIsInBhcmFtZXRlcnMiLCJjaGlsZHJlbiIsInN5bmNBbmltYXRpb25zIiwiY3JlYXRlVHJlZSIsImZpbmRQYXJhbWV0ZXIiLCJzb3J0IiwiYSIsImIiLCJjYWxjdWxhdGVXZWlnaHRzIiwidXBkYXRlUGFyYW1ldGVyVmFsdWVzIiwid2VpZ2h0ZWREdXJhdGlvblN1bSIsIl9jaGlsZHJlbiIsIndlaWdodCIsImkiLCJsZW5ndGgiLCJjMSIsImMyIiwibWF0aCIsImJldHdlZW4iLCJfcGFyYW1ldGVyVmFsdWVzIiwiY2hpbGQyRGlzdGFuY2UiLCJNYXRoIiwiYWJzIiwicGFyYW1ldGVyRGlzdGFuY2UiLCJfc3luY0FuaW1hdGlvbnMiLCJhbmltVHJhY2siLCJkdXJhdGlvbiIsImFic29sdXRlU3BlZWQiLCJjaGlsZCIsIndlaWdodGVkU3BlZWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBVUEsTUFBTUEsZUFBTixTQUE4QkMsYUFBOUIsQ0FBNEM7QUFvQnhDQyxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBUUMsTUFBUixFQUFnQkMsSUFBaEIsRUFBc0JDLEtBQXRCLEVBQTZCQyxVQUE3QixFQUF5Q0MsUUFBekMsRUFBbURDLGNBQW5ELEVBQW1FQyxVQUFuRSxFQUErRUMsYUFBL0UsRUFBOEY7QUFDckdILElBQUFBLFFBQVEsQ0FBQ0ksSUFBVCxDQUFjLENBQUNDLENBQUQsRUFBSUMsQ0FBSixLQUFVRCxDQUFDLENBQUNQLEtBQUYsR0FBVVEsQ0FBQyxDQUFDUixLQUFwQyxDQUFBLENBQUE7QUFDQSxJQUFBLEtBQUEsQ0FBTUgsS0FBTixFQUFhQyxNQUFiLEVBQXFCQyxJQUFyQixFQUEyQkMsS0FBM0IsRUFBa0NDLFVBQWxDLEVBQThDQyxRQUE5QyxFQUF3REMsY0FBeEQsRUFBd0VDLFVBQXhFLEVBQW9GQyxhQUFwRixDQUFBLENBQUE7QUFDSCxHQUFBOztBQUVESSxFQUFBQSxnQkFBZ0IsR0FBRztJQUNmLElBQUksSUFBQSxDQUFLQyxxQkFBTCxFQUFKLEVBQWtDLE9BQUE7SUFDbEMsSUFBSUMsbUJBQW1CLEdBQUcsR0FBMUIsQ0FBQTtBQUNB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
