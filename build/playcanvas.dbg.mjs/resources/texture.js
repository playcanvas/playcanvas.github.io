/**
 * @license
 * PlayCanvas Engine v1.57.0 revision f1998a31e (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { path } from '../core/path.js';
import { PIXELFORMAT_R8_G8_B8, TEXTURETYPE_RGBM, TEXTURETYPE_SWIZZLEGGGR, ADDRESS_REPEAT, ADDRESS_CLAMP_TO_EDGE, ADDRESS_MIRRORED_REPEAT, FILTER_NEAREST, FILTER_LINEAR, FILTER_NEAREST_MIPMAP_NEAREST, FILTER_LINEAR_MIPMAP_NEAREST, FILTER_NEAREST_MIPMAP_LINEAR, FILTER_LINEAR_MIPMAP_LINEAR, TEXTURETYPE_DEFAULT, TEXTURETYPE_RGBE, TEXTURETYPE_RGBP, PIXELFORMAT_R8_G8_B8_A8, PIXELFORMAT_RGBA32F } from '../graphics/constants.js';
import { Texture } from '../graphics/texture.js';
import { BasisParser } from './parser/texture/basis.js';
import { ImgParser } from './parser/texture/img.js';
import { KtxParser } from './parser/texture/ktx.js';
import { Ktx2Parser } from './parser/texture/ktx2.js';
import { DdsParser } from './parser/texture/dds.js';
import { HdrParser } from './parser/texture/hdr.js';

const JSON_ADDRESS_MODE = {
  'repeat': ADDRESS_REPEAT,
  'clamp': ADDRESS_CLAMP_TO_EDGE,
  'mirror': ADDRESS_MIRRORED_REPEAT
};
const JSON_FILTER_MODE = {
  'nearest': FILTER_NEAREST,
  'linear': FILTER_LINEAR,
  'nearest_mip_nearest': FILTER_NEAREST_MIPMAP_NEAREST,
  'linear_mip_nearest': FILTER_LINEAR_MIPMAP_NEAREST,
  'nearest_mip_linear': FILTER_NEAREST_MIPMAP_LINEAR,
  'linear_mip_linear': FILTER_LINEAR_MIPMAP_LINEAR
};
const JSON_TEXTURE_TYPE = {
  'default': TEXTURETYPE_DEFAULT,
  'rgbm': TEXTURETYPE_RGBM,
  'rgbe': TEXTURETYPE_RGBE,
  'rgbp': TEXTURETYPE_RGBP,
  'swizzleGGGR': TEXTURETYPE_SWIZZLEGGGR
};

class TextureParser {
  load(url, callback, asset) {
    throw new Error('not implemented');
  }

  open(url, data, device) {
    throw new Error('not implemented');
  }

}

const _completePartialMipmapChain = function _completePartialMipmapChain(texture) {
  const requiredMipLevels = Math.log2(Math.max(texture._width, texture._height)) + 1;

  const isHtmlElement = function isHtmlElement(object) {
    return object instanceof HTMLCanvasElement || object instanceof HTMLImageElement || object instanceof HTMLVideoElement;
  };

  if (!(texture._format === PIXELFORMAT_R8_G8_B8_A8 || texture._format === PIXELFORMAT_RGBA32F) || texture._volume || texture._compressed || texture._levels.length === 1 || texture._levels.length === requiredMipLevels || isHtmlElement(texture._cubemap ? texture._levels[0][0] : texture._levels[0])) {
    return;
  }

  const downsample = function downsample(width, height, data) {
    const sampledWidth = Math.max(1, width >> 1);
    const sampledHeight = Math.max(1, height >> 1);
    const sampledData = new data.constructor(sampledWidth * sampledHeight * 4);
    const xs = Math.floor(width / sampledWidth);
    const ys = Math.floor(height / sampledHeight);
    const xsys = xs * ys;

    for (let y = 0; y < sampledHeight; ++y) {
      for (let x = 0; x < sampledWidth; ++x) {
        for (let e = 0; e < 4; ++e) {
          let sum = 0;

          for (let sy = 0; sy < ys; ++sy) {
            for (let sx = 0; sx < xs; ++sx) {
              sum += data[(x * xs + sx + (y * ys + sy) * width) * 4 + e];
            }
          }

          sampledData[(x + y * sampledWidth) * 4 + e] = sum / xsys;
        }
      }
    }

    return sampledData;
  };

  for (let level = texture._levels.length; level < requiredMipLevels; ++level) {
    const width = Math.max(1, texture._width >> level - 1);
    const height = Math.max(1, texture._height >> level - 1);

    if (texture._cubemap) {
      const mips = [];

      for (let face = 0; face < 6; ++face) {
        mips.push(downsample(width, height, texture._levels[level - 1][face]));
      }

      texture._levels.push(mips);
    } else {
      texture._levels.push(downsample(width, height, texture._levels[level - 1]));
    }
  }

  texture._levelsUpdated = texture._cubemap ? [[true, true, true, true, true, true]] : [true];
};

class TextureHandler {
  constructor(app) {
    this.handlerType = "texture";
    const assets = app.assets;
    const device = app.graphicsDevice;
    this._device = device;
    this._assets = assets;
    this._loader = app.loader;
    this.imgParser = new ImgParser(assets, device);
    this.parsers = {
      dds: new DdsParser(assets),
      ktx: new KtxParser(assets),
      ktx2: new Ktx2Parser(assets, device),
      basis: new BasisParser(assets, device),
      hdr: new HdrParser(assets)
    };
  }

  set crossOrigin(value) {
    this.imgParser.crossOrigin = value;
  }

  get crossOrigin() {
    return this.imgParser.crossOrigin;
  }

  set maxRetries(value) {
    this.imgParser.maxRetries = value;

    for (const parser in this.parsers) {
      if (this.parsers.hasOwnProperty(parser)) {
        this.parsers[parser].maxRetries = value;
      }
    }
  }

  get maxRetries() {
    return this.imgParser.maxRetries;
  }

  _getUrlWithoutParams(url) {
    return url.indexOf('?') >= 0 ? url.split('?')[0] : url;
  }

  _getParser(url) {
    const ext = path.getExtension(this._getUrlWithoutParams(url)).toLowerCase().replace('.', '');
    return this.parsers[ext] || this.imgParser;
  }

  load(url, callback, asset) {
    if (typeof url === 'string') {
      url = {
        load: url,
        original: url
      };
    }

    this._getParser(url.original).load(url, callback, asset);
  }

  open(url, data, asset) {
    if (!url) return undefined;

    let texture = this._getParser(url).open(url, data, this._device);

    if (texture === null) {
      texture = new Texture(this._device, {
        width: 4,
        height: 4,
        format: PIXELFORMAT_R8_G8_B8
      });
    } else {
      _completePartialMipmapChain(texture);

      if (data.unswizzledGGGR) {
        asset.file.variants.basis.opt &= ~8;
      }
    }

    return texture;
  }

  patch(asset, assets) {
    const texture = asset.resource;

    if (!texture) {
      return;
    }

    if (asset.name && asset.name.length > 0) {
      texture.name = asset.name;
    }

    const assetData = asset.data;

    if (assetData.hasOwnProperty('minfilter')) {
      texture.minFilter = JSON_FILTER_MODE[assetData.minfilter];
    }

    if (assetData.hasOwnProperty('magfilter')) {
      texture.magFilter = JSON_FILTER_MODE[assetData.magfilter];
    }

    if (!texture.cubemap) {
      if (assetData.hasOwnProperty('addressu')) {
        texture.addressU = JSON_ADDRESS_MODE[assetData.addressu];
      }

      if (assetData.hasOwnProperty('addressv')) {
        texture.addressV = JSON_ADDRESS_MODE[assetData.addressv];
      }
    }

    if (assetData.hasOwnProperty('mipmaps')) {
      texture.mipmaps = assetData.mipmaps;
    }

    if (assetData.hasOwnProperty('anisotropy')) {
      texture.anisotropy = assetData.anisotropy;
    }

    if (assetData.hasOwnProperty('flipY')) {
      texture.flipY = !!assetData.flipY;
    }

    if (assetData.hasOwnProperty('type')) {
      texture.type = JSON_TEXTURE_TYPE[assetData.type];
    } else if (assetData.hasOwnProperty('rgbm') && assetData.rgbm) {
      texture.type = TEXTURETYPE_RGBM;
    } else if (asset.file && (asset.file.opt & 8) !== 0) {
      texture.type = TEXTURETYPE_SWIZZLEGGGR;
    }
  }

}

export { TextureHandler, TextureParser };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGV4dHVyZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3Jlc291cmNlcy90ZXh0dXJlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHBhdGggfSBmcm9tICcuLi9jb3JlL3BhdGguanMnO1xuXG5pbXBvcnQge1xuICAgIEFERFJFU1NfQ0xBTVBfVE9fRURHRSwgQUREUkVTU19NSVJST1JFRF9SRVBFQVQsIEFERFJFU1NfUkVQRUFULFxuICAgIEZJTFRFUl9MSU5FQVIsIEZJTFRFUl9ORUFSRVNULCBGSUxURVJfTkVBUkVTVF9NSVBNQVBfTkVBUkVTVCwgRklMVEVSX05FQVJFU1RfTUlQTUFQX0xJTkVBUiwgRklMVEVSX0xJTkVBUl9NSVBNQVBfTkVBUkVTVCwgRklMVEVSX0xJTkVBUl9NSVBNQVBfTElORUFSLFxuICAgIFBJWEVMRk9STUFUX1I4X0c4X0I4LCBQSVhFTEZPUk1BVF9SOF9HOF9COF9BOCwgUElYRUxGT1JNQVRfUkdCQTMyRixcbiAgICBURVhUVVJFVFlQRV9ERUZBVUxULCBURVhUVVJFVFlQRV9SR0JFLCBURVhUVVJFVFlQRV9SR0JNLCBURVhUVVJFVFlQRV9TV0laWkxFR0dHUiwgVEVYVFVSRVRZUEVfUkdCUFxufSBmcm9tICcuLi9ncmFwaGljcy9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgVGV4dHVyZSB9IGZyb20gJy4uL2dyYXBoaWNzL3RleHR1cmUuanMnO1xuXG5pbXBvcnQgeyBCYXNpc1BhcnNlciB9IGZyb20gJy4vcGFyc2VyL3RleHR1cmUvYmFzaXMuanMnO1xuaW1wb3J0IHsgSW1nUGFyc2VyIH0gZnJvbSAnLi9wYXJzZXIvdGV4dHVyZS9pbWcuanMnO1xuaW1wb3J0IHsgS3R4UGFyc2VyIH0gZnJvbSAnLi9wYXJzZXIvdGV4dHVyZS9rdHguanMnO1xuaW1wb3J0IHsgS3R4MlBhcnNlciB9IGZyb20gJy4vcGFyc2VyL3RleHR1cmUva3R4Mi5qcyc7XG5pbXBvcnQgeyBEZHNQYXJzZXIgfSBmcm9tICcuL3BhcnNlci90ZXh0dXJlL2Rkcy5qcyc7XG5pbXBvcnQgeyBIZHJQYXJzZXIgfSBmcm9tICcuL3BhcnNlci90ZXh0dXJlL2hkci5qcyc7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuLi9mcmFtZXdvcmsvYXBwLWJhc2UuanMnKS5BcHBCYXNlfSBBcHBCYXNlICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi4vYXNzZXQvYXNzZXQuanMnKS5Bc3NldH0gQXNzZXQgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2hhbmRsZXIuanMnKS5SZXNvdXJjZUhhbmRsZXJ9IFJlc291cmNlSGFuZGxlciAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vaGFuZGxlci5qcycpLlJlc291cmNlSGFuZGxlckNhbGxiYWNrfSBSZXNvdXJjZUhhbmRsZXJDYWxsYmFjayAqL1xuXG5jb25zdCBKU09OX0FERFJFU1NfTU9ERSA9IHtcbiAgICAncmVwZWF0JzogQUREUkVTU19SRVBFQVQsXG4gICAgJ2NsYW1wJzogQUREUkVTU19DTEFNUF9UT19FREdFLFxuICAgICdtaXJyb3InOiBBRERSRVNTX01JUlJPUkVEX1JFUEVBVFxufTtcblxuY29uc3QgSlNPTl9GSUxURVJfTU9ERSA9IHtcbiAgICAnbmVhcmVzdCc6IEZJTFRFUl9ORUFSRVNULFxuICAgICdsaW5lYXInOiBGSUxURVJfTElORUFSLFxuICAgICduZWFyZXN0X21pcF9uZWFyZXN0JzogRklMVEVSX05FQVJFU1RfTUlQTUFQX05FQVJFU1QsXG4gICAgJ2xpbmVhcl9taXBfbmVhcmVzdCc6IEZJTFRFUl9MSU5FQVJfTUlQTUFQX05FQVJFU1QsXG4gICAgJ25lYXJlc3RfbWlwX2xpbmVhcic6IEZJTFRFUl9ORUFSRVNUX01JUE1BUF9MSU5FQVIsXG4gICAgJ2xpbmVhcl9taXBfbGluZWFyJzogRklMVEVSX0xJTkVBUl9NSVBNQVBfTElORUFSXG59O1xuXG5jb25zdCBKU09OX1RFWFRVUkVfVFlQRSA9IHtcbiAgICAnZGVmYXVsdCc6IFRFWFRVUkVUWVBFX0RFRkFVTFQsXG4gICAgJ3JnYm0nOiBURVhUVVJFVFlQRV9SR0JNLFxuICAgICdyZ2JlJzogVEVYVFVSRVRZUEVfUkdCRSxcbiAgICAncmdicCc6IFRFWFRVUkVUWVBFX1JHQlAsXG4gICAgJ3N3aXp6bGVHR0dSJzogVEVYVFVSRVRZUEVfU1dJWlpMRUdHR1Jcbn07XG5cbi8qKlxuICogQGludGVyZmFjZVxuICogQG5hbWUgVGV4dHVyZVBhcnNlclxuICogQGRlc2NyaXB0aW9uIEludGVyZmFjZSB0byBhIHRleHR1cmUgcGFyc2VyLiBJbXBsZW1lbnRhdGlvbnMgb2YgdGhpcyBpbnRlcmZhY2UgaGFuZGxlIHRoZSBsb2FkaW5nXG4gKiBhbmQgb3BlbmluZyBvZiB0ZXh0dXJlIGFzc2V0cy5cbiAqL1xuY2xhc3MgVGV4dHVyZVBhcnNlciB7XG4gICAgLyogZXNsaW50LWRpc2FibGUganNkb2MvcmVxdWlyZS1yZXR1cm5zLWNoZWNrICovXG4gICAgLyoqXG4gICAgICogQGZ1bmN0aW9uXG4gICAgICogQG5hbWUgVGV4dHVyZVBhcnNlciNsb2FkXG4gICAgICogQGRlc2NyaXB0aW9uIExvYWQgdGhlIHRleHR1cmUgZnJvbSB0aGUgcmVtb3RlIFVSTC4gV2hlbiBsb2FkZWQgKG9yIGZhaWxlZCksXG4gICAgICogdXNlIHRoZSBjYWxsYmFjayB0byByZXR1cm4gYW4gdGhlIHJhdyByZXNvdXJjZSBkYXRhIChvciBlcnJvcikuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHVybCAtIFRoZSBVUkwgb2YgdGhlIHJlc291cmNlIHRvIGxvYWQuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHVybC5sb2FkIC0gVGhlIFVSTCB0byB1c2UgZm9yIGxvYWRpbmcgdGhlIHJlc291cmNlLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwub3JpZ2luYWwgLSBUaGUgb3JpZ2luYWwgVVJMIHVzZWZ1bCBmb3IgaWRlbnRpZnlpbmcgdGhlIHJlc291cmNlIHR5cGUuXG4gICAgICogQHBhcmFtIHtSZXNvdXJjZUhhbmRsZXJDYWxsYmFja30gY2FsbGJhY2sgLSBUaGUgY2FsbGJhY2sgdXNlZCB3aGVuIHRoZSByZXNvdXJjZSBpcyBsb2FkZWQgb3IgYW4gZXJyb3Igb2NjdXJzLlxuICAgICAqIEBwYXJhbSB7QXNzZXR9IFthc3NldF0gLSBPcHRpb25hbCBhc3NldCB0aGF0IGlzIHBhc3NlZCBieSBSZXNvdXJjZUxvYWRlci5cbiAgICAgKi9cbiAgICBsb2FkKHVybCwgY2FsbGJhY2ssIGFzc2V0KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignbm90IGltcGxlbWVudGVkJyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGZ1bmN0aW9uXG4gICAgICogQG5hbWUgVGV4dHVyZVBhcnNlciNvcGVuXG4gICAgICogQGRlc2NyaXB0aW9uIENvbnZlcnQgcmF3IHJlc291cmNlIGRhdGEgaW50byBhIHJlc291cmNlIGluc3RhbmNlLiBFLmcuIFRha2UgM0QgbW9kZWwgZm9ybWF0IEpTT04gYW5kIHJldHVybiBhIHtAbGluayBNb2RlbH0uXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBVUkwgb2YgdGhlIHJlc291cmNlIHRvIG9wZW4uXG4gICAgICogQHBhcmFtIHsqfSBkYXRhIC0gVGhlIHJhdyByZXNvdXJjZSBkYXRhIHBhc3NlZCBieSBjYWxsYmFjayBmcm9tIHtAbGluayBSZXNvdXJjZUhhbmRsZXIjbG9hZH0uXG4gICAgICogQHBhcmFtIHtHcmFwaGljc0RldmljZX0gZGV2aWNlIC0gVGhlIGdyYXBoaWNzIGRldmljZS5cbiAgICAgKiBAcmV0dXJucyB7VGV4dHVyZX0gVGhlIHBhcnNlZCByZXNvdXJjZSBkYXRhLlxuICAgICAqL1xuICAgIG9wZW4odXJsLCBkYXRhLCBkZXZpY2UpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTtcbiAgICB9XG4gICAgLyogZXNsaW50LWVuYWJsZSBqc2RvYy9yZXF1aXJlLXJldHVybnMtY2hlY2sgKi9cbn1cblxuLy8gSW4gdGhlIGNhc2Ugd2hlcmUgYSB0ZXh0dXJlIGhhcyBtb3JlIHRoYW4gMSBsZXZlbCBvZiBtaXAgZGF0YSBzcGVjaWZpZWQsIGJ1dCBub3QgdGhlIGZ1bGxcbi8vIG1pcCBjaGFpbiwgd2UgZ2VuZXJhdGUgdGhlIG1pc3NpbmcgbGV2ZWxzIGhlcmUuXG4vLyBUaGlzIGlzIHRvIG92ZXJjb21lIGFuIGlzc3VlIHdoZXJlIGlwaG9uZSB4ciBhbmQgeHMgaWdub3JlcyBmdXJ0aGVyIHVwZGF0ZXMgdG8gdGhlIG1pcCBkYXRhXG4vLyBhZnRlciBpbnZva2luZyBnbC5nZW5lcmF0ZU1pcG1hcCBvbiB0aGUgdGV4dHVyZSAod2hpY2ggd2FzIHRoZSBwcmV2aW91cyBtZXRob2Qgb2YgZW5zdXJpbmdcbi8vIHRoZSB0ZXh0dXJlJ3MgZnVsbCBtaXAgY2hhaW4gd2FzIGNvbXBsZXRlKS5cbi8vIE5PVEU6IHRoaXMgZnVuY3Rpb24gb25seSByZXNhbXBsZXMgUkdCQTggYW5kIFJHQkFGbG9hdDMyIGRhdGEuXG5jb25zdCBfY29tcGxldGVQYXJ0aWFsTWlwbWFwQ2hhaW4gPSBmdW5jdGlvbiAodGV4dHVyZSkge1xuXG4gICAgY29uc3QgcmVxdWlyZWRNaXBMZXZlbHMgPSBNYXRoLmxvZzIoTWF0aC5tYXgodGV4dHVyZS5fd2lkdGgsIHRleHR1cmUuX2hlaWdodCkpICsgMTtcblxuICAgIGNvbnN0IGlzSHRtbEVsZW1lbnQgPSBmdW5jdGlvbiAob2JqZWN0KSB7XG4gICAgICAgIHJldHVybiAob2JqZWN0IGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQpIHx8XG4gICAgICAgICAgICAgICAob2JqZWN0IGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudCkgfHxcbiAgICAgICAgICAgICAgIChvYmplY3QgaW5zdGFuY2VvZiBIVE1MVmlkZW9FbGVtZW50KTtcbiAgICB9O1xuXG4gICAgaWYgKCEodGV4dHVyZS5fZm9ybWF0ID09PSBQSVhFTEZPUk1BVF9SOF9HOF9COF9BOCB8fFxuICAgICAgICAgIHRleHR1cmUuX2Zvcm1hdCA9PT0gUElYRUxGT1JNQVRfUkdCQTMyRikgfHxcbiAgICAgICAgICB0ZXh0dXJlLl92b2x1bWUgfHxcbiAgICAgICAgICB0ZXh0dXJlLl9jb21wcmVzc2VkIHx8XG4gICAgICAgICAgdGV4dHVyZS5fbGV2ZWxzLmxlbmd0aCA9PT0gMSB8fFxuICAgICAgICAgIHRleHR1cmUuX2xldmVscy5sZW5ndGggPT09IHJlcXVpcmVkTWlwTGV2ZWxzIHx8XG4gICAgICAgICAgaXNIdG1sRWxlbWVudCh0ZXh0dXJlLl9jdWJlbWFwID8gdGV4dHVyZS5fbGV2ZWxzWzBdWzBdIDogdGV4dHVyZS5fbGV2ZWxzWzBdKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgZG93bnNhbXBsZSA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0LCBkYXRhKSB7XG4gICAgICAgIGNvbnN0IHNhbXBsZWRXaWR0aCA9IE1hdGgubWF4KDEsIHdpZHRoID4+IDEpO1xuICAgICAgICBjb25zdCBzYW1wbGVkSGVpZ2h0ID0gTWF0aC5tYXgoMSwgaGVpZ2h0ID4+IDEpO1xuICAgICAgICBjb25zdCBzYW1wbGVkRGF0YSA9IG5ldyBkYXRhLmNvbnN0cnVjdG9yKHNhbXBsZWRXaWR0aCAqIHNhbXBsZWRIZWlnaHQgKiA0KTtcblxuICAgICAgICBjb25zdCB4cyA9IE1hdGguZmxvb3Iod2lkdGggLyBzYW1wbGVkV2lkdGgpO1xuICAgICAgICBjb25zdCB5cyA9IE1hdGguZmxvb3IoaGVpZ2h0IC8gc2FtcGxlZEhlaWdodCk7XG4gICAgICAgIGNvbnN0IHhzeXMgPSB4cyAqIHlzO1xuXG4gICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgc2FtcGxlZEhlaWdodDsgKyt5KSB7XG4gICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHNhbXBsZWRXaWR0aDsgKyt4KSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgZSA9IDA7IGUgPCA0OyArK2UpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHN1bSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHN5ID0gMDsgc3kgPCB5czsgKytzeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgc3ggPSAwOyBzeCA8IHhzOyArK3N4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VtICs9IGRhdGFbKHggKiB4cyArIHN4ICsgKHkgKiB5cyArIHN5KSAqIHdpZHRoKSAqIDQgKyBlXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzYW1wbGVkRGF0YVsoeCArIHkgKiBzYW1wbGVkV2lkdGgpICogNCArIGVdID0gc3VtIC8geHN5cztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2FtcGxlZERhdGE7XG4gICAgfTtcblxuICAgIC8vIHN0ZXAgdGhyb3VnaCBsZXZlbHNcbiAgICBmb3IgKGxldCBsZXZlbCA9IHRleHR1cmUuX2xldmVscy5sZW5ndGg7IGxldmVsIDwgcmVxdWlyZWRNaXBMZXZlbHM7ICsrbGV2ZWwpIHtcbiAgICAgICAgY29uc3Qgd2lkdGggPSBNYXRoLm1heCgxLCB0ZXh0dXJlLl93aWR0aCA+PiAobGV2ZWwgLSAxKSk7XG4gICAgICAgIGNvbnN0IGhlaWdodCA9IE1hdGgubWF4KDEsIHRleHR1cmUuX2hlaWdodCA+PiAobGV2ZWwgLSAxKSk7XG4gICAgICAgIGlmICh0ZXh0dXJlLl9jdWJlbWFwKSB7XG4gICAgICAgICAgICBjb25zdCBtaXBzID0gW107XG4gICAgICAgICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IDY7ICsrZmFjZSkge1xuICAgICAgICAgICAgICAgIG1pcHMucHVzaChkb3duc2FtcGxlKHdpZHRoLCBoZWlnaHQsIHRleHR1cmUuX2xldmVsc1tsZXZlbCAtIDFdW2ZhY2VdKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0ZXh0dXJlLl9sZXZlbHMucHVzaChtaXBzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRleHR1cmUuX2xldmVscy5wdXNoKGRvd25zYW1wbGUod2lkdGgsIGhlaWdodCwgdGV4dHVyZS5fbGV2ZWxzW2xldmVsIC0gMV0pKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHRleHR1cmUuX2xldmVsc1VwZGF0ZWQgPSB0ZXh0dXJlLl9jdWJlbWFwID8gW1t0cnVlLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlXV0gOiBbdHJ1ZV07XG59O1xuXG4vKipcbiAqIFJlc291cmNlIGhhbmRsZXIgdXNlZCBmb3IgbG9hZGluZyAyRCBhbmQgM0Qge0BsaW5rIFRleHR1cmV9IHJlc291cmNlcy5cbiAqXG4gKiBAaW1wbGVtZW50cyB7UmVzb3VyY2VIYW5kbGVyfVxuICovXG5jbGFzcyBUZXh0dXJlSGFuZGxlciB7XG4gICAgLyoqXG4gICAgICogVHlwZSBvZiB0aGUgcmVzb3VyY2UgdGhlIGhhbmRsZXIgaGFuZGxlcy5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICovXG4gICAgaGFuZGxlclR5cGUgPSBcInRleHR1cmVcIjtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBUZXh0dXJlSGFuZGxlciBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7QXBwQmFzZX0gYXBwIC0gVGhlIHJ1bm5pbmcge0BsaW5rIEFwcEJhc2V9LlxuICAgICAqIEBoaWRlY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihhcHApIHtcbiAgICAgICAgY29uc3QgYXNzZXRzID0gYXBwLmFzc2V0cztcbiAgICAgICAgY29uc3QgZGV2aWNlID0gYXBwLmdyYXBoaWNzRGV2aWNlO1xuXG4gICAgICAgIHRoaXMuX2RldmljZSA9IGRldmljZTtcbiAgICAgICAgdGhpcy5fYXNzZXRzID0gYXNzZXRzO1xuICAgICAgICB0aGlzLl9sb2FkZXIgPSBhcHAubG9hZGVyO1xuXG4gICAgICAgIC8vIGltZyBwYXJzZXIgaGFuZGxlcyBhbGwgYnJvd3Nlci1zdXBwb3J0ZWQgaW1hZ2UgZm9ybWF0cywgdGhpc1xuICAgICAgICAvLyBwYXJzZXIgd2lsbCBiZSB1c2VkIHdoZW4gb3RoZXIgbW9yZSBzcGVjaWZpYyBwYXJzZXJzIGFyZSBub3QgZm91bmQuXG4gICAgICAgIHRoaXMuaW1nUGFyc2VyID0gbmV3IEltZ1BhcnNlcihhc3NldHMsIGRldmljZSk7XG5cbiAgICAgICAgdGhpcy5wYXJzZXJzID0ge1xuICAgICAgICAgICAgZGRzOiBuZXcgRGRzUGFyc2VyKGFzc2V0cyksXG4gICAgICAgICAgICBrdHg6IG5ldyBLdHhQYXJzZXIoYXNzZXRzKSxcbiAgICAgICAgICAgIGt0eDI6IG5ldyBLdHgyUGFyc2VyKGFzc2V0cywgZGV2aWNlKSxcbiAgICAgICAgICAgIGJhc2lzOiBuZXcgQmFzaXNQYXJzZXIoYXNzZXRzLCBkZXZpY2UpLFxuICAgICAgICAgICAgaGRyOiBuZXcgSGRyUGFyc2VyKGFzc2V0cylcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBzZXQgY3Jvc3NPcmlnaW4odmFsdWUpIHtcbiAgICAgICAgdGhpcy5pbWdQYXJzZXIuY3Jvc3NPcmlnaW4gPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBnZXQgY3Jvc3NPcmlnaW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmltZ1BhcnNlci5jcm9zc09yaWdpbjtcbiAgICB9XG5cbiAgICBzZXQgbWF4UmV0cmllcyh2YWx1ZSkge1xuICAgICAgICB0aGlzLmltZ1BhcnNlci5tYXhSZXRyaWVzID0gdmFsdWU7XG4gICAgICAgIGZvciAoY29uc3QgcGFyc2VyIGluIHRoaXMucGFyc2Vycykge1xuICAgICAgICAgICAgaWYgKHRoaXMucGFyc2Vycy5oYXNPd25Qcm9wZXJ0eShwYXJzZXIpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJzZXJzW3BhcnNlcl0ubWF4UmV0cmllcyA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IG1heFJldHJpZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmltZ1BhcnNlci5tYXhSZXRyaWVzO1xuICAgIH1cblxuICAgIF9nZXRVcmxXaXRob3V0UGFyYW1zKHVybCkge1xuICAgICAgICByZXR1cm4gdXJsLmluZGV4T2YoJz8nKSA+PSAwID8gdXJsLnNwbGl0KCc/JylbMF0gOiB1cmw7XG4gICAgfVxuXG4gICAgX2dldFBhcnNlcih1cmwpIHtcbiAgICAgICAgY29uc3QgZXh0ID0gcGF0aC5nZXRFeHRlbnNpb24odGhpcy5fZ2V0VXJsV2l0aG91dFBhcmFtcyh1cmwpKS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoJy4nLCAnJyk7XG4gICAgICAgIHJldHVybiB0aGlzLnBhcnNlcnNbZXh0XSB8fCB0aGlzLmltZ1BhcnNlcjtcbiAgICB9XG5cbiAgICBsb2FkKHVybCwgY2FsbGJhY2ssIGFzc2V0KSB7XG4gICAgICAgIGlmICh0eXBlb2YgdXJsID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdXJsID0ge1xuICAgICAgICAgICAgICAgIGxvYWQ6IHVybCxcbiAgICAgICAgICAgICAgICBvcmlnaW5hbDogdXJsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fZ2V0UGFyc2VyKHVybC5vcmlnaW5hbCkubG9hZCh1cmwsIGNhbGxiYWNrLCBhc3NldCk7XG4gICAgfVxuXG4gICAgb3Blbih1cmwsIGRhdGEsIGFzc2V0KSB7XG4gICAgICAgIGlmICghdXJsKVxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcblxuICAgICAgICBsZXQgdGV4dHVyZSA9IHRoaXMuX2dldFBhcnNlcih1cmwpLm9wZW4odXJsLCBkYXRhLCB0aGlzLl9kZXZpY2UpO1xuXG4gICAgICAgIGlmICh0ZXh0dXJlID09PSBudWxsKSB7XG4gICAgICAgICAgICB0ZXh0dXJlID0gbmV3IFRleHR1cmUodGhpcy5fZGV2aWNlLCB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IDQsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiA0LFxuICAgICAgICAgICAgICAgIGZvcm1hdDogUElYRUxGT1JNQVRfUjhfRzhfQjhcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gY2hlY2sgaWYgdGhlIHRleHR1cmUgaGFzIG9ubHkgYSBwYXJ0aWFsIG1pcG1hcCBjaGFpbiBzcGVjaWZpZWQgYW5kIGdlbmVyYXRlIHRoZVxuICAgICAgICAgICAgLy8gbWlzc2luZyBsZXZlbHMgaWYgcG9zc2libGUuXG4gICAgICAgICAgICBfY29tcGxldGVQYXJ0aWFsTWlwbWFwQ2hhaW4odGV4dHVyZSk7XG5cbiAgICAgICAgICAgIC8vIGlmIHRoZSBiYXNpcyB0cmFuc2NvZGVyIHVuc3dpenpsZWQgYSBHR0dSIHRleHR1cmUsIHJlbW92ZSB0aGUgZmxhZyBmcm9tIHRoZSBhc3NldFxuICAgICAgICAgICAgaWYgKGRhdGEudW5zd2l6emxlZEdHR1IpIHtcbiAgICAgICAgICAgICAgICBhc3NldC5maWxlLnZhcmlhbnRzLmJhc2lzLm9wdCAmPSB+ODtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0ZXh0dXJlO1xuICAgIH1cblxuICAgIHBhdGNoKGFzc2V0LCBhc3NldHMpIHtcbiAgICAgICAgY29uc3QgdGV4dHVyZSA9IGFzc2V0LnJlc291cmNlO1xuICAgICAgICBpZiAoIXRleHR1cmUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhc3NldC5uYW1lICYmIGFzc2V0Lm5hbWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGV4dHVyZS5uYW1lID0gYXNzZXQubmFtZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGFzc2V0RGF0YSA9IGFzc2V0LmRhdGE7XG5cbiAgICAgICAgaWYgKGFzc2V0RGF0YS5oYXNPd25Qcm9wZXJ0eSgnbWluZmlsdGVyJykpIHtcbiAgICAgICAgICAgIHRleHR1cmUubWluRmlsdGVyID0gSlNPTl9GSUxURVJfTU9ERVthc3NldERhdGEubWluZmlsdGVyXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhc3NldERhdGEuaGFzT3duUHJvcGVydHkoJ21hZ2ZpbHRlcicpKSB7XG4gICAgICAgICAgICB0ZXh0dXJlLm1hZ0ZpbHRlciA9IEpTT05fRklMVEVSX01PREVbYXNzZXREYXRhLm1hZ2ZpbHRlcl07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRleHR1cmUuY3ViZW1hcCkge1xuICAgICAgICAgICAgaWYgKGFzc2V0RGF0YS5oYXNPd25Qcm9wZXJ0eSgnYWRkcmVzc3UnKSkge1xuICAgICAgICAgICAgICAgIHRleHR1cmUuYWRkcmVzc1UgPSBKU09OX0FERFJFU1NfTU9ERVthc3NldERhdGEuYWRkcmVzc3VdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYXNzZXREYXRhLmhhc093blByb3BlcnR5KCdhZGRyZXNzdicpKSB7XG4gICAgICAgICAgICAgICAgdGV4dHVyZS5hZGRyZXNzViA9IEpTT05fQUREUkVTU19NT0RFW2Fzc2V0RGF0YS5hZGRyZXNzdl07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYXNzZXREYXRhLmhhc093blByb3BlcnR5KCdtaXBtYXBzJykpIHtcbiAgICAgICAgICAgIHRleHR1cmUubWlwbWFwcyA9IGFzc2V0RGF0YS5taXBtYXBzO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGFzc2V0RGF0YS5oYXNPd25Qcm9wZXJ0eSgnYW5pc290cm9weScpKSB7XG4gICAgICAgICAgICB0ZXh0dXJlLmFuaXNvdHJvcHkgPSBhc3NldERhdGEuYW5pc290cm9weTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhc3NldERhdGEuaGFzT3duUHJvcGVydHkoJ2ZsaXBZJykpIHtcbiAgICAgICAgICAgIHRleHR1cmUuZmxpcFkgPSAhIWFzc2V0RGF0YS5mbGlwWTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGV4dHJhY3QgYXNzZXQgdHlwZSAodGhpcyBpcyBiaXQgb2YgYSBtZXNzKVxuICAgICAgICBpZiAoYXNzZXREYXRhLmhhc093blByb3BlcnR5KCd0eXBlJykpIHtcbiAgICAgICAgICAgIHRleHR1cmUudHlwZSA9IEpTT05fVEVYVFVSRV9UWVBFW2Fzc2V0RGF0YS50eXBlXTtcbiAgICAgICAgfSBlbHNlIGlmIChhc3NldERhdGEuaGFzT3duUHJvcGVydHkoJ3JnYm0nKSAmJiBhc3NldERhdGEucmdibSkge1xuICAgICAgICAgICAgdGV4dHVyZS50eXBlID0gVEVYVFVSRVRZUEVfUkdCTTtcbiAgICAgICAgfSBlbHNlIGlmIChhc3NldC5maWxlICYmIChhc3NldC5maWxlLm9wdCAmIDgpICE9PSAwKSB7XG4gICAgICAgICAgICAvLyBiYXNpcyBub3JtYWxtYXBzIGZsYWcgdGhlIHZhcmlhbnQgYXMgc3dpenpsZWRcbiAgICAgICAgICAgIHRleHR1cmUudHlwZSA9IFRFWFRVUkVUWVBFX1NXSVpaTEVHR0dSO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgeyBUZXh0dXJlSGFuZGxlciwgVGV4dHVyZVBhcnNlciB9O1xuIl0sIm5hbWVzIjpbIkpTT05fQUREUkVTU19NT0RFIiwiQUREUkVTU19SRVBFQVQiLCJBRERSRVNTX0NMQU1QX1RPX0VER0UiLCJBRERSRVNTX01JUlJPUkVEX1JFUEVBVCIsIkpTT05fRklMVEVSX01PREUiLCJGSUxURVJfTkVBUkVTVCIsIkZJTFRFUl9MSU5FQVIiLCJGSUxURVJfTkVBUkVTVF9NSVBNQVBfTkVBUkVTVCIsIkZJTFRFUl9MSU5FQVJfTUlQTUFQX05FQVJFU1QiLCJGSUxURVJfTkVBUkVTVF9NSVBNQVBfTElORUFSIiwiRklMVEVSX0xJTkVBUl9NSVBNQVBfTElORUFSIiwiSlNPTl9URVhUVVJFX1RZUEUiLCJURVhUVVJFVFlQRV9ERUZBVUxUIiwiVEVYVFVSRVRZUEVfUkdCTSIsIlRFWFRVUkVUWVBFX1JHQkUiLCJURVhUVVJFVFlQRV9SR0JQIiwiVEVYVFVSRVRZUEVfU1dJWlpMRUdHR1IiLCJUZXh0dXJlUGFyc2VyIiwibG9hZCIsInVybCIsImNhbGxiYWNrIiwiYXNzZXQiLCJFcnJvciIsIm9wZW4iLCJkYXRhIiwiZGV2aWNlIiwiX2NvbXBsZXRlUGFydGlhbE1pcG1hcENoYWluIiwidGV4dHVyZSIsInJlcXVpcmVkTWlwTGV2ZWxzIiwiTWF0aCIsImxvZzIiLCJtYXgiLCJfd2lkdGgiLCJfaGVpZ2h0IiwiaXNIdG1sRWxlbWVudCIsIm9iamVjdCIsIkhUTUxDYW52YXNFbGVtZW50IiwiSFRNTEltYWdlRWxlbWVudCIsIkhUTUxWaWRlb0VsZW1lbnQiLCJfZm9ybWF0IiwiUElYRUxGT1JNQVRfUjhfRzhfQjhfQTgiLCJQSVhFTEZPUk1BVF9SR0JBMzJGIiwiX3ZvbHVtZSIsIl9jb21wcmVzc2VkIiwiX2xldmVscyIsImxlbmd0aCIsIl9jdWJlbWFwIiwiZG93bnNhbXBsZSIsIndpZHRoIiwiaGVpZ2h0Iiwic2FtcGxlZFdpZHRoIiwic2FtcGxlZEhlaWdodCIsInNhbXBsZWREYXRhIiwiY29uc3RydWN0b3IiLCJ4cyIsImZsb29yIiwieXMiLCJ4c3lzIiwieSIsIngiLCJlIiwic3VtIiwic3kiLCJzeCIsImxldmVsIiwibWlwcyIsImZhY2UiLCJwdXNoIiwiX2xldmVsc1VwZGF0ZWQiLCJUZXh0dXJlSGFuZGxlciIsImFwcCIsImhhbmRsZXJUeXBlIiwiYXNzZXRzIiwiZ3JhcGhpY3NEZXZpY2UiLCJfZGV2aWNlIiwiX2Fzc2V0cyIsIl9sb2FkZXIiLCJsb2FkZXIiLCJpbWdQYXJzZXIiLCJJbWdQYXJzZXIiLCJwYXJzZXJzIiwiZGRzIiwiRGRzUGFyc2VyIiwia3R4IiwiS3R4UGFyc2VyIiwia3R4MiIsIkt0eDJQYXJzZXIiLCJiYXNpcyIsIkJhc2lzUGFyc2VyIiwiaGRyIiwiSGRyUGFyc2VyIiwiY3Jvc3NPcmlnaW4iLCJ2YWx1ZSIsIm1heFJldHJpZXMiLCJwYXJzZXIiLCJoYXNPd25Qcm9wZXJ0eSIsIl9nZXRVcmxXaXRob3V0UGFyYW1zIiwiaW5kZXhPZiIsInNwbGl0IiwiX2dldFBhcnNlciIsImV4dCIsInBhdGgiLCJnZXRFeHRlbnNpb24iLCJ0b0xvd2VyQ2FzZSIsInJlcGxhY2UiLCJvcmlnaW5hbCIsInVuZGVmaW5lZCIsIlRleHR1cmUiLCJmb3JtYXQiLCJQSVhFTEZPUk1BVF9SOF9HOF9COCIsInVuc3dpenpsZWRHR0dSIiwiZmlsZSIsInZhcmlhbnRzIiwib3B0IiwicGF0Y2giLCJyZXNvdXJjZSIsIm5hbWUiLCJhc3NldERhdGEiLCJtaW5GaWx0ZXIiLCJtaW5maWx0ZXIiLCJtYWdGaWx0ZXIiLCJtYWdmaWx0ZXIiLCJjdWJlbWFwIiwiYWRkcmVzc1UiLCJhZGRyZXNzdSIsImFkZHJlc3NWIiwiYWRkcmVzc3YiLCJtaXBtYXBzIiwiYW5pc290cm9weSIsImZsaXBZIiwidHlwZSIsInJnYm0iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQXNCQSxNQUFNQSxpQkFBaUIsR0FBRztBQUN0QixFQUFBLFFBQUEsRUFBVUMsY0FEWTtBQUV0QixFQUFBLE9BQUEsRUFBU0MscUJBRmE7RUFHdEIsUUFBVUMsRUFBQUEsdUJBQUFBO0FBSFksQ0FBMUIsQ0FBQTtBQU1BLE1BQU1DLGdCQUFnQixHQUFHO0FBQ3JCLEVBQUEsU0FBQSxFQUFXQyxjQURVO0FBRXJCLEVBQUEsUUFBQSxFQUFVQyxhQUZXO0FBR3JCLEVBQUEscUJBQUEsRUFBdUJDLDZCQUhGO0FBSXJCLEVBQUEsb0JBQUEsRUFBc0JDLDRCQUpEO0FBS3JCLEVBQUEsb0JBQUEsRUFBc0JDLDRCQUxEO0VBTXJCLG1CQUFxQkMsRUFBQUEsMkJBQUFBO0FBTkEsQ0FBekIsQ0FBQTtBQVNBLE1BQU1DLGlCQUFpQixHQUFHO0FBQ3RCLEVBQUEsU0FBQSxFQUFXQyxtQkFEVztBQUV0QixFQUFBLE1BQUEsRUFBUUMsZ0JBRmM7QUFHdEIsRUFBQSxNQUFBLEVBQVFDLGdCQUhjO0FBSXRCLEVBQUEsTUFBQSxFQUFRQyxnQkFKYztFQUt0QixhQUFlQyxFQUFBQSx1QkFBQUE7QUFMTyxDQUExQixDQUFBOztBQWNBLE1BQU1DLGFBQU4sQ0FBb0I7QUFhaEJDLEVBQUFBLElBQUksQ0FBQ0MsR0FBRCxFQUFNQyxRQUFOLEVBQWdCQyxLQUFoQixFQUF1QjtBQUN2QixJQUFBLE1BQU0sSUFBSUMsS0FBSixDQUFVLGlCQUFWLENBQU4sQ0FBQTtBQUNILEdBQUE7O0FBV0RDLEVBQUFBLElBQUksQ0FBQ0osR0FBRCxFQUFNSyxJQUFOLEVBQVlDLE1BQVosRUFBb0I7QUFDcEIsSUFBQSxNQUFNLElBQUlILEtBQUosQ0FBVSxpQkFBVixDQUFOLENBQUE7QUFDSCxHQUFBOztBQTVCZSxDQUFBOztBQXNDcEIsTUFBTUksMkJBQTJCLEdBQUcsU0FBOUJBLDJCQUE4QixDQUFVQyxPQUFWLEVBQW1CO0FBRW5ELEVBQUEsTUFBTUMsaUJBQWlCLEdBQUdDLElBQUksQ0FBQ0MsSUFBTCxDQUFVRCxJQUFJLENBQUNFLEdBQUwsQ0FBU0osT0FBTyxDQUFDSyxNQUFqQixFQUF5QkwsT0FBTyxDQUFDTSxPQUFqQyxDQUFWLElBQXVELENBQWpGLENBQUE7O0FBRUEsRUFBQSxNQUFNQyxhQUFhLEdBQUcsU0FBaEJBLGFBQWdCLENBQVVDLE1BQVYsRUFBa0I7SUFDcEMsT0FBUUEsTUFBTSxZQUFZQyxpQkFBbkIsSUFDQ0QsTUFBTSxZQUFZRSxnQkFEbkIsSUFFQ0YsTUFBTSxZQUFZRyxnQkFGMUIsQ0FBQTtHQURKLENBQUE7O0VBTUEsSUFBSSxFQUFFWCxPQUFPLENBQUNZLE9BQVIsS0FBb0JDLHVCQUFwQixJQUNBYixPQUFPLENBQUNZLE9BQVIsS0FBb0JFLG1CQUR0QixDQUFBLElBRUVkLE9BQU8sQ0FBQ2UsT0FGVixJQUdFZixPQUFPLENBQUNnQixXQUhWLElBSUVoQixPQUFPLENBQUNpQixPQUFSLENBQWdCQyxNQUFoQixLQUEyQixDQUo3QixJQUtFbEIsT0FBTyxDQUFDaUIsT0FBUixDQUFnQkMsTUFBaEIsS0FBMkJqQixpQkFMN0IsSUFNRU0sYUFBYSxDQUFDUCxPQUFPLENBQUNtQixRQUFSLEdBQW1CbkIsT0FBTyxDQUFDaUIsT0FBUixDQUFnQixDQUFoQixDQUFBLENBQW1CLENBQW5CLENBQW5CLEdBQTJDakIsT0FBTyxDQUFDaUIsT0FBUixDQUFnQixDQUFoQixDQUE1QyxDQU5uQixFQU1vRjtBQUNoRixJQUFBLE9BQUE7QUFDSCxHQUFBOztFQUVELE1BQU1HLFVBQVUsR0FBRyxTQUFiQSxVQUFhLENBQVVDLEtBQVYsRUFBaUJDLE1BQWpCLEVBQXlCekIsSUFBekIsRUFBK0I7SUFDOUMsTUFBTTBCLFlBQVksR0FBR3JCLElBQUksQ0FBQ0UsR0FBTCxDQUFTLENBQVQsRUFBWWlCLEtBQUssSUFBSSxDQUFyQixDQUFyQixDQUFBO0lBQ0EsTUFBTUcsYUFBYSxHQUFHdEIsSUFBSSxDQUFDRSxHQUFMLENBQVMsQ0FBVCxFQUFZa0IsTUFBTSxJQUFJLENBQXRCLENBQXRCLENBQUE7QUFDQSxJQUFBLE1BQU1HLFdBQVcsR0FBRyxJQUFJNUIsSUFBSSxDQUFDNkIsV0FBVCxDQUFxQkgsWUFBWSxHQUFHQyxhQUFmLEdBQStCLENBQXBELENBQXBCLENBQUE7SUFFQSxNQUFNRyxFQUFFLEdBQUd6QixJQUFJLENBQUMwQixLQUFMLENBQVdQLEtBQUssR0FBR0UsWUFBbkIsQ0FBWCxDQUFBO0lBQ0EsTUFBTU0sRUFBRSxHQUFHM0IsSUFBSSxDQUFDMEIsS0FBTCxDQUFXTixNQUFNLEdBQUdFLGFBQXBCLENBQVgsQ0FBQTtBQUNBLElBQUEsTUFBTU0sSUFBSSxHQUFHSCxFQUFFLEdBQUdFLEVBQWxCLENBQUE7O0lBRUEsS0FBSyxJQUFJRSxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHUCxhQUFwQixFQUFtQyxFQUFFTyxDQUFyQyxFQUF3QztNQUNwQyxLQUFLLElBQUlDLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdULFlBQXBCLEVBQWtDLEVBQUVTLENBQXBDLEVBQXVDO1FBQ25DLEtBQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBRyxDQUFwQixFQUF1QixFQUFFQSxDQUF6QixFQUE0QjtVQUN4QixJQUFJQyxHQUFHLEdBQUcsQ0FBVixDQUFBOztVQUNBLEtBQUssSUFBSUMsRUFBRSxHQUFHLENBQWQsRUFBaUJBLEVBQUUsR0FBR04sRUFBdEIsRUFBMEIsRUFBRU0sRUFBNUIsRUFBZ0M7WUFDNUIsS0FBSyxJQUFJQyxFQUFFLEdBQUcsQ0FBZCxFQUFpQkEsRUFBRSxHQUFHVCxFQUF0QixFQUEwQixFQUFFUyxFQUE1QixFQUFnQztjQUM1QkYsR0FBRyxJQUFJckMsSUFBSSxDQUFDLENBQUNtQyxDQUFDLEdBQUdMLEVBQUosR0FBU1MsRUFBVCxHQUFjLENBQUNMLENBQUMsR0FBR0YsRUFBSixHQUFTTSxFQUFWLElBQWdCZCxLQUEvQixJQUF3QyxDQUF4QyxHQUE0Q1ksQ0FBN0MsQ0FBWCxDQUFBO0FBQ0gsYUFBQTtBQUNKLFdBQUE7O0FBQ0RSLFVBQUFBLFdBQVcsQ0FBQyxDQUFDTyxDQUFDLEdBQUdELENBQUMsR0FBR1IsWUFBVCxJQUF5QixDQUF6QixHQUE2QlUsQ0FBOUIsQ0FBWCxHQUE4Q0MsR0FBRyxHQUFHSixJQUFwRCxDQUFBO0FBQ0gsU0FBQTtBQUNKLE9BQUE7QUFDSixLQUFBOztBQUVELElBQUEsT0FBT0wsV0FBUCxDQUFBO0dBdkJKLENBQUE7O0FBMkJBLEVBQUEsS0FBSyxJQUFJWSxLQUFLLEdBQUdyQyxPQUFPLENBQUNpQixPQUFSLENBQWdCQyxNQUFqQyxFQUF5Q21CLEtBQUssR0FBR3BDLGlCQUFqRCxFQUFvRSxFQUFFb0MsS0FBdEUsRUFBNkU7QUFDekUsSUFBQSxNQUFNaEIsS0FBSyxHQUFHbkIsSUFBSSxDQUFDRSxHQUFMLENBQVMsQ0FBVCxFQUFZSixPQUFPLENBQUNLLE1BQVIsSUFBbUJnQyxLQUFLLEdBQUcsQ0FBdkMsQ0FBZCxDQUFBO0FBQ0EsSUFBQSxNQUFNZixNQUFNLEdBQUdwQixJQUFJLENBQUNFLEdBQUwsQ0FBUyxDQUFULEVBQVlKLE9BQU8sQ0FBQ00sT0FBUixJQUFvQitCLEtBQUssR0FBRyxDQUF4QyxDQUFmLENBQUE7O0lBQ0EsSUFBSXJDLE9BQU8sQ0FBQ21CLFFBQVosRUFBc0I7TUFDbEIsTUFBTW1CLElBQUksR0FBRyxFQUFiLENBQUE7O01BQ0EsS0FBSyxJQUFJQyxJQUFJLEdBQUcsQ0FBaEIsRUFBbUJBLElBQUksR0FBRyxDQUExQixFQUE2QixFQUFFQSxJQUEvQixFQUFxQztBQUNqQ0QsUUFBQUEsSUFBSSxDQUFDRSxJQUFMLENBQVVwQixVQUFVLENBQUNDLEtBQUQsRUFBUUMsTUFBUixFQUFnQnRCLE9BQU8sQ0FBQ2lCLE9BQVIsQ0FBZ0JvQixLQUFLLEdBQUcsQ0FBeEIsQ0FBMkJFLENBQUFBLElBQTNCLENBQWhCLENBQXBCLENBQUEsQ0FBQTtBQUNILE9BQUE7O0FBQ0R2QyxNQUFBQSxPQUFPLENBQUNpQixPQUFSLENBQWdCdUIsSUFBaEIsQ0FBcUJGLElBQXJCLENBQUEsQ0FBQTtBQUNILEtBTkQsTUFNTztBQUNIdEMsTUFBQUEsT0FBTyxDQUFDaUIsT0FBUixDQUFnQnVCLElBQWhCLENBQXFCcEIsVUFBVSxDQUFDQyxLQUFELEVBQVFDLE1BQVIsRUFBZ0J0QixPQUFPLENBQUNpQixPQUFSLENBQWdCb0IsS0FBSyxHQUFHLENBQXhCLENBQWhCLENBQS9CLENBQUEsQ0FBQTtBQUNILEtBQUE7QUFDSixHQUFBOztFQUVEckMsT0FBTyxDQUFDeUMsY0FBUixHQUF5QnpDLE9BQU8sQ0FBQ21CLFFBQVIsR0FBbUIsQ0FBQyxDQUFDLElBQUQsRUFBTyxJQUFQLEVBQWEsSUFBYixFQUFtQixJQUFuQixFQUF5QixJQUF6QixFQUErQixJQUEvQixDQUFELENBQW5CLEdBQTRELENBQUMsSUFBRCxDQUFyRixDQUFBO0FBQ0gsQ0E5REQsQ0FBQTs7QUFxRUEsTUFBTXVCLGNBQU4sQ0FBcUI7RUFjakJoQixXQUFXLENBQUNpQixHQUFELEVBQU07SUFBQSxJQVJqQkMsQ0FBQUEsV0FRaUIsR0FSSCxTQVFHLENBQUE7QUFDYixJQUFBLE1BQU1DLE1BQU0sR0FBR0YsR0FBRyxDQUFDRSxNQUFuQixDQUFBO0FBQ0EsSUFBQSxNQUFNL0MsTUFBTSxHQUFHNkMsR0FBRyxDQUFDRyxjQUFuQixDQUFBO0lBRUEsSUFBS0MsQ0FBQUEsT0FBTCxHQUFlakQsTUFBZixDQUFBO0lBQ0EsSUFBS2tELENBQUFBLE9BQUwsR0FBZUgsTUFBZixDQUFBO0FBQ0EsSUFBQSxJQUFBLENBQUtJLE9BQUwsR0FBZU4sR0FBRyxDQUFDTyxNQUFuQixDQUFBO0lBSUEsSUFBS0MsQ0FBQUEsU0FBTCxHQUFpQixJQUFJQyxTQUFKLENBQWNQLE1BQWQsRUFBc0IvQyxNQUF0QixDQUFqQixDQUFBO0FBRUEsSUFBQSxJQUFBLENBQUt1RCxPQUFMLEdBQWU7QUFDWEMsTUFBQUEsR0FBRyxFQUFFLElBQUlDLFNBQUosQ0FBY1YsTUFBZCxDQURNO0FBRVhXLE1BQUFBLEdBQUcsRUFBRSxJQUFJQyxTQUFKLENBQWNaLE1BQWQsQ0FGTTtBQUdYYSxNQUFBQSxJQUFJLEVBQUUsSUFBSUMsVUFBSixDQUFlZCxNQUFmLEVBQXVCL0MsTUFBdkIsQ0FISztBQUlYOEQsTUFBQUEsS0FBSyxFQUFFLElBQUlDLFdBQUosQ0FBZ0JoQixNQUFoQixFQUF3Qi9DLE1BQXhCLENBSkk7QUFLWGdFLE1BQUFBLEdBQUcsRUFBRSxJQUFJQyxTQUFKLENBQWNsQixNQUFkLENBQUE7S0FMVCxDQUFBO0FBT0gsR0FBQTs7RUFFYyxJQUFYbUIsV0FBVyxDQUFDQyxLQUFELEVBQVE7QUFDbkIsSUFBQSxJQUFBLENBQUtkLFNBQUwsQ0FBZWEsV0FBZixHQUE2QkMsS0FBN0IsQ0FBQTtBQUNILEdBQUE7O0FBRWMsRUFBQSxJQUFYRCxXQUFXLEdBQUc7SUFDZCxPQUFPLElBQUEsQ0FBS2IsU0FBTCxDQUFlYSxXQUF0QixDQUFBO0FBQ0gsR0FBQTs7RUFFYSxJQUFWRSxVQUFVLENBQUNELEtBQUQsRUFBUTtBQUNsQixJQUFBLElBQUEsQ0FBS2QsU0FBTCxDQUFlZSxVQUFmLEdBQTRCRCxLQUE1QixDQUFBOztBQUNBLElBQUEsS0FBSyxNQUFNRSxNQUFYLElBQXFCLElBQUEsQ0FBS2QsT0FBMUIsRUFBbUM7QUFDL0IsTUFBQSxJQUFJLEtBQUtBLE9BQUwsQ0FBYWUsY0FBYixDQUE0QkQsTUFBNUIsQ0FBSixFQUF5QztBQUNyQyxRQUFBLElBQUEsQ0FBS2QsT0FBTCxDQUFhYyxNQUFiLENBQXFCRCxDQUFBQSxVQUFyQixHQUFrQ0QsS0FBbEMsQ0FBQTtBQUNILE9BQUE7QUFDSixLQUFBO0FBQ0osR0FBQTs7QUFFYSxFQUFBLElBQVZDLFVBQVUsR0FBRztJQUNiLE9BQU8sSUFBQSxDQUFLZixTQUFMLENBQWVlLFVBQXRCLENBQUE7QUFDSCxHQUFBOztFQUVERyxvQkFBb0IsQ0FBQzdFLEdBQUQsRUFBTTtBQUN0QixJQUFBLE9BQU9BLEdBQUcsQ0FBQzhFLE9BQUosQ0FBWSxHQUFaLEtBQW9CLENBQXBCLEdBQXdCOUUsR0FBRyxDQUFDK0UsS0FBSixDQUFVLEdBQVYsRUFBZSxDQUFmLENBQXhCLEdBQTRDL0UsR0FBbkQsQ0FBQTtBQUNILEdBQUE7O0VBRURnRixVQUFVLENBQUNoRixHQUFELEVBQU07QUFDWixJQUFBLE1BQU1pRixHQUFHLEdBQUdDLElBQUksQ0FBQ0MsWUFBTCxDQUFrQixLQUFLTixvQkFBTCxDQUEwQjdFLEdBQTFCLENBQWxCLENBQUEsQ0FBa0RvRixXQUFsRCxFQUFnRUMsQ0FBQUEsT0FBaEUsQ0FBd0UsR0FBeEUsRUFBNkUsRUFBN0UsQ0FBWixDQUFBO0FBQ0EsSUFBQSxPQUFPLEtBQUt4QixPQUFMLENBQWFvQixHQUFiLENBQUEsSUFBcUIsS0FBS3RCLFNBQWpDLENBQUE7QUFDSCxHQUFBOztBQUVENUQsRUFBQUEsSUFBSSxDQUFDQyxHQUFELEVBQU1DLFFBQU4sRUFBZ0JDLEtBQWhCLEVBQXVCO0FBQ3ZCLElBQUEsSUFBSSxPQUFPRixHQUFQLEtBQWUsUUFBbkIsRUFBNkI7QUFDekJBLE1BQUFBLEdBQUcsR0FBRztBQUNGRCxRQUFBQSxJQUFJLEVBQUVDLEdBREo7QUFFRnNGLFFBQUFBLFFBQVEsRUFBRXRGLEdBQUFBO09BRmQsQ0FBQTtBQUlILEtBQUE7O0FBRUQsSUFBQSxJQUFBLENBQUtnRixVQUFMLENBQWdCaEYsR0FBRyxDQUFDc0YsUUFBcEIsQ0FBQSxDQUE4QnZGLElBQTlCLENBQW1DQyxHQUFuQyxFQUF3Q0MsUUFBeEMsRUFBa0RDLEtBQWxELENBQUEsQ0FBQTtBQUNILEdBQUE7O0FBRURFLEVBQUFBLElBQUksQ0FBQ0osR0FBRCxFQUFNSyxJQUFOLEVBQVlILEtBQVosRUFBbUI7QUFDbkIsSUFBQSxJQUFJLENBQUNGLEdBQUwsRUFDSSxPQUFPdUYsU0FBUCxDQUFBOztBQUVKLElBQUEsSUFBSS9FLE9BQU8sR0FBRyxJQUFLd0UsQ0FBQUEsVUFBTCxDQUFnQmhGLEdBQWhCLENBQUEsQ0FBcUJJLElBQXJCLENBQTBCSixHQUExQixFQUErQkssSUFBL0IsRUFBcUMsSUFBQSxDQUFLa0QsT0FBMUMsQ0FBZCxDQUFBOztJQUVBLElBQUkvQyxPQUFPLEtBQUssSUFBaEIsRUFBc0I7QUFDbEJBLE1BQUFBLE9BQU8sR0FBRyxJQUFJZ0YsT0FBSixDQUFZLElBQUEsQ0FBS2pDLE9BQWpCLEVBQTBCO0FBQ2hDMUIsUUFBQUEsS0FBSyxFQUFFLENBRHlCO0FBRWhDQyxRQUFBQSxNQUFNLEVBQUUsQ0FGd0I7QUFHaEMyRCxRQUFBQSxNQUFNLEVBQUVDLG9CQUFBQTtBQUh3QixPQUExQixDQUFWLENBQUE7QUFLSCxLQU5ELE1BTU87TUFHSG5GLDJCQUEyQixDQUFDQyxPQUFELENBQTNCLENBQUE7O01BR0EsSUFBSUgsSUFBSSxDQUFDc0YsY0FBVCxFQUF5QjtRQUNyQnpGLEtBQUssQ0FBQzBGLElBQU4sQ0FBV0MsUUFBWCxDQUFvQnpCLEtBQXBCLENBQTBCMEIsR0FBMUIsSUFBaUMsQ0FBQyxDQUFsQyxDQUFBO0FBQ0gsT0FBQTtBQUNKLEtBQUE7O0FBRUQsSUFBQSxPQUFPdEYsT0FBUCxDQUFBO0FBQ0gsR0FBQTs7QUFFRHVGLEVBQUFBLEtBQUssQ0FBQzdGLEtBQUQsRUFBUW1ELE1BQVIsRUFBZ0I7QUFDakIsSUFBQSxNQUFNN0MsT0FBTyxHQUFHTixLQUFLLENBQUM4RixRQUF0QixDQUFBOztJQUNBLElBQUksQ0FBQ3hGLE9BQUwsRUFBYztBQUNWLE1BQUEsT0FBQTtBQUNILEtBQUE7O0lBRUQsSUFBSU4sS0FBSyxDQUFDK0YsSUFBTixJQUFjL0YsS0FBSyxDQUFDK0YsSUFBTixDQUFXdkUsTUFBWCxHQUFvQixDQUF0QyxFQUF5QztBQUNyQ2xCLE1BQUFBLE9BQU8sQ0FBQ3lGLElBQVIsR0FBZS9GLEtBQUssQ0FBQytGLElBQXJCLENBQUE7QUFDSCxLQUFBOztBQUVELElBQUEsTUFBTUMsU0FBUyxHQUFHaEcsS0FBSyxDQUFDRyxJQUF4QixDQUFBOztBQUVBLElBQUEsSUFBSTZGLFNBQVMsQ0FBQ3RCLGNBQVYsQ0FBeUIsV0FBekIsQ0FBSixFQUEyQztNQUN2Q3BFLE9BQU8sQ0FBQzJGLFNBQVIsR0FBb0JsSCxnQkFBZ0IsQ0FBQ2lILFNBQVMsQ0FBQ0UsU0FBWCxDQUFwQyxDQUFBO0FBQ0gsS0FBQTs7QUFFRCxJQUFBLElBQUlGLFNBQVMsQ0FBQ3RCLGNBQVYsQ0FBeUIsV0FBekIsQ0FBSixFQUEyQztNQUN2Q3BFLE9BQU8sQ0FBQzZGLFNBQVIsR0FBb0JwSCxnQkFBZ0IsQ0FBQ2lILFNBQVMsQ0FBQ0ksU0FBWCxDQUFwQyxDQUFBO0FBQ0gsS0FBQTs7QUFFRCxJQUFBLElBQUksQ0FBQzlGLE9BQU8sQ0FBQytGLE9BQWIsRUFBc0I7QUFDbEIsTUFBQSxJQUFJTCxTQUFTLENBQUN0QixjQUFWLENBQXlCLFVBQXpCLENBQUosRUFBMEM7UUFDdENwRSxPQUFPLENBQUNnRyxRQUFSLEdBQW1CM0gsaUJBQWlCLENBQUNxSCxTQUFTLENBQUNPLFFBQVgsQ0FBcEMsQ0FBQTtBQUNILE9BQUE7O0FBRUQsTUFBQSxJQUFJUCxTQUFTLENBQUN0QixjQUFWLENBQXlCLFVBQXpCLENBQUosRUFBMEM7UUFDdENwRSxPQUFPLENBQUNrRyxRQUFSLEdBQW1CN0gsaUJBQWlCLENBQUNxSCxTQUFTLENBQUNTLFFBQVgsQ0FBcEMsQ0FBQTtBQUNILE9BQUE7QUFDSixLQUFBOztBQUVELElBQUEsSUFBSVQsU0FBUyxDQUFDdEIsY0FBVixDQUF5QixTQUF6QixDQUFKLEVBQXlDO0FBQ3JDcEUsTUFBQUEsT0FBTyxDQUFDb0csT0FBUixHQUFrQlYsU0FBUyxDQUFDVSxPQUE1QixDQUFBO0FBQ0gsS0FBQTs7QUFFRCxJQUFBLElBQUlWLFNBQVMsQ0FBQ3RCLGNBQVYsQ0FBeUIsWUFBekIsQ0FBSixFQUE0QztBQUN4Q3BFLE1BQUFBLE9BQU8sQ0FBQ3FHLFVBQVIsR0FBcUJYLFNBQVMsQ0FBQ1csVUFBL0IsQ0FBQTtBQUNILEtBQUE7O0FBRUQsSUFBQSxJQUFJWCxTQUFTLENBQUN0QixjQUFWLENBQXlCLE9BQXpCLENBQUosRUFBdUM7QUFDbkNwRSxNQUFBQSxPQUFPLENBQUNzRyxLQUFSLEdBQWdCLENBQUMsQ0FBQ1osU0FBUyxDQUFDWSxLQUE1QixDQUFBO0FBQ0gsS0FBQTs7QUFHRCxJQUFBLElBQUlaLFNBQVMsQ0FBQ3RCLGNBQVYsQ0FBeUIsTUFBekIsQ0FBSixFQUFzQztNQUNsQ3BFLE9BQU8sQ0FBQ3VHLElBQVIsR0FBZXZILGlCQUFpQixDQUFDMEcsU0FBUyxDQUFDYSxJQUFYLENBQWhDLENBQUE7S0FESixNQUVPLElBQUliLFNBQVMsQ0FBQ3RCLGNBQVYsQ0FBeUIsTUFBekIsQ0FBb0NzQixJQUFBQSxTQUFTLENBQUNjLElBQWxELEVBQXdEO01BQzNEeEcsT0FBTyxDQUFDdUcsSUFBUixHQUFlckgsZ0JBQWYsQ0FBQTtBQUNILEtBRk0sTUFFQSxJQUFJUSxLQUFLLENBQUMwRixJQUFOLElBQWMsQ0FBQzFGLEtBQUssQ0FBQzBGLElBQU4sQ0FBV0UsR0FBWCxHQUFpQixDQUFsQixNQUF5QixDQUEzQyxFQUE4QztNQUVqRHRGLE9BQU8sQ0FBQ3VHLElBQVIsR0FBZWxILHVCQUFmLENBQUE7QUFDSCxLQUFBO0FBQ0osR0FBQTs7QUF6SmdCOzs7OyJ9
