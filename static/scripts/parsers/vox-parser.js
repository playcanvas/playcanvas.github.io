/*! For license information please see vox-parser.js.LICENSE.txt */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).VoxParser={})}(this,(function(t){"use strict";function i(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function n(t,n,e){return n&&i(t.prototype,n),e&&i(t,e),t}function e(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i)}function s(t,i){return s=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t},s(t,i)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var r=function(){function t(){this.initEventHandler()}var i=t.prototype;return i.initEventHandler=function(){this._callbacks={},this._callbackActive={}},i._addCallback=function(t,i,n,e){void 0===e&&(e=!1),t&&"string"==typeof t&&i&&(this._callbacks[t]||(this._callbacks[t]=[]),this._callbackActive[t]&&this._callbackActive[t]===this._callbacks[t]&&(this._callbackActive[t]=this._callbackActive[t].slice()),this._callbacks[t].push({callback:i,scope:n||this,once:e}))},i.on=function(t,i,n){return this._addCallback(t,i,n,!1),this},i.off=function(t,i,n){if(t)this._callbackActive[t]&&this._callbackActive[t]===this._callbacks[t]&&(this._callbackActive[t]=this._callbackActive[t].slice());else for(var e in this._callbackActive)this._callbacks[e]&&this._callbacks[e]===this._callbackActive[e]&&(this._callbackActive[e]=this._callbackActive[e].slice());if(t)if(i){var s=this._callbacks[t];if(!s)return this;for(var h=s.length,r=0;r<h;r++)s[r].callback===i&&(n&&s[r].scope!==n||(s[r--]=s[--h]));s.length=h}else this._callbacks[t]&&(this._callbacks[t]=[]);else this._callbacks={};return this},i.fire=function(t,i,n,e,s,h,r,a,o){if(!t||!this._callbacks[t])return this;var c;this._callbackActive[t]?(this._callbackActive[t]===this._callbacks[t]&&(this._callbackActive[t]=this._callbackActive[t].slice()),c=this._callbacks[t].slice()):this._callbackActive[t]=this._callbacks[t];for(var u=0;(c||this._callbackActive[t])&&u<(c||this._callbackActive[t]).length;u++){var l=(c||this._callbackActive[t])[u];if(l.callback.call(l.scope,i,n,e,s,h,r,a,o),l.once){var f=this._callbacks[t],y=f?f.indexOf(l):-1;-1!==y&&(this._callbackActive[t]===f&&(this._callbackActive[t]=this._callbackActive[t].slice()),this._callbacks[t].splice(y,1))}}return c||(this._callbackActive[t]=null),this},i.once=function(t,i,n){return this._addCallback(t,i,n,!0),this},i.hasEvent=function(t){return this._callbacks[t]&&0!==this._callbacks[t].length||!1},t}(),a=function(t){function i(i,n){var e;return(e=t.call(this)||this).system=i,e.entity=n,e.system.schema&&!e._accessorsBuilt&&e.buildAccessors(e.system.schema),e.on("set",(function(t,i,n){this.fire("set_"+t,t,i,n)})),e.on("set_enabled",e.onSetEnabled,h(e)),e}e(i,t),i._buildAccessors=function(t,i){i.forEach((function(i){var n="object"==typeof i?i.name:i;Object.defineProperty(t,n,{get:function(){return this.data[n]},set:function(t){var i=this.data,e=i[n];i[n]=t,this.fire("set",n,e,t)},configurable:!0})})),t._accessorsBuilt=!0};var s=i.prototype;return s.buildAccessors=function(t){i._buildAccessors(this,t)},s.onSetEnabled=function(t,i,n){i!==n&&this.entity.enabled&&(n?this.onEnable():this.onDisable())},s.onEnable=function(){},s.onDisable=function(){},s.onPostStateChange=function(){},n(i,[{key:"data",get:function(){var t=this.system.store[this.entity.getGuid()];return t?t.data:null}}]),i}(r),o={attach:function(t){var i=o;return t._addCallback=i._addCallback,t.on=i.on,t.off=i.off,t.fire=i.fire,t.once=i.once,t.hasEvent=i.hasEvent,t._callbacks={},t._callbackActive={},t},_addCallback:r.prototype._addCallback,on:r.prototype.on,off:r.prototype.off,fire:r.prototype.fire,once:r.prototype.once,hasEvent:r.prototype.hasEvent},c={DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,clamp:function(t,i,n){return t>=n?n:t<=i?i:t},intToBytes24:function(t){return[t>>16&255,t>>8&255,255&t]},intToBytes32:function(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]},bytesToInt24:function(t,i,n){return t.length&&(n=t[2],i=t[1],t=t[0]),t<<16|i<<8|n},bytesToInt32:function(t,i,n,e){return t.length&&(e=t[3],n=t[2],i=t[1],t=t[0]),(t<<24|i<<16|n<<8|e)>>>32},lerp:function(t,i,n){return t+(i-t)*c.clamp(n,0,1)},lerpAngle:function(t,i,n){return i-t>180&&(i-=360),i-t<-180&&(i+=360),c.lerp(t,i,c.clamp(n,0,1))},powerOfTwo:function(t){return 0!==t&&!(t&t-1)},nextPowerOfTwo:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},random:function(t,i){var n=i-t;return Math.random()*n+t},smoothstep:function(t,i,n){return n<=t?0:n>=i?1:(n=(n-t)/(i-t))*n*(3-2*n)},smootherstep:function(t,i,n){return n<=t?0:n>=i?1:(n=(n-t)/(i-t))*n*n*(n*(6*n-15)+10)},roundUp:function(t,i){return 0===i?t:Math.ceil(t/i)*i},between:function(t,i,n,e){var s=Math.min(i,n),h=Math.max(i,n);return e?t>=s&&t<=h:t>s&&t<h}},u=function(){function t(t,i,n,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=1);var s=t.length;3===s||4===s?(this.r=t[0],this.g=t[1],this.b=t[2],this.a=void 0!==t[3]?t[3]:1):(this.r=t,this.g=i,this.b=n,this.a=e)}var i=t.prototype;return i.clone=function(){return new t(this.r,this.g,this.b,this.a)},i.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},i.equals=function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},i.set=function(t,i,n,e){return void 0===e&&(e=1),this.r=t,this.g=i,this.b=n,this.a=e,this},i.lerp=function(t,i,n){return this.r=t.r+n*(i.r-t.r),this.g=t.g+n*(i.g-t.g),this.b=t.b+n*(i.b-t.b),this.a=t.a+n*(i.a-t.a),this},i.fromString=function(t){var i,n=parseInt(t.replace("#","0x"),16);return t.length>7?i=c.intToBytes32(n):(i=c.intToBytes24(n))[3]=255,this.set(i[0]/255,i[1]/255,i[2]/255,i[3]/255),this},i.toString=function(t){var i="#"+((1<<24)+(Math.round(255*this.r)<<16)+(Math.round(255*this.g)<<8)+Math.round(255*this.b)).toString(16).slice(1);if(!0===t){var n=Math.round(255*this.a).toString(16);this.a<16/255?i+="0"+n:i+=n}return i},t}();u.BLACK=Object.freeze(new u(0,0,0,1)),u.BLUE=Object.freeze(new u(0,0,1,1)),u.CYAN=Object.freeze(new u(0,1,1,1)),u.GRAY=Object.freeze(new u(.5,.5,.5,1)),u.GREEN=Object.freeze(new u(0,1,0,1)),u.MAGENTA=Object.freeze(new u(1,0,1,1)),u.RED=Object.freeze(new u(1,0,0,1)),u.WHITE=Object.freeze(new u(1,1,1,1)),u.YELLOW=Object.freeze(new u(1,1,0,1));var l=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=0),2===t.length?(this.x=t[0],this.y=t[1]):(this.x=t,this.y=i)}var i=t.prototype;return i.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.add2=function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},i.addScalar=function(t){return this.x+=t,this.y+=t,this},i.clone=function(){return new t(this.x,this.y)},i.copy=function(t){return this.x=t.x,this.y=t.y,this},i.cross=function(t){return this.x*t.y-this.y*t.x},i.distance=function(t){var i=this.x-t.x,n=this.y-t.y;return Math.sqrt(i*i+n*n)},i.div=function(t){return this.x/=t.x,this.y/=t.y,this},i.div2=function(t,i){return this.x=t.x/i.x,this.y=t.y/i.y,this},i.divScalar=function(t){return this.x/=t,this.y/=t,this},i.dot=function(t){return this.x*t.x+this.y*t.y},i.equals=function(t){return this.x===t.x&&this.y===t.y},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.lengthSq=function(){return this.x*this.x+this.y*this.y},i.lerp=function(t,i,n){return this.x=t.x+n*(i.x-t.x),this.y=t.y+n*(i.y-t.y),this},i.mul=function(t){return this.x*=t.x,this.y*=t.y,this},i.mul2=function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this},i.mulScalar=function(t){return this.x*=t,this.y*=t,this},i.normalize=function(){var t=this.x*this.x+this.y*this.y;if(t>0){var i=1/Math.sqrt(t);this.x*=i,this.y*=i}return this},i.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},i.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},i.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},i.min=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),this},i.max=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),this},i.set=function(t,i){return this.x=t,this.y=i,this},i.sub=function(t){return this.x-=t.x,this.y-=t.y,this},i.sub2=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},i.subScalar=function(t){return this.x-=t,this.y-=t,this},i.toString=function(){return"["+this.x+", "+this.y+"]"},t.angleRad=function(t,i){return Math.atan2(t.x*i.y-t.y*i.x,t.x*i.x+t.y*i.y)},t}();l.ZERO=Object.freeze(new l(0,0)),l.ONE=Object.freeze(new l(1,1)),l.UP=Object.freeze(new l(0,1)),l.DOWN=Object.freeze(new l(0,-1)),l.RIGHT=Object.freeze(new l(1,0)),l.LEFT=Object.freeze(new l(-1,0));var f=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),3===t.length?(this.x=t[0],this.y=t[1],this.z=t[2]):(this.x=t,this.y=i,this.z=n)}var i=t.prototype;return i.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.add2=function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},i.addScalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this},i.clone=function(){return new t(this.x,this.y,this.z)},i.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.cross=function(t,i){var n=t.x,e=t.y,s=t.z,h=i.x,r=i.y,a=i.z;return this.x=e*a-r*s,this.y=s*h-a*n,this.z=n*r-h*e,this},i.distance=function(t){var i=this.x-t.x,n=this.y-t.y,e=this.z-t.z;return Math.sqrt(i*i+n*n+e*e)},i.div=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},i.div2=function(t,i){return this.x=t.x/i.x,this.y=t.y/i.y,this.z=t.z/i.z,this},i.divScalar=function(t){return this.x/=t,this.y/=t,this.z/=t,this},i.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},i.equals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.lerp=function(t,i,n){return this.x=t.x+n*(i.x-t.x),this.y=t.y+n*(i.y-t.y),this.z=t.z+n*(i.z-t.z),this},i.mul=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},i.mul2=function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},i.mulScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.normalize=function(){var t=this.x*this.x+this.y*this.y+this.z*this.z;if(t>0){var i=1/Math.sqrt(t);this.x*=i,this.y*=i,this.z*=i}return this},i.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},i.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},i.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},i.min=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),this},i.max=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),this},i.project=function(t){var i=(this.x*t.x+this.y*t.y+this.z*t.z)/(t.x*t.x+t.y*t.y+t.z*t.z);return this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this},i.set=function(t,i,n){return this.x=t,this.y=i,this.z=n,this},i.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.sub2=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},i.subScalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this},i.toString=function(){return"["+this.x+", "+this.y+", "+this.z+"]"},t}();f.ZERO=Object.freeze(new f(0,0,0)),f.ONE=Object.freeze(new f(1,1,1)),f.UP=Object.freeze(new f(0,1,0)),f.DOWN=Object.freeze(new f(0,-1,0)),f.RIGHT=Object.freeze(new f(1,0,0)),f.LEFT=Object.freeze(new f(-1,0,0)),f.FORWARD=Object.freeze(new f(0,0,-1)),f.BACK=Object.freeze(new f(0,0,1));var y=function(){function t(t,i,n,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),4===t.length?(this.x=t[0],this.y=t[1],this.z=t[2],this.w=t[3]):(this.x=t,this.y=i,this.z=n,this.w=e)}var i=t.prototype;return i.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},i.add2=function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this},i.addScalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},i.clone=function(){return new t(this.x,this.y,this.z,this.w)},i.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.div=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this},i.div2=function(t,i){return this.x=t.x/i.x,this.y=t.y/i.y,this.z=t.z/i.z,this.w=t.w/i.w,this},i.divScalar=function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},i.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},i.equals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},i.lerp=function(t,i,n){return this.x=t.x+n*(i.x-t.x),this.y=t.y+n*(i.y-t.y),this.z=t.z+n*(i.z-t.z),this.w=t.w+n*(i.w-t.w),this},i.mul=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},i.mul2=function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this.w=t.w*i.w,this},i.mulScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.normalize=function(){var t=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;if(t>0){var i=1/Math.sqrt(t);this.x*=i,this.y*=i,this.z*=i,this.w*=i}return this},i.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},i.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},i.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},i.min=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},i.max=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},i.set=function(t,i,n,e){return this.x=t,this.y=i,this.z=n,this.w=e,this},i.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},i.sub2=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this},i.subScalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},i.toString=function(){return"["+this.x+", "+this.y+", "+this.z+", "+this.w+"]"},t}();y.ZERO=Object.freeze(new y(0,0,0,0)),y.ONE=Object.freeze(new y(1,1,1,1));var d=function(t){function i(i){var n;return(n=t.call(this)||this).app=i,n.store={},n.schema=[],n}e(i,t);var n=i.prototype;return n.addComponent=function(t,i){void 0===i&&(i={});var n=new this.ComponentType(this,t),e=new this.DataType;return this.store[t.getGuid()]={entity:t,data:e},t[this.id]=n,t.c[this.id]=n,this.initializeComponentData(n,i,[]),this.fire("add",t,n),n},n.removeComponent=function(t){var i=this.store[t.getGuid()],n=t.c[this.id];this.fire("beforeremove",t,n),delete this.store[t.getGuid()],delete t[this.id],delete t.c[this.id],this.fire("remove",t,i.data)},n.cloneComponent=function(t,i){var n=this.store[t.getGuid()];return this.addComponent(i,n.data)},n.initializeComponentData=function(t,i,n){void 0===i&&(i={});for(var e=0,s=n.length;e<s;e++){var h=n[e],r=void 0,a=void 0;"object"==typeof h?(r=h.name,a=h.type):(r=h,a=void 0);var o=i[r];void 0!==o?(void 0!==a&&(o=x(o,a)),t[r]=o):t[r]=t.data[r]}t.enabled&&t.entity.enabled&&t.onEnable()},n.getPropertiesOfType=function(t){var i=[];return(this.schema||[]).forEach((function(n){n&&"object"==typeof n&&n.type===t&&i.push(n)})),i},n.destroy=function(){this.off()},i}(r);function x(t,i){if(!t)return t;switch(i){case"rgb":return t instanceof u?t.clone():new u(t[0],t[1],t[2]);case"rgba":return t instanceof u?t.clone():new u(t[0],t[1],t[2],t[3]);case"vec2":return t instanceof l?t.clone():new l(t[0],t[1]);case"vec3":return t instanceof f?t.clone():new f(t[0],t[1],t[2]);case"vec4":return t instanceof y?t.clone():new y(t[0],t[1],t[2],t[3]);case"boolean":case"number":case"string":case"entity":return t;default:throw new Error("Could not convert unhandled type: "+i)}}o.attach(d);var v=new Uint8Array(new Uint32Array([0,4294967295,4291624959,4288282623,4284940287,4281597951,4278255615,4294954239,4291611903,4288269567,4284927231,4281584895,4278242559,4294941183,4291598847,4288256511,4284914175,4281571839,4278229503,4294928127,4291585791,4288243455,4284901119,4281558783,4278216447,4294915071,4291572735,4288230399,4284888063,4281545727,4278203391,4294902015,4291559679,4288217343,4284875007,4281532671,4278190335,4294967244,4291624908,4288282572,4284940236,4281597900,4278255564,4294954188,4291611852,4288269516,4284927180,4281584844,4278242508,4294941132,4291598796,4288256460,4284914124,4281571788,4278229452,4294928076,4291585740,4288243404,4284901068,4281558732,4278216396,4294915020,4291572684,4288230348,4284888012,4281545676,4278203340,4294901964,4291559628,4288217292,4284874956,4281532620,4278190284,4294967193,4291624857,4288282521,4284940185,4281597849,4278255513,4294954137,4291611801,4288269465,4284927129,4281584793,4278242457,4294941081,4291598745,4288256409,4284914073,4281571737,4278229401,4294928025,4291585689,4288243353,4284901017,4281558681,4278216345,4294914969,4291572633,4288230297,4284887961,4281545625,4278203289,4294901913,4291559577,4288217241,4284874905,4281532569,4278190233,4294967142,4291624806,4288282470,4284940134,4281597798,4278255462,4294954086,4291611750,4288269414,4284927078,4281584742,4278242406,4294941030,4291598694,4288256358,4284914022,4281571686,4278229350,4294927974,4291585638,4288243302,4284900966,4281558630,4278216294,4294914918,4291572582,4288230246,4284887910,4281545574,4278203238,4294901862,4291559526,4288217190,4284874854,4281532518,4278190182,4294967091,4291624755,4288282419,4284940083,4281597747,4278255411,4294954035,4291611699,4288269363,4284927027,4281584691,4278242355,4294940979,4291598643,4288256307,4284913971,4281571635,4278229299,4294927923,4291585587,4288243251,4284900915,4281558579,4278216243,4294914867,4291572531,4288230195,4284887859,4281545523,4278203187,4294901811,4291559475,4288217139,4284874803,4281532467,4278190131,4294967040,4291624704,4288282368,4284940032,4281597696,4278255360,4294953984,4291611648,4288269312,4284926976,4281584640,4278242304,4294940928,4291598592,4288256256,4284913920,4281571584,4278229248,4294927872,4291585536,4288243200,4284900864,4281558528,4278216192,4294914816,4291572480,4288230144,4284887808,4281545472,4278203136,4294901760,4291559424,4288217088,4284874752,4281532416,4278190318,4278190301,4278190267,4278190250,4278190216,4278190199,4278190165,4278190148,4278190114,4278190097,4278251008,4278246656,4278237952,4278233600,4278224896,4278220544,4278211840,4278207488,4278198784,4278194432,4293787648,4292673536,4290445312,4289331200,4287102976,4285988864,4283760640,4282646528,4280418304,4279304192,4293848814,4292730333,4290493371,4289374890,4287137928,4286019447,4283782485,4282664004,4280427042,4279308561]).buffer),p=function(){function t(t){this.data=t,this.tmp=[0,0,0,0]}return t.prototype.clr=function(t){var i=this.tmp;return i[0]=this.data[4*t+0],i[1]=this.data[4*t+1],i[2]=this.data[4*t+2],i[3]=this.data[4*t+3],i},t}(),z=function(){function t(t){this._data=t,this._bound=null,this._flattened=null}return n(t,[{key:"data",get:function(){return this._data}},{key:"numVoxels",get:function(){return this.data.length/4}},{key:"bound",get:function(){if(!this._bound){for(var t=this.data,i=[t[0],t[2],t[1]],n=[t[0],t[2],t[1]],e=this.numVoxels,s=1;s<e;++s){var h=t[4*s+0],r=t[4*s+2],a=t[4*s+1];h<i[0]?i[0]=h:h>n[0]&&(n[0]=h),r<i[1]?i[1]=r:r>n[1]&&(n[1]=r),a<i[2]?i[2]=a:a>n[2]&&(n[2]=a)}this._bound={min:i,max:n,extent:[n[0]-i[0]+1,n[1]-i[1]+1,n[2]-i[2]+1]}}return this._bound}},{key:"flattened",get:function(){if(!this._flattened){var t=this.data,i=this.bound.min;this.bound.max;for(var n=this.bound.extent,e=new Uint8Array(n[0]*n[1]*n[2]),s=this.numVoxels,h=0;h<s;++h){var r=t[4*h+0]-i[0]+(t[4*h+2]-i[1])*n[0]+(t[4*h+1]-i[2])*n[0]*n[1];e[r]=t[4*h+3]}this._flattened={extent:n,data:e,at:function(t,i,s){if(t<0||i<0||s<0||t>=n[0]||i>=n[1]||s>=n[2])return 0;var h=t+i*n[0]+s*n[0]*n[1];return e[h]}}}return this._flattened}}]),t}(),b=function(){function t(){this.frames=[],this.palette=null}var i=t.prototype;return i.addFrame=function(t){this.frames.push(t)},i.setPalette=function(t){this.palette=t},t}(),w=function(){function t(){}return t.load=function(t){var i=new pc.ReadStream(t),n=function(){return{id:i.readChars(4),numBytes:i.readU32(),numChildBytes:i.readU32()}};if("VOX "!==i.readChars(4))return console.log("invalid vox header"),null;if(150!==i.readU32())return console.log("invalid vox version"),null;var e=n();if("MAIN"!==e.id)return console.log("invalid first chunk in vox"),null;for(var s=new b;i.offset<e.numChildBytes;){var h=n();switch(h.id){case"XYZI":var r=i.readU32();s.addFrame(new z(new Uint8Array(t,i.offset,4*r))),i.skip(4*r);break;case"RGBA":s.setPalette(new p(new Uint8Array(t,i.offset,1024))),i.skip(1536);break;default:i.skip(h.numBytes+h.numChildBytes)}}return s.palette||s.setPalette(v),s},t}(),m=function(t,i){t[0]+=i[0],t[1]+=i[1],t[2]+=i[2]},_=function(){function t(){}return t.mesh=function(t,i,n){var e=i.frames[n];if(!e)return null;for(var s=e.flattened,h=[],r=[],a=[],o=[],c=[0,0,0],u=[0,0,0],l=function(t,n,e,s){var l,f,y=h.length/3;o.push(y,y+1,y+2,y,y+2,y+3),(l=u)[0]=(f=c)[0],l[1]=f[1],l[2]=f[2],h.push(u[0],u[1],u[2]),m(u,t),h.push(u[0],u[1],u[2]),m(u,n),h.push(u[0],u[1],u[2]),function(t,i){t[0]-=i[0],t[1]-=i[1],t[2]-=i[2]}(u,t),h.push(u[0],u[1],u[2]),r.push(e[0],e[1],e[2]),r.push(e[0],e[1],e[2]),r.push(e[0],e[1],e[2]),r.push(e[0],e[1],e[2]);var d=i.palette.clr(s-1);a.push(d[0],d[1],d[2],d[3]),a.push(d[0],d[1],d[2],d[3]),a.push(d[0],d[1],d[2],d[3]),a.push(d[0],d[1],d[2],d[3])},f=[1,0,0],y=[0,1,0],d=[0,0,1],x=[-1,0,0],v=[0,-1,0],p=[0,0,-1],z=0;z<=s.extent[2];++z){c[2]=z;for(var b=0;b<=s.extent[1];++b){c[1]=b;for(var w=0;w<=s.extent[0];++w){c[0]=w;var _=s.at(w,b,z),g=s.at(w-1,b,z),k=s.at(w,b-1,z),M=s.at(w,b,z-1);0!==_?(0===g&&l(d,y,x,_),0===k&&l(f,d,v,_),0===M&&l(y,f,p,_)):(0!==g&&l(y,d,f,g),0!==k&&l(d,f,y,k),0!==M&&l(f,y,d,M))}}}var A=new pc.Mesh(t);return A.setPositions(h),A.setNormals(r),A.setColors32(a),A.setIndices(o),A.update(),A},t}(),g=function(){function t(t,i){this.device=t,this.voxModel=i}var i=t.prototype;return i.instantiateModelEntity=function(t){return null},i.instantiateRenderEntity=function(t){var i=this,n=new pc.StandardMaterial;n.diffuseVertexColor=!0;var e=this.voxModel.frames.map((function(t,e){var s=_.mesh(i.device,i.voxModel,e);return new pc.MeshInstance(s,n)})),s=new pc.Entity;return s.addComponent("render",{material:n,meshInstances:e}),s.addComponent("voxanim",{}),this.renders=[],s},t}(),k=["enabled"],M=function(){this.enabled=!0},A=function(t){function i(i,n){var e;return(e=t.call(this,i,n)||this).playing=!0,e.timer=0,e.fps=10,e}return e(i,t),i.prototype.update=function(t){var i,n;this.playing&&(this.timer+=t);var e=(null==(i=this.entity.render)?void 0:i.meshInstances)||(null==(n=this.entity.model)?void 0:n.meshInstances);if(e)for(var s=Math.floor(this.timer*this.fps)%e.length,h=0;h<e.length;++h)e[h].visible=h===s},i}(a),O=function(t){function i(i){var n;return(n=t.call(this,i)||this).id="voxanim",n.ComponentType=A,n.DataType=M,n.schema=k,n.app.systems.on("update",n.onUpdate,h(n)),n}e(i,t);var n=i.prototype;return n.initializeComponentData=function(i,n,e){e=["playing","timer","fps"];for(var s=0;s<e.length;s++)n.hasOwnProperty(e[s])&&(i[e[s]]=n[e[s]]);t.prototype.initializeComponentData.call(this,i,n,k)},n.cloneComponent=function(t,i){var n=t.voxanim,e={playing:n.playing,timer:n.timer,fps:n.fps};return this.addComponent(i,e)},n.onUpdate=function(t){var i=this.store;for(var n in i)if(i.hasOwnProperty(n)){var e=i[n].entity;if(e.enabled){var s=e.voxanim;s.enabled&&s.update(t)}}},n.destroy=function(){t.prototype.destroy.call(this),this.app.systems.off("update",this.onUpdate,this)},i}(d);a._buildAccessors(A.prototype,k);var E=function(){function t(t,i,n){this._device=t,this._assets=i,this._maxRetries=n}var i=t.prototype;return i.load=function(t,i,n){var e=this;pc.Asset.fetchArrayBuffer(t.load,(function(t,n){t?i(t):i(null,new g(e._device,w.load(n)))}),n,this._maxRetries)},i.open=function(t,i,n){return i},t}();t.registerVoxParser=function(t){t.systems.add(new O(t)),t.loader.getHandler("container").parsers.vox=new E(t.graphicsDevice,t.assets)},Object.defineProperty(t,"__esModule",{value:!0})}));