/**
 * @license
 * PlayCanvas Engine v1.62.0 revision 818511d2b (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { Debug, DebugHelper } from '../../../core/debug.js';
import { TRACEID_PIPELINELAYOUT_ALLOC, TRACEID_RENDERPIPELINE_ALLOC } from '../../../core/constants.js';
import { WebgpuVertexBufferLayout } from './webgpu-vertex-buffer-layout.js';
import { WebgpuDebug } from './webgpu-debug.js';

let _pipelineId = 0;
let _layoutId = 0;
const _primitiveTopology = ['point-list',
// PRIMITIVE_POINTS
'line-list',
// PRIMITIVE_LINES
undefined,
// PRIMITIVE_LINELOOP
'line-strip',
// PRIMITIVE_LINESTRIP
'triangle-list',
// PRIMITIVE_TRIANGLES
'triangle-strip',
// PRIMITIVE_TRISTRIP
undefined // PRIMITIVE_TRIFAN
];

const _blendOperation = ['add',
// BLENDEQUATION_ADD
'subtract',
// BLENDEQUATION_SUBTRACT
'reverse-subtract',
// BLENDEQUATION_REVERSE_SUBTRACT
'min',
// BLENDEQUATION_MIN
'max' // BLENDEQUATION_MAX
];

const _blendFactor = ['zero',
// BLENDMODE_ZERO
'one',
// BLENDMODE_ONE
'src',
// BLENDMODE_SRC_COLOR
'one-minus-src',
// BLENDMODE_ONE_MINUS_SRC_COLOR
'dst',
// BLENDMODE_DST_COLOR
'one-minus-dst',
// BLENDMODE_ONE_MINUS_DST_COLOR
'src-alpha',
// BLENDMODE_SRC_ALPHA
'src-alpha-saturated',
// BLENDMODE_SRC_ALPHA_SATURATE
'one-minus-src-alpha',
// BLENDMODE_ONE_MINUS_SRC_ALPHA
'dst-alpha',
// BLENDMODE_DST_ALPHA
'one-minus-dst-alpha',
// BLENDMODE_ONE_MINUS_DST_ALPHA
'constant',
// BLENDMODE_CONSTANT
'one-minus-constant' // BLENDMODE_ONE_MINUS_CONSTANT
];

const _depthCompareFunction = ['never',
// FUNC_NEVER
'less',
// FUNC_LESS
'equal',
// FUNC_EQUAL
'less-equal',
// FUNC_LESSEQUAL
'greater',
// FUNC_GREATER
'not-equal',
// FUNC_NOTEQUAL
'greater-equal',
// FUNC_GREATEREQUAL
'always' // FUNC_ALWAYS
];

// temp array to avoid allocation
const _bindGroupLayouts = [];

/**
 * @ignore
 */
class WebgpuRenderPipeline {
  constructor(device) {
    /** @type {import('./webgpu-graphics-device.js').WebgpuGraphicsDevice} */
    this.device = device;

    /**
     * The cache of vertex buffer layouts
     *
     * @type {WebgpuVertexBufferLayout}
     */
    this.vertexBufferLayout = new WebgpuVertexBufferLayout();

    /**
     * The cache of render pipelines
     *
     * @type {Map<string, object>}
     */
    this.cache = new Map();
  }
  get(primitive, vertexFormat0, vertexFormat1, shader, renderTarget, bindGroupFormats, blendState, depthState) {
    // render pipeline unique key
    const key = this.getKey(primitive, vertexFormat0, vertexFormat1, shader, renderTarget, bindGroupFormats, blendState, depthState);

    // cached pipeline
    let pipeline = this.cache.get(key);
    if (!pipeline) {
      const primitiveTopology = _primitiveTopology[primitive.type];
      Debug.assert(primitiveTopology, `Unsupported primitive topology`, primitive);

      // pipeline layout
      const pipelineLayout = this.getPipelineLayout(bindGroupFormats);

      // vertex buffer layout
      const vertexBufferLayout = this.vertexBufferLayout.get(vertexFormat0, vertexFormat1);

      // pipeline
      pipeline = this.create(primitiveTopology, shader, renderTarget, pipelineLayout, blendState, depthState, vertexBufferLayout);
      this.cache.set(key, pipeline);
    }
    return pipeline;
  }

  /**
   * Generate a unique key for the render pipeline. Keep this function as lean as possible,
   * as it executes for each draw call.
   */
  getKey(primitive, vertexFormat0, vertexFormat1, shader, renderTarget, bindGroupFormats, blendState, depthState) {
    let bindGroupKey = '';
    for (let i = 0; i < bindGroupFormats.length; i++) {
      bindGroupKey += bindGroupFormats[i].key;
    }
    const vertexBufferLayoutKey = this.vertexBufferLayout.getKey(vertexFormat0, vertexFormat1);
    const renderTargetKey = renderTarget.impl.key;
    return vertexBufferLayoutKey + shader.impl.vertexCode + shader.impl.fragmentCode + renderTargetKey + primitive.type + bindGroupKey + blendState.key + depthState.key;
  }

  // TODO: this could be cached using bindGroupKey

  /**
   * @param {import('../bind-group-format.js').BindGroupFormat[]} bindGroupFormats - An array
   * of bind group formats.
   * @returns {any} Returns the pipeline layout.
   */
  getPipelineLayout(bindGroupFormats) {
    bindGroupFormats.forEach(format => {
      _bindGroupLayouts.push(format.bindGroupLayout);
    });
    const descr = {
      bindGroupLayouts: _bindGroupLayouts
    };
    _layoutId++;
    DebugHelper.setLabel(descr, `PipelineLayoutDescr-${_layoutId}`);

    /** @type {GPUPipelineLayout} */
    const pipelineLayout = this.device.wgpu.createPipelineLayout(descr);
    DebugHelper.setLabel(pipelineLayout, `PipelineLayout-${_layoutId}`);
    Debug.trace(TRACEID_PIPELINELAYOUT_ALLOC, `Alloc: Id ${_layoutId}`, descr);
    _bindGroupLayouts.length = 0;
    return pipelineLayout;
  }
  getBlend(blendState) {
    // blend needs to be undefined when blending is disabled
    let blend;
    if (blendState.blend) {
      /** @type {GPUBlendState} */
      blend = {
        color: {
          operation: _blendOperation[blendState.colorOp],
          srcFactor: _blendFactor[blendState.colorSrcFactor],
          dstFactor: _blendFactor[blendState.colorDstFactor]
        },
        alpha: {
          operation: _blendOperation[blendState.alphaOp],
          srcFactor: _blendFactor[blendState.alphaSrcFactor],
          dstFactor: _blendFactor[blendState.alphaDstFactor]
        }
      };

      // unsupported blend factors
      Debug.assert(blend.color.srcFactor !== undefined);
      Debug.assert(blend.color.dstFactor !== undefined);
      Debug.assert(blend.alpha.srcFactor !== undefined);
      Debug.assert(blend.alpha.dstFactor !== undefined);
    }
    return blend;
  }

  /** @private */
  getDepthStencil(depthState, renderTarget) {
    /** @type {GPUDepthStencilState} */
    let depthStencil;
    const {
      depth,
      stencil
    } = renderTarget;
    if (depth || stencil) {
      depthStencil = {
        format: renderTarget.impl.depthFormat
      };
      if (depth) {
        depthStencil.depthWriteEnabled = depthState.write;
        depthStencil.depthCompare = _depthCompareFunction[depthState.func];
      } else {
        // if render target does not have depth buffer
        depthStencil.depthWriteEnabled = false;
        depthStencil.depthCompare = 'always';
      }
    }
    return depthStencil;
  }
  create(primitiveTopology, shader, renderTarget, pipelineLayout, blendState, depthState, vertexBufferLayout) {
    const wgpu = this.device.wgpu;

    /** @type {import('./webgpu-shader.js').WebgpuShader} */
    const webgpuShader = shader.impl;

    /** @type {GPURenderPipelineDescriptor} */
    const descr = {
      vertex: {
        module: webgpuShader.getVertexShaderModule(),
        entryPoint: webgpuShader.vertexEntryPoint,
        buffers: vertexBufferLayout
      },
      primitive: {
        topology: primitiveTopology,
        cullMode: "none"
      },
      depthStencil: this.getDepthStencil(depthState, renderTarget),
      multisample: {
        count: renderTarget.samples
      },
      // uniform / texture binding layout
      layout: pipelineLayout
    };

    // provide fragment state only when render target contains color buffer, otherwise rendering to depth only
    // TODO: the exclusion of fragment here should be reflected in the key generation (no blend, no frag ..)
    const colorFormat = renderTarget.impl.colorFormat;
    if (colorFormat) {
      let writeMask = 0;
      if (blendState.redWrite) writeMask |= GPUColorWrite.RED;
      if (blendState.greenWrite) writeMask |= GPUColorWrite.GREEN;
      if (blendState.blueWrite) writeMask |= GPUColorWrite.BLUE;
      if (blendState.alphaWrite) writeMask |= GPUColorWrite.ALPHA;

      /** @type {GPUFragmentState} */
      descr.fragment = {
        module: webgpuShader.getFragmentShaderModule(),
        entryPoint: webgpuShader.fragmentEntryPoint,
        targets: [{
          format: renderTarget.impl.colorFormat,
          writeMask: writeMask,
          blend: this.getBlend(blendState)
        }]
      };
    }
    WebgpuDebug.validate(this.device);
    _pipelineId++;
    DebugHelper.setLabel(descr, `RenderPipelineDescr-${_pipelineId}`);
    const pipeline = wgpu.createRenderPipeline(descr);
    DebugHelper.setLabel(pipeline, `RenderPipeline-${_pipelineId}`);
    Debug.trace(TRACEID_RENDERPIPELINE_ALLOC, `Alloc: Id ${_pipelineId}`, descr);
    WebgpuDebug.end(this.device, {
      renderPipeline: this,
      descr,
      shader
    });
    return pipeline;
  }
}

export { WebgpuRenderPipeline };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViZ3B1LXJlbmRlci1waXBlbGluZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL3BsYXRmb3JtL2dyYXBoaWNzL3dlYmdwdS93ZWJncHUtcmVuZGVyLXBpcGVsaW5lLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnLCBEZWJ1Z0hlbHBlciB9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2RlYnVnLmpzXCI7XG5pbXBvcnQgeyBUUkFDRUlEX1JFTkRFUlBJUEVMSU5FX0FMTE9DLCBUUkFDRUlEX1BJUEVMSU5FTEFZT1VUX0FMTE9DIH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvY29uc3RhbnRzLmpzXCI7XG5cbmltcG9ydCB7IFdlYmdwdVZlcnRleEJ1ZmZlckxheW91dCB9IGZyb20gXCIuL3dlYmdwdS12ZXJ0ZXgtYnVmZmVyLWxheW91dC5qc1wiO1xuaW1wb3J0IHsgV2ViZ3B1RGVidWcgfSBmcm9tIFwiLi93ZWJncHUtZGVidWcuanNcIjtcblxubGV0IF9waXBlbGluZUlkID0gMDtcbmxldCBfbGF5b3V0SWQgPSAwO1xuXG5jb25zdCBfcHJpbWl0aXZlVG9wb2xvZ3kgPSBbXG4gICAgJ3BvaW50LWxpc3QnLCAgICAgICAvLyBQUklNSVRJVkVfUE9JTlRTXG4gICAgJ2xpbmUtbGlzdCcsICAgICAgICAvLyBQUklNSVRJVkVfTElORVNcbiAgICB1bmRlZmluZWQsICAgICAgICAgIC8vIFBSSU1JVElWRV9MSU5FTE9PUFxuICAgICdsaW5lLXN0cmlwJywgICAgICAgLy8gUFJJTUlUSVZFX0xJTkVTVFJJUFxuICAgICd0cmlhbmdsZS1saXN0JywgICAgLy8gUFJJTUlUSVZFX1RSSUFOR0xFU1xuICAgICd0cmlhbmdsZS1zdHJpcCcsICAgLy8gUFJJTUlUSVZFX1RSSVNUUklQXG4gICAgdW5kZWZpbmVkICAgICAgICAgICAvLyBQUklNSVRJVkVfVFJJRkFOXG5dO1xuXG5jb25zdCBfYmxlbmRPcGVyYXRpb24gPSBbXG4gICAgJ2FkZCcsICAgICAgICAgICAgICAvLyBCTEVOREVRVUFUSU9OX0FERFxuICAgICdzdWJ0cmFjdCcsICAgICAgICAgLy8gQkxFTkRFUVVBVElPTl9TVUJUUkFDVFxuICAgICdyZXZlcnNlLXN1YnRyYWN0JywgLy8gQkxFTkRFUVVBVElPTl9SRVZFUlNFX1NVQlRSQUNUXG4gICAgJ21pbicsICAgICAgICAgICAgICAvLyBCTEVOREVRVUFUSU9OX01JTlxuICAgICdtYXgnICAgICAgICAgICAgICAgLy8gQkxFTkRFUVVBVElPTl9NQVhcbl07XG5cbmNvbnN0IF9ibGVuZEZhY3RvciA9IFtcbiAgICAnemVybycsICAgICAgICAgICAgICAgICAvLyBCTEVORE1PREVfWkVST1xuICAgICdvbmUnLCAgICAgICAgICAgICAgICAgIC8vIEJMRU5ETU9ERV9PTkVcbiAgICAnc3JjJywgICAgICAgICAgICAgICAgICAvLyBCTEVORE1PREVfU1JDX0NPTE9SXG4gICAgJ29uZS1taW51cy1zcmMnLCAgICAgICAgLy8gQkxFTkRNT0RFX09ORV9NSU5VU19TUkNfQ09MT1JcbiAgICAnZHN0JywgICAgICAgICAgICAgICAgICAvLyBCTEVORE1PREVfRFNUX0NPTE9SXG4gICAgJ29uZS1taW51cy1kc3QnLCAgICAgICAgLy8gQkxFTkRNT0RFX09ORV9NSU5VU19EU1RfQ09MT1JcbiAgICAnc3JjLWFscGhhJywgICAgICAgICAgICAvLyBCTEVORE1PREVfU1JDX0FMUEhBXG4gICAgJ3NyYy1hbHBoYS1zYXR1cmF0ZWQnLCAgLy8gQkxFTkRNT0RFX1NSQ19BTFBIQV9TQVRVUkFURVxuICAgICdvbmUtbWludXMtc3JjLWFscGhhJywgIC8vIEJMRU5ETU9ERV9PTkVfTUlOVVNfU1JDX0FMUEhBXG4gICAgJ2RzdC1hbHBoYScsICAgICAgICAgICAgLy8gQkxFTkRNT0RFX0RTVF9BTFBIQVxuICAgICdvbmUtbWludXMtZHN0LWFscGhhJywgIC8vIEJMRU5ETU9ERV9PTkVfTUlOVVNfRFNUX0FMUEhBXG4gICAgJ2NvbnN0YW50JywgICAgICAgICAgICAgLy8gQkxFTkRNT0RFX0NPTlNUQU5UXG4gICAgJ29uZS1taW51cy1jb25zdGFudCcgICAgLy8gQkxFTkRNT0RFX09ORV9NSU5VU19DT05TVEFOVFxuXTtcblxuY29uc3QgX2RlcHRoQ29tcGFyZUZ1bmN0aW9uID0gW1xuICAgICduZXZlcicsICAgICAgICAgICAgICAgIC8vIEZVTkNfTkVWRVJcbiAgICAnbGVzcycsICAgICAgICAgICAgICAgICAvLyBGVU5DX0xFU1NcbiAgICAnZXF1YWwnLCAgICAgICAgICAgICAgICAvLyBGVU5DX0VRVUFMXG4gICAgJ2xlc3MtZXF1YWwnLCAgICAgICAgICAgLy8gRlVOQ19MRVNTRVFVQUxcbiAgICAnZ3JlYXRlcicsICAgICAgICAgICAgICAvLyBGVU5DX0dSRUFURVJcbiAgICAnbm90LWVxdWFsJywgICAgICAgICAgICAvLyBGVU5DX05PVEVRVUFMXG4gICAgJ2dyZWF0ZXItZXF1YWwnLCAgICAgICAgLy8gRlVOQ19HUkVBVEVSRVFVQUxcbiAgICAnYWx3YXlzJyAgICAgICAgICAgICAgICAvLyBGVU5DX0FMV0FZU1xuXTtcblxuLy8gdGVtcCBhcnJheSB0byBhdm9pZCBhbGxvY2F0aW9uXG5jb25zdCBfYmluZEdyb3VwTGF5b3V0cyA9IFtdO1xuXG4vKipcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgV2ViZ3B1UmVuZGVyUGlwZWxpbmUge1xuICAgIGNvbnN0cnVjdG9yKGRldmljZSkge1xuICAgICAgICAvKiogQHR5cGUge2ltcG9ydCgnLi93ZWJncHUtZ3JhcGhpY3MtZGV2aWNlLmpzJykuV2ViZ3B1R3JhcGhpY3NEZXZpY2V9ICovXG4gICAgICAgIHRoaXMuZGV2aWNlID0gZGV2aWNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgY2FjaGUgb2YgdmVydGV4IGJ1ZmZlciBsYXlvdXRzXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIHtXZWJncHVWZXJ0ZXhCdWZmZXJMYXlvdXR9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnZlcnRleEJ1ZmZlckxheW91dCA9IG5ldyBXZWJncHVWZXJ0ZXhCdWZmZXJMYXlvdXQoKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGNhY2hlIG9mIHJlbmRlciBwaXBlbGluZXNcbiAgICAgICAgICpcbiAgICAgICAgICogQHR5cGUge01hcDxzdHJpbmcsIG9iamVjdD59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNhY2hlID0gbmV3IE1hcCgpO1xuICAgIH1cblxuICAgIGdldChwcmltaXRpdmUsIHZlcnRleEZvcm1hdDAsIHZlcnRleEZvcm1hdDEsIHNoYWRlciwgcmVuZGVyVGFyZ2V0LCBiaW5kR3JvdXBGb3JtYXRzLCBibGVuZFN0YXRlLCBkZXB0aFN0YXRlKSB7XG5cbiAgICAgICAgLy8gcmVuZGVyIHBpcGVsaW5lIHVuaXF1ZSBrZXlcbiAgICAgICAgY29uc3Qga2V5ID0gdGhpcy5nZXRLZXkocHJpbWl0aXZlLCB2ZXJ0ZXhGb3JtYXQwLCB2ZXJ0ZXhGb3JtYXQxLCBzaGFkZXIsIHJlbmRlclRhcmdldCwgYmluZEdyb3VwRm9ybWF0cywgYmxlbmRTdGF0ZSwgZGVwdGhTdGF0ZSk7XG5cbiAgICAgICAgLy8gY2FjaGVkIHBpcGVsaW5lXG4gICAgICAgIGxldCBwaXBlbGluZSA9IHRoaXMuY2FjaGUuZ2V0KGtleSk7XG4gICAgICAgIGlmICghcGlwZWxpbmUpIHtcblxuICAgICAgICAgICAgY29uc3QgcHJpbWl0aXZlVG9wb2xvZ3kgPSBfcHJpbWl0aXZlVG9wb2xvZ3lbcHJpbWl0aXZlLnR5cGVdO1xuICAgICAgICAgICAgRGVidWcuYXNzZXJ0KHByaW1pdGl2ZVRvcG9sb2d5LCBgVW5zdXBwb3J0ZWQgcHJpbWl0aXZlIHRvcG9sb2d5YCwgcHJpbWl0aXZlKTtcblxuICAgICAgICAgICAgLy8gcGlwZWxpbmUgbGF5b3V0XG4gICAgICAgICAgICBjb25zdCBwaXBlbGluZUxheW91dCA9IHRoaXMuZ2V0UGlwZWxpbmVMYXlvdXQoYmluZEdyb3VwRm9ybWF0cyk7XG5cbiAgICAgICAgICAgIC8vIHZlcnRleCBidWZmZXIgbGF5b3V0XG4gICAgICAgICAgICBjb25zdCB2ZXJ0ZXhCdWZmZXJMYXlvdXQgPSB0aGlzLnZlcnRleEJ1ZmZlckxheW91dC5nZXQodmVydGV4Rm9ybWF0MCwgdmVydGV4Rm9ybWF0MSk7XG5cbiAgICAgICAgICAgIC8vIHBpcGVsaW5lXG4gICAgICAgICAgICBwaXBlbGluZSA9IHRoaXMuY3JlYXRlKHByaW1pdGl2ZVRvcG9sb2d5LCBzaGFkZXIsIHJlbmRlclRhcmdldCwgcGlwZWxpbmVMYXlvdXQsIGJsZW5kU3RhdGUsIGRlcHRoU3RhdGUsIHZlcnRleEJ1ZmZlckxheW91dCk7XG4gICAgICAgICAgICB0aGlzLmNhY2hlLnNldChrZXksIHBpcGVsaW5lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwaXBlbGluZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZW5lcmF0ZSBhIHVuaXF1ZSBrZXkgZm9yIHRoZSByZW5kZXIgcGlwZWxpbmUuIEtlZXAgdGhpcyBmdW5jdGlvbiBhcyBsZWFuIGFzIHBvc3NpYmxlLFxuICAgICAqIGFzIGl0IGV4ZWN1dGVzIGZvciBlYWNoIGRyYXcgY2FsbC5cbiAgICAgKi9cbiAgICBnZXRLZXkocHJpbWl0aXZlLCB2ZXJ0ZXhGb3JtYXQwLCB2ZXJ0ZXhGb3JtYXQxLCBzaGFkZXIsIHJlbmRlclRhcmdldCwgYmluZEdyb3VwRm9ybWF0cywgYmxlbmRTdGF0ZSwgZGVwdGhTdGF0ZSkge1xuXG4gICAgICAgIGxldCBiaW5kR3JvdXBLZXkgPSAnJztcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiaW5kR3JvdXBGb3JtYXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBiaW5kR3JvdXBLZXkgKz0gYmluZEdyb3VwRm9ybWF0c1tpXS5rZXk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB2ZXJ0ZXhCdWZmZXJMYXlvdXRLZXkgPSB0aGlzLnZlcnRleEJ1ZmZlckxheW91dC5nZXRLZXkodmVydGV4Rm9ybWF0MCwgdmVydGV4Rm9ybWF0MSk7XG4gICAgICAgIGNvbnN0IHJlbmRlclRhcmdldEtleSA9IHJlbmRlclRhcmdldC5pbXBsLmtleTtcblxuICAgICAgICByZXR1cm4gdmVydGV4QnVmZmVyTGF5b3V0S2V5ICsgc2hhZGVyLmltcGwudmVydGV4Q29kZSArIHNoYWRlci5pbXBsLmZyYWdtZW50Q29kZSArXG4gICAgICAgICAgICByZW5kZXJUYXJnZXRLZXkgKyBwcmltaXRpdmUudHlwZSArIGJpbmRHcm91cEtleSArIGJsZW5kU3RhdGUua2V5ICsgZGVwdGhTdGF0ZS5rZXk7XG4gICAgfVxuXG4gICAgLy8gVE9ETzogdGhpcyBjb3VsZCBiZSBjYWNoZWQgdXNpbmcgYmluZEdyb3VwS2V5XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vYmluZC1ncm91cC1mb3JtYXQuanMnKS5CaW5kR3JvdXBGb3JtYXRbXX0gYmluZEdyb3VwRm9ybWF0cyAtIEFuIGFycmF5XG4gICAgICogb2YgYmluZCBncm91cCBmb3JtYXRzLlxuICAgICAqIEByZXR1cm5zIHthbnl9IFJldHVybnMgdGhlIHBpcGVsaW5lIGxheW91dC5cbiAgICAgKi9cbiAgICBnZXRQaXBlbGluZUxheW91dChiaW5kR3JvdXBGb3JtYXRzKSB7XG5cbiAgICAgICAgYmluZEdyb3VwRm9ybWF0cy5mb3JFYWNoKChmb3JtYXQpID0+IHtcbiAgICAgICAgICAgIF9iaW5kR3JvdXBMYXlvdXRzLnB1c2goZm9ybWF0LmJpbmRHcm91cExheW91dCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGRlc2NyID0ge1xuICAgICAgICAgICAgYmluZEdyb3VwTGF5b3V0czogX2JpbmRHcm91cExheW91dHNcbiAgICAgICAgfTtcblxuICAgICAgICBfbGF5b3V0SWQrKztcbiAgICAgICAgRGVidWdIZWxwZXIuc2V0TGFiZWwoZGVzY3IsIGBQaXBlbGluZUxheW91dERlc2NyLSR7X2xheW91dElkfWApO1xuXG4gICAgICAgIC8qKiBAdHlwZSB7R1BVUGlwZWxpbmVMYXlvdXR9ICovXG4gICAgICAgIGNvbnN0IHBpcGVsaW5lTGF5b3V0ID0gdGhpcy5kZXZpY2Uud2dwdS5jcmVhdGVQaXBlbGluZUxheW91dChkZXNjcik7XG4gICAgICAgIERlYnVnSGVscGVyLnNldExhYmVsKHBpcGVsaW5lTGF5b3V0LCBgUGlwZWxpbmVMYXlvdXQtJHtfbGF5b3V0SWR9YCk7XG4gICAgICAgIERlYnVnLnRyYWNlKFRSQUNFSURfUElQRUxJTkVMQVlPVVRfQUxMT0MsIGBBbGxvYzogSWQgJHtfbGF5b3V0SWR9YCwgZGVzY3IpO1xuXG4gICAgICAgIF9iaW5kR3JvdXBMYXlvdXRzLmxlbmd0aCA9IDA7XG5cbiAgICAgICAgcmV0dXJuIHBpcGVsaW5lTGF5b3V0O1xuICAgIH1cblxuICAgIGdldEJsZW5kKGJsZW5kU3RhdGUpIHtcblxuICAgICAgICAvLyBibGVuZCBuZWVkcyB0byBiZSB1bmRlZmluZWQgd2hlbiBibGVuZGluZyBpcyBkaXNhYmxlZFxuICAgICAgICBsZXQgYmxlbmQ7XG5cbiAgICAgICAgaWYgKGJsZW5kU3RhdGUuYmxlbmQpIHtcblxuICAgICAgICAgICAgLyoqIEB0eXBlIHtHUFVCbGVuZFN0YXRlfSAqL1xuICAgICAgICAgICAgYmxlbmQgPSB7XG4gICAgICAgICAgICAgICAgY29sb3I6IHtcbiAgICAgICAgICAgICAgICAgICAgb3BlcmF0aW9uOiBfYmxlbmRPcGVyYXRpb25bYmxlbmRTdGF0ZS5jb2xvck9wXSxcbiAgICAgICAgICAgICAgICAgICAgc3JjRmFjdG9yOiBfYmxlbmRGYWN0b3JbYmxlbmRTdGF0ZS5jb2xvclNyY0ZhY3Rvcl0sXG4gICAgICAgICAgICAgICAgICAgIGRzdEZhY3RvcjogX2JsZW5kRmFjdG9yW2JsZW5kU3RhdGUuY29sb3JEc3RGYWN0b3JdXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBhbHBoYToge1xuICAgICAgICAgICAgICAgICAgICBvcGVyYXRpb246IF9ibGVuZE9wZXJhdGlvbltibGVuZFN0YXRlLmFscGhhT3BdLFxuICAgICAgICAgICAgICAgICAgICBzcmNGYWN0b3I6IF9ibGVuZEZhY3RvcltibGVuZFN0YXRlLmFscGhhU3JjRmFjdG9yXSxcbiAgICAgICAgICAgICAgICAgICAgZHN0RmFjdG9yOiBfYmxlbmRGYWN0b3JbYmxlbmRTdGF0ZS5hbHBoYURzdEZhY3Rvcl1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyB1bnN1cHBvcnRlZCBibGVuZCBmYWN0b3JzXG4gICAgICAgICAgICBEZWJ1Zy5hc3NlcnQoYmxlbmQuY29sb3Iuc3JjRmFjdG9yICE9PSB1bmRlZmluZWQpO1xuICAgICAgICAgICAgRGVidWcuYXNzZXJ0KGJsZW5kLmNvbG9yLmRzdEZhY3RvciAhPT0gdW5kZWZpbmVkKTtcbiAgICAgICAgICAgIERlYnVnLmFzc2VydChibGVuZC5hbHBoYS5zcmNGYWN0b3IgIT09IHVuZGVmaW5lZCk7XG4gICAgICAgICAgICBEZWJ1Zy5hc3NlcnQoYmxlbmQuYWxwaGEuZHN0RmFjdG9yICE9PSB1bmRlZmluZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGJsZW5kO1xuICAgIH1cblxuICAgIC8qKiBAcHJpdmF0ZSAqL1xuICAgIGdldERlcHRoU3RlbmNpbChkZXB0aFN0YXRlLCByZW5kZXJUYXJnZXQpIHtcblxuICAgICAgICAvKiogQHR5cGUge0dQVURlcHRoU3RlbmNpbFN0YXRlfSAqL1xuICAgICAgICBsZXQgZGVwdGhTdGVuY2lsO1xuICAgICAgICBjb25zdCB7IGRlcHRoLCBzdGVuY2lsIH0gPSByZW5kZXJUYXJnZXQ7XG4gICAgICAgIGlmIChkZXB0aCB8fCBzdGVuY2lsKSB7XG4gICAgICAgICAgICBkZXB0aFN0ZW5jaWwgPSB7XG4gICAgICAgICAgICAgICAgZm9ybWF0OiByZW5kZXJUYXJnZXQuaW1wbC5kZXB0aEZvcm1hdFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKGRlcHRoKSB7XG4gICAgICAgICAgICAgICAgZGVwdGhTdGVuY2lsLmRlcHRoV3JpdGVFbmFibGVkID0gZGVwdGhTdGF0ZS53cml0ZTtcbiAgICAgICAgICAgICAgICBkZXB0aFN0ZW5jaWwuZGVwdGhDb21wYXJlID0gX2RlcHRoQ29tcGFyZUZ1bmN0aW9uW2RlcHRoU3RhdGUuZnVuY107XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIGlmIHJlbmRlciB0YXJnZXQgZG9lcyBub3QgaGF2ZSBkZXB0aCBidWZmZXJcbiAgICAgICAgICAgICAgICBkZXB0aFN0ZW5jaWwuZGVwdGhXcml0ZUVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBkZXB0aFN0ZW5jaWwuZGVwdGhDb21wYXJlID0gJ2Fsd2F5cyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGVwdGhTdGVuY2lsO1xuICAgIH1cblxuICAgIGNyZWF0ZShwcmltaXRpdmVUb3BvbG9neSwgc2hhZGVyLCByZW5kZXJUYXJnZXQsIHBpcGVsaW5lTGF5b3V0LCBibGVuZFN0YXRlLCBkZXB0aFN0YXRlLCB2ZXJ0ZXhCdWZmZXJMYXlvdXQpIHtcblxuICAgICAgICBjb25zdCB3Z3B1ID0gdGhpcy5kZXZpY2Uud2dwdTtcblxuICAgICAgICAvKiogQHR5cGUge2ltcG9ydCgnLi93ZWJncHUtc2hhZGVyLmpzJykuV2ViZ3B1U2hhZGVyfSAqL1xuICAgICAgICBjb25zdCB3ZWJncHVTaGFkZXIgPSBzaGFkZXIuaW1wbDtcblxuICAgICAgICAvKiogQHR5cGUge0dQVVJlbmRlclBpcGVsaW5lRGVzY3JpcHRvcn0gKi9cbiAgICAgICAgY29uc3QgZGVzY3IgPSB7XG4gICAgICAgICAgICB2ZXJ0ZXg6IHtcbiAgICAgICAgICAgICAgICBtb2R1bGU6IHdlYmdwdVNoYWRlci5nZXRWZXJ0ZXhTaGFkZXJNb2R1bGUoKSxcbiAgICAgICAgICAgICAgICBlbnRyeVBvaW50OiB3ZWJncHVTaGFkZXIudmVydGV4RW50cnlQb2ludCxcbiAgICAgICAgICAgICAgICBidWZmZXJzOiB2ZXJ0ZXhCdWZmZXJMYXlvdXRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcmltaXRpdmU6IHtcbiAgICAgICAgICAgICAgICB0b3BvbG9neTogcHJpbWl0aXZlVG9wb2xvZ3ksXG4gICAgICAgICAgICAgICAgY3VsbE1vZGU6IFwibm9uZVwiXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBkZXB0aFN0ZW5jaWw6IHRoaXMuZ2V0RGVwdGhTdGVuY2lsKGRlcHRoU3RhdGUsIHJlbmRlclRhcmdldCksXG5cbiAgICAgICAgICAgIG11bHRpc2FtcGxlOiB7XG4gICAgICAgICAgICAgICAgY291bnQ6IHJlbmRlclRhcmdldC5zYW1wbGVzXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyB1bmlmb3JtIC8gdGV4dHVyZSBiaW5kaW5nIGxheW91dFxuICAgICAgICAgICAgbGF5b3V0OiBwaXBlbGluZUxheW91dFxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHByb3ZpZGUgZnJhZ21lbnQgc3RhdGUgb25seSB3aGVuIHJlbmRlciB0YXJnZXQgY29udGFpbnMgY29sb3IgYnVmZmVyLCBvdGhlcndpc2UgcmVuZGVyaW5nIHRvIGRlcHRoIG9ubHlcbiAgICAgICAgLy8gVE9ETzogdGhlIGV4Y2x1c2lvbiBvZiBmcmFnbWVudCBoZXJlIHNob3VsZCBiZSByZWZsZWN0ZWQgaW4gdGhlIGtleSBnZW5lcmF0aW9uIChubyBibGVuZCwgbm8gZnJhZyAuLilcbiAgICAgICAgY29uc3QgY29sb3JGb3JtYXQgPSByZW5kZXJUYXJnZXQuaW1wbC5jb2xvckZvcm1hdDtcbiAgICAgICAgaWYgKGNvbG9yRm9ybWF0KSB7XG5cbiAgICAgICAgICAgIGxldCB3cml0ZU1hc2sgPSAwO1xuICAgICAgICAgICAgaWYgKGJsZW5kU3RhdGUucmVkV3JpdGUpIHdyaXRlTWFzayB8PSBHUFVDb2xvcldyaXRlLlJFRDtcbiAgICAgICAgICAgIGlmIChibGVuZFN0YXRlLmdyZWVuV3JpdGUpIHdyaXRlTWFzayB8PSBHUFVDb2xvcldyaXRlLkdSRUVOO1xuICAgICAgICAgICAgaWYgKGJsZW5kU3RhdGUuYmx1ZVdyaXRlKSB3cml0ZU1hc2sgfD0gR1BVQ29sb3JXcml0ZS5CTFVFO1xuICAgICAgICAgICAgaWYgKGJsZW5kU3RhdGUuYWxwaGFXcml0ZSkgd3JpdGVNYXNrIHw9IEdQVUNvbG9yV3JpdGUuQUxQSEE7XG5cbiAgICAgICAgICAgIC8qKiBAdHlwZSB7R1BVRnJhZ21lbnRTdGF0ZX0gKi9cbiAgICAgICAgICAgIGRlc2NyLmZyYWdtZW50ID0ge1xuICAgICAgICAgICAgICAgIG1vZHVsZTogd2ViZ3B1U2hhZGVyLmdldEZyYWdtZW50U2hhZGVyTW9kdWxlKCksXG4gICAgICAgICAgICAgICAgZW50cnlQb2ludDogd2ViZ3B1U2hhZGVyLmZyYWdtZW50RW50cnlQb2ludCxcbiAgICAgICAgICAgICAgICB0YXJnZXRzOiBbe1xuICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IHJlbmRlclRhcmdldC5pbXBsLmNvbG9yRm9ybWF0LFxuICAgICAgICAgICAgICAgICAgICB3cml0ZU1hc2s6IHdyaXRlTWFzayxcbiAgICAgICAgICAgICAgICAgICAgYmxlbmQ6IHRoaXMuZ2V0QmxlbmQoYmxlbmRTdGF0ZSlcbiAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIFdlYmdwdURlYnVnLnZhbGlkYXRlKHRoaXMuZGV2aWNlKTtcblxuICAgICAgICBfcGlwZWxpbmVJZCsrO1xuICAgICAgICBEZWJ1Z0hlbHBlci5zZXRMYWJlbChkZXNjciwgYFJlbmRlclBpcGVsaW5lRGVzY3ItJHtfcGlwZWxpbmVJZH1gKTtcblxuICAgICAgICBjb25zdCBwaXBlbGluZSA9IHdncHUuY3JlYXRlUmVuZGVyUGlwZWxpbmUoZGVzY3IpO1xuXG4gICAgICAgIERlYnVnSGVscGVyLnNldExhYmVsKHBpcGVsaW5lLCBgUmVuZGVyUGlwZWxpbmUtJHtfcGlwZWxpbmVJZH1gKTtcbiAgICAgICAgRGVidWcudHJhY2UoVFJBQ0VJRF9SRU5ERVJQSVBFTElORV9BTExPQywgYEFsbG9jOiBJZCAke19waXBlbGluZUlkfWAsIGRlc2NyKTtcblxuICAgICAgICBXZWJncHVEZWJ1Zy5lbmQodGhpcy5kZXZpY2UsIHtcbiAgICAgICAgICAgIHJlbmRlclBpcGVsaW5lOiB0aGlzLFxuICAgICAgICAgICAgZGVzY3IsXG4gICAgICAgICAgICBzaGFkZXJcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHBpcGVsaW5lO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgV2ViZ3B1UmVuZGVyUGlwZWxpbmUgfTtcbiJdLCJuYW1lcyI6WyJfcGlwZWxpbmVJZCIsIl9sYXlvdXRJZCIsIl9wcmltaXRpdmVUb3BvbG9neSIsInVuZGVmaW5lZCIsIl9ibGVuZE9wZXJhdGlvbiIsIl9ibGVuZEZhY3RvciIsIl9kZXB0aENvbXBhcmVGdW5jdGlvbiIsIl9iaW5kR3JvdXBMYXlvdXRzIiwiV2ViZ3B1UmVuZGVyUGlwZWxpbmUiLCJjb25zdHJ1Y3RvciIsImRldmljZSIsInZlcnRleEJ1ZmZlckxheW91dCIsIldlYmdwdVZlcnRleEJ1ZmZlckxheW91dCIsImNhY2hlIiwiTWFwIiwiZ2V0IiwicHJpbWl0aXZlIiwidmVydGV4Rm9ybWF0MCIsInZlcnRleEZvcm1hdDEiLCJzaGFkZXIiLCJyZW5kZXJUYXJnZXQiLCJiaW5kR3JvdXBGb3JtYXRzIiwiYmxlbmRTdGF0ZSIsImRlcHRoU3RhdGUiLCJrZXkiLCJnZXRLZXkiLCJwaXBlbGluZSIsInByaW1pdGl2ZVRvcG9sb2d5IiwidHlwZSIsIkRlYnVnIiwiYXNzZXJ0IiwicGlwZWxpbmVMYXlvdXQiLCJnZXRQaXBlbGluZUxheW91dCIsImNyZWF0ZSIsInNldCIsImJpbmRHcm91cEtleSIsImkiLCJsZW5ndGgiLCJ2ZXJ0ZXhCdWZmZXJMYXlvdXRLZXkiLCJyZW5kZXJUYXJnZXRLZXkiLCJpbXBsIiwidmVydGV4Q29kZSIsImZyYWdtZW50Q29kZSIsImZvckVhY2giLCJmb3JtYXQiLCJwdXNoIiwiYmluZEdyb3VwTGF5b3V0IiwiZGVzY3IiLCJiaW5kR3JvdXBMYXlvdXRzIiwiRGVidWdIZWxwZXIiLCJzZXRMYWJlbCIsIndncHUiLCJjcmVhdGVQaXBlbGluZUxheW91dCIsInRyYWNlIiwiVFJBQ0VJRF9QSVBFTElORUxBWU9VVF9BTExPQyIsImdldEJsZW5kIiwiYmxlbmQiLCJjb2xvciIsIm9wZXJhdGlvbiIsImNvbG9yT3AiLCJzcmNGYWN0b3IiLCJjb2xvclNyY0ZhY3RvciIsImRzdEZhY3RvciIsImNvbG9yRHN0RmFjdG9yIiwiYWxwaGEiLCJhbHBoYU9wIiwiYWxwaGFTcmNGYWN0b3IiLCJhbHBoYURzdEZhY3RvciIsImdldERlcHRoU3RlbmNpbCIsImRlcHRoU3RlbmNpbCIsImRlcHRoIiwic3RlbmNpbCIsImRlcHRoRm9ybWF0IiwiZGVwdGhXcml0ZUVuYWJsZWQiLCJ3cml0ZSIsImRlcHRoQ29tcGFyZSIsImZ1bmMiLCJ3ZWJncHVTaGFkZXIiLCJ2ZXJ0ZXgiLCJtb2R1bGUiLCJnZXRWZXJ0ZXhTaGFkZXJNb2R1bGUiLCJlbnRyeVBvaW50IiwidmVydGV4RW50cnlQb2ludCIsImJ1ZmZlcnMiLCJ0b3BvbG9neSIsImN1bGxNb2RlIiwibXVsdGlzYW1wbGUiLCJjb3VudCIsInNhbXBsZXMiLCJsYXlvdXQiLCJjb2xvckZvcm1hdCIsIndyaXRlTWFzayIsInJlZFdyaXRlIiwiR1BVQ29sb3JXcml0ZSIsIlJFRCIsImdyZWVuV3JpdGUiLCJHUkVFTiIsImJsdWVXcml0ZSIsIkJMVUUiLCJhbHBoYVdyaXRlIiwiQUxQSEEiLCJmcmFnbWVudCIsImdldEZyYWdtZW50U2hhZGVyTW9kdWxlIiwiZnJhZ21lbnRFbnRyeVBvaW50IiwidGFyZ2V0cyIsIldlYmdwdURlYnVnIiwidmFsaWRhdGUiLCJjcmVhdGVSZW5kZXJQaXBlbGluZSIsIlRSQUNFSURfUkVOREVSUElQRUxJTkVf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
