/**
 * @license
 * PlayCanvas Engine v1.62.0-dev revision 7d088032c (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { SEMANTIC_POSITION } from '../../../platform/graphics/constants.js';
import { shaderChunks } from '../chunks/chunks.js';
import { ChunkUtils } from '../chunk-utils.js';
import { gammaCode, tonemapCode } from './common.js';
import { ShaderUtils } from '../../../platform/graphics/shader-utils.js';

const skybox = {
  generateKey: function (options) {
    return options.type === 'cubemap' ? `skybox-${options.type}-${options.encoding}-${options.useIntensity}-${options.gamma}-${options.toneMapping}-${options.fixSeams}-${options.mip}` : `skybox-${options.type}-${options.encoding}-${options.useIntensity}-${options.gamma}-${options.toneMapping}`;
  },
  createShaderDefinition: function (device, options) {
    let fshader = '';
    if (options.type === 'cubemap') {
      const mip2size = [128, 64, /* 32 */16, 8, 4, 2];
      fshader += options.mip ? shaderChunks.fixCubemapSeamsStretchPS : shaderChunks.fixCubemapSeamsNonePS;
      fshader += options.useIntensity ? shaderChunks.envMultiplyPS : shaderChunks.envConstPS;
      fshader += shaderChunks.decodePS;
      fshader += gammaCode(options.gamma);
      fshader += tonemapCode(options.toneMapping);
      fshader += shaderChunks.skyboxHDRPS.replace(/\$DECODE/g, ChunkUtils.decodeFunc(options.encoding)).replace(/\$FIXCONST/g, 1 - 1 / mip2size[options.mip] + "");
    } else {
      fshader += options.useIntensity ? shaderChunks.envMultiplyPS : shaderChunks.envConstPS;
      fshader += shaderChunks.decodePS;
      fshader += gammaCode(options.gamma);
      fshader += tonemapCode(options.toneMapping);
      fshader += shaderChunks.sphericalPS;
      fshader += shaderChunks.envAtlasPS;
      fshader += shaderChunks.skyboxEnvPS.replace(/\$DECODE/g, ChunkUtils.decodeFunc(options.encoding));
    }
    return ShaderUtils.createDefinition(device, {
      attributes: {
        aPosition: SEMANTIC_POSITION
      },
      vertexCode: shaderChunks.skyboxVS,
      fragmentCode: fshader
    });
  }
};

export { skybox };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2t5Ym94LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvc2NlbmUvc2hhZGVyLWxpYi9wcm9ncmFtcy9za3lib3guanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU0VNQU5USUNfUE9TSVRJT04gfSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgc2hhZGVyQ2h1bmtzIH0gZnJvbSAnLi4vY2h1bmtzL2NodW5rcy5qcyc7XG5pbXBvcnQgeyBDaHVua1V0aWxzIH0gZnJvbSAnLi4vY2h1bmstdXRpbHMuanMnO1xuXG5pbXBvcnQgeyBnYW1tYUNvZGUsIHRvbmVtYXBDb2RlIH0gZnJvbSAnLi9jb21tb24uanMnO1xuaW1wb3J0IHsgU2hhZGVyVXRpbHMgfSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9zaGFkZXItdXRpbHMuanMnO1xuXG5jb25zdCBza3lib3ggPSB7XG4gICAgZ2VuZXJhdGVLZXk6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLnR5cGUgPT09ICdjdWJlbWFwJyA/XG4gICAgICAgICAgICBgc2t5Ym94LSR7b3B0aW9ucy50eXBlfS0ke29wdGlvbnMuZW5jb2Rpbmd9LSR7b3B0aW9ucy51c2VJbnRlbnNpdHl9LSR7b3B0aW9ucy5nYW1tYX0tJHtvcHRpb25zLnRvbmVNYXBwaW5nfS0ke29wdGlvbnMuZml4U2VhbXN9LSR7b3B0aW9ucy5taXB9YCA6XG4gICAgICAgICAgICBgc2t5Ym94LSR7b3B0aW9ucy50eXBlfS0ke29wdGlvbnMuZW5jb2Rpbmd9LSR7b3B0aW9ucy51c2VJbnRlbnNpdHl9LSR7b3B0aW9ucy5nYW1tYX0tJHtvcHRpb25zLnRvbmVNYXBwaW5nfWA7XG4gICAgfSxcblxuICAgIGNyZWF0ZVNoYWRlckRlZmluaXRpb246IGZ1bmN0aW9uIChkZXZpY2UsIG9wdGlvbnMpIHtcbiAgICAgICAgbGV0IGZzaGFkZXIgPSAnJztcbiAgICAgICAgaWYgKG9wdGlvbnMudHlwZSA9PT0gJ2N1YmVtYXAnKSB7XG4gICAgICAgICAgICBjb25zdCBtaXAyc2l6ZSA9IFsxMjgsIDY0LCAvKiAzMiAqLyAxNiwgOCwgNCwgMl07XG4gICAgICAgICAgICBmc2hhZGVyICs9IG9wdGlvbnMubWlwID8gc2hhZGVyQ2h1bmtzLmZpeEN1YmVtYXBTZWFtc1N0cmV0Y2hQUyA6IHNoYWRlckNodW5rcy5maXhDdWJlbWFwU2VhbXNOb25lUFM7XG4gICAgICAgICAgICBmc2hhZGVyICs9IG9wdGlvbnMudXNlSW50ZW5zaXR5ID8gc2hhZGVyQ2h1bmtzLmVudk11bHRpcGx5UFMgOiBzaGFkZXJDaHVua3MuZW52Q29uc3RQUztcbiAgICAgICAgICAgIGZzaGFkZXIgKz0gc2hhZGVyQ2h1bmtzLmRlY29kZVBTO1xuICAgICAgICAgICAgZnNoYWRlciArPSBnYW1tYUNvZGUob3B0aW9ucy5nYW1tYSk7XG4gICAgICAgICAgICBmc2hhZGVyICs9IHRvbmVtYXBDb2RlKG9wdGlvbnMudG9uZU1hcHBpbmcpO1xuICAgICAgICAgICAgZnNoYWRlciArPSBzaGFkZXJDaHVua3Muc2t5Ym94SERSUFNcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFwkREVDT0RFL2csIENodW5rVXRpbHMuZGVjb2RlRnVuYyhvcHRpb25zLmVuY29kaW5nKSlcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFwkRklYQ09OU1QvZywgKDEgLSAxIC8gbWlwMnNpemVbb3B0aW9ucy5taXBdKSArIFwiXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZnNoYWRlciArPSBvcHRpb25zLnVzZUludGVuc2l0eSA/IHNoYWRlckNodW5rcy5lbnZNdWx0aXBseVBTIDogc2hhZGVyQ2h1bmtzLmVudkNvbnN0UFM7XG4gICAgICAgICAgICBmc2hhZGVyICs9IHNoYWRlckNodW5rcy5kZWNvZGVQUztcbiAgICAgICAgICAgIGZzaGFkZXIgKz0gZ2FtbWFDb2RlKG9wdGlvbnMuZ2FtbWEpO1xuICAgICAgICAgICAgZnNoYWRlciArPSB0b25lbWFwQ29kZShvcHRpb25zLnRvbmVNYXBwaW5nKTtcbiAgICAgICAgICAgIGZzaGFkZXIgKz0gc2hhZGVyQ2h1bmtzLnNwaGVyaWNhbFBTO1xuICAgICAgICAgICAgZnNoYWRlciArPSBzaGFkZXJDaHVua3MuZW52QXRsYXNQUztcbiAgICAgICAgICAgIGZzaGFkZXIgKz0gc2hhZGVyQ2h1bmtzLnNreWJveEVudlBTLnJlcGxhY2UoL1xcJERFQ09ERS9nLCBDaHVua1V0aWxzLmRlY29kZUZ1bmMob3B0aW9ucy5lbmNvZGluZykpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFNoYWRlclV0aWxzLmNyZWF0ZURlZmluaXRpb24oZGV2aWNlLCB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAgICAgYVBvc2l0aW9uOiBTRU1BTlRJQ19QT1NJVElPTlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHZlcnRleENvZGU6IHNoYWRlckNodW5rcy5za3lib3hWUyxcbiAgICAgICAgICAgIGZyYWdtZW50Q29kZTogZnNoYWRlclxuICAgICAgICB9KTtcbiAgICB9XG59O1xuXG5leHBvcnQgeyBza3lib3ggfTtcbiJdLCJuYW1lcyI6WyJza3lib3giLCJnZW5lcmF0ZUtleSIsIm9wdGlvbnMiLCJ0eXBlIiwiZW5jb2RpbmciLCJ1c2VJbnRlbnNpdHkiLCJnYW1tYSIsInRvbmVNYXBwaW5nIiwiZml4U2VhbXMiLCJtaXAiLCJjcmVhdGVTaGFkZXJEZWZpbml0aW9uIiwiZGV2aWNlIiwiZnNoYWRlciIsIm1pcDJzaXplIiwic2hhZGVyQ2h1bmtzIiwiZml4Q3ViZW1hcFNlYW1zU3RyZXRjaFBTIiwiZml4Q3ViZW1hcFNlYW1zTm9uZVBTIiwiZW52TXVsdGlwbHlQUyIsImVudkNvbnN0UFMiLCJkZWNvZGVQUyIsImdhbW1hQ29kZSIsInRvbmVtYXBDb2RlIiwic2t5Ym94SERSUFMiLCJyZXBsYWNlIiwiQ2h1bmtVdGlscyIsImRlY29kZUZ1bmMiLCJzcGhlcmljYWxQUyIsImVudkF0bGFzUFMiLCJza3lib3hFbnZQUyIsIlNoYWRlclV0aWxzIiwiY3JlYXRlRGVmaW5pdGlvbiIsImF0dHJpYnV0ZXMiLCJhUG9zaXRpb24iLCJTRU1BTlRJQ19QT1NJVElPTiIsInZlcnRleENvZGUiLCJza3lib3hWUyIsImZyYWdtZW50Q29kZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFPQSxNQUFNQSxNQUFNLEdBQUc7RUFDWEMsV0FBVyxFQUFFLFVBQVVDLE9BQU8sRUFBRTtJQUM1QixPQUFPQSxPQUFPLENBQUNDLElBQUksS0FBSyxTQUFTLEdBQzVCLENBQUEsT0FBQSxFQUFTRCxPQUFPLENBQUNDLElBQUssQ0FBQSxDQUFBLEVBQUdELE9BQU8sQ0FBQ0UsUUFBUyxDQUFHRixDQUFBQSxFQUFBQSxPQUFPLENBQUNHLFlBQWEsQ0FBR0gsQ0FBQUEsRUFBQUEsT0FBTyxDQUFDSSxLQUFNLENBQUdKLENBQUFBLEVBQUFBLE9BQU8sQ0FBQ0ssV0FBWSxDQUFHTCxDQUFBQSxFQUFBQSxPQUFPLENBQUNNLFFBQVMsQ0FBQSxDQUFBLEVBQUdOLE9BQU8sQ0FBQ08sR0FBSSxDQUFBLENBQUMsR0FDOUksQ0FBQSxPQUFBLEVBQVNQLE9BQU8sQ0FBQ0MsSUFBSyxDQUFBLENBQUEsRUFBR0QsT0FBTyxDQUFDRSxRQUFTLENBQUdGLENBQUFBLEVBQUFBLE9BQU8sQ0FBQ0csWUFBYSxDQUFHSCxDQUFBQSxFQUFBQSxPQUFPLENBQUNJLEtBQU0sQ0FBR0osQ0FBQUEsRUFBQUEsT0FBTyxDQUFDSyxXQUFZLENBQUMsQ0FBQSxDQUFBO0dBQ25IO0FBRURHLEVBQUFBLHNCQUFzQixFQUFFLFVBQVVDLE1BQU0sRUFBRVQsT0FBTyxFQUFFO0lBQy9DLElBQUlVLE9BQU8sR0FBRyxFQUFFLENBQUE7QUFDaEIsSUFBQSxJQUFJVixPQUFPLENBQUNDLElBQUksS0FBSyxTQUFTLEVBQUU7QUFDNUIsTUFBQSxNQUFNVSxRQUFRLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxVQUFXLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO01BQ2hERCxPQUFPLElBQUlWLE9BQU8sQ0FBQ08sR0FBRyxHQUFHSyxZQUFZLENBQUNDLHdCQUF3QixHQUFHRCxZQUFZLENBQUNFLHFCQUFxQixDQUFBO01BQ25HSixPQUFPLElBQUlWLE9BQU8sQ0FBQ0csWUFBWSxHQUFHUyxZQUFZLENBQUNHLGFBQWEsR0FBR0gsWUFBWSxDQUFDSSxVQUFVLENBQUE7TUFDdEZOLE9BQU8sSUFBSUUsWUFBWSxDQUFDSyxRQUFRLENBQUE7QUFDaENQLE1BQUFBLE9BQU8sSUFBSVEsU0FBUyxDQUFDbEIsT0FBTyxDQUFDSSxLQUFLLENBQUMsQ0FBQTtBQUNuQ00sTUFBQUEsT0FBTyxJQUFJUyxXQUFXLENBQUNuQixPQUFPLENBQUNLLFdBQVcsQ0FBQyxDQUFBO0FBQzNDSyxNQUFBQSxPQUFPLElBQUlFLFlBQVksQ0FBQ1EsV0FBVyxDQUM5QkMsT0FBTyxDQUFDLFdBQVcsRUFBRUMsVUFBVSxDQUFDQyxVQUFVLENBQUN2QixPQUFPLENBQUNFLFFBQVEsQ0FBQyxDQUFDLENBQzdEbUIsT0FBTyxDQUFDLGFBQWEsRUFBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHVixRQUFRLENBQUNYLE9BQU8sQ0FBQ08sR0FBRyxDQUFDLEdBQUksRUFBRSxDQUFDLENBQUE7QUFDckUsS0FBQyxNQUFNO01BQ0hHLE9BQU8sSUFBSVYsT0FBTyxDQUFDRyxZQUFZLEdBQUdTLFlBQVksQ0FBQ0csYUFBYSxHQUFHSCxZQUFZLENBQUNJLFVBQVUsQ0FBQTtNQUN0Rk4sT0FBTyxJQUFJRSxZQUFZLENBQUNLLFFBQVEsQ0FBQTtBQUNoQ1AsTUFBQUEsT0FBTyxJQUFJUSxTQUFTLENBQUNsQixPQUFPLENBQUNJLEtBQUssQ0FBQyxDQUFBO0FBQ25DTSxNQUFBQSxPQUFPLElBQUlTLFdBQVcsQ0FBQ25CLE9BQU8sQ0FBQ0ssV0FBVyxDQUFDLENBQUE7TUFDM0NLLE9BQU8sSUFBSUUsWUFBWSxDQUFDWSxXQUFXLENBQUE7TUFDbkNkLE9BQU8sSUFBSUUsWUFBWSxDQUFDYSxVQUFVLENBQUE7QUFDbENmLE1BQUFBLE9BQU8sSUFBSUUsWUFBWSxDQUFDYyxXQUFXLENBQUNMLE9BQU8sQ0FBQyxXQUFXLEVBQUVDLFVBQVUsQ0FBQ0MsVUFBVSxDQUFDdkIsT0FBTyxDQUFDRSxRQUFRLENBQUMsQ0FBQyxDQUFBO0FBQ3JHLEtBQUE7QUFFQSxJQUFBLE9BQU95QixXQUFXLENBQUNDLGdCQUFnQixDQUFDbkIsTUFBTSxFQUFFO0FBQ3hDb0IsTUFBQUEsVUFBVSxFQUFFO0FBQ1JDLFFBQUFBLFNBQVMsRUFBRUMsaUJBQUFBO09BQ2Q7TUFDREMsVUFBVSxFQUFFcEIsWUFBWSxDQUFDcUIsUUFBUTtBQUNqQ0MsTUFBQUEsWUFBWSxFQUFFeEIsT0FBQUE7QUFDbEIsS0FBQyxDQUFDLENBQUE7QUFDTixHQUFBO0FBQ0o7Ozs7In0=
