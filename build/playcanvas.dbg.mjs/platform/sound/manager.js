/**
 * @license
 * PlayCanvas Engine v1.58.0-preview revision 1fec26519 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../../core/debug.js';
import { EventHandler } from '../../core/event-handler.js';
import { math } from '../../core/math/math.js';
import { Channel } from '../audio/channel.js';
import { Channel3d } from '../audio/channel3d.js';
import { Listener } from './listener.js';

const CONTEXT_STATE_RUNNING = 'running';

const USER_INPUT_EVENTS = ['click', 'touchstart'];

class SoundManager extends EventHandler {
  constructor() {
    super();

    this._context = null;
    this.AudioContext = typeof AudioContext !== 'undefined' && AudioContext || typeof webkitAudioContext !== 'undefined' && webkitAudioContext;
    if (!this.AudioContext) {
      Debug.warn('No support for 3D audio found');
    }
    this._unlockHandlerFunc = this._unlockHandler.bind(this);

    this._userSuspended = false;
    this.listener = new Listener(this);
    this._volume = 1;
  }

  set volume(volume) {
    volume = math.clamp(volume, 0, 1);
    this._volume = volume;
    this.fire('volumechange', volume);
  }
  get volume() {
    return this._volume;
  }
  get suspended() {
    return this._userSuspended;
  }

  get context() {
    if (!this._context && this.AudioContext) {
      this._context = new this.AudioContext();
      if (this._context.state !== CONTEXT_STATE_RUNNING) {
        this._registerUnlockListeners();
      }
    }
    return this._context;
  }
  suspend() {
    if (!this._userSuspended) {
      this._userSuspended = true;
      if (this._context && this._context.state === CONTEXT_STATE_RUNNING) {
        this._suspend();
      }
    }
  }
  resume() {
    if (this._userSuspended) {
      this._userSuspended = false;
      if (this._context && this._context.state !== CONTEXT_STATE_RUNNING) {
        this._resume();
      }
    }
  }
  destroy() {
    this.fire('destroy');
    if (this._context) {
      var _this$_context;
      this._removeUnlockListeners();
      (_this$_context = this._context) == null ? void 0 : _this$_context.close();
      this._context = null;
    }
  }

  playSound(sound, options = {}) {
    let channel = null;
    if (Channel) {
      channel = new Channel(this, sound, options);
      channel.play();
    }
    return channel;
  }

  playSound3d(sound, position, options = {}) {
    let channel = null;
    if (Channel3d) {
      channel = new Channel3d(this, sound, options);
      channel.setPosition(position);
      if (options.volume) {
        channel.setVolume(options.volume);
      }
      if (options.loop) {
        channel.setLoop(options.loop);
      }
      if (options.maxDistance) {
        channel.setMaxDistance(options.maxDistance);
      }
      if (options.minDistance) {
        channel.setMinDistance(options.minDistance);
      }
      if (options.rollOffFactor) {
        channel.setRollOffFactor(options.rollOffFactor);
      }
      if (options.distanceModel) {
        channel.setDistanceModel(options.distanceModel);
      }
      channel.play();
    }
    return channel;
  }

  _resume() {
    this._context.resume().then(() => {
      const source = this._context.createBufferSource();
      source.buffer = this._context.createBuffer(1, 1, this._context.sampleRate);
      source.connect(this._context.destination);
      source.start(0);

      source.onended = event => {
        source.disconnect(0);
        this.fire('resume');
      };
    }, e => {
      Debug.error(`Attempted to resume the AudioContext on SoundManager.resume(), but it was rejected ${e}`);
    }).catch(e => {
      Debug.error(`Attempted to resume the AudioContext on SoundManager.resume(), but threw an exception ${e}`);
    });
  }

  _suspend() {
    this._context.suspend().then(() => {
      this.fire('suspend');
    }, e => {
      Debug.error(`Attempted to suspend the AudioContext on SoundManager.suspend(), but it was rejected ${e}`);
    }).catch(e => {
      Debug.error(`Attempted to suspend the AudioContext on SoundManager.suspend(), but threw an exception ${e}`);
    });
  }
  _unlockHandler() {
    this._removeUnlockListeners();
    if (!this._userSuspended && this._context.state !== CONTEXT_STATE_RUNNING) {
      this._resume();
    }
  }
  _registerUnlockListeners() {
    USER_INPUT_EVENTS.forEach(eventName => {
      window.addEventListener(eventName, this._unlockHandlerFunc, false);
    });
  }
  _removeUnlockListeners() {
    USER_INPUT_EVENTS.forEach(eventName => {
      window.removeEventListener(eventName, this._unlockHandlerFunc, false);
    });
  }
}

export { SoundManager };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFuYWdlci5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3BsYXRmb3JtL3NvdW5kL21hbmFnZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcgfSBmcm9tICcuLi8uLi9jb3JlL2RlYnVnLmpzJztcblxuaW1wb3J0IHsgRXZlbnRIYW5kbGVyIH0gZnJvbSAnLi4vLi4vY29yZS9ldmVudC1oYW5kbGVyLmpzJztcblxuaW1wb3J0IHsgbWF0aCB9IGZyb20gJy4uLy4uL2NvcmUvbWF0aC9tYXRoLmpzJztcblxuaW1wb3J0IHsgQ2hhbm5lbCB9IGZyb20gJy4uL2F1ZGlvL2NoYW5uZWwuanMnO1xuaW1wb3J0IHsgQ2hhbm5lbDNkIH0gZnJvbSAnLi4vYXVkaW8vY2hhbm5lbDNkLmpzJztcblxuaW1wb3J0IHsgTGlzdGVuZXIgfSBmcm9tICcuL2xpc3RlbmVyLmpzJztcblxuY29uc3QgQ09OVEVYVF9TVEFURV9SVU5OSU5HID0gJ3J1bm5pbmcnO1xuXG4vKipcbiAqIExpc3Qgb2YgV2luZG93IGV2ZW50cyB0byBsaXN0ZW4gd2hlbiBBdWRpb0NvbnRleHQgbmVlZHMgdG8gYmUgdW5sb2NrZWQuXG4gKi9cbmNvbnN0IFVTRVJfSU5QVVRfRVZFTlRTID0gW1xuICAgICdjbGljaycsICd0b3VjaHN0YXJ0J1xuXTtcblxuLyoqXG4gKiBUaGUgU291bmRNYW5hZ2VyIGlzIHVzZWQgdG8gbG9hZCBhbmQgcGxheSBhdWRpby4gSXQgYWxzbyBhcHBsaWVzIHN5c3RlbS13aWRlIHNldHRpbmdzIGxpa2VcbiAqIGdsb2JhbCB2b2x1bWUsIHN1c3BlbmQgYW5kIHJlc3VtZS5cbiAqXG4gKiBAYXVnbWVudHMgRXZlbnRIYW5kbGVyXG4gKi9cbmNsYXNzIFNvdW5kTWFuYWdlciBleHRlbmRzIEV2ZW50SGFuZGxlciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IFNvdW5kTWFuYWdlciBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdW5kZXJseWluZyBBdWRpb0NvbnRleHQsIGxhenkgbG9hZGVkIGluIHRoZSAnY29udGV4dCcgcHJvcGVydHkuXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIHtBdWRpb0NvbnRleHR9XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl9jb250ZXh0ID0gbnVsbDtcblxuICAgICAgICB0aGlzLkF1ZGlvQ29udGV4dCA9ICh0eXBlb2YgQXVkaW9Db250ZXh0ICE9PSAndW5kZWZpbmVkJyAmJiBBdWRpb0NvbnRleHQpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKHR5cGVvZiB3ZWJraXRBdWRpb0NvbnRleHQgIT09ICd1bmRlZmluZWQnICYmIHdlYmtpdEF1ZGlvQ29udGV4dCk7XG5cbiAgICAgICAgaWYgKCF0aGlzLkF1ZGlvQ29udGV4dCkge1xuICAgICAgICAgICAgRGVidWcud2FybignTm8gc3VwcG9ydCBmb3IgM0QgYXVkaW8gZm91bmQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3VubG9ja0hhbmRsZXJGdW5jID0gdGhpcy5fdW5sb2NrSGFuZGxlci5iaW5kKHRoaXMpO1xuXG4gICAgICAgIC8vIHVzZXIgc3VzcGVuZGVkIGF1ZGlvXG4gICAgICAgIHRoaXMuX3VzZXJTdXNwZW5kZWQgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLmxpc3RlbmVyID0gbmV3IExpc3RlbmVyKHRoaXMpO1xuXG4gICAgICAgIHRoaXMuX3ZvbHVtZSA9IDE7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2xvYmFsIHZvbHVtZSBmb3IgdGhlIG1hbmFnZXIuIEFsbCB7QGxpbmsgU291bmRJbnN0YW5jZX1zIHdpbGwgc2NhbGUgdGhlaXIgdm9sdW1lIHdpdGggdGhpc1xuICAgICAqIHZvbHVtZS4gVmFsaWQgYmV0d2VlbiBbMCwgMV0uXG4gICAgICpcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqL1xuICAgIHNldCB2b2x1bWUodm9sdW1lKSB7XG4gICAgICAgIHZvbHVtZSA9IG1hdGguY2xhbXAodm9sdW1lLCAwLCAxKTtcbiAgICAgICAgdGhpcy5fdm9sdW1lID0gdm9sdW1lO1xuICAgICAgICB0aGlzLmZpcmUoJ3ZvbHVtZWNoYW5nZScsIHZvbHVtZSk7XG4gICAgfVxuXG4gICAgZ2V0IHZvbHVtZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZvbHVtZTtcbiAgICB9XG5cbiAgICBnZXQgc3VzcGVuZGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdXNlclN1c3BlbmRlZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIFdlYiBBdWRpbyBBUEkgY29udGV4dC5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtBdWRpb0NvbnRleHR9XG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGdldCBjb250ZXh0KCkge1xuICAgICAgICAvLyBsYXp5IGNyZWF0ZSB0aGUgQXVkaW9Db250ZXh0XG4gICAgICAgIGlmICghdGhpcy5fY29udGV4dCAmJiB0aGlzLkF1ZGlvQ29udGV4dCkge1xuICAgICAgICAgICAgdGhpcy5fY29udGV4dCA9IG5ldyB0aGlzLkF1ZGlvQ29udGV4dCgpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5fY29udGV4dC5zdGF0ZSAhPT0gQ09OVEVYVF9TVEFURV9SVU5OSU5HKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVnaXN0ZXJVbmxvY2tMaXN0ZW5lcnMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl9jb250ZXh0O1xuICAgIH1cblxuICAgIHN1c3BlbmQoKSB7XG4gICAgICAgIGlmICghdGhpcy5fdXNlclN1c3BlbmRlZCkge1xuICAgICAgICAgICAgdGhpcy5fdXNlclN1c3BlbmRlZCA9IHRydWU7XG4gICAgICAgICAgICBpZiAodGhpcy5fY29udGV4dCAmJiB0aGlzLl9jb250ZXh0LnN0YXRlID09PSBDT05URVhUX1NUQVRFX1JVTk5JTkcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdXNwZW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXN1bWUoKSB7XG4gICAgICAgIGlmICh0aGlzLl91c2VyU3VzcGVuZGVkKSB7XG4gICAgICAgICAgICB0aGlzLl91c2VyU3VzcGVuZGVkID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy5fY29udGV4dCAmJiB0aGlzLl9jb250ZXh0LnN0YXRlICE9PSBDT05URVhUX1NUQVRFX1JVTk5JTkcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZXN1bWUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuZmlyZSgnZGVzdHJveScpO1xuXG4gICAgICAgIGlmICh0aGlzLl9jb250ZXh0KSB7XG4gICAgICAgICAgICB0aGlzLl9yZW1vdmVVbmxvY2tMaXN0ZW5lcnMoKTtcbiAgICAgICAgICAgIHRoaXMuX2NvbnRleHQ/LmNsb3NlKCk7XG4gICAgICAgICAgICB0aGlzLl9jb250ZXh0ID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyB7QGxpbmsgQ2hhbm5lbH0gYW5kIGJlZ2luIHBsYXliYWNrIG9mIHRoZSBzb3VuZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U291bmR9IHNvdW5kIC0gVGhlIFNvdW5kIG9iamVjdCB0byBwbGF5LlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zIC0gT3B0aW9uYWwgb3B0aW9ucyBvYmplY3QuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLnZvbHVtZV0gLSBUaGUgdm9sdW1lIHRvIHBsYXliYWNrIGF0LCBiZXR3ZWVuIDAgYW5kIDEuXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy5sb29wXSAtIFdoZXRoZXIgdG8gbG9vcCB0aGUgc291bmQgd2hlbiBpdCByZWFjaGVzIHRoZSBlbmQuXG4gICAgICogQHJldHVybnMge0NoYW5uZWx9IFRoZSBjaGFubmVsIHBsYXlpbmcgdGhlIHNvdW5kLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcGxheVNvdW5kKHNvdW5kLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgbGV0IGNoYW5uZWwgPSBudWxsO1xuICAgICAgICBpZiAoQ2hhbm5lbCkge1xuICAgICAgICAgICAgY2hhbm5lbCA9IG5ldyBDaGFubmVsKHRoaXMsIHNvdW5kLCBvcHRpb25zKTtcbiAgICAgICAgICAgIGNoYW5uZWwucGxheSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGFubmVsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyB7QGxpbmsgQ2hhbm5lbDNkfSBhbmQgYmVnaW4gcGxheWJhY2sgb2YgdGhlIHNvdW5kIGF0IHRoZSBwb3NpdGlvbiBzcGVjaWZpZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1NvdW5kfSBzb3VuZCAtIFRoZSBTb3VuZCBvYmplY3QgdG8gcGxheS5cbiAgICAgKiBAcGFyYW0ge1ZlYzN9IHBvc2l0aW9uIC0gVGhlIHBvc2l0aW9uIG9mIHRoZSBzb3VuZCBpbiAzRCBzcGFjZS5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gb3B0aW9ucyAtIE9wdGlvbmFsIG9wdGlvbnMgb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy52b2x1bWVdIC0gVGhlIHZvbHVtZSB0byBwbGF5YmFjayBhdCwgYmV0d2VlbiAwIGFuZCAxLlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW29wdGlvbnMubG9vcF0gLSBXaGV0aGVyIHRvIGxvb3AgdGhlIHNvdW5kIHdoZW4gaXQgcmVhY2hlcyB0aGUgZW5kLlxuICAgICAqIEByZXR1cm5zIHtDaGFubmVsM2R9IFRoZSAzRCBjaGFubmVsIHBsYXlpbmcgdGhlIHNvdW5kLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcGxheVNvdW5kM2Qoc291bmQsIHBvc2l0aW9uLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgbGV0IGNoYW5uZWwgPSBudWxsO1xuICAgICAgICBpZiAoQ2hhbm5lbDNkKSB7XG4gICAgICAgICAgICBjaGFubmVsID0gbmV3IENoYW5uZWwzZCh0aGlzLCBzb3VuZCwgb3B0aW9ucyk7XG4gICAgICAgICAgICBjaGFubmVsLnNldFBvc2l0aW9uKHBvc2l0aW9uKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnZvbHVtZSkge1xuICAgICAgICAgICAgICAgIGNoYW5uZWwuc2V0Vm9sdW1lKG9wdGlvbnMudm9sdW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvcHRpb25zLmxvb3ApIHtcbiAgICAgICAgICAgICAgICBjaGFubmVsLnNldExvb3Aob3B0aW9ucy5sb29wKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvcHRpb25zLm1heERpc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgY2hhbm5lbC5zZXRNYXhEaXN0YW5jZShvcHRpb25zLm1heERpc3RhbmNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvcHRpb25zLm1pbkRpc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgY2hhbm5lbC5zZXRNaW5EaXN0YW5jZShvcHRpb25zLm1pbkRpc3RhbmNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvcHRpb25zLnJvbGxPZmZGYWN0b3IpIHtcbiAgICAgICAgICAgICAgICBjaGFubmVsLnNldFJvbGxPZmZGYWN0b3Iob3B0aW9ucy5yb2xsT2ZmRmFjdG9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvcHRpb25zLmRpc3RhbmNlTW9kZWwpIHtcbiAgICAgICAgICAgICAgICBjaGFubmVsLnNldERpc3RhbmNlTW9kZWwob3B0aW9ucy5kaXN0YW5jZU1vZGVsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2hhbm5lbC5wbGF5KCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY2hhbm5lbDtcbiAgICB9XG5cbiAgICAvLyByZXN1bWUgdGhlIHNvdW5kIGNvbnRleHRcbiAgICBfcmVzdW1lKCkge1xuICAgICAgICB0aGlzLl9jb250ZXh0LnJlc3VtZSgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgLy8gU29tZSBwbGF0Zm9ybXMgKG1vc3RseSBpT1MpIHJlcXVpcmUgYW4gYWRkaXRpb25hbCBzb3VuZCB0byBiZSBwbGF5ZWQuXG4gICAgICAgICAgICAvLyBUaGlzIGFsc28gcGVyZm9ybXMgYSBzYW5pdHkgY2hlY2sgYW5kIHZlcmlmaWVzIHNvdW5kcyBjYW4gYmUgcGxheWVkLlxuICAgICAgICAgICAgY29uc3Qgc291cmNlID0gdGhpcy5fY29udGV4dC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtcbiAgICAgICAgICAgIHNvdXJjZS5idWZmZXIgPSB0aGlzLl9jb250ZXh0LmNyZWF0ZUJ1ZmZlcigxLCAxLCB0aGlzLl9jb250ZXh0LnNhbXBsZVJhdGUpO1xuICAgICAgICAgICAgc291cmNlLmNvbm5lY3QodGhpcy5fY29udGV4dC5kZXN0aW5hdGlvbik7XG4gICAgICAgICAgICBzb3VyY2Uuc3RhcnQoMCk7XG5cbiAgICAgICAgICAgIC8vIG9uZW5kZWQgaXMgb25seSBjYWxsZWQgaWYgZXZlcnl0aGluZyB3b3JrZWQgYXMgZXhwZWN0ZWQgKGNvbnRleHQgaXMgcnVubmluZylcbiAgICAgICAgICAgIHNvdXJjZS5vbmVuZGVkID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgc291cmNlLmRpc2Nvbm5lY3QoMCk7XG4gICAgICAgICAgICAgICAgdGhpcy5maXJlKCdyZXN1bWUnKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sIChlKSA9PiB7XG4gICAgICAgICAgICBEZWJ1Zy5lcnJvcihgQXR0ZW1wdGVkIHRvIHJlc3VtZSB0aGUgQXVkaW9Db250ZXh0IG9uIFNvdW5kTWFuYWdlci5yZXN1bWUoKSwgYnV0IGl0IHdhcyByZWplY3RlZCAke2V9YCk7XG4gICAgICAgIH0pLmNhdGNoKChlKSA9PiB7XG4gICAgICAgICAgICBEZWJ1Zy5lcnJvcihgQXR0ZW1wdGVkIHRvIHJlc3VtZSB0aGUgQXVkaW9Db250ZXh0IG9uIFNvdW5kTWFuYWdlci5yZXN1bWUoKSwgYnV0IHRocmV3IGFuIGV4Y2VwdGlvbiAke2V9YCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIHJlc3VtZSB0aGUgc291bmQgY29udGV4dCBhbmQgZmlyZSBzdXNwZW5kIGV2ZW50IGlmIGl0IHN1Y2NlZWRzXG4gICAgX3N1c3BlbmQoKSB7XG4gICAgICAgIHRoaXMuX2NvbnRleHQuc3VzcGVuZCgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5maXJlKCdzdXNwZW5kJyk7XG4gICAgICAgIH0sIChlKSA9PiB7XG4gICAgICAgICAgICBEZWJ1Zy5lcnJvcihgQXR0ZW1wdGVkIHRvIHN1c3BlbmQgdGhlIEF1ZGlvQ29udGV4dCBvbiBTb3VuZE1hbmFnZXIuc3VzcGVuZCgpLCBidXQgaXQgd2FzIHJlamVjdGVkICR7ZX1gKTtcbiAgICAgICAgfSkuY2F0Y2goKGUpID0+IHtcbiAgICAgICAgICAgIERlYnVnLmVycm9yKGBBdHRlbXB0ZWQgdG8gc3VzcGVuZCB0aGUgQXVkaW9Db250ZXh0IG9uIFNvdW5kTWFuYWdlci5zdXNwZW5kKCksIGJ1dCB0aHJldyBhbiBleGNlcHRpb24gJHtlfWApO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBfdW5sb2NrSGFuZGxlcigpIHtcbiAgICAgICAgdGhpcy5fcmVtb3ZlVW5sb2NrTGlzdGVuZXJzKCk7XG5cbiAgICAgICAgaWYgKCF0aGlzLl91c2VyU3VzcGVuZGVkICYmIHRoaXMuX2NvbnRleHQuc3RhdGUgIT09IENPTlRFWFRfU1RBVEVfUlVOTklORykge1xuICAgICAgICAgICAgdGhpcy5fcmVzdW1lKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfcmVnaXN0ZXJVbmxvY2tMaXN0ZW5lcnMoKSB7XG4gICAgICAgIC8vIGF0dGFjaCB0byBhbGwgdXNlciBpbnB1dCBldmVudHNcbiAgICAgICAgVVNFUl9JTlBVVF9FVkVOVFMuZm9yRWFjaCgoZXZlbnROYW1lKSA9PiB7XG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHRoaXMuX3VubG9ja0hhbmRsZXJGdW5jLCBmYWxzZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIF9yZW1vdmVVbmxvY2tMaXN0ZW5lcnMoKSB7XG4gICAgICAgIFVTRVJfSU5QVVRfRVZFTlRTLmZvckVhY2goKGV2ZW50TmFtZSkgPT4ge1xuICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCB0aGlzLl91bmxvY2tIYW5kbGVyRnVuYywgZmFsc2UpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFNvdW5kTWFuYWdlciB9O1xuIl0sIm5hbWVzIjpbIkNPTlRFWFRfU1RBVEVfUlVOTklORyIsIlVTRVJfSU5QVVRfRVZFTlRTIiwiU291bmRNYW5hZ2VyIiwiRXZlbnRIYW5kbGVyIiwiY29uc3RydWN0b3IiLCJfY29udGV4dCIsIkF1ZGlvQ29udGV4dCIsIndlYmtpdEF1ZGlvQ29udGV4dCIsIkRlYnVnIiwid2FybiIsIl91bmxvY2tIYW5kbGVyRnVuYyIsIl91bmxvY2tIYW5kbGVyIiwiYmluZCIsIl91c2VyU3VzcGVuZGVkIiwibGlzdGVuZXIiLCJMaXN0ZW5lciIsIl92b2x1bWUiLCJ2b2x1bWUiLCJtYXRoIiwiY2xhbXAiLCJmaXJlIiwic3VzcGVuZGVkIiwiY29udGV4dCIsInN0YXRlIiwiX3JlZ2lzdGVyVW5sb2NrTGlzdGVuZXJzIiwic3VzcGVuZCIsIl9zdXNwZW5kIiwicmVzdW1lIiwiX3Jlc3VtZSIsImRlc3Ryb3kiLCJfcmVtb3ZlVW5sb2NrTGlzdGVuZXJzIiwiY2xvc2UiLCJwbGF5U291bmQiLCJzb3VuZCIsIm9wdGlvbnMiLCJjaGFubmVsIiwiQ2hhbm5lbCIsInBsYXkiLCJwbGF5U291bmQzZCIsInBvc2l0aW9uIiwiQ2hhbm5lbDNkIiwic2V0UG9zaXRpb24iLCJzZXRWb2x1bWUiLCJsb29wIiwic2V0TG9vcCIsIm1heERpc3RhbmNlIiwic2V0TWF4RGlzdGFuY2UiLCJtaW5EaXN0YW5jZSIsInNldE1pbkRpc3RhbmNlIiwicm9sbE9mZkZhY3RvciIsInNldFJvbGxPZmZGYWN0b3IiLCJkaXN0YW5jZU1vZGVsIiwic2V0RGlzdGFuY2VNb2RlbCIsInRoZW4iLCJzb3VyY2UiLCJjcmVhdGVCdWZmZXJTb3VyY2UiLCJidWZmZXIiLCJjcmVhdGVCdWZmZXIiLCJzYW1wbGVSYXRlIiwiY29ubmVjdCIsImRlc3RpbmF0aW9uIiwic3RhcnQiLCJvbmVuZGVkIiwiZXZlbnQiLCJkaXNjb25uZWN0IiwiZSIsImVycm9yIiwiY2F0Y2giLCJmb3JFYWNoIiwiZXZlbnROYW1lIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQVdBLE1BQU1BLHFCQUFxQixHQUFHLFNBQVMsQ0FBQTs7QUFLdkMsTUFBTUMsaUJBQWlCLEdBQUcsQ0FDdEIsT0FBTyxFQUFFLFlBQVksQ0FDeEIsQ0FBQTs7QUFRRCxNQUFNQyxZQUFZLFNBQVNDLFlBQVksQ0FBQztBQUtwQ0MsRUFBQUEsV0FBVyxHQUFHO0FBQ1YsSUFBQSxLQUFLLEVBQUUsQ0FBQTs7SUFRUCxJQUFJLENBQUNDLFFBQVEsR0FBRyxJQUFJLENBQUE7QUFFcEIsSUFBQSxJQUFJLENBQUNDLFlBQVksR0FBSSxPQUFPQSxZQUFZLEtBQUssV0FBVyxJQUFJQSxZQUFZLElBQ25ELE9BQU9DLGtCQUFrQixLQUFLLFdBQVcsSUFBSUEsa0JBQW1CLENBQUE7QUFFckYsSUFBQSxJQUFJLENBQUMsSUFBSSxD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
