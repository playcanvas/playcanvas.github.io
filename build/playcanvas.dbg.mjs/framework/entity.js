/**
 * @license
 * PlayCanvas Engine v1.58.0-preview revision 1fec26519 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../core/debug.js';
import { guid } from '../core/guid.js';
import { GraphNode } from '../scene/graph-node.js';
import { getApplication } from './globals.js';

const _enableList = [];

class Entity extends GraphNode {

  constructor(name, app = getApplication()) {
    super(name);
    this.anim = void 0;
    this.animation = void 0;
    this.audiolistener = void 0;
    this.button = void 0;
    this.camera = void 0;
    this.collision = void 0;
    this.element = void 0;
    this.layoutchild = void 0;
    this.layoutgroup = void 0;
    this.light = void 0;
    this.model = void 0;
    this.particlesystem = void 0;
    this.render = void 0;
    this.rigidbody = void 0;
    this.screen = void 0;
    this.script = void 0;
    this.scrollbar = void 0;
    this.scrollview = void 0;
    this.sound = void 0;
    this.sprite = void 0;
    this.c = {};
    this._app = void 0;
    this._destroying = false;
    this._guid = null;
    this._template = false;
    Debug.assert(app, 'Could not find current application');
    this._app = app;
  }

  addComponent(type, data) {
    const system = this._app.systems[type];
    if (!system) {
      Debug.error(`addComponent: System ${type} doesn't exist`);
      return null;
    }
    if (this.c[type]) {
      Debug.warn(`addComponent: Entity already has ${type} component`);
      return null;
    }
    return system.addComponent(this, data);
  }

  removeComponent(type) {
    const system = this._app.systems[type];
    if (!system) {
      Debug.error(`addComponent: System ${type} doesn't exist`);
      return;
    }
    if (!this.c[type]) {
      Debug.warn(`removeComponent: Entity doesn't have ${type} component`);
      return;
    }
    system.removeComponent(this);
  }

  findComponent(type) {
    const entity = this.findOne(function (node) {
      return node.c && node.c[type];
    });
    return entity && entity.c[type];
  }

  findComponents(type) {
    const entities = this.find(function (node) {
      return node.c && node.c[type];
    });
    return entities.map(function (entity) {
      return entity.c[type];
    });
  }

  getGuid() {
    if (!this._guid) {
      this.setGuid(guid.create());
    }
    return this._guid;
  }

  setGuid(guid) {
    const index = this._app._entityIndex;
    if (this._guid) {
      delete index[this._guid];
    }

    this._guid = guid;
    index[this._guid] = this;
  }

  _notifyHierarchyStateChanged(node, enabled) {
    let enableFirst = false;
    if (node === this && _enableList.length === 0) enableFirst = true;
    node._beingEnabled = true;
    node._onHierarchyStateChanged(enabled);
    if (node._onHierarchyStatePostChanged) _enableList.push(node);
    const c = node._children;
    for (let i = 0, len = c.length; i < len; i++) {
      if (c[i]._enabled) this._notifyHierarchyStateChanged(c[i], enabled);
    }
    node._beingEnabled = false;
    if (enableFirst) {
      for (let i = 0; i < _enableList.length; i++) {
        _enableList[i]._onHierarchyStatePostChanged();
      }
      _enableList.length = 0;
    }
  }

  _onHierarchyStateChanged(enabled) {
    super._onHierarchyStateChanged(enabled);

    const components = this.c;
    for (const type in components) {
      if (components.hasOwnProperty(type)) {
        const component = components[type];
        if (component.enabled) {
          if (enabled) {
            component.onEnable();
          } else {
            component.onDisable();
          }
        }
      }
    }
  }

  _onHierarchyStatePostChanged() {
    const components = this.c;
    for (const type in components) {
      if (components.hasOwnProperty(type)) components[type].onPostStateChange();
    }
  }

  findByGuid(guid) {
    if (this._guid === guid) return this;
    const e = this._app._entityIndex[guid];
    if (e && (e === this || e.isDescendantOf(this))) {
      return e;
    }
    return null;
  }

  destroy() {
    this._destroying = true;

    for (const name in this.c) {
      this.c[name].enabled = false;
    }

    for (const name in this.c) {
      this.c[name].system.removeComponent(this);
    }

    if (this._parent) this._parent.removeChild(this);

    const children = this._children;
    while (children.length) {
      const child = children.pop();
      child._parent = null;
      if (child instanceof Entity) {
        child.destroy();
      }
    }

    this.fire('destroy', this);

    this.off();

    if (this._guid) {
      delete this._app._entityIndex[this._guid];
    }
    this._destroying = false;
  }

  clone() {
    const duplicatedIdsMap = {};
    const clone = this._cloneRecursively(duplicatedIdsMap);
    duplicatedIdsMap[this.getGuid()] = clone;
    resolveDuplicatedEntityReferenceProperties(this, this, clone, duplicatedIdsMap);
    return clone;
  }

  _cloneRecursively(duplicatedIdsMap) {
    const clone = new this.constructor(undefined, this._app);
    super._cloneInternal(clone);
    for (const type in this.c) {
      const component = this.c[type];
      component.system.cloneComponent(this, clone);
    }
    for (let i = 0; i < this._children.length; i++) {
      const oldChild = this._children[i];
      if (oldChild instanceof Entity) {
        const newChild = oldChild._cloneRecursively(duplicatedIdsMap);
        clone.addChild(newChild);
        duplicatedIdsMap[oldChild.getGuid()] = newChild;
      }
    }
    return clone;
  }
}

function resolveDuplicatedEntityReferenceProperties(oldSubtreeRoot, oldEntity, newEntity, duplicatedIdsMap) {
  if (oldEntity instanceof Entity) {
    const components = oldEntity.c;

    for (const componentName in components) {
      const component = components[componentName];
      const entityProperties = component.system.getPropertiesOfType('entity');
      for (let i = 0, len = entityProperties.length; i < len; i++) {
        const propertyDescriptor = entityProperties[i];
        const propertyName = propertyDescriptor.name;
        const oldEntityReferenceId = component[propertyName];
        const entityIsWithinOldSubtree = !!oldSubtreeRoot.findByGuid(oldEntityReferenceId);
        if (entityIsWithinOldSubtree) {
          const newEntityReferenceId = duplicatedIdsMap[oldEntityReferenceId].getGuid();
          if (newEntityReferenceId) {
            newEntity.c[componentName][propertyName] = newEntityReferenceId;
          } else {
            Debug.warn('Could not find corresponding entity id when resolving duplicated entity references');
          }
        }
      }
    }

    if (components.script && !newEntity._app.useLegacyScriptAttributeCloning) {
      newEntity.script.resolveDuplicatedEntityReferenceProperties(components.script, duplicatedIdsMap);
    }

    if (components.render) {
      newEntity.render.resolveDuplicatedEntityReferenceProperties(components.render, duplicatedIdsMap);
    }

    if (components.anim) {
      newEntity.anim.resolveDuplicatedEntityReferenceProperties(components.anim, duplicatedIdsMap);
    }

    const _old = oldEntity.children.filter(function (e) {
      return e instanceof Entity;
    });
    const _new = newEntity.children.filter(function (e) {
      return e instanceof Entity;
    });
    for (let i = 0, len = _old.length; i < len; i++) {
      resolveDuplicatedEntityReferenceProperties(oldSubtreeRoot, _old[i], _new[i], duplicatedIdsMap);
    }
  }
}

export { Entity };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2VudGl0eS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uL2NvcmUvZGVidWcuanMnO1xuaW1wb3J0IHsgZ3VpZCB9IGZyb20gJy4uL2NvcmUvZ3VpZC5qcyc7XG5cbmltcG9ydCB7IEdyYXBoTm9kZSB9IGZyb20gJy4uL3NjZW5lL2dyYXBoLW5vZGUuanMnO1xuXG5pbXBvcnQgeyBnZXRBcHBsaWNhdGlvbiB9IGZyb20gJy4vZ2xvYmFscy5qcyc7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2NvbXBvbmVudHMvY29tcG9uZW50LmpzJykuQ29tcG9uZW50fSBDb21wb25lbnQgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2NvbXBvbmVudHMvYW5pbS9jb21wb25lbnQuanMnKS5BbmltQ29tcG9uZW50fSBBbmltQ29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL2FuaW1hdGlvbi9jb21wb25lbnQuanMnKS5BbmltYXRpb25Db21wb25lbnR9IEFuaW1hdGlvbkNvbXBvbmVudCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vY29tcG9uZW50cy9hdWRpby1saXN0ZW5lci9jb21wb25lbnQuanMnKS5BdWRpb0xpc3RlbmVyQ29tcG9uZW50fSBBdWRpb0xpc3RlbmVyQ29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL2J1dHRvbi9jb21wb25lbnQuanMnKS5CdXR0b25Db21wb25lbnR9IEJ1dHRvbkNvbXBvbmVudCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vY29tcG9uZW50cy9jYW1lcmEvY29tcG9uZW50LmpzJykuQ2FtZXJhQ29tcG9uZW50fSBDYW1lcmFDb21wb25lbnQgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2NvbXBvbmVudHMvY29sbGlzaW9uL2NvbXBvbmVudC5qcycpLkNvbGxpc2lvbkNvbXBvbmVudH0gQ29sbGlzaW9uQ29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL2VsZW1lbnQvY29tcG9uZW50LmpzJykuRWxlbWVudENvbXBvbmVudH0gRWxlbWVudENvbXBvbmVudCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vY29tcG9uZW50cy9sYXlvdXQtY2hpbGQvY29tcG9uZW50LmpzJykuTGF5b3V0Q2hpbGRDb21wb25lbnR9IExheW91dENoaWxkQ29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL2xheW91dC1ncm91cC9jb21wb25lbnQuanMnKS5MYXlvdXRHcm91cENvbXBvbmVudH0gTGF5b3V0R3JvdXBDb21wb25lbnQgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2NvbXBvbmVudHMvbGlnaHQvY29tcG9uZW50LmpzJykuTGlnaHRDb21wb25lbnR9IExpZ2h0Q29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL21vZGVsL2NvbXBvbmVudC5qcycpLk1vZGVsQ29tcG9uZW50fSBNb2RlbENvbXBvbmVudCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vY29tcG9uZW50cy9wYXJ0aWNsZS1zeXN0ZW0vY29tcG9uZW50LmpzJykuUGFydGljbGVTeXN0ZW1Db21wb25lbnR9IFBhcnRpY2xlU3lzdGVtQ29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL3JlbmRlci9jb21wb25lbnQuanMnKS5SZW5kZXJDb21wb25lbnR9IFJlbmRlckNvbXBvbmVudCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vY29tcG9uZW50cy9yaWdpZC1ib2R5L2NvbXBvbmVudC5qcycpLlJpZ2lkQm9keUNvbXBvbmVudH0gUmlnaWRCb2R5Q29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL3NjcmVlbi9jb21wb25lbnQuanMnKS5TY3JlZW5Db21wb25lbnR9IFNjcmVlbkNvbXBvbmVudCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vY29tcG9uZW50cy9zY3JpcHQvY29tcG9uZW50LmpzJykuU2NyaXB0Q29tcG9uZW50fSBTY3JpcHRDb21wb25lbnQgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2NvbXBvbmVudHMvc2Nyb2xsYmFyL2NvbXBvbmVudC5qcycpLlNjcm9sbGJhckNvbXBvbmVudH0gU2Nyb2xsYmFyQ29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL3Njcm9sbC12aWV3L2NvbXBvbmVudC5qcycpLlNjcm9sbFZpZXdDb21wb25lbnR9IFNjcm9sbFZpZXdDb21wb25lbnQgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2NvbXBvbmVudHMvc291bmQvY29tcG9uZW50LmpzJykuU291bmRDb21wb25lbnR9IFNvdW5kQ29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL3Nwcml0ZS9jb21wb25lbnQuanMnKS5TcHJpdGVDb21wb25lbnR9IFNwcml0ZUNvbXBvbmVudCAqL1xuXG4vKipcbiAqIEB0eXBlIHtHcmFwaE5vZGVbXX1cbiAqIEBpZ25vcmVcbiAqL1xuY29uc3QgX2VuYWJsZUxpc3QgPSBbXTtcblxuLyoqXG4gKiBUaGUgRW50aXR5IGlzIHRoZSBjb3JlIHByaW1pdGl2ZSBvZiBhIFBsYXlDYW52YXMgZ2FtZS4gR2VuZXJhbGx5IHNwZWFraW5nIGFuIG9iamVjdCBpbiB5b3VyIGdhbWVcbiAqIHdpbGwgY29uc2lzdCBvZiBhbiB7QGxpbmsgRW50aXR5fSwgYW5kIGEgc2V0IG9mIHtAbGluayBDb21wb25lbnR9cyB3aGljaCBhcmUgbWFuYWdlZCBieSB0aGVpclxuICogcmVzcGVjdGl2ZSB7QGxpbmsgQ29tcG9uZW50U3lzdGVtfXMuIE9uZSBvZiB0aG9zZSBjb21wb25lbnRzIG1heWJlIGEge0BsaW5rIFNjcmlwdENvbXBvbmVudH1cbiAqIHdoaWNoIGFsbG93cyB5b3UgdG8gd3JpdGUgY3VzdG9tIGNvZGUgdG8gYXR0YWNoIHRvIHlvdXIgRW50aXR5LlxuICpcbiAqIFRoZSBFbnRpdHkgdW5pcXVlbHkgaWRlbnRpZmllcyB0aGUgb2JqZWN0IGFuZCBhbHNvIHByb3ZpZGVzIGEgdHJhbnNmb3JtIGZvciBwb3NpdGlvbiBhbmRcbiAqIG9yaWVudGF0aW9uIHdoaWNoIGl0IGluaGVyaXRzIGZyb20ge0BsaW5rIEdyYXBoTm9kZX0gc28gY2FuIGJlIGFkZGVkIGludG8gdGhlIHNjZW5lIGdyYXBoLiBUaGVcbiAqIENvbXBvbmVudCBhbmQgQ29tcG9uZW50U3lzdGVtIHByb3ZpZGUgdGhlIGxvZ2ljIHRvIGdpdmUgYW4gRW50aXR5IGEgc3BlY2lmaWMgdHlwZSBvZiBiZWhhdmlvci5cbiAqIGUuZy4gdGhlIGFiaWxpdHkgdG8gcmVuZGVyIGEgbW9kZWwgb3IgcGxheSBhIHNvdW5kLiBDb21wb25lbnRzIGFyZSBzcGVjaWZpYyB0byBhbiBpbnN0YW5jZSBvZiBhblxuICogRW50aXR5IGFuZCBhcmUgYXR0YWNoZWQgKGUuZy4gYHRoaXMuZW50aXR5Lm1vZGVsYCkgQ29tcG9uZW50U3lzdGVtcyBhbGxvdyBhY2Nlc3MgdG8gYWxsIEVudGl0aWVzXG4gKiBhbmQgQ29tcG9uZW50cyBhbmQgYXJlIGF0dGFjaGVkIHRvIHRoZSB7QGxpbmsgQXBwQmFzZX0uXG4gKlxuICogQGF1Z21lbnRzIEdyYXBoTm9kZVxuICovXG5jbGFzcyBFbnRpdHkgZXh0ZW5kcyBHcmFwaE5vZGUge1xuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHtAbGluayBBbmltQ29tcG9uZW50fSBhdHRhY2hlZCB0byB0aGlzIGVudGl0eS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtBbmltQ29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBhbmltO1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUge0BsaW5rIEFuaW1hdGlvbkNvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7QW5pbWF0aW9uQ29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBhbmltYXRpb247XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSB7QGxpbmsgQXVkaW9MaXN0ZW5lckNvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7QXVkaW9MaXN0ZW5lckNvbXBvbmVudHx1bmRlZmluZWR9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgYXVkaW9saXN0ZW5lcjtcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHtAbGluayBCdXR0b25Db21wb25lbnR9IGF0dGFjaGVkIHRvIHRoaXMgZW50aXR5LlxuICAgICAqXG4gICAgICogQHR5cGUge0J1dHRvbkNvbXBvbmVudHx1bmRlZmluZWR9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgYnV0dG9uO1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUge0BsaW5rIENhbWVyYUNvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7Q2FtZXJhQ29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBjYW1lcmE7XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSB7QGxpbmsgQ29sbGlzaW9uQ29tcG9uZW50fSBhdHRhY2hlZCB0byB0aGlzIGVudGl0eS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtDb2xsaXNpb25Db21wb25lbnR8dW5kZWZpbmVkfVxuICAgICAqIEByZWFkb25seVxuICAgICAqL1xuICAgIGNvbGxpc2lvbjtcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHtAbGluayBFbGVtZW50Q29tcG9uZW50fSBhdHRhY2hlZCB0byB0aGlzIGVudGl0eS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtFbGVtZW50Q29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBlbGVtZW50O1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUge0BsaW5rIExheW91dENoaWxkQ29tcG9uZW50fSBhdHRhY2hlZCB0byB0aGlzIGVudGl0eS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtMYXlvdXRDaGlsZENvbXBvbmVudHx1bmRlZmluZWR9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgbGF5b3V0Y2hpbGQ7XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSB7QGxpbmsgTGF5b3V0R3JvdXBDb21wb25lbnR9IGF0dGFjaGVkIHRvIHRoaXMgZW50aXR5LlxuICAgICAqXG4gICAgICogQHR5cGUge0xheW91dEdyb3VwQ29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBsYXlvdXRncm91cDtcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHtAbGluayBMaWdodENvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7TGlnaHRDb21wb25lbnR8dW5kZWZpbmVkfVxuICAgICAqIEByZWFkb25seVxuICAgICAqL1xuICAgIGxpZ2h0O1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUge0BsaW5rIE1vZGVsQ29tcG9uZW50fSBhdHRhY2hlZCB0byB0aGlzIGVudGl0eS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtNb2RlbENvbXBvbmVudHx1bmRlZmluZWR9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgbW9kZWw7XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSB7QGxpbmsgUGFydGljbGVTeXN0ZW1Db21wb25lbnR9IGF0dGFjaGVkIHRvIHRoaXMgZW50aXR5LlxuICAgICAqXG4gICAgICogQHR5cGUge1BhcnRpY2xlU3lzdGVtQ29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBwYXJ0aWNsZXN5c3RlbTtcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHtAbGluayBSZW5kZXJDb21wb25lbnR9IGF0dGFjaGVkIHRvIHRoaXMgZW50aXR5LlxuICAgICAqXG4gICAgICogQHR5cGUge1JlbmRlckNvbXBvbmVudHx1bmRlZmluZWR9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgcmVuZGVyO1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUge0BsaW5rIFJpZ2lkQm9keUNvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7UmlnaWRCb2R5Q29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICByaWdpZGJvZHk7XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSB7QGxpbmsgU2NyZWVuQ29tcG9uZW50fSBhdHRhY2hlZCB0byB0aGlzIGVudGl0eS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtTY3JlZW5Db21wb25lbnR8dW5kZWZpbmVkfVxuICAgICAqIEByZWFkb25seVxuICAgICAqL1xuICAgIHNjcmVlbjtcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHtAbGluayBTY3JpcHRDb21wb25lbnR9IGF0dGFjaGVkIHRvIHRoaXMgZW50aXR5LlxuICAgICAqXG4gICAgICogQHR5cGUge1NjcmlwdENvbXBvbmVudHx1bmRlZmluZWR9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgc2NyaXB0O1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUge0BsaW5rIFNjcm9sbGJhckNvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7U2Nyb2xsYmFyQ29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBzY3JvbGxiYXI7XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSB7QGxpbmsgU2Nyb2xsVmlld0NvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7U2Nyb2xsVmlld0NvbXBvbmVudHx1bmRlZmluZWR9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgc2Nyb2xsdmlldztcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHtAbGluayBTb3VuZENvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7U291bmRDb21wb25lbnR8dW5kZWZpbmVkfVxuICAgICAqIEByZWFkb25seVxuICAgICAqL1xuICAgIHNvdW5kO1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUge0BsaW5rIFNwcml0ZUNvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7U3ByaXRlQ29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBzcHJpdGU7XG5cbiAgICAvKipcbiAgICAgKiBDb21wb25lbnQgc3RvcmFnZS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtPYmplY3Q8c3RyaW5nLCBDb21wb25lbnQ+fVxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBjID0ge307XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7QXBwQmFzZX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9hcHA7XG5cbiAgICAvKipcbiAgICAgKiBVc2VkIGJ5IGNvbXBvbmVudCBzeXN0ZW1zIHRvIHNwZWVkIHVwIGRlc3RydWN0aW9uLlxuICAgICAqXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIF9kZXN0cm95aW5nID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7c3RyaW5nfG51bGx9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZ3VpZCA9IG51bGw7XG5cbiAgICAvKipcbiAgICAgKiBVc2VkIHRvIGRpZmZlcmVudGlhdGUgYmV0d2VlbiB0aGUgZW50aXRpZXMgb2YgYSB0ZW1wbGF0ZSByb290IGluc3RhbmNlLCB3aGljaCBoYXZlIGl0IHNldCB0b1xuICAgICAqIHRydWUsIGFuZCB0aGUgY2xvbmVkIGluc3RhbmNlIGVudGl0aWVzIChzZXQgdG8gZmFsc2UpLlxuICAgICAqXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIF90ZW1wbGF0ZSA9IGZhbHNlO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IEVudGl0eS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbbmFtZV0gLSBUaGUgbm9uLXVuaXF1ZSBuYW1lIG9mIHRoZSBlbnRpdHksIGRlZmF1bHQgaXMgXCJVbnRpdGxlZFwiLlxuICAgICAqIEBwYXJhbSB7QXBwQmFzZX0gW2FwcF0gLSBUaGUgYXBwbGljYXRpb24gdGhlIGVudGl0eSBiZWxvbmdzIHRvLCBkZWZhdWx0IGlzIHRoZSBjdXJyZW50IGFwcGxpY2F0aW9uLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogdmFyIGVudGl0eSA9IG5ldyBwYy5FbnRpdHkoKTtcbiAgICAgKlxuICAgICAqIC8vIEFkZCBhIENvbXBvbmVudCB0byB0aGUgRW50aXR5XG4gICAgICogZW50aXR5LmFkZENvbXBvbmVudChcImNhbWVyYVwiLCB7XG4gICAgICogICAgIGZvdjogNDUsXG4gICAgICogICAgIG5lYXJDbGlwOiAxLFxuICAgICAqICAgICBmYXJDbGlwOiAxMDAwMFxuICAgICAqIH0pO1xuICAgICAqXG4gICAgICogLy8gQWRkIHRoZSBFbnRpdHkgaW50byB0aGUgc2NlbmUgZ3JhcGhcbiAgICAgKiBhcHAucm9vdC5hZGRDaGlsZChlbnRpdHkpO1xuICAgICAqXG4gICAgICogLy8gTW92ZSB0aGUgZW50aXR5XG4gICAgICogZW50aXR5LnRyYW5zbGF0ZSgxMCwgMCwgMCk7XG4gICAgICpcbiAgICAgKiAvLyBPciB0cmFuc2xhdGUgaXQgYnkgc2V0dGluZyBpdHMgcG9zaXRpb24gZGlyZWN0bHlcbiAgICAgKiB2YXIgcCA9IGVudGl0eS5nZXRQb3NpdGlvbigpO1xuICAgICAqIGVudGl0eS5zZXRQb3NpdGlvbihwLnggKyAxMCwgcC55LCBwLnopO1xuICAgICAqXG4gICAgICogLy8gQ2hhbmdlIHRoZSBlbnRpdHkncyByb3RhdGlvbiBpbiBsb2NhbCBzcGFjZVxuICAgICAqIHZhciBlID0gZW50aXR5LmdldExvY2FsRXVsZXJBbmdsZXMoKTtcbiAgICAgKiBlbnRpdHkuc2V0TG9jYWxFdWxlckFuZ2xlcyhlLngsIGUueSArIDkwLCBlLnopO1xuICAgICAqXG4gICAgICogLy8gT3IgdXNlIHJvdGF0ZUxvY2FsXG4gICAgICogZW50aXR5LnJvdGF0ZUxvY2FsKDAsIDkwLCAwKTtcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBhcHAgPSBnZXRBcHBsaWNhdGlvbigpKSB7XG4gICAgICAgIHN1cGVyKG5hbWUpO1xuXG4gICAgICAgIERlYnVnLmFzc2VydChhcHAsICdDb3VsZCBub3QgZmluZCBjdXJyZW50IGFwcGxpY2F0aW9uJyk7XG4gICAgICAgIHRoaXMuX2FwcCA9IGFwcDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgY29tcG9uZW50IGFuZCBhZGQgaXQgdG8gdGhlIGVudGl0eS4gVXNlIHRoaXMgdG8gYWRkIGZ1bmN0aW9uYWxpdHkgdG8gdGhlIGVudGl0eVxuICAgICAqIGxpa2UgcmVuZGVyaW5nIGEgbW9kZWwsIHBsYXlpbmcgc291bmRzIGFuZCBzbyBvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gVGhlIG5hbWUgb2YgdGhlIGNvbXBvbmVudCB0byBhZGQuIFZhbGlkIHN0cmluZ3MgYXJlOlxuICAgICAqXG4gICAgICogLSBcImFuaW1cIiAtIHNlZSB7QGxpbmsgQW5pbUNvbXBvbmVudH1cbiAgICAgKiAtIFwiYW5pbWF0aW9uXCIgLSBzZWUge0BsaW5rIEFuaW1hdGlvbkNvbXBvbmVudH1cbiAgICAgKiAtIFwiYXVkaW9saXN0ZW5lclwiIC0gc2VlIHtAbGluayBBdWRpb0xpc3RlbmVyQ29tcG9uZW50fVxuICAgICAqIC0gXCJidXR0b25cIiAtIHNlZSB7QGxpbmsgQnV0dG9uQ29tcG9uZW50fVxuICAgICAqIC0gXCJjYW1lcmFcIiAtIHNlZSB7QGxpbmsgQ2FtZXJhQ29tcG9uZW50fVxuICAgICAqIC0gXCJjb2xsaXNpb25cIiAtIHNlZSB7QGxpbmsgQ29sbGlzaW9uQ29tcG9uZW50fVxuICAgICAqIC0gXCJlbGVtZW50XCIgLSBzZWUge0BsaW5rIEVsZW1lbnRDb21wb25lbnR9XG4gICAgICogLSBcImxheW91dGNoaWxkXCIgLSBzZWUge0BsaW5rIExheW91dENoaWxkQ29tcG9uZW50fVxuICAgICAqIC0gXCJsYXlvdXRncm91cFwiIC0gc2VlIHtAbGluayBMYXlvdXRHcm91cENvbXBvbmVudH1cbiAgICAgKiAtIFwibGlnaHRcIiAtIHNlZSB7QGxpbmsgTGlnaHRDb21wb25lbnR9XG4gICAgICogLSBcIm1vZGVsXCIgLSBzZWUge0BsaW5rIE1vZGVsQ29tcG9uZW50fVxuICAgICAqIC0gXCJwYXJ0aWNsZXN5c3RlbVwiIC0gc2VlIHtAbGluayBQYXJ0aWNsZVN5c3RlbUNvbXBvbmVudH1cbiAgICAgKiAtIFwicmVuZGVyXCIgLSBzZWUge0BsaW5rIFJlbmRlckNvbXBvbmVudH1cbiAgICAgKiAtIFwicmlnaWRib2R5XCIgLSBzZWUge0BsaW5rIFJpZ2lkQm9keUNvbXBvbmVudH1cbiAgICAgKiAtIFwic2NyZWVuXCIgLSBzZWUge0BsaW5rIFNjcmVlbkNvbXBvbmVudH1cbiAgICAgKiAtIFwic2NyaXB0XCIgLSBzZWUge0BsaW5rIFNjcmlwdENvbXBvbmVudH1cbiAgICAgKiAtIFwic2Nyb2xsYmFyXCIgLSBzZWUge0BsaW5rIFNjcm9sbGJhckNvbXBvbmVudH1cbiAgICAgKiAtIFwic2Nyb2xsdmlld1wiIC0gc2VlIHtAbGluayBTY3JvbGxWaWV3Q29tcG9uZW50fVxuICAgICAqIC0gXCJzb3VuZFwiIC0gc2VlIHtAbGluayBTb3VuZENvbXBvbmVudH1cbiAgICAgKiAtIFwic3ByaXRlXCIgLSBzZWUge0BsaW5rIFNwcml0ZUNvbXBvbmVudH1cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbZGF0YV0gLSBUaGUgaW5pdGlhbGl6YXRpb24gZGF0YSBmb3IgdGhlIHNwZWNpZmljIGNvbXBvbmVudCB0eXBlLiBSZWZlciB0b1xuICAgICAqIGVhY2ggc3BlY2lmaWMgY29tcG9uZW50J3MgQVBJIHJlZmVyZW5jZSBwYWdlIGZvciBkZXRhaWxzIG9uIHZhbGlkIHZhbHVlcyBmb3IgdGhpcyBwYXJhbWV0ZXIuXG4gICAgICogQHJldHVybnMge0NvbXBvbmVudHxudWxsfSBUaGUgbmV3IENvbXBvbmVudCB0aGF0IHdhcyBhdHRhY2hlZCB0byB0aGUgZW50aXR5IG9yIG51bGwgaWYgdGhlcmVcbiAgICAgKiB3YXMgYW4gZXJyb3IuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgZW50aXR5ID0gbmV3IHBjLkVudGl0eSgpO1xuICAgICAqXG4gICAgICogLy8gQWRkIGEgbGlnaHQgY29tcG9uZW50IHdpdGggZGVmYXVsdCBwcm9wZXJ0aWVzXG4gICAgICogZW50aXR5LmFkZENvbXBvbmVudChcImxpZ2h0XCIpO1xuICAgICAqXG4gICAgICogLy8gQWRkIGEgY2FtZXJhIGNvbXBvbmVudCB3aXRoIHNvbWUgc3BlY2lmaWVkIHByb3BlcnRpZXNcbiAgICAgKiBlbnRpdHkuYWRkQ29tcG9uZW50KFwiY2FtZXJhXCIsIHtcbiAgICAgKiAgICAgZm92OiA0NSxcbiAgICAgKiAgICAgY2xlYXJDb2xvcjogbmV3IHBjLkNvbG9yKDEsIDAsIDApXG4gICAgICogfSk7XG4gICAgICovXG4gICAgYWRkQ29tcG9uZW50KHR5cGUsIGRhdGEpIHtcbiAgICAgICAgY29uc3Qgc3lzdGVtID0gdGhpcy5fYXBwLnN5c3RlbXNbdHlwZV07XG4gICAgICAgIGlmICghc3lzdGVtKSB7XG4gICAgICAgICAgICBEZWJ1Zy5lcnJvcihgYWRkQ29tcG9uZW50OiBTeXN0ZW0gJHt0eXBlfSBkb2Vzbid0IGV4aXN0YCk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jW3R5cGVdKSB7XG4gICAgICAgICAgICBEZWJ1Zy53YXJuKGBhZGRDb21wb25lbnQ6IEVudGl0eSBhbHJlYWR5IGhhcyAke3R5cGV9IGNvbXBvbmVudGApO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN5c3RlbS5hZGRDb21wb25lbnQodGhpcywgZGF0YSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGEgY29tcG9uZW50IGZyb20gdGhlIEVudGl0eS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gVGhlIG5hbWUgb2YgdGhlIENvbXBvbmVudCB0eXBlLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogdmFyIGVudGl0eSA9IG5ldyBwYy5FbnRpdHkoKTtcbiAgICAgKiBlbnRpdHkuYWRkQ29tcG9uZW50KFwibGlnaHRcIik7IC8vIGFkZCBuZXcgbGlnaHQgY29tcG9uZW50XG4gICAgICpcbiAgICAgKiBlbnRpdHkucmVtb3ZlQ29tcG9uZW50KFwibGlnaHRcIik7IC8vIHJlbW92ZSBsaWdodCBjb21wb25lbnRcbiAgICAgKi9cbiAgICByZW1vdmVDb21wb25lbnQodHlwZSkge1xuICAgICAgICBjb25zdCBzeXN0ZW0gPSB0aGlzLl9hcHAuc3lzdGVtc1t0eXBlXTtcbiAgICAgICAgaWYgKCFzeXN0ZW0pIHtcbiAgICAgICAgICAgIERlYnVnLmVycm9yKGBhZGRDb21wb25lbnQ6IFN5c3RlbSAke3R5cGV9IGRvZXNuJ3QgZXhpc3RgKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuY1t0eXBlXSkge1xuICAgICAgICAgICAgRGVidWcud2FybihgcmVtb3ZlQ29tcG9uZW50OiBFbnRpdHkgZG9lc24ndCBoYXZlICR7dHlwZX0gY29tcG9uZW50YCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc3lzdGVtLnJlbW92ZUNvbXBvbmVudCh0aGlzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZWFyY2ggdGhlIGVudGl0eSBhbmQgYWxsIG9mIGl0cyBkZXNjZW5kYW50cyBmb3IgdGhlIGZpcnN0IGNvbXBvbmVudCBvZiBzcGVjaWZpZWQgdHlwZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gVGhlIG5hbWUgb2YgdGhlIGNvbXBvbmVudCB0eXBlIHRvIHJldHJpZXZlLlxuICAgICAqIEByZXR1cm5zIHtDb21wb25lbnR9IEEgY29tcG9uZW50IG9mIHNwZWNpZmllZCB0eXBlLCBpZiB0aGUgZW50aXR5IG9yIGFueSBvZiBpdHMgZGVzY2VuZGFudHNcbiAgICAgKiBoYXMgb25lLiBSZXR1cm5zIHVuZGVmaW5lZCBvdGhlcndpc2UuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiAvLyBHZXQgdGhlIGZpcnN0IGZvdW5kIGxpZ2h0IGNvbXBvbmVudCBpbiB0aGUgaGllcmFyY2h5IHRyZWUgdGhhdCBzdGFydHMgd2l0aCB0aGlzIGVudGl0eVxuICAgICAqIHZhciBsaWdodCA9IGVudGl0eS5maW5kQ29tcG9uZW50KFwibGlnaHRcIik7XG4gICAgICovXG4gICAgZmluZENvbXBvbmVudCh0eXBlKSB7XG4gICAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuZmluZE9uZShmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5vZGUuYyAmJiBub2RlLmNbdHlwZV07XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZW50aXR5ICYmIGVudGl0eS5jW3R5cGVdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlYXJjaCB0aGUgZW50aXR5IGFuZCBhbGwgb2YgaXRzIGRlc2NlbmRhbnRzIGZvciBhbGwgY29tcG9uZW50cyBvZiBzcGVjaWZpZWQgdHlwZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gVGhlIG5hbWUgb2YgdGhlIGNvbXBvbmVudCB0eXBlIHRvIHJldHJpZXZlLlxuICAgICAqIEByZXR1cm5zIHtDb21wb25lbnRbXX0gQWxsIGNvbXBvbmVudHMgb2Ygc3BlY2lmaWVkIHR5cGUgaW4gdGhlIGVudGl0eSBvciBhbnkgb2YgaXRzXG4gICAgICogZGVzY2VuZGFudHMuIFJldHVybnMgZW1wdHkgYXJyYXkgaWYgbm9uZSBmb3VuZC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIC8vIEdldCBhbGwgbGlnaHQgY29tcG9uZW50cyBpbiB0aGUgaGllcmFyY2h5IHRyZWUgdGhhdCBzdGFydHMgd2l0aCB0aGlzIGVudGl0eVxuICAgICAqIHZhciBsaWdodHMgPSBlbnRpdHkuZmluZENvbXBvbmVudHMoXCJsaWdodFwiKTtcbiAgICAgKi9cbiAgICBmaW5kQ29tcG9uZW50cyh0eXBlKSB7XG4gICAgICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy5maW5kKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICByZXR1cm4gbm9kZS5jICYmIG5vZGUuY1t0eXBlXTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBlbnRpdGllcy5tYXAoZnVuY3Rpb24gKGVudGl0eSkge1xuICAgICAgICAgICAgcmV0dXJuIGVudGl0eS5jW3R5cGVdO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIEdVSUQgdmFsdWUgZm9yIHRoaXMgRW50aXR5LlxuICAgICAqXG4gICAgICogQHJldHVybnMge3N0cmluZ30gVGhlIEdVSUQgb2YgdGhlIEVudGl0eS5cbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgZ2V0R3VpZCgpIHtcbiAgICAgICAgLy8gaWYgdGhlIGd1aWQgaGFzbid0IGJlZW4gc2V0IHlldCB0aGVuIHNldCBpdCBub3cgYmVmb3JlIHJldHVybmluZyBpdFxuICAgICAgICBpZiAoIXRoaXMuX2d1aWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0R3VpZChndWlkLmNyZWF0ZSgpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl9ndWlkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgR1VJRCB2YWx1ZSBmb3IgdGhpcyBFbnRpdHkuIE5vdGUgdGhhdCBpdCBpcyB1bmxpa2VseSB0aGF0IHlvdSBzaG91bGQgbmVlZCB0byBjaGFuZ2VcbiAgICAgKiB0aGUgR1VJRCB2YWx1ZSBvZiBhbiBFbnRpdHkgYXQgcnVuLXRpbWUuIERvaW5nIHNvIHdpbGwgY29ycnVwdCB0aGUgZ3JhcGggdGhpcyBFbnRpdHkgaXMgaW4uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZ3VpZCAtIFRoZSBHVUlEIHRvIGFzc2lnbiB0byB0aGUgRW50aXR5LlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBzZXRHdWlkKGd1aWQpIHtcbiAgICAgICAgLy8gcmVtb3ZlIGN1cnJlbnQgZ3VpZCBmcm9tIGVudGl0eUluZGV4XG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5fYXBwLl9lbnRpdHlJbmRleDtcbiAgICAgICAgaWYgKHRoaXMuX2d1aWQpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBpbmRleFt0aGlzLl9ndWlkXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFkZCBuZXcgZ3VpZCB0byBlbnRpdHlJbmRleFxuICAgICAgICB0aGlzLl9ndWlkID0gZ3VpZDtcbiAgICAgICAgaW5kZXhbdGhpcy5fZ3VpZF0gPSB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7R3JhcGhOb2RlfSBub2RlIC0gVGhlIG5vZGUgdG8gdXBkYXRlLlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gZW5hYmxlZCAtIEVuYWJsZSBvciBkaXNhYmxlIHRoZSBub2RlLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX25vdGlmeUhpZXJhcmNoeVN0YXRlQ2hhbmdlZChub2RlLCBlbmFibGVkKSB7XG4gICAgICAgIGxldCBlbmFibGVGaXJzdCA9IGZhbHNlO1xuICAgICAgICBpZiAobm9kZSA9PT0gdGhpcyAmJiBfZW5hYmxlTGlzdC5sZW5ndGggPT09IDApXG4gICAgICAgICAgICBlbmFibGVGaXJzdCA9IHRydWU7XG5cbiAgICAgICAgbm9kZS5fYmVpbmdFbmFibGVkID0gdHJ1ZTtcblxuICAgICAgICBub2RlLl9vbkhpZXJhcmNoeVN0YXRlQ2hhbmdlZChlbmFibGVkKTtcblxuICAgICAgICBpZiAobm9kZS5fb25IaWVyYXJjaHlTdGF0ZVBvc3RDaGFuZ2VkKVxuICAgICAgICAgICAgX2VuYWJsZUxpc3QucHVzaChub2RlKTtcblxuICAgICAgICBjb25zdCBjID0gbm9kZS5fY2hpbGRyZW47XG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBjLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoY1tpXS5fZW5hYmxlZClcbiAgICAgICAgICAgICAgICB0aGlzLl9ub3RpZnlIaWVyYXJjaHlTdGF0ZUNoYW5nZWQoY1tpXSwgZW5hYmxlZCk7XG4gICAgICAgIH1cblxuICAgICAgICBub2RlLl9iZWluZ0VuYWJsZWQgPSBmYWxzZTtcblxuICAgICAgICBpZiAoZW5hYmxlRmlyc3QpIHtcbiAgICAgICAgICAgIC8vIGRvIG5vdCBjYWNoZSB0aGUgbGVuZ3RoIGhlcmUsIGFzIGVuYWJsZUxpc3QgbWF5IGJlIGFkZGVkIHRvIGR1cmluZyBsb29wXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IF9lbmFibGVMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgX2VuYWJsZUxpc3RbaV0uX29uSGllcmFyY2h5U3RhdGVQb3N0Q2hhbmdlZCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBfZW5hYmxlTGlzdC5sZW5ndGggPSAwO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtib29sZWFufSBlbmFibGVkIC0gRW5hYmxlIG9yIGRpc2FibGUgdGhlIG5vZGUuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfb25IaWVyYXJjaHlTdGF0ZUNoYW5nZWQoZW5hYmxlZCkge1xuICAgICAgICBzdXBlci5fb25IaWVyYXJjaHlTdGF0ZUNoYW5nZWQoZW5hYmxlZCk7XG5cbiAgICAgICAgLy8gZW5hYmxlIC8gZGlzYWJsZSBhbGwgdGhlIGNvbXBvbmVudHNcbiAgICAgICAgY29uc3QgY29tcG9uZW50cyA9IHRoaXMuYztcbiAgICAgICAgZm9yIChjb25zdCB0eXBlIGluIGNvbXBvbmVudHMpIHtcbiAgICAgICAgICAgIGlmIChjb21wb25lbnRzLmhhc093blByb3BlcnR5KHR5cGUpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29tcG9uZW50ID0gY29tcG9uZW50c1t0eXBlXTtcbiAgICAgICAgICAgICAgICBpZiAoY29tcG9uZW50LmVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC5vbkVuYWJsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50Lm9uRGlzYWJsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEBwcml2YXRlICovXG4gICAgX29uSGllcmFyY2h5U3RhdGVQb3N0Q2hhbmdlZCgpIHtcbiAgICAgICAgLy8gcG9zdCBlbmFibGUgYWxsIHRoZSBjb21wb25lbnRzXG4gICAgICAgIGNvbnN0IGNvbXBvbmVudHMgPSB0aGlzLmM7XG4gICAgICAgIGZvciAoY29uc3QgdHlwZSBpbiBjb21wb25lbnRzKSB7XG4gICAgICAgICAgICBpZiAoY29tcG9uZW50cy5oYXNPd25Qcm9wZXJ0eSh0eXBlKSlcbiAgICAgICAgICAgICAgICBjb21wb25lbnRzW3R5cGVdLm9uUG9zdFN0YXRlQ2hhbmdlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaW5kIGEgZGVzY2VuZGFudCBvZiB0aGlzIGVudGl0eSB3aXRoIHRoZSBHVUlELlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGd1aWQgLSBUaGUgR1VJRCB0byBzZWFyY2ggZm9yLlxuICAgICAqIEByZXR1cm5zIHtFbnRpdHl8bnVsbH0gVGhlIGVudGl0eSB3aXRoIHRoZSBtYXRjaGluZyBHVUlEIG9yIG51bGwgaWYgbm8gZW50aXR5IGlzIGZvdW5kLlxuICAgICAqL1xuICAgIGZpbmRCeUd1aWQoZ3VpZCkge1xuICAgICAgICBpZiAodGhpcy5fZ3VpZCA9PT0gZ3VpZCkgcmV0dXJuIHRoaXM7XG5cbiAgICAgICAgY29uc3QgZSA9IHRoaXMuX2FwcC5fZW50aXR5SW5kZXhbZ3VpZF07XG4gICAgICAgIGlmIChlICYmIChlID09PSB0aGlzIHx8IGUuaXNEZXNjZW5kYW50T2YodGhpcykpKSB7XG4gICAgICAgICAgICByZXR1cm4gZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhbGwgY29tcG9uZW50cyBmcm9tIHRoZSBFbnRpdHkgYW5kIGRldGFjaCBpdCBmcm9tIHRoZSBFbnRpdHkgaGllcmFyY2h5LiBUaGVuXG4gICAgICogcmVjdXJzaXZlbHkgZGVzdHJveSBhbGwgYW5jZXN0b3IgRW50aXRpZXMuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHZhciBmaXJzdENoaWxkID0gdGhpcy5lbnRpdHkuY2hpbGRyZW5bMF07XG4gICAgICogZmlyc3RDaGlsZC5kZXN0cm95KCk7IC8vIGRlbGV0ZSBjaGlsZCwgYWxsIGNvbXBvbmVudHMgYW5kIHJlbW92ZSBmcm9tIGhpZXJhcmNoeVxuICAgICAqL1xuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuX2Rlc3Ryb3lpbmcgPSB0cnVlO1xuXG4gICAgICAgIC8vIERpc2FibGUgYWxsIGVuYWJsZWQgY29tcG9uZW50cyBmaXJzdFxuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgaW4gdGhpcy5jKSB7XG4gICAgICAgICAgICB0aGlzLmNbbmFtZV0uZW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmVtb3ZlIGFsbCBjb21wb25lbnRzXG4gICAgICAgIGZvciAoY29uc3QgbmFtZSBpbiB0aGlzLmMpIHtcbiAgICAgICAgICAgIHRoaXMuY1tuYW1lXS5zeXN0ZW0ucmVtb3ZlQ29tcG9uZW50KHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRGV0YWNoIGZyb20gcGFyZW50XG4gICAgICAgIGlmICh0aGlzLl9wYXJlbnQpXG4gICAgICAgICAgICB0aGlzLl9wYXJlbnQucmVtb3ZlQ2hpbGQodGhpcyk7XG5cbiAgICAgICAgLy8gcmVjdXJzaXZlbHkgZGVzdHJveSBhbGwgY2hpbGRyZW5cbiAgICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLl9jaGlsZHJlbjtcbiAgICAgICAgd2hpbGUgKGNoaWxkcmVuLmxlbmd0aCkge1xuXG4gICAgICAgICAgICAvLyByZW1vdmUgYSBjaGlsZCBmcm9tIHRoZSBhcnJheSBhbmQgZGlzY29ubmVjdCBpdCBmcm9tIHRoZSBwYXJlbnRcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW4ucG9wKCk7XG4gICAgICAgICAgICBjaGlsZC5fcGFyZW50ID0gbnVsbDtcblxuICAgICAgICAgICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgRW50aXR5KSB7XG4gICAgICAgICAgICAgICAgY2hpbGQuZGVzdHJveSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gZmlyZSBkZXN0cm95IGV2ZW50XG4gICAgICAgIHRoaXMuZmlyZSgnZGVzdHJveScsIHRoaXMpO1xuXG4gICAgICAgIC8vIGNsZWFyIGFsbCBldmVudHNcbiAgICAgICAgdGhpcy5vZmYoKTtcblxuICAgICAgICAvLyByZW1vdmUgZnJvbSBlbnRpdHkgaW5kZXhcbiAgICAgICAgaWYgKHRoaXMuX2d1aWQpIHtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9hcHAuX2VudGl0eUluZGV4W3RoaXMuX2d1aWRdO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fZGVzdHJveWluZyA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIGRlZXAgY29weSBvZiB0aGUgRW50aXR5LiBEdXBsaWNhdGUgdGhlIGZ1bGwgRW50aXR5IGhpZXJhcmNoeSwgd2l0aCBhbGwgQ29tcG9uZW50c1xuICAgICAqIGFuZCBhbGwgZGVzY2VuZGFudHMuIE5vdGUsIHRoaXMgRW50aXR5IGlzIG5vdCBpbiB0aGUgaGllcmFyY2h5IGFuZCBtdXN0IGJlIGFkZGVkIG1hbnVhbGx5LlxuICAgICAqXG4gICAgICogQHJldHVybnMge3RoaXN9IEEgbmV3IEVudGl0eSB3aGljaCBpcyBhIGRlZXAgY29weSBvZiB0aGUgb3JpZ2luYWwuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgZSA9IHRoaXMuZW50aXR5LmNsb25lKCk7XG4gICAgICpcbiAgICAgKiAvLyBBZGQgY2xvbmUgYXMgYSBzaWJsaW5nIHRvIHRoZSBvcmlnaW5hbFxuICAgICAqIHRoaXMuZW50aXR5LnBhcmVudC5hZGRDaGlsZChlKTtcbiAgICAgKi9cbiAgICBjbG9uZSgpIHtcbiAgICAgICAgY29uc3QgZHVwbGljYXRlZElkc01hcCA9IHt9O1xuICAgICAgICBjb25zdCBjbG9uZSA9IHRoaXMuX2Nsb25lUmVjdXJzaXZlbHkoZHVwbGljYXRlZElkc01hcCk7XG4gICAgICAgIGR1cGxpY2F0ZWRJZHNNYXBbdGhpcy5nZXRHdWlkKCldID0gY2xvbmU7XG5cbiAgICAgICAgcmVzb2x2ZUR1cGxpY2F0ZWRFbnRpdHlSZWZlcmVuY2VQcm9wZXJ0aWVzKHRoaXMsIHRoaXMsIGNsb25lLCBkdXBsaWNhdGVkSWRzTWFwKTtcblxuICAgICAgICByZXR1cm4gY2xvbmU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3Q8c3RyaW5nLCBFbnRpdHk+fSBkdXBsaWNhdGVkSWRzTWFwIC0gQSBtYXAgb2Ygb3JpZ2luYWwgZW50aXR5IEdVSURzIHRvIGNsb25lZFxuICAgICAqIGVudGl0aWVzLlxuICAgICAqIEByZXR1cm5zIHt0aGlzfSBBIG5ldyBFbnRpdHkgd2hpY2ggaXMgYSBkZWVwIGNvcHkgb2YgdGhlIG9yaWdpbmFsLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2Nsb25lUmVjdXJzaXZlbHkoZHVwbGljYXRlZElkc01hcCkge1xuICAgICAgICAvKiogQHR5cGUge3RoaXN9ICovXG4gICAgICAgIGNvbnN0IGNsb25lID0gbmV3IHRoaXMuY29uc3RydWN0b3IodW5kZWZpbmVkLCB0aGlzLl9hcHApO1xuICAgICAgICBzdXBlci5fY2xvbmVJbnRlcm5hbChjbG9uZSk7XG5cbiAgICAgICAgZm9yIChjb25zdCB0eXBlIGluIHRoaXMuYykge1xuICAgICAgICAgICAgY29uc3QgY29tcG9uZW50ID0gdGhpcy5jW3R5cGVdO1xuICAgICAgICAgICAgY29tcG9uZW50LnN5c3RlbS5jbG9uZUNvbXBvbmVudCh0aGlzLCBjbG9uZSk7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX2NoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBvbGRDaGlsZCA9IHRoaXMuX2NoaWxkcmVuW2ldO1xuICAgICAgICAgICAgaWYgKG9sZENoaWxkIGluc3RhbmNlb2YgRW50aXR5KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3Q2hpbGQgPSBvbGRDaGlsZC5fY2xvbmVSZWN1cnNpdmVseShkdXBsaWNhdGVkSWRzTWFwKTtcbiAgICAgICAgICAgICAgICBjbG9uZS5hZGRDaGlsZChuZXdDaGlsZCk7XG4gICAgICAgICAgICAgICAgZHVwbGljYXRlZElkc01hcFtvbGRDaGlsZC5nZXRHdWlkKCldID0gbmV3Q2hpbGQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY2xvbmU7XG4gICAgfVxufVxuXG4vLyBXaGVuIGFuIGVudGl0eSB0aGF0IGhhcyBwcm9wZXJ0aWVzIHRoYXQgY29udGFpbiByZWZlcmVuY2VzIHRvIG90aGVyXG4vLyBlbnRpdGllcyB3aXRoaW4gaXRzIHN1YnRyZWUgaXMgZHVwbGljYXRlZCwgdGhlIGV4cGVjdGF0aW9uIG9mIHRoZVxuLy8gdXNlciBpcyBsaWtlbHkgdGhhdCB0aG9zZSBwcm9wZXJ0aWVzIHdpbGwgYmUgdXBkYXRlZCB0byBwb2ludCB0b1xuLy8gdGhlIGNvcnJlc3BvbmRpbmcgZW50aXRpZXMgd2l0aGluIHRoZSBuZXdseS1jcmVhdGVkIGR1cGxpY2F0ZSBzdWJ0cmVlLlxuLy9cbi8vIFRvIGhhbmRsZSB0aGlzLCB3ZSBuZWVkIHRvIHNlYXJjaCBmb3IgcHJvcGVydGllcyB0aGF0IHJlZmVyIHRvIGVudGl0aWVzXG4vLyB3aXRoaW4gdGhlIG9sZCBkdXBsaWNhdGVkIHN0cnVjdHVyZSwgZmluZCB0aGVpciBuZXdseS1jbG9uZWQgcGFydG5lcnNcbi8vIHdpdGhpbiB0aGUgbmV3IHN0cnVjdHVyZSwgYW5kIHVwZGF0ZSB0aGUgcmVmZXJlbmNlcyBhY2NvcmRpbmdseS4gVGhpc1xuLy8gZnVuY3Rpb24gaW1wbGVtZW50cyB0aGF0IHJlcXVpcmVtZW50LlxuZnVuY3Rpb24gcmVzb2x2ZUR1cGxpY2F0ZWRFbnRpdHlSZWZlcmVuY2VQcm9wZXJ0aWVzKG9sZFN1YnRyZWVSb290LCBvbGRFbnRpdHksIG5ld0VudGl0eSwgZHVwbGljYXRlZElkc01hcCkge1xuICAgIGlmIChvbGRFbnRpdHkgaW5zdGFuY2VvZiBFbnRpdHkpIHtcbiAgICAgICAgY29uc3QgY29tcG9uZW50cyA9IG9sZEVudGl0eS5jO1xuXG4gICAgICAgIC8vIEhhbmRsZSBjb21wb25lbnQgcHJvcGVydGllc1xuICAgICAgICBmb3IgKGNvbnN0IGNvbXBvbmVudE5hbWUgaW4gY29tcG9uZW50cykge1xuICAgICAgICAgICAgY29uc3QgY29tcG9uZW50ID0gY29tcG9uZW50c1tjb21wb25lbnROYW1lXTtcbiAgICAgICAgICAgIGNvbnN0IGVudGl0eVByb3BlcnRpZXMgPSBjb21wb25lbnQuc3lzdGVtLmdldFByb3BlcnRpZXNPZlR5cGUoJ2VudGl0eScpO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gZW50aXR5UHJvcGVydGllcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5RGVzY3JpcHRvciA9IGVudGl0eVByb3BlcnRpZXNbaV07XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlOYW1lID0gcHJvcGVydHlEZXNjcmlwdG9yLm5hbWU7XG4gICAgICAgICAgICAgICAgY29uc3Qgb2xkRW50aXR5UmVmZXJlbmNlSWQgPSBjb21wb25lbnRbcHJvcGVydHlOYW1lXTtcbiAgICAgICAgICAgICAgICBjb25zdCBlbnRpdHlJc1dpdGhpbk9sZFN1YnRyZWUgPSAhIW9sZFN1YnRyZWVSb290LmZpbmRCeUd1aWQob2xkRW50aXR5UmVmZXJlbmNlSWQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGVudGl0eUlzV2l0aGluT2xkU3VidHJlZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdFbnRpdHlSZWZlcmVuY2VJZCA9IGR1cGxpY2F0ZWRJZHNNYXBbb2xkRW50aXR5UmVmZXJlbmNlSWRdLmdldEd1aWQoKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3RW50aXR5UmVmZXJlbmNlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0VudGl0eS5jW2NvbXBvbmVudE5hbWVdW3Byb3BlcnR5TmFtZV0gPSBuZXdFbnRpdHlSZWZlcmVuY2VJZDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnLndhcm4oJ0NvdWxkIG5vdCBmaW5kIGNvcnJlc3BvbmRpbmcgZW50aXR5IGlkIHdoZW4gcmVzb2x2aW5nIGR1cGxpY2F0ZWQgZW50aXR5IHJlZmVyZW5jZXMnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEhhbmRsZSBlbnRpdHkgc2NyaXB0IGF0dHJpYnV0ZXNcbiAgICAgICAgaWYgKGNvbXBvbmVudHMuc2NyaXB0ICYmICFuZXdFbnRpdHkuX2FwcC51c2VMZWdhY3lTY3JpcHRBdHRyaWJ1dGVDbG9uaW5nKSB7XG4gICAgICAgICAgICBuZXdFbnRpdHkuc2NyaXB0LnJlc29sdmVEdXBsaWNhdGVkRW50aXR5UmVmZXJlbmNlUHJvcGVydGllcyhjb21wb25lbnRzLnNjcmlwdCwgZHVwbGljYXRlZElkc01hcCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBIYW5kbGUgZW50aXR5IHJlbmRlciBhdHRyaWJ1dGVzXG4gICAgICAgIGlmIChjb21wb25lbnRzLnJlbmRlcikge1xuICAgICAgICAgICAgbmV3RW50aXR5LnJlbmRlci5yZXNvbHZlRHVwbGljYXRlZEVudGl0eVJlZmVyZW5jZVByb3BlcnRpZXMoY29tcG9uZW50cy5yZW5kZXIsIGR1cGxpY2F0ZWRJZHNNYXApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSGFuZGxlIGVudGl0eSBhbmltIGF0dHJpYnV0ZXNcbiAgICAgICAgaWYgKGNvbXBvbmVudHMuYW5pbSkge1xuICAgICAgICAgICAgbmV3RW50aXR5LmFuaW0ucmVzb2x2ZUR1cGxpY2F0ZWRFbnRpdHlSZWZlcmVuY2VQcm9wZXJ0aWVzKGNvbXBvbmVudHMuYW5pbSwgZHVwbGljYXRlZElkc01hcCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZWN1cnNlIGludG8gY2hpbGRyZW4uIE5vdGUgdGhhdCB3ZSBjb250aW51ZSB0byBwYXNzIGluIHRoZSBzYW1lIGBvbGRTdWJ0cmVlUm9vdGAsXG4gICAgICAgIC8vIGluIG9yZGVyIHRvIGNvcnJlY3RseSBoYW5kbGUgY2FzZXMgd2hlcmUgYSBjaGlsZCBoYXMgYW4gZW50aXR5IHJlZmVyZW5jZVxuICAgICAgICAvLyBmaWVsZCB0aGF0IHBvaW50cyB0byBhIHBhcmVudCBvciBvdGhlciBhbmNlc3RvciB0aGF0IGlzIHN0aWxsIHdpdGhpbiB0aGVcbiAgICAgICAgLy8gZHVwbGljYXRlZCBzdWJ0cmVlLlxuICAgICAgICBjb25zdCBfb2xkID0gb2xkRW50aXR5LmNoaWxkcmVuLmZpbHRlcihmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIChlIGluc3RhbmNlb2YgRW50aXR5KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IF9uZXcgPSBuZXdFbnRpdHkuY2hpbGRyZW4uZmlsdGVyKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gKGUgaW5zdGFuY2VvZiBFbnRpdHkpO1xuICAgICAgICB9KTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gX29sZC5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgcmVzb2x2ZUR1cGxpY2F0ZWRFbnRpdHlSZWZlcmVuY2VQcm9wZXJ0aWVzKG9sZFN1YnRyZWVSb290LCBfb2xkW2ldLCBfbmV3W2ldLCBkdXBsaWNhdGVkSWRzTWFwKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBGaXJlZCBhZnRlciB0aGUgZW50aXR5IGlzIGRlc3Ryb3llZC5cbiAqXG4gKiBAZXZlbnQgRW50aXR5I2Rlc3Ryb3lcbiAqIEBwYXJhbSB7RW50aXR5fSBlbnRpdHkgLSBUaGUgZW50aXR5IHRoYXQgd2FzIGRlc3Ryb3llZC5cbiAqIEBleGFtcGxlXG4gKiBlbnRpdHkub24oXCJkZXN0cm95XCIsIGZ1bmN0aW9uIChlKSB7XG4gKiAgICAgY29uc29sZS5sb2coJ2VudGl0eSAnICsgZS5uYW1lICsgJyBoYXMgYmVlbiBkZXN0cm95ZWQnKTtcbiAqIH0pO1xuICovXG5cbmV4cG9ydCB7IEVudGl0eSB9O1xuIl0sIm5hbWVzIjpbIl9lbmFibGVMaXN0IiwiRW50aXR5IiwiR3JhcGhOb2RlIiwiY29uc3RydWN0b3IiLCJuYW1lIiwiYXBwIiwiZ2V0QXBwbGljYXRpb24iLCJhbmltIiwiYW5pbWF0aW9uIiwiYXVkaW9saXN0ZW5lciIsImJ1dHRvbiIsImNhbWVyYSIsImNvbGxpc2lvbiIsImVsZW1lbnQiLCJsYXlvdXRjaGlsZCIsImxheW91dGdyb3VwIiwibGlnaHQiLCJtb2RlbCIsInBhcnRpY2xlc3lzdGVtIiwicmVuZGVyIiwicmlnaWRib2R5Iiwic2NyZWVuIiwic2NyaXB0Iiwic2Nyb2xsYmFyIiwic2Nyb2xsdmlldyIsInNvdW5kIiwic3ByaXRlIiwiYyIsIl9hcHAiLCJfZGVzdHJveWluZyIsIl9ndWlkIiwiX3RlbXBsYXRlIiwiRGVidWciLCJhc3NlcnQiLCJhZGRDb21wb25lbnQiLCJ0eXBlIiwiZGF0YSIsInN5c3RlbSIsInN5c3RlbXMiLCJlcnJvciIsIndhcm4iLCJyZW1vdmVDb21wb25lbnQiLCJmaW5kQ29tcG9uZW50IiwiZW50aXR5IiwiZmluZE9uZSIsIm5vZGUiLCJmaW5kQ29tcG9uZW50cyIsImVudGl0aWVzIiwiZmluZCIsIm1hcCIsImdldEd1aWQiLCJzZXRHdWlkIiwiZ3VpZCIsImNyZWF0ZSIsImluZGV4IiwiX2VudGl0eUluZGV4IiwiX25vdGlmeUhpZXJhcmNoeVN0YXRlQ2hhbmdlZCIsImVuYWJsZWQiLCJlbmFibGVGaXJzdCIsImxlbmd0aCIsIl9iZWluZ0VuYWJsZWQiLCJfb25IaWVyYXJjaHlTdGF0ZUNoYW5nZWQiLCJfb25IaWVyYXJjaHlTdGF0ZVBvc3RDaGFuZ2VkIiwicHVzaCIsIl9jaGlsZHJlbiIsImkiLCJsZW4iLCJfZW5hYmxlZCIsImNvbXBvbmVudHMiLCJoYXNPd25Qcm9wZXJ0eSIsImNvbXBvbmVudCIsIm9uRW5hYmxlIiwib25EaXNhYmxlIiwib25Qb3N0U3RhdGVDaGFuZ2UiLCJmaW5kQnlHdWlkIiwiZSIsImlzRGVzY2VuZGFudE9mIiwiZGVzdHJveSIsIl9wYXJlbnQiLCJyZW1vdmVDaGlsZCIsImNoaWxkcmVuIiwiY2hpbGQiLCJwb3AiLCJmaXJlIiwib2ZmIiwiY2xvbmUiLCJkdXBsaWNhdGVkSWRzTWFwIiwiX2Nsb25lUmVjdXJzaXZlbHkiLCJyZXNvbHZlRHVwbGljYXRlZEVudGl0eVJlZmVyZW5jZVByb3BlcnRpZXMiLCJ1bmRlZmluZWQiLCJfY2xvbmVJbnRlcm5hbCIsImNsb25lQ29tcG9uZW50Iiwib2xkQ2hpbGQiLCJuZXdDaGlsZCIsImFkZENoaWxkIiwib2xkU3VidHJlZVJvb3QiLCJvbGRFbnRpdHkiLCJuZXdFbnRpdHkiLCJjb21wb25lbnROYW1lIiwiZW50aXR5UHJvcGVydGllcyIsImdldFByb3BlcnRpZXNPZlR5cGUiLCJwcm9wZXJ0eURlc2NyaXB0b3IiLCJwcm9wZXJ0eU5hbWUiLCJvbGRFbnRpdHlSZWZlcmVuY2VJZCIsImVudGl0eUlzV2l0aGluT2xkU3VidHJlZSIsIm5ld0VudGl0eVJlZmVyZW5jZUlkIiwidXNlTGVnYWN5U2NyaXB0QXR0cmlidXRlQ2xvbmluZyIsIl9vbGQiLCJmaWx0ZXIiLCJfbmV3Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBaUNBLE1BQU1BLFdBQVcsR0FBRyxFQUFFLENBQUE7O0FBaUJ0QixNQUFNQyxNQUFNLFNBQVNDLFNBQVMsQ0FBQzs7QUFzTzNCQyxFQUFBQSxXQUFXLENBQUNDLElBQUksRUFBRUMsR0FBRyxHQUFHQyxjQUFjLEVBQUUsRUFBRTtJQUN0QyxLQUFLLENBQUNGLElBQUksQ0FBQyxDQUFBO0FBQUMsSUFBQSxJQUFBLENBaE9oQkcsSUFBSSxHQUFBLEtBQUEsQ0FBQSxDQUFBO0FBQUEsSUFBQSxJQUFBLENBUUpDLFNBQVMsR0FBQSxLQUFBLENBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQVFUQyxhQUFhLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0FRYkMsTUFBTSxHQUFBLEtBQUEsQ0FBQSxDQUFBO0FBQUEsSUFBQSxJQUFBLENBUU5DLE1BQU0sR0FBQSxLQUFBLENBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQVFOQyxTQUFTLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0FRVEMsT0FBTyxHQUFBLEtBQUEsQ0FBQSxDQUFBO0FBQUEsSUFBQSxJQUFBLENBUVBDLFdBQVcsR0FBQSxLQUFBLENBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQVFYQyxXQUFXLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0FRWEMsS0FBSyxHQUFBLEtBQUEsQ0FBQSxDQUFBO0FBQUEsSUFBQSxJQUFBLENBUUxDLEtBQUssR0FBQSxLQUFBLENBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQVFMQyxjQUFjLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0FRZEMsTUFBTSxHQUFBLEtBQUEsQ0FBQSxDQUFBO0FBQUEsSUFBQSxJQUFBLENBUU5DLFNBQVMsR0FBQSxLQUFBLENBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQVFUQyxNQUFNLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0FRTkMsTUFBTSxHQUFBLEtBQUEsQ0FBQSxDQUFBO0FBQUEsSUFBQSxJQUFBLENBUU5DLFNBQVMsR0FBQSxLQUFBLENBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQVFUQyxVQUFVLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEs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
