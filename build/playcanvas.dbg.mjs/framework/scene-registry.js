/**
 * @license
 * PlayCanvas Engine v1.58.0-preview revision 1fec26519 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { path } from '../core/path.js';
import { Debug } from '../core/debug.js';
import { ABSOLUTE_URL } from './asset/constants.js';
import { SceneRegistryItem } from './scene-registry-item.js';

class SceneRegistry {
  constructor(app) {
    this._app = app;
    this._list = [];
    this._index = {};
    this._urlIndex = {};
  }
  destroy() {
    this._app = null;
  }

  list() {
    return this._list;
  }

  add(name, url) {
    if (this._index.hasOwnProperty(name)) {
      Debug.warn('pc.SceneRegistry: trying to add more than one scene called: ' + name);
      return false;
    }
    const item = new SceneRegistryItem(name, url);
    const i = this._list.push(item);
    this._index[item.name] = i - 1;
    this._urlIndex[item.url] = i - 1;
    return true;
  }

  find(name) {
    if (this._index.hasOwnProperty(name)) {
      return this._list[this._index[name]];
    }
    return null;
  }

  findByUrl(url) {
    if (this._urlIndex.hasOwnProperty(url)) {
      return this._list[this._urlIndex[url]];
    }
    return null;
  }

  remove(name) {
    if (this._index.hasOwnProperty(name)) {
      const idx = this._index[name];
      let item = this._list[idx];
      delete this._urlIndex[item.url];
      delete this._index[name];

      this._list.splice(idx, 1);

      for (let i = 0; i < this._list.length; i++) {
        item = this._list[i];
        this._index[item.name] = i;
        this._urlIndex[item.url] = i;
      }
    }
  }

  _loadSceneData(sceneItem, storeInCache, callback) {
    const app = this._app;

    let url = sceneItem;
    if (typeof sceneItem === 'string') {
      sceneItem = this.findByUrl(url) || this.find(url) || new SceneRegistryItem('Untitled', url);
    }
    url = sceneItem.url;
    if (!url) {
      callback("Cannot find scene to load");
      return;
    }

    if (sceneItem.loaded) {
      callback(null, sceneItem);
      return;
    }

    if (app.assets && app.assets.prefix && !ABSOLUTE_URL.test(url)) {
      url = path.join(app.assets.prefix, url);
    }
    sceneItem._onLoadedCallbacks.push(callback);
    if (!sceneItem._loading) {
      const handler = app.loader.getHandler("hierarchy");
      handler.load(url, (err, data) => {
        sceneItem.data = data;
        sceneItem._loading = false;
        for (let i = 0; i < sceneItem._onLoadedCallbacks.length; i++) {
          sceneItem._onLoadedCallbacks[i](err, sceneItem);
        }

        if (!storeInCache) {
          sceneItem.data = null;
        }
        sceneItem._onLoadedCallbacks.length = 0;
      });
    }
    sceneItem._loading = true;
  }

  loadSceneData(sceneItem, callback) {
    this._loadSceneData(sceneItem, true, callback);
  }

  unloadSceneData(sceneItem) {
    if (typeof sceneItem === 'string') {
      sceneItem = this.findByUrl(sceneItem);
    }
    if (sceneItem) {
      sceneItem.data = null;
    }
  }
  _loadSceneHierarchy(sceneItem, onBeforeAddHierarchy, callback) {
    this._loadSceneData(sceneItem, false, (err, sceneItem) => {
      if (err) {
        if (callback) {
          callback(err);
        }
        return;
      }
      if (onBeforeAddHierarchy) {
        onBeforeAddHierarchy(sceneItem);
      }
      const app = this._app;

      const _loaded = () => {
        const handler = app.loader.getHandler("hierarchy");
        app.systems.script.preloading = true;
        const entity = handler.open(sceneItem.url, sceneItem.data);
        app.systems.script.preloading = false;

        app.loader.clearCache(sceneItem.url, "hierarchy");

        app.root.addChild(entity);

        app.systems.fire('initialize', entity);
        app.systems.fire('postInitialize', entity);
        app.systems.fire('postPostInitialize', entity);
        if (callback) callback(null, entity);
      };

      app._preloadScripts(sceneItem.data, _loaded);
    });
  }

  loadSceneHierarchy(sceneItem, callback) {
    this._loadSceneHierarchy(sceneItem, null, callback);
  }

  loadSceneSettings(sceneItem, callback) {
    this._loadSceneData(sceneItem, false, (err, sceneItem) => {
      if (!err) {
        this._app.applySceneSettings(sceneItem.data.settings);
        if (callback) {
          callback(null);
        }
      } else {
        if (callback) {
          callback(err);
        }
      }
    });
  }

  changeScene(sceneItem, callback) {
    const app = this._app;
    const onBeforeAddHierarchy = sceneItem => {
      const rootChildren = app.root.children;
      while (rootChildren.length > 0) {
        const child = rootChildren[0];
        child.reparent(null);
        child.destroy == null ? void 0 : child.destroy();
      }
      app.applySceneSettings(sceneItem.data.settings);
    };
    this._loadSceneHierarchy(sceneItem, onBeforeAddHierarchy, callback);
  }

  loadScene(url, callback) {
    const app = this._app;
    const handler = app.loader.getHandler("scene");

    if (app.assets && app.assets.prefix && !ABSOLUTE_URL.test(url)) {
      url = path.join(app.assets.prefix, url);
    }
    handler.load(url, (err, data) => {
      if (!err) {
        const _loaded = () => {
          app.systems.script.preloading = true;
          const scene = handler.open(url, data);

          const sceneItem = this.findByUrl(url);
          if (sceneItem && !sceneItem.loaded) {
            sceneItem.data = data;
          }
          app.systems.script.preloading = false;

          app.loader.clearCache(url, "scene");
          app.loader.patch({
            resource: scene,
            type: "scene"
          }, app.assets);
          app.root.addChild(scene.root);

          if (app.systems.rigidbody && typeof Ammo !== 'undefined') {
            app.systems.rigidbody.gravity.set(scene._gravity.x, scene._gravity.y, scene._gravity.z);
          }
          if (callback) {
            callback(null, scene);
          }
        };

        app._preloadScripts(data, _loaded);
      } else {
        if (callback) {
          callback(err);
        }
      }
    });
  }
}

export { SceneRegistry };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NlbmUtcmVnaXN0cnkuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9mcmFtZXdvcmsvc2NlbmUtcmVnaXN0cnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGF0aCB9IGZyb20gJy4uL2NvcmUvcGF0aC5qcyc7XG5pbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uL2NvcmUvZGVidWcuanMnO1xuXG5pbXBvcnQgeyBBQlNPTFVURV9VUkwgfSBmcm9tICcuL2Fzc2V0L2NvbnN0YW50cy5qcyc7XG5cbmltcG9ydCB7IFNjZW5lUmVnaXN0cnlJdGVtIH0gZnJvbSAnLi9zY2VuZS1yZWdpc3RyeS1pdGVtLmpzJztcblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vYXBwLWJhc2UuanMnKS5BcHBCYXNlfSBBcHBCYXNlICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9lbnRpdHkuanMnKS5FbnRpdHl9IEVudGl0eSAqL1xuXG4vKipcbiAqIENhbGxiYWNrIHVzZWQgYnkge0BsaW5rIFNjZW5lUmVnaXN0cnkjbG9hZFNjZW5lSGllcmFyY2h5fS5cbiAqXG4gKiBAY2FsbGJhY2sgTG9hZEhpZXJhcmNoeUNhbGxiYWNrXG4gKiBAcGFyYW0ge3N0cmluZ3xudWxsfSBlcnIgLSBUaGUgZXJyb3IgbWVzc2FnZSBpbiB0aGUgY2FzZSB3aGVyZSB0aGUgbG9hZGluZyBvciBwYXJzaW5nIGZhaWxzLlxuICogQHBhcmFtIHtFbnRpdHl9IFtlbnRpdHldIC0gVGhlIGxvYWRlZCByb290IGVudGl0eSBpZiBubyBlcnJvcnMgd2VyZSBlbmNvdW50ZXJlZC5cbiAqL1xuXG4vKipcbiAqIENhbGxiYWNrIHVzZWQgYnkge0BsaW5rIFNjZW5lUmVnaXN0cnkjbG9hZFNjZW5lU2V0dGluZ3N9LlxuICpcbiAqIEBjYWxsYmFjayBMb2FkU2V0dGluZ3NDYWxsYmFja1xuICogQHBhcmFtIHtzdHJpbmd8bnVsbH0gZXJyIC0gVGhlIGVycm9yIG1lc3NhZ2UgaW4gdGhlIGNhc2Ugd2hlcmUgdGhlIGxvYWRpbmcgb3IgcGFyc2luZyBmYWlscy5cbiAqL1xuXG4vKipcbiAqIENhbGxiYWNrIHVzZWQgYnkge0BsaW5rIFNjZW5lUmVnaXN0cnkjY2hhbmdlU2NlbmV9LlxuICpcbiAqIEBjYWxsYmFjayBDaGFuZ2VTY2VuZUNhbGxiYWNrXG4gKiBAcGFyYW0ge3N0cmluZ3xudWxsfSBlcnIgLSBUaGUgZXJyb3IgbWVzc2FnZSBpbiB0aGUgY2FzZSB3aGVyZSB0aGUgbG9hZGluZyBvciBwYXJzaW5nIGZhaWxzLlxuICogQHBhcmFtIHtFbnRpdHl9IFtlbnRpdHldIC0gVGhlIGxvYWRlZCByb290IGVudGl0eSBpZiBubyBlcnJvcnMgd2VyZSBlbmNvdW50ZXJlZC5cbiAqL1xuXG4vKipcbiAqIENhbGxiYWNrIHVzZWQgYnkge0BsaW5rIFNjZW5lUmVnaXN0cnkjbG9hZFNjZW5lfS5cbiAqXG4gKiBAY2FsbGJhY2sgTG9hZFNjZW5lQ2FsbGJhY2tcbiAqIEBwYXJhbSB7c3RyaW5nfG51bGx9IGVyciAtIFRoZSBlcnJvciBtZXNzYWdlIGluIHRoZSBjYXNlIHdoZXJlIHRoZSBsb2FkaW5nIG9yIHBhcnNpbmcgZmFpbHMuXG4gKiBAcGFyYW0ge0VudGl0eX0gW2VudGl0eV0gLSBUaGUgbG9hZGVkIHJvb3QgZW50aXR5IGlmIG5vIGVycm9ycyB3ZXJlIGVuY291bnRlcmVkLlxuICovXG5cbi8qKlxuICogQ2FsbGJhY2sgdXNlZCBieSB7QGxpbmsgU2NlbmVSZWdpc3RyeSNsb2FkU2NlbmVEYXRhfS5cbiAqXG4gKiBAY2FsbGJhY2sgTG9hZFNjZW5lRGF0YUNhbGxiYWNrXG4gKiBAcGFyYW0ge3N0cmluZ3xudWxsfSBlcnIgLSBUaGUgZXJyb3IgbWVzc2FnZSBpbiB0aGUgY2FzZSB3aGVyZSB0aGUgbG9hZGluZyBvciBwYXJzaW5nIGZhaWxzLlxuICogQHBhcmFtIHtTY2VuZVJlZ2lzdHJ5SXRlbX0gW3NjZW5lSXRlbV0gLSBUaGUgc2NlbmUgcmVnaXN0cnkgaXRlbSBpZiBubyBlcnJvcnMgd2VyZSBlbmNvdW50ZXJlZC5cbiAqL1xuXG4vKipcbiAqIENvbnRhaW5lciBmb3Igc3RvcmluZyBhbmQgbG9hZGluZyBvZiBzY2VuZXMuIEFuIGluc3RhbmNlIG9mIHRoZSByZWdpc3RyeSBpcyBjcmVhdGVkIG9uIHRoZVxuICoge0BsaW5rIEFwcEJhc2V9IG9iamVjdCBhcyB7QGxpbmsgQXBwQmFzZSNzY2VuZXN9LlxuICovXG5jbGFzcyBTY2VuZVJlZ2lzdHJ5IHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgU2NlbmVSZWdpc3RyeSBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7QXBwQmFzZX0gYXBwIC0gVGhlIGFwcGxpY2F0aW9uLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFwcCkge1xuICAgICAgICB0aGlzLl9hcHAgPSBhcHA7XG4gICAgICAgIHRoaXMuX2xpc3QgPSBbXTtcbiAgICAgICAgdGhpcy5faW5kZXggPSB7fTtcbiAgICAgICAgdGhpcy5fdXJsSW5kZXggPSB7fTtcbiAgICB9XG5cbiAgICBkZXN0cm95KCkge1xuICAgICAgICB0aGlzLl9hcHAgPSBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0aGUgbGlzdCBvZiBzY2VuZS5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtTY2VuZVJlZ2lzdHJ5SXRlbVtdfSBBbGwgaXRlbXMgaW4gdGhlIHJlZ2lzdHJ5LlxuICAgICAqL1xuICAgIGxpc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9saXN0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZCBhIG5ldyBpdGVtIHRvIHRoZSBzY2VuZSByZWdpc3RyeS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHNjZW5lLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSAgVGhlIHVybCBvZiB0aGUgc2NlbmUgZmlsZS5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHRoZSBzY2VuZSB3YXMgc3VjY2Vzc2Z1bGx5IGFkZGVkIHRvIHRoZSByZWdpc3RyeSwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgICAqL1xuICAgIGFkZChuYW1lLCB1cmwpIHtcbiAgICAgICAgaWYgKHRoaXMuX2luZGV4Lmhhc093blByb3BlcnR5KG5hbWUpKSB7XG4gICAgICAgICAgICBEZWJ1Zy53YXJuKCdwYy5TY2VuZVJlZ2lzdHJ5OiB0cnlpbmcgdG8gYWRkIG1vcmUgdGhhbiBvbmUgc2NlbmUgY2FsbGVkOiAnICsgbmFtZSk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBpdGVtID0gbmV3IFNjZW5lUmVnaXN0cnlJdGVtKG5hbWUsIHVybCk7XG5cbiAgICAgICAgY29uc3QgaSA9IHRoaXMuX2xpc3QucHVzaChpdGVtKTtcbiAgICAgICAgdGhpcy5faW5kZXhbaXRlbS5uYW1lXSA9IGkgLSAxO1xuICAgICAgICB0aGlzLl91cmxJbmRleFtpdGVtLnVybF0gPSBpIC0gMTtcblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaW5kIGEgU2NlbmUgYnkgbmFtZSBhbmQgcmV0dXJuIHRoZSB7QGxpbmsgU2NlbmVSZWdpc3RyeUl0ZW19LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgc2NlbmUuXG4gICAgICogQHJldHVybnMge1NjZW5lUmVnaXN0cnlJdGVtfG51bGx9IFRoZSBzdG9yZWQgZGF0YSBhYm91dCBhIHNjZW5lIG9yIG51bGwgaWYgbm8gc2NlbmUgd2l0aFxuICAgICAqIHRoYXQgbmFtZSBleGlzdHMuXG4gICAgICovXG4gICAgZmluZChuYW1lKSB7XG4gICAgICAgIGlmICh0aGlzLl9pbmRleC5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xpc3RbdGhpcy5faW5kZXhbbmFtZV1dO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZCBhIHNjZW5lIGJ5IHRoZSBVUkwgYW5kIHJldHVybiB0aGUge0BsaW5rIFNjZW5lUmVnaXN0cnlJdGVtfS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgVVJMIHRvIHNlYXJjaCBieS5cbiAgICAgKiBAcmV0dXJucyB7U2NlbmVSZWdpc3RyeUl0ZW18bnVsbH0gVGhlIHN0b3JlZCBkYXRhIGFib3V0IGEgc2NlbmUgb3IgbnVsbCBpZiBubyBzY2VuZSB3aXRoXG4gICAgICogdGhhdCBVUkwgZXhpc3RzLlxuICAgICAqL1xuICAgIGZpbmRCeVVybCh1cmwpIHtcbiAgICAgICAgaWYgKHRoaXMuX3VybEluZGV4Lmhhc093blByb3BlcnR5KHVybCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9saXN0W3RoaXMuX3VybEluZGV4W3VybF1dO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGFuIGl0ZW0gZnJvbSB0aGUgc2NlbmUgcmVnaXN0cnkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBzY2VuZS5cbiAgICAgKi9cbiAgICByZW1vdmUobmFtZSkge1xuICAgICAgICBpZiAodGhpcy5faW5kZXguaGFzT3duUHJvcGVydHkobmFtZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGlkeCA9IHRoaXMuX2luZGV4W25hbWVdO1xuICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLl9saXN0W2lkeF07XG5cbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl91cmxJbmRleFtpdGVtLnVybF07XG4gICAgICAgICAgICAvLyByZW1vdmUgZnJvbSBpbmRleFxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2luZGV4W25hbWVdO1xuXG4gICAgICAgICAgICAvLyByZW1vdmUgZnJvbSBsaXN0XG4gICAgICAgICAgICB0aGlzLl9saXN0LnNwbGljZShpZHgsIDEpO1xuXG4gICAgICAgICAgICAvLyByZWZyZXNoIGluZGV4XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX2xpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpdGVtID0gdGhpcy5fbGlzdFtpXTtcbiAgICAgICAgICAgICAgICB0aGlzLl9pbmRleFtpdGVtLm5hbWVdID0gaTtcbiAgICAgICAgICAgICAgICB0aGlzLl91cmxJbmRleFtpdGVtLnVybF0gPSBpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gUHJpdmF0ZSBmdW5jdGlvbiB0byBsb2FkIHNjZW5lIGRhdGEgd2l0aCB0aGUgb3B0aW9uIHRvIGNhY2hlXG4gICAgLy8gVGhpcyBhbGxvd3MgdXMgdG8gcmV0YWluIGV4cGVjdGVkIGJlaGF2aW9yIG9mIGxvYWRTY2VuZVNldHRpbmdzIGFuZCBsb2FkU2NlbmVIaWVyYXJjaHkgd2hlcmUgdGhleVxuICAgIC8vIGRvbid0IHN0b3JlIGxvYWRlZCBkYXRhIHdoaWNoIG1heSBiZSB1bmRlc2lyZWQgYmVoYXZpb3Igd2l0aCBwcm9qZWN0cyB0aGF0IGhhdmUgbWFueSBzY2VuZXMuXG4gICAgX2xvYWRTY2VuZURhdGEoc2NlbmVJdGVtLCBzdG9yZUluQ2FjaGUsIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IGFwcCA9IHRoaXMuX2FwcDtcbiAgICAgICAgLy8gSWYgaXQncyBhIHNjZW5lSXRlbSwgd2Ugd2FudCB0byBiZSBhYmxlIHRvIGNhY2hlIHRoZSBkYXRhXG4gICAgICAgIC8vIHRoYXQgaXMgbG9hZGVkIHNvIHdlIGRvbid0IGRvIGEgc3Vic2VxdWVudCBodHRwIHJlcXVlc3RzXG4gICAgICAgIC8vIG9uIHRoZSBzYW1lIHNjZW5lIGxhdGVyXG5cbiAgICAgICAgLy8gSWYgaXQncyBqdXN0IGEgVVJMIG9yIHNjZW5lIG5hbWUgdGhlbiBhdHRlbXB0IHRvIGZpbmRcbiAgICAgICAgLy8gdGhlIHNjZW5lIGl0ZW0gaW4gdGhlIHJlZ2lzdHJ5IGVsc2UgY3JlYXRlIGEgdGVtcFxuICAgICAgICAvLyBTY2VuZVJlZ2lzdHJ5SXRlbSB0byB1c2UgZm9yIHRoaXMgZnVuY3Rpb24gYXMgdGhlIHNjZW5lXG4gICAgICAgIC8vIG1heSBub3QgaGF2ZSBiZWVuIGFkZGVkIHRvIHRoZSByZWdpc3RyeVxuICAgICAgICBsZXQgdXJsID0gc2NlbmVJdGVtO1xuICAgICAgICBpZiAodHlwZW9mIHNjZW5lSXRlbSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHNjZW5lSXRlbSA9IHRoaXMuZmluZEJ5VXJsKHVybCkgfHwgdGhpcy5maW5kKHVybCkgfHwgbmV3IFNjZW5lUmVnaXN0cnlJdGVtKCdVbnRpdGxlZCcsIHVybCk7XG4gICAgICAgIH1cblxuICAgICAgICB1cmwgPSBzY2VuZUl0ZW0udXJsO1xuXG4gICAgICAgIGlmICghdXJsKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhcIkNhbm5vdCBmaW5kIHNjZW5lIHRvIGxvYWRcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiB3ZSBoYXZlIHRoZSBkYXRhIGFscmVhZHkgbG9hZGVkLCBubyBuZWVkIHRvIGRvIGFub3RoZXIgSFRUUCByZXF1ZXN0XG4gICAgICAgIGlmIChzY2VuZUl0ZW0ubG9hZGVkKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBzY2VuZUl0ZW0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaW5jbHVkZSBhc3NldCBwcmVmaXggaWYgcHJlc2VudFxuICAgICAgICBpZiAoYXBwLmFzc2V0cyAmJiBhcHAuYXNzZXRzLnByZWZpeCAmJiAhQUJTT0xVVEVfVVJMLnRlc3QodXJsKSkge1xuICAgICAgICAgICAgdXJsID0gcGF0aC5qb2luKGFwcC5hc3NldHMucHJlZml4LCB1cmwpO1xuICAgICAgICB9XG5cbiAgICAgICAgc2NlbmVJdGVtLl9vbkxvYWRlZENhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTtcblxuICAgICAgICBpZiAoIXNjZW5lSXRlbS5fbG9hZGluZykge1xuICAgICAgICAgICAgLy8gQmVjYXVzZSB3ZSBuZWVkIHRvIGxvYWQgc2NyaXB0cyBiZWZvcmUgd2UgaW5zdGFuY2UgdGhlIGhpZXJhcmNoeSAoaS5lLiBiZWZvcmUgd2UgY3JlYXRlIHNjcmlwdCBjb21wb25lbnRzKVxuICAgICAgICAgICAgLy8gU3BsaXQgbG9hZGluZyBpbnRvIGxvYWQgYW5kIG9wZW5cbiAgICAgICAgICAgIGNvbnN0IGhhbmRsZXIgPSBhcHAubG9hZGVyLmdldEhhbmRsZXIoXCJoaWVyYXJjaHlcIik7XG5cbiAgICAgICAgICAgIGhhbmRsZXIubG9hZCh1cmwsIChlcnIsIGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICBzY2VuZUl0ZW0uZGF0YSA9IGRhdGE7XG4gICAgICAgICAgICAgICAgc2NlbmVJdGVtLl9sb2FkaW5nID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNjZW5lSXRlbS5fb25Mb2FkZWRDYWxsYmFja3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgc2NlbmVJdGVtLl9vbkxvYWRlZENhbGxiYWNrc1tpXShlcnIsIHNjZW5lSXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBkYXRhIGlmIGl0J3Mgbm90IGJlZW4gcmVxdWVzdGVkIHRvIHN0b3JlIGluIGNhY2hlXG4gICAgICAgICAgICAgICAgaWYgKCFzdG9yZUluQ2FjaGUpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NlbmVJdGVtLmRhdGEgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHNjZW5lSXRlbS5fb25Mb2FkZWRDYWxsYmFja3MubGVuZ3RoID0gMDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgc2NlbmVJdGVtLl9sb2FkaW5nID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMb2FkcyBhbmQgc3RvcmVzIHRoZSBzY2VuZSBkYXRhIHRvIHJlZHVjZSB0aGUgbnVtYmVyIG9mIHRoZSBuZXR3b3JrIHJlcXVlc3RzIHdoZW4gdGhlIHNhbWVcbiAgICAgKiBzY2VuZXMgYXJlIGxvYWRlZCBtdWx0aXBsZSB0aW1lcy4gQ2FuIGFsc28gYmUgdXNlZCB0byBsb2FkIGRhdGEgYmVmb3JlIGNhbGxpbmdcbiAgICAgKiB7QGxpbmsgU2NlbmVSZWdpc3RyeSNsb2FkU2NlbmVIaWVyYXJjaHl9IGFuZCB7QGxpbmsgU2NlbmVSZWdpc3RyeSNsb2FkU2NlbmVTZXR0aW5nc30gdG8gbWFrZVxuICAgICAqIHNjZW5lIGxvYWRpbmcgcXVpY2tlciBmb3IgdGhlIHVzZXIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1NjZW5lUmVnaXN0cnlJdGVtIHwgc3RyaW5nfSBzY2VuZUl0ZW0gLSBUaGUgc2NlbmUgaXRlbSAod2hpY2ggY2FuIGJlIGZvdW5kIHdpdGhcbiAgICAgKiB7QGxpbmsgU2NlbmVSZWdpc3RyeSNmaW5kfSwgVVJMIG9mIHRoZSBzY2VuZSBmaWxlIChlLmcuXCJzY2VuZV9pZC5qc29uXCIpIG9yIG5hbWUgb2YgdGhlIHNjZW5lLlxuICAgICAqIEBwYXJhbSB7TG9hZFNjZW5lRGF0YUNhbGxiYWNrfSBjYWxsYmFjayAtIFRoZSBmdW5jdGlvbiB0byBjYWxsIGFmdGVyIGxvYWRpbmcsXG4gICAgICogcGFzc2VkIChlcnIsIHNjZW5lSXRlbSkgd2hlcmUgZXJyIGlzIG51bGwgaWYgbm8gZXJyb3JzIG9jY3VycmVkLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogdmFyIHNjZW5lSXRlbSA9IGFwcC5zY2VuZXMuZmluZChcIlNjZW5lIE5hbWVcIik7XG4gICAgICogYXBwLnNjZW5lcy5sb2FkU2NlbmVEYXRhKHNjZW5lSXRlbSwgZnVuY3Rpb24gKGVyciwgc2NlbmVJdGVtKSB7XG4gICAgICogICAgIGlmIChlcnIpIHtcbiAgICAgKiAgICAgICAgIC8vIGVycm9yXG4gICAgICogICAgIH1cbiAgICAgKiB9KTtcbiAgICAgKi9cbiAgICBsb2FkU2NlbmVEYXRhKHNjZW5lSXRlbSwgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fbG9hZFNjZW5lRGF0YShzY2VuZUl0ZW0sIHRydWUsIGNhbGxiYWNrKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVbmxvYWRzIHNjZW5lIGRhdGEgdGhhdCBoYXMgYmVlbiBsb2FkZWQgcHJldmlvdXNseSB1c2luZyB7QGxpbmsgU2NlbmVSZWdpc3RyeSNsb2FkU2NlbmVEYXRhfS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U2NlbmVSZWdpc3RyeUl0ZW0gfCBzdHJpbmd9IHNjZW5lSXRlbSAtIFRoZSBzY2VuZSBpdGVtICh3aGljaCBjYW4gYmUgZm91bmQgd2l0aFxuICAgICAqIHtAbGluayBTY2VuZVJlZ2lzdHJ5I2ZpbmR9IG9yIFVSTCBvZiB0aGUgc2NlbmUgZmlsZS4gVXN1YWxseSB0aGlzIHdpbGwgYmUgXCJzY2VuZV9pZC5qc29uXCIuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgc2NlbmVJdGVtID0gYXBwLnNjZW5lcy5maW5kKFwiU2NlbmUgTmFtZVwiKTtcbiAgICAgKiBhcHAuc2NlbmVzLnVubG9hZFNjZW5lRGF0YShzY2VuZUl0ZW0pO1xuICAgICAqL1xuICAgIHVubG9hZFNjZW5lRGF0YShzY2VuZUl0ZW0pIHtcbiAgICAgICAgaWYgKHR5cGVvZiBzY2VuZUl0ZW0gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBzY2VuZUl0ZW0gPSB0aGlzLmZpbmRCeVVybChzY2VuZUl0ZW0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNjZW5lSXRlbSkge1xuICAgICAgICAgICAgc2NlbmVJdGVtLmRhdGEgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2xvYWRTY2VuZUhpZXJhcmNoeShzY2VuZUl0ZW0sIG9uQmVmb3JlQWRkSGllcmFyY2h5LCBjYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9sb2FkU2NlbmVEYXRhKHNjZW5lSXRlbSwgZmFsc2UsIChlcnIsIHNjZW5lSXRlbSkgPT4ge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvbkJlZm9yZUFkZEhpZXJhcmNoeSkge1xuICAgICAgICAgICAgICAgIG9uQmVmb3JlQWRkSGllcmFyY2h5KHNjZW5lSXRlbSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGFwcCA9IHRoaXMuX2FwcDtcblxuICAgICAgICAgICAgLy8gY2FsbGVkIGFmdGVyIHNjcmlwdHMgYXJlIHByZWxvYWRlZFxuICAgICAgICAgICAgY29uc3QgX2xvYWRlZCA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBCZWNhdXNlIHdlIG5lZWQgdG8gbG9hZCBzY3JpcHRzIGJlZm9yZSB3ZSBpbnN0YW5jZSB0aGUgaGllcmFyY2h5IChpLmUuIGJlZm9yZSB3ZSBjcmVhdGUgc2NyaXB0IGNvbXBvbmVudHMpXG4gICAgICAgICAgICAgICAgLy8gU3BsaXQgbG9hZGluZyBpbnRvIGxvYWQgYW5kIG9wZW5cbiAgICAgICAgICAgICAgICBjb25zdCBoYW5kbGVyID0gYXBwLmxvYWRlci5nZXRIYW5kbGVyKFwiaGllcmFyY2h5XCIpO1xuXG4gICAgICAgICAgICAgICAgYXBwLnN5c3RlbXMuc2NyaXB0LnByZWxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGVudGl0eSA9IGhhbmRsZXIub3BlbihzY2VuZUl0ZW0udXJsLCBzY2VuZUl0ZW0uZGF0YSk7XG5cbiAgICAgICAgICAgICAgICBhcHAuc3lzdGVtcy5zY3JpcHQucHJlbG9hZGluZyA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgLy8gY2xlYXIgZnJvbSBjYWNoZSBiZWNhdXNlIHRoaXMgZGF0YSBpcyBtb2RpZmllZCBieSBlbnRpdHkgb3BlcmF0aW9ucyAoZS5nLiBkZXN0cm95KVxuICAgICAgICAgICAgICAgIGFwcC5sb2FkZXIuY2xlYXJDYWNoZShzY2VuZUl0ZW0udXJsLCBcImhpZXJhcmNoeVwiKTtcblxuICAgICAgICAgICAgICAgIC8vIGFkZCB0byBoaWVyYXJjaHlcbiAgICAgICAgICAgICAgICBhcHAucm9vdC5hZGRDaGlsZChlbnRpdHkpO1xuXG4gICAgICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSBjb21wb25lbnRzXG4gICAgICAgICAgICAgICAgYXBwLnN5c3RlbXMuZmlyZSgnaW5pdGlhbGl6ZScsIGVudGl0eSk7XG4gICAgICAgICAgICAgICAgYXBwLnN5c3RlbXMuZmlyZSgncG9zdEluaXRpYWxpemUnLCBlbnRpdHkpO1xuICAgICAgICAgICAgICAgIGFwcC5zeXN0ZW1zLmZpcmUoJ3Bvc3RQb3N0SW5pdGlhbGl6ZScsIGVudGl0eSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKG51bGwsIGVudGl0eSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBsb2FkIHByaW9yaXR5IGFuZCByZWZlcmVuY2VkIHNjcmlwdHMgYmVmb3JlIG9wZW5pbmcgc2NlbmVcbiAgICAgICAgICAgIGFwcC5fcHJlbG9hZFNjcmlwdHMoc2NlbmVJdGVtLmRhdGEsIF9sb2FkZWQpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMb2FkIGEgc2NlbmUgZmlsZSwgY3JlYXRlIGFuZCBpbml0aWFsaXplIHRoZSBFbnRpdHkgaGllcmFyY2h5IGFuZCBhZGQgdGhlIGhpZXJhcmNoeSB0byB0aGVcbiAgICAgKiBhcHBsaWNhdGlvbiByb290IEVudGl0eS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U2NlbmVSZWdpc3RyeUl0ZW0gfCBzdHJpbmd9IHNjZW5lSXRlbSAtIFRoZSBzY2VuZSBpdGVtICh3aGljaCBjYW4gYmUgZm91bmQgd2l0aFxuICAgICAqIHtAbGluayBTY2VuZVJlZ2lzdHJ5I2ZpbmR9LCBVUkwgb2YgdGhlIHNjZW5lIGZpbGUgKGUuZy5cInNjZW5lX2lkLmpzb25cIikgb3IgbmFtZSBvZiB0aGUgc2NlbmUuXG4gICAgICogQHBhcmFtIHtMb2FkSGllcmFyY2h5Q2FsbGJhY2t9IGNhbGxiYWNrIC0gVGhlIGZ1bmN0aW9uIHRvIGNhbGwgYWZ0ZXIgbG9hZGluZyxcbiAgICAgKiBwYXNzZWQgKGVyciwgZW50aXR5KSB3aGVyZSBlcnIgaXMgbnVsbCBpZiBubyBlcnJvcnMgb2NjdXJyZWQuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgc2NlbmVJdGVtID0gYXBwLnNjZW5lcy5maW5kKFwiU2NlbmUgTmFtZVwiKTtcbiAgICAgKiBhcHAuc2NlbmVzLmxvYWRTY2VuZUhpZXJhcmNoeShzY2VuZUl0ZW0sIGZ1bmN0aW9uIChlcnIsIGVudGl0eSkge1xuICAgICAqICAgICBpZiAoIWVycikge1xuICAgICAqICAgICAgICAgdmFyIGUgPSBhcHAucm9vdC5maW5kKFwiTXkgTmV3IEVudGl0eVwiKTtcbiAgICAgKiAgICAgfSBlbHNlIHtcbiAgICAgKiAgICAgICAgIC8vIGVycm9yXG4gICAgICogICAgIH1cbiAgICAgKiB9KTtcbiAgICAgKi9cbiAgICBsb2FkU2NlbmVIaWVyYXJjaHkoc2NlbmVJdGVtLCBjYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9sb2FkU2NlbmVIaWVyYXJjaHkoc2NlbmVJdGVtLCBudWxsLCBjYWxsYmFjayk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTG9hZCBhIHNjZW5lIGZpbGUgYW5kIGFwcGx5IHRoZSBzY2VuZSBzZXR0aW5ncyB0byB0aGUgY3VycmVudCBzY2VuZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U2NlbmVSZWdpc3RyeUl0ZW0gfCBzdHJpbmd9IHNjZW5lSXRlbSAtIFRoZSBzY2VuZSBpdGVtICh3aGljaCBjYW4gYmUgZm91bmQgd2l0aFxuICAgICAqIHtAbGluayBTY2VuZVJlZ2lzdHJ5I2ZpbmR9LCBVUkwgb2YgdGhlIHNjZW5lIGZpbGUgKGUuZy5cInNjZW5lX2lkLmpzb25cIikgb3IgbmFtZSBvZiB0aGUgc2NlbmUuXG4gICAgICogQHBhcmFtIHtMb2FkU2V0dGluZ3NDYWxsYmFja30gY2FsbGJhY2sgLSBUaGUgZnVuY3Rpb24gY2FsbGVkIGFmdGVyIHRoZSBzZXR0aW5nc1xuICAgICAqIGFyZSBhcHBsaWVkLiBQYXNzZWQgKGVycikgd2hlcmUgZXJyIGlzIG51bGwgaWYgbm8gZXJyb3Igb2NjdXJyZWQuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgc2NlbmVJdGVtID0gYXBwLnNjZW5lcy5maW5kKFwiU2NlbmUgTmFtZVwiKTtcbiAgICAgKiBhcHAuc2NlbmVzLmxvYWRTY2VuZVNldHRpbmdzKHNjZW5lSXRlbSwgZnVuY3Rpb24gKGVycikge1xuICAgICAqICAgICBpZiAoIWVycikge1xuICAgICAqICAgICAgICAgLy8gc3VjY2Vzc1xuICAgICAqICAgICB9IGVsc2Uge1xuICAgICAqICAgICAgICAgLy8gZXJyb3JcbiAgICAgKiAgICAgfVxuICAgICAqIH0pO1xuICAgICAqL1xuICAgIGxvYWRTY2VuZVNldHRpbmdzKHNjZW5lSXRlbSwgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fbG9hZFNjZW5lRGF0YShzY2VuZUl0ZW0sIGZhbHNlLCAoZXJyLCBzY2VuZUl0ZW0pID0+IHtcbiAgICAgICAgICAgIGlmICghZXJyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYXBwLmFwcGx5U2NlbmVTZXR0aW5ncyhzY2VuZUl0ZW0uZGF0YS5zZXR0aW5ncyk7XG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGFuZ2UgdG8gYSBuZXcgc2NlbmUuIENhbGxpbmcgdGhpcyBmdW5jdGlvbiB3aWxsIGxvYWQgdGhlIHNjZW5lIGRhdGEsIGRlbGV0ZSBhbGxcbiAgICAgKiBlbnRpdGllcyBhbmQgZ3JhcGggbm9kZXMgdW5kZXIgYGFwcC5yb290YCBhbmQgbG9hZCB0aGUgc2NlbmUgc2V0dGluZ3MgYW5kIGhpZXJhcmNoeS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U2NlbmVSZWdpc3RyeUl0ZW0gfCBzdHJpbmd9IHNjZW5lSXRlbSAtIFRoZSBzY2VuZSBpdGVtICh3aGljaCBjYW4gYmUgZm91bmQgd2l0aFxuICAgICAqIHtAbGluayBTY2VuZVJlZ2lzdHJ5I2ZpbmR9LCBVUkwgb2YgdGhlIHNjZW5lIGZpbGUgKGUuZy5cInNjZW5lX2lkLmpzb25cIikgb3IgbmFtZSBvZiB0aGUgc2NlbmUuXG4gICAgICogQHBhcmFtIHtDaGFuZ2VTY2VuZUNhbGxiYWNrfSBbY2FsbGJhY2tdIC0gVGhlIGZ1bmN0aW9uIHRvIGNhbGwgYWZ0ZXIgbG9hZGluZyxcbiAgICAgKiBwYXNzZWQgKGVyciwgZW50aXR5KSB3aGVyZSBlcnIgaXMgbnVsbCBpZiBubyBlcnJvcnMgb2NjdXJyZWQuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBhcHAuc2NlbmVzLmNoYW5nZVNjZW5lKFwiU2NlbmUgTmFtZVwiLCBmdW5jdGlvbiAoZXJyLCBlbnRpdHkpIHtcbiAgICAgKiAgICAgaWYgKCFlcnIpIHtcbiAgICAgKiAgICAgICAgIC8vIHN1Y2Nlc3NcbiAgICAgKiAgICAgfSBlbHNlIHtcbiAgICAgKiAgICAgICAgIC8vIGVycm9yXG4gICAgICogICAgIH1cbiAgICAgKiB9KTtcbiAgICAgKi9cbiAgICBjaGFuZ2VTY2VuZShzY2VuZUl0ZW0sIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IGFwcCA9IHRoaXMuX2FwcDtcblxuICAgICAgICBjb25zdCBvbkJlZm9yZUFkZEhpZXJhcmNoeSA9IChzY2VuZUl0ZW0pID0+IHtcbiAgICAgICAgICAgIC8vIERlc3Ryb3kvUmVtb3ZlIGFsbCBub2RlcyBvbiB0aGUgYXBwLnJvb3RcbiAgICAgICAgICAgIGNvbnN0IHJvb3RDaGlsZHJlbiA9IGFwcC5yb290LmNoaWxkcmVuO1xuICAgICAgICAgICAgd2hpbGUgKHJvb3RDaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2hpbGQgPSByb290Q2hpbGRyZW5bMF07XG4gICAgICAgICAgICAgICAgY2hpbGQucmVwYXJlbnQobnVsbCk7XG4gICAgICAgICAgICAgICAgY2hpbGQuZGVzdHJveT8uKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFwcC5hcHBseVNjZW5lU2V0dGluZ3Moc2NlbmVJdGVtLmRhdGEuc2V0dGluZ3MpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuX2xvYWRTY2VuZUhpZXJhcmNoeShzY2VuZUl0ZW0sIG9uQmVmb3JlQWRkSGllcmFyY2h5LCBjYWxsYmFjayk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTG9hZCB0aGUgc2NlbmUgaGllcmFyY2h5IGFuZCBzY2VuZSBzZXR0aW5ncy4gVGhpcyBpcyBhbiBpbnRlcm5hbCBtZXRob2QgdXNlZCBieSB0aGVcbiAgICAgKiB7QGxpbmsgQXBwQmFzZX0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIFVSTCBvZiB0aGUgc2NlbmUgZmlsZS5cbiAgICAgKiBAcGFyYW0ge0xvYWRTY2VuZUNhbGxiYWNrfSBjYWxsYmFjayAtIFRoZSBmdW5jdGlvbiBjYWxsZWQgYWZ0ZXIgdGhlIHNldHRpbmdzIGFyZVxuICAgICAqIGFwcGxpZWQuIFBhc3NlZCAoZXJyLCBzY2VuZSkgd2hlcmUgZXJyIGlzIG51bGwgaWYgbm8gZXJyb3Igb2NjdXJyZWQgYW5kIHNjZW5lIGlzIHRoZVxuICAgICAqIHtAbGluayBTY2VuZX0uXG4gICAgICovXG4gICAgbG9hZFNjZW5lKHVybCwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgYXBwID0gdGhpcy5fYXBwO1xuXG4gICAgICAgIGNvbnN0IGhhbmRsZXIgPSBhcHAubG9hZGVyLmdldEhhbmRsZXIoXCJzY2VuZVwiKTtcblxuICAgICAgICAvLyBpbmNsdWRlIGFzc2V0IHByZWZpeCBpZiBwcmVzZW50XG4gICAgICAgIGlmIChhcHAuYXNzZXRzICYmIGFwcC5hc3NldHMucHJlZml4ICYmICFBQlNPTFVURV9VUkwudGVzdCh1cmwpKSB7XG4gICAgICAgICAgICB1cmwgPSBwYXRoLmpvaW4oYXBwLmFzc2V0cy5wcmVmaXgsIHVybCk7XG4gICAgICAgIH1cblxuICAgICAgICBoYW5kbGVyLmxvYWQodXJsLCAoZXJyLCBkYXRhKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWVycikge1xuICAgICAgICAgICAgICAgIGNvbnN0IF9sb2FkZWQgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHBhcnNlIGFuZCBjcmVhdGUgc2NlbmVcbiAgICAgICAgICAgICAgICAgICAgYXBwLnN5c3RlbXMuc2NyaXB0LnByZWxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzY2VuZSA9IGhhbmRsZXIub3Blbih1cmwsIGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIENhY2hlIHRoZSBkYXRhIGFzIHdlIGFyZSBsb2FkaW5nIHZpYSBVUkwgb25seVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzY2VuZUl0ZW0gPSB0aGlzLmZpbmRCeVVybCh1cmwpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2NlbmVJdGVtICYmICFzY2VuZUl0ZW0ubG9hZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY2VuZUl0ZW0uZGF0YSA9IGRhdGE7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBhcHAuc3lzdGVtcy5zY3JpcHQucHJlbG9hZGluZyA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNsZWFyIHNjZW5lIGZyb20gY2FjaGUgYmVjYXVzZSB3ZSdsbCBkZXN0cm95IGl0IHdoZW4gd2UgbG9hZCBhbm90aGVyIG9uZVxuICAgICAgICAgICAgICAgICAgICAvLyBzbyBkYXRhIHdpbGwgYmUgaW52YWxpZFxuICAgICAgICAgICAgICAgICAgICBhcHAubG9hZGVyLmNsZWFyQ2FjaGUodXJsLCBcInNjZW5lXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgIGFwcC5sb2FkZXIucGF0Y2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2U6IHNjZW5lLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzY2VuZVwiXG4gICAgICAgICAgICAgICAgICAgIH0sIGFwcC5hc3NldHMpO1xuXG4gICAgICAgICAgICAgICAgICAgIGFwcC5yb290LmFkZENoaWxkKHNjZW5lLnJvb3QpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEluaXRpYWxpemUgcGFjayBzZXR0aW5nc1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXBwLnN5c3RlbXMucmlnaWRib2R5ICYmIHR5cGVvZiBBbW1vICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnN5c3RlbXMucmlnaWRib2R5LmdyYXZpdHkuc2V0KHNjZW5lLl9ncmF2aXR5LngsIHNjZW5lLl9ncmF2aXR5LnksIHNjZW5lLl9ncmF2aXR5LnopO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBzY2VuZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8gcHJlbG9hZCBzY3JpcHRzIGJlZm9yZSBvcGVuaW5nIHNjZW5lXG4gICAgICAgICAgICAgICAgYXBwLl9wcmVsb2FkU2NyaXB0cyhkYXRhLCBfbG9hZGVkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFNjZW5lUmVnaXN0cnkgfTtcbiJdLCJuYW1lcyI6WyJTY2VuZVJlZ2lzdHJ5IiwiY29uc3RydWN0b3IiLCJhcHAiLCJfYXBwIiwiX2xpc3QiLCJfaW5kZXgiLCJfdXJsSW5kZXgiLCJkZXN0cm95IiwibGlzdCIsImFkZCIsIm5hbWUiLCJ1cmwiLCJoYXNPd25Qcm9wZXJ0eSIsIkRlYnVnIiwid2FybiIsIml0ZW0iLCJTY2VuZVJlZ2lzdHJ5SXRlbSIsImkiLCJwdXNoIiwiZmluZCIsImZpbmRCeVVybCIsInJlbW92ZSIsImlkeCIsInNwbGljZSIsImxlbmd0aCIsIl9sb2FkU2NlbmVEYXRhIiwic2NlbmVJdGVtIiwic3RvcmVJbkNhY2hlIiwiY2FsbGJhY2siLCJsb2FkZWQiLCJhc3NldHMiLCJwcmVmaXgiLCJBQlNPTFVURV9VUkwiLCJ0ZXN0IiwicGF0aCIsImpvaW4iLCJfb25Mb2FkZWRDYWxsYmFja3MiLCJfbG9hZGluZyIsImhhbmRsZXIiLCJsb2FkZXIiLCJnZXRIYW5kbGVyIiwibG9hZCIsImVyciIsImRhdGEiLCJsb2FkU2NlbmVEYXRhIiwidW5sb2FkU2NlbmVEYXRhIiwiX2xvYWRTY2VuZUhpZXJhcmNoeSIsIm9uQmVmb3JlQWRkSGllcmFyY2h5IiwiX2xvYWRlZCIsInN5c3RlbXMiLCJzY3JpcHQiLCJwcmVsb2FkaW5nIiwiZW50aXR5Iiwib3BlbiIsImNsZWFyQ2FjaGUiLCJyb290IiwiYWRkQ2hpbGQiLCJmaXJlIiwiX3ByZWxvYWRTY3JpcHRzIiwibG9hZFNjZW5lSGllcmFyY2h5IiwibG9hZFNjZW5lU2V0dGluZ3MiLCJhcHBseVNjZW5lU2V0dGluZ3MiLCJzZXR0aW5ncyIsImNoYW5nZVNjZW5lIiwicm9vdENoaWxkcmVuIiwiY2hpbGRyZW4iLCJjaGlsZCIsInJlcGFyZW50IiwibG9hZFNjZW5lIiwic2NlbmUiLCJwYXRjaCIsInJlc291cmNlIiwidHlwZSIsInJpZ2lkYm9keSIsIkFtbW8iLCJncmF2aXR5Iiwic2V0IiwiX2dyYXZpdHkiLCJ4IiwieSIsInoiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFxREEsTUFBTUEsYUFBYSxDQUFDO0VBTWhCQyxXQUFXLENBQUNDLEdBQUcsRUFBRTtJQUNiLElBQUksQ0FBQ0MsSUFBSSxHQUFHRCxHQUFHLENBQUE7SUFDZixJQUFJLENBQUNFLEtBQUssR0FBRyxFQUFFLENBQUE7QUFDZixJQUFBLElBQUksQ0FBQ0MsTUFBTSxHQUFHLEVBQUUsQ0FBQTtBQUNoQixJQUFBLElBQUksQ0FBQ0MsU0FBUyxHQUFHLEVBQUUsQ0FBQTtBQUN2QixHQUFBO0FBRUFDLEVBQUFBLE9BQU8sR0FBRztJQUNOLElBQUksQ0FBQ0osSUFBSSxHQUFHLElBQUksQ0FBQTtBQUNwQixHQUFBOztBQU9BSyxFQUFBQSxJQUFJLEdBQUc7SUFDSCxPQUFPLElBQUksQ0FBQ0osS0FBSyxDQUFBO0FBQ3JCLEdBQUE7O0FBU0FLLEVBQUFBLEdBQUcsQ0FBQ0MsSUFBSSxFQUFFQyxHQUFHLEVBQUU7SUFDWCxJQUFJLElBQUksQ0FBQ04sTUFBTSxDQUFDTyxjQUFjLENBQUNGLElBQUksQ0FBQyxFQUFFO0FBQ2xDRyxNQUFBQSxLQUFLLENBQUNDLElBQUksQ0FBQyw4REFBOEQsR0FBR0osSUFBSSxDQUFD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
