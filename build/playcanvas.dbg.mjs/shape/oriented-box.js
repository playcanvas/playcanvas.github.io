/**
 * @license
 * PlayCanvas Engine v1.58.0-dev revision e102f2b2a (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../core/debug.js';
import { Mat4 } from '../math/mat4.js';
import { Vec3 } from '../math/vec3.js';
import { BoundingBox } from './bounding-box.js';
import { BoundingSphere } from './bounding-sphere.js';
import { Ray } from './ray.js';

const tmpRay = new Ray();
const tmpVec3 = new Vec3();
const tmpSphere = new BoundingSphere();
const tmpMat4 = new Mat4();

class OrientedBox {
  constructor(worldTransform = new Mat4(), halfExtents = new Vec3(0.5, 0.5, 0.5)) {
    Debug.assert(!Object.isFrozen(worldTransform), 'The constructor of \'OrientedBox\' does not accept a constant (frozen) object as a \'worldTransform\' parameter');
    Debug.assert(!Object.isFrozen(halfExtents), 'The constructor of \'OrientedBox\' does not accept a constant (frozen) object as a \'halfExtents\' parameter');
    this.halfExtents = halfExtents;
    this._modelTransform = worldTransform.clone().invert();
    this._worldTransform = worldTransform.clone();
    this._aabb = new BoundingBox(new Vec3(), this.halfExtents);
  }

  set worldTransform(value) {
    this._worldTransform.copy(value);

    this._modelTransform.copy(value).invert();
  }

  get worldTransform() {
    return this._worldTransform;
  }

  intersectsRay(ray, point) {
    this._modelTransform.transformPoint(ray.origin, tmpRay.origin);

    this._modelTransform.transformVector(ray.direction, tmpRay.direction);

    if (point) {
      const result = this._aabb._intersectsRay(tmpRay, point);

      tmpMat4.copy(this._modelTransform).invert().transformPoint(point, point);
      return result;
    }

    return this._aabb._fastIntersectsRay(tmpRay);
  }

  containsPoint(point) {
    this._modelTransform.transformPoint(point, tmpVec3);

    return this._aabb.containsPoint(tmpVec3);
  }

  intersectsBoundingSphere(sphere) {
    this._modelTransform.transformPoint(sphere.center, tmpSphere.center);

    tmpSphere.radius = sphere.radius;

    if (this._aabb.intersectsBoundingSphere(tmpSphere)) {
      return true;
    }

    return false;
  }

}

export { OrientedBox };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JpZW50ZWQtYm94LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc2hhcGUvb3JpZW50ZWQtYm94LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSAnLi4vY29yZS9kZWJ1Zy5qcyc7XG5pbXBvcnQgeyBNYXQ0IH0gZnJvbSAnLi4vbWF0aC9tYXQ0LmpzJztcbmltcG9ydCB7IFZlYzMgfSBmcm9tICcuLi9tYXRoL3ZlYzMuanMnO1xuXG5pbXBvcnQgeyBCb3VuZGluZ0JveCB9IGZyb20gJy4vYm91bmRpbmctYm94LmpzJztcbmltcG9ydCB7IEJvdW5kaW5nU3BoZXJlIH0gZnJvbSAnLi9ib3VuZGluZy1zcGhlcmUuanMnO1xuaW1wb3J0IHsgUmF5IH0gZnJvbSAnLi9yYXkuanMnO1xuXG5jb25zdCB0bXBSYXkgPSBuZXcgUmF5KCk7XG5jb25zdCB0bXBWZWMzID0gbmV3IFZlYzMoKTtcbmNvbnN0IHRtcFNwaGVyZSA9IG5ldyBCb3VuZGluZ1NwaGVyZSgpO1xuY29uc3QgdG1wTWF0NCA9IG5ldyBNYXQ0KCk7XG5cbi8qKlxuICogT3JpZW50ZWQgQm94LlxuICovXG5jbGFzcyBPcmllbnRlZEJveCB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IE9yaWVudGVkQm94IGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtNYXQ0fSBbd29ybGRUcmFuc2Zvcm1dIC0gVHJhbnNmb3JtIHRoYXQgaGFzIHRoZSBvcmllbnRhdGlvbiBhbmQgcG9zaXRpb24gb2YgdGhlIGJveC5cbiAgICAgKiBTY2FsZSBpcyBhc3N1bWVkIHRvIGJlIG9uZS5cbiAgICAgKiBAcGFyYW0ge1ZlYzN9IFtoYWxmRXh0ZW50c10gLSBIYWxmIHRoZSBkaXN0YW5jZSBhY3Jvc3MgdGhlIGJveCBpbiBlYWNoIGxvY2FsIGF4aXMuIFRoZVxuICAgICAqIGNvbnN0cnVjdG9yIHRha2VzIGEgcmVmZXJlbmNlIG9mIHRoaXMgcGFyYW1ldGVyLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHdvcmxkVHJhbnNmb3JtID0gbmV3IE1hdDQoKSwgaGFsZkV4dGVudHMgPSBuZXcgVmVjMygwLjUsIDAuNSwgMC41KSkge1xuICAgICAgICBEZWJ1Zy5hc3NlcnQoIU9iamVjdC5pc0Zyb3plbih3b3JsZFRyYW5zZm9ybSksICdUaGUgY29uc3RydWN0b3Igb2YgXFwnT3JpZW50ZWRCb3hcXCcgZG9lcyBub3QgYWNjZXB0IGEgY29uc3RhbnQgKGZyb3plbikgb2JqZWN0IGFzIGEgXFwnd29ybGRUcmFuc2Zvcm1cXCcgcGFyYW1ldGVyJyk7XG4gICAgICAgIERlYnVnLmFzc2VydCghT2JqZWN0LmlzRnJvemVuKGhhbGZFeHRlbnRzKSwgJ1RoZSBjb25zdHJ1Y3RvciBvZiBcXCdPcmllbnRlZEJveFxcJyBkb2VzIG5vdCBhY2NlcHQgYSBjb25zdGFudCAoZnJvemVuKSBvYmplY3QgYXMgYSBcXCdoYWxmRXh0ZW50c1xcJyBwYXJhbWV0ZXInKTtcblxuICAgICAgICB0aGlzLmhhbGZFeHRlbnRzID0gaGFsZkV4dGVudHM7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEB0eXBlIHtNYXQ0fVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5fbW9kZWxUcmFuc2Zvcm0gPSB3b3JsZFRyYW5zZm9ybS5jbG9uZSgpLmludmVydCgpO1xuICAgICAgICAvKipcbiAgICAgICAgICogQHR5cGUge01hdDR9XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl93b3JsZFRyYW5zZm9ybSA9IHdvcmxkVHJhbnNmb3JtLmNsb25lKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAdHlwZSB7Qm91bmRpbmdCb3h9XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl9hYWJiID0gbmV3IEJvdW5kaW5nQm94KG5ldyBWZWMzKCksIHRoaXMuaGFsZkV4dGVudHMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSB3b3JsZCB0cmFuc2Zvcm0gb2YgdGhlIE9CQi5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtNYXQ0fVxuICAgICAqL1xuICAgIHNldCB3b3JsZFRyYW5zZm9ybSh2YWx1ZSkge1xuICAgICAgICB0aGlzLl93b3JsZFRyYW5zZm9ybS5jb3B5KHZhbHVlKTtcbiAgICAgICAgdGhpcy5fbW9kZWxUcmFuc2Zvcm0uY29weSh2YWx1ZSkuaW52ZXJ0KCk7XG4gICAgfVxuXG4gICAgZ2V0IHdvcmxkVHJhbnNmb3JtKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fd29ybGRUcmFuc2Zvcm07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVzdCBpZiBhIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIE9CQi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7UmF5fSByYXkgLSBSYXkgdG8gdGVzdCBhZ2FpbnN0IChkaXJlY3Rpb24gbXVzdCBiZSBub3JtYWxpemVkKS5cbiAgICAgKiBAcGFyYW0ge1ZlYzN9IFtwb2ludF0gLSBJZiB0aGVyZSBpcyBhbiBpbnRlcnNlY3Rpb24sIHRoZSBpbnRlcnNlY3Rpb24gcG9pbnQgd2lsbCBiZSBjb3BpZWRcbiAgICAgKiBpbnRvIGhlcmUuXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlcmUgaXMgYW4gaW50ZXJzZWN0aW9uLlxuICAgICAqL1xuICAgIGludGVyc2VjdHNSYXkocmF5LCBwb2ludCkge1xuICAgICAgICB0aGlzLl9tb2RlbFRyYW5zZm9ybS50cmFuc2Zvcm1Qb2ludChyYXkub3JpZ2luLCB0bXBSYXkub3JpZ2luKTtcbiAgICAgICAgdGhpcy5fbW9kZWxUcmFuc2Zvcm0udHJhbnNmb3JtVmVjdG9yKHJheS5kaXJlY3Rpb24sIHRtcFJheS5kaXJlY3Rpb24pO1xuXG4gICAgICAgIGlmIChwb2ludCkge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5fYWFiYi5faW50ZXJzZWN0c1JheSh0bXBSYXksIHBvaW50KTtcbiAgICAgICAgICAgIHRtcE1hdDQuY29weSh0aGlzLl9tb2RlbFRyYW5zZm9ybSkuaW52ZXJ0KCkudHJhbnNmb3JtUG9pbnQocG9pbnQsIHBvaW50KTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5fYWFiYi5fZmFzdEludGVyc2VjdHNSYXkodG1wUmF5KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZXN0IGlmIGEgcG9pbnQgaXMgaW5zaWRlIGEgT0JCLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtWZWMzfSBwb2ludCAtIFBvaW50IHRvIHRlc3QuXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlIHBvaW50IGlzIGluc2lkZSB0aGUgT0JCIGFuZCBmYWxzZSBvdGhlcndpc2UuXG4gICAgICovXG4gICAgY29udGFpbnNQb2ludChwb2ludCkge1xuICAgICAgICB0aGlzLl9tb2RlbFRyYW5zZm9ybS50cmFuc2Zvcm1Qb2ludChwb2ludCwgdG1wVmVjMyk7XG4gICAgICAgIHJldHVybiB0aGlzLl9hYWJiLmNvbnRhaW5zUG9pbnQodG1wVmVjMyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVzdCBpZiBhIEJvdW5kaW5nIFNwaGVyZSBpcyBvdmVybGFwcGluZywgZW52ZWxvcGluZywgb3IgaW5zaWRlIHRoaXMgT0JCLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtCb3VuZGluZ1NwaGVyZX0gc3BoZXJlIC0gQm91bmRpbmcgU3BoZXJlIHRvIHRlc3QuXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlIEJvdW5kaW5nIFNwaGVyZSBpcyBvdmVybGFwcGluZywgZW52ZWxvcGluZyBvciBpbnNpZGUgdGhpcyBPQkJcbiAgICAgKiBhbmQgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgICAqL1xuICAgIGludGVyc2VjdHNCb3VuZGluZ1NwaGVyZShzcGhlcmUpIHtcbiAgICAgICAgdGhpcy5fbW9kZWxUcmFuc2Zvcm0udHJhbnNmb3JtUG9pbnQoc3BoZXJlLmNlbnRlciwgdG1wU3BoZXJlLmNlbnRlcik7XG4gICAgICAgIHRtcFNwaGVyZS5yYWRpdXMgPSBzcGhlcmUucmFkaXVzO1xuXG4gICAgICAgIGlmICh0aGlzLl9hYWJiLmludGVyc2VjdHNCb3VuZGluZ1NwaGVyZSh0bXBTcGhlcmUpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IE9yaWVudGVkQm94IH07XG4iXSwibmFtZXMiOlsidG1wUmF5IiwiUmF5IiwidG1wVmVjMyIsIlZlYzMiLCJ0bXBTcGhlcmUiLCJCb3VuZGluZ1NwaGVyZSIsInRtcE1hdDQiLCJNYXQ0IiwiT3JpZW50ZWRCb3giLCJjb25zdHJ1Y3RvciIsIndvcmxkVHJhbnNmb3JtIiwiaGFsZkV4dGVudHMiLCJEZWJ1ZyIsImFzc2VydCIsIk9iamVjdCIsImlzRnJvemVuIiwiX21vZGVsVHJhbnNmb3JtIiwiY2xvbmUiLCJpbnZlcnQiLCJfd29ybGRUcmFuc2Zvcm0iLCJfYWFiYiIsIkJvdW5kaW5nQm94IiwidmFsdWUiLCJjb3B5IiwiaW50ZXJzZWN0c1JheSIsInJheSIsInBvaW50IiwidHJhbnNmb3JtUG9pbnQiLCJvcmlnaW4iLCJ0cmFuc2Zvcm1WZWN0b3IiLCJkaXJlY3Rpb24iLCJyZXN1bHQiLCJfaW50ZXJzZWN0c1JheSIsIl9mYXN0SW50ZXJzZWN0c1JheSIsImNvbnRhaW5zUG9pbnQiLCJpbnRlcnNlY3RzQm91bmRpbmdTcGhlcmUiLCJzcGhlcmUiLCJjZW50ZXIiLCJyYWRpdXMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQVFBLE1BQU1BLE1BQU0sR0FBRyxJQUFJQyxHQUFKLEVBQWYsQ0FBQTtBQUNBLE1BQU1DLE9BQU8sR0FBRyxJQUFJQyxJQUFKLEVBQWhCLENBQUE7QUFDQSxNQUFNQyxTQUFTLEdBQUcsSUFB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
