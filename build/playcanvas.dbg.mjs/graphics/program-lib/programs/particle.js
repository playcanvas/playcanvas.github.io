/**
 * @license
 * PlayCanvas Engine v1.57.1 revision 256dd83c2 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { BLEND_NORMAL, BLEND_ADDITIVE, BLEND_MULTIPLICATIVE } from '../../../scene/constants.js';
import { shaderChunks } from '../chunks/chunks.js';
import { collectAttribs } from '../utils.js';
import { precisionCode, gammaCode, tonemapCode } from './common.js';

const particle = {
  generateKey: function (options) {
    let key = "particle";

    for (const prop in options) {
      if (options.hasOwnProperty(prop)) {
        key += options[prop];
      }
    }

    return key;
  },
  _animTex: function (options) {
    let vshader = "";
    vshader += options.animTexLoop ? shaderChunks.particleAnimFrameLoopVS : shaderChunks.particleAnimFrameClampVS;
    vshader += shaderChunks.particleAnimTexVS;
    return vshader;
  },
  createShaderDefinition: function (device, options) {
    let vshader = "";
    let fshader = precisionCode(device) + "\n";
    fshader += '#define PARTICLE\n';

    if (device.webgl2) {
      vshader += "#define GL2\n";
      fshader += "#define GL2\n";
    }

    vshader += "#define VERTEXSHADER\n";
    if (options.mesh) vshader += "#define USE_MESH\n";
    if (options.localSpace) vshader += "#define LOCAL_SPACE\n";
    if (options.screenSpace) vshader += "#define SCREEN_SPACE\n";
    if (options.animTex) vshader += "\nuniform vec2 animTexTilesParams;\n";
    if (options.animTex) vshader += "\nuniform vec4 animTexParams;\n";
    if (options.animTex) vshader += "\nuniform vec2 animTexIndexParams;\n";
    if (options.normal === 2) vshader += "\nvarying mat3 ParticleMat;\n";
    if (options.normal === 1) vshader += "\nvarying vec3 Normal;\n";
    if (options.soft) vshader += "\nvarying float vDepth;\n";
    const faceVS = options.customFace ? shaderChunks.particle_customFaceVS : shaderChunks.particle_billboardVS;

    if (!options.useCpu) {
      vshader += shaderChunks.particle_initVS;
      vshader += options.pack8 ? shaderChunks.particleInputRgba8PS : shaderChunks.particleInputFloatPS;
      if (options.soft > 0) vshader += shaderChunks.screenDepthPS;
      vshader += shaderChunks.particleVS;
      if (options.localSpace) vshader += shaderChunks.particle_localShiftVS;
      if (options.animTex) vshader += this._animTex(options);
      if (options.wrap) vshader += shaderChunks.particle_wrapVS;
      if (options.alignToMotion) vshader += shaderChunks.particle_pointAlongVS;
      vshader += options.mesh ? shaderChunks.particle_meshVS : faceVS;
      if (options.normal === 1) vshader += shaderChunks.particle_normalVS;
      if (options.normal === 2) vshader += shaderChunks.particle_TBNVS;
      if (options.stretch > 0.0) vshader += shaderChunks.particle_stretchVS;
      vshader += shaderChunks.particle_endVS;
      if (options.soft > 0) vshader += shaderChunks.particle_softVS;
    } else {
      if (options.soft > 0) vshader += shaderChunks.screenDepthPS;
      vshader += shaderChunks.particle_cpuVS;
      if (options.localSpace) vshader += shaderChunks.particle_localShiftVS;
      if (options.animTex) vshader += this._animTex(options);
      if (options.alignToMotion) vshader += shaderChunks.particle_pointAlongVS;
      vshader += options.mesh ? shaderChunks.particle_meshVS : faceVS;
      if (options.normal === 1) vshader += shaderChunks.particle_normalVS;
      if (options.normal === 2) vshader += shaderChunks.particle_TBNVS;
      if (options.stretch > 0.0) vshader += shaderChunks.particle_stretchVS;
      vshader += shaderChunks.particle_cpu_endVS;
      if (options.soft > 0) vshader += shaderChunks.particle_softVS;
    }

    vshader += "}\n";

    if (options.normal > 0) {
      if (options.normal === 1) {
        fshader += "\nvarying vec3 Normal;\n";
      } else if (options.normal === 2) {
        fshader += "\nvarying mat3 ParticleMat;\n";
      }

      fshader += "\nuniform vec3 lightCube[6];\n";
    }

    if (options.soft) fshader += "\nvarying float vDepth;\n";
    if (options.normal === 0 && options.fog === "none") options.srgb = false;
    fshader += shaderChunks.decodePS;
    fshader += gammaCode(options.gamma);
    fshader += tonemapCode(options.toneMap);

    if (options.fog === 'linear') {
      fshader += shaderChunks.fogLinearPS;
    } else if (options.fog === 'exp') {
      fshader += shaderChunks.fogExpPS;
    } else if (options.fog === 'exp2') {
      fshader += shaderChunks.fogExp2PS;
    } else {
      fshader += shaderChunks.fogNonePS;
    }

    if (options.normal === 2) fshader += "\nuniform sampler2D normalMap;\n";
    if (options.soft > 0) fshader += shaderChunks.screenDepthPS;
    fshader += shaderChunks.particlePS;
    if (options.soft > 0) fshader += shaderChunks.particle_softPS;
    if (options.normal === 1) fshader += "\nvec3 normal = Normal;\n";
    if (options.normal === 2) fshader += shaderChunks.particle_normalMapPS;
    if (options.normal > 0) fshader += options.halflambert ? shaderChunks.particle_halflambertPS : shaderChunks.particle_lambertPS;
    if (options.normal > 0) fshader += shaderChunks.particle_lightingPS;

    if (options.blend === BLEND_NORMAL) {
      fshader += shaderChunks.particle_blendNormalPS;
    } else if (options.blend === BLEND_ADDITIVE) {
      fshader += shaderChunks.particle_blendAddPS;
    } else if (options.blend === BLEND_MULTIPLICATIVE) {
      fshader += shaderChunks.particle_blendMultiplyPS;
    }

    fshader += shaderChunks.particle_endPS;
    const attributes = collectAttribs(vshader);
    return {
      attributes: attributes,
      vshader: vshader,
      fshader: fshader
    };
  }
};

export { particle };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFydGljbGUuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9ncmFwaGljcy9wcm9ncmFtLWxpYi9wcm9ncmFtcy9wYXJ0aWNsZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCTEVORF9BRERJVElWRSwgQkxFTkRfTVVMVElQTElDQVRJVkUsIEJMRU5EX05PUk1BTCB9IGZyb20gJy4uLy4uLy4uL3NjZW5lL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBzaGFkZXJDaHVua3MgfSBmcm9tICcuLi9jaHVua3MvY2h1bmtzLmpzJztcblxuaW1wb3J0IHsgY29sbGVjdEF0dHJpYnMgfSBmcm9tICcuLi91dGlscy5qcyc7XG5pbXBvcnQgeyBnYW1tYUNvZGUsIHByZWNpc2lvbkNvZGUsIHRvbmVtYXBDb2RlIH0gZnJvbSAnLi9jb21tb24uanMnO1xuXG5jb25zdCBwYXJ0aWNsZSA9IHtcbiAgICBnZW5lcmF0ZUtleTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgbGV0IGtleSA9IFwicGFydGljbGVcIjtcbiAgICAgICAgZm9yIChjb25zdCBwcm9wIGluIG9wdGlvbnMpIHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmhhc093blByb3BlcnR5KHByb3ApKSB7XG4gICAgICAgICAgICAgICAga2V5ICs9IG9wdGlvbnNbcHJvcF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGtleTtcbiAgICB9LFxuXG4gICAgX2FuaW1UZXg6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIGxldCB2c2hhZGVyID0gXCJcIjtcbiAgICAgICAgdnNoYWRlciArPSBvcHRpb25zLmFuaW1UZXhMb29wID8gc2hhZGVyQ2h1bmtzLnBhcnRpY2xlQW5pbUZyYW1lTG9vcFZTIDogc2hhZGVyQ2h1bmtzLnBhcnRpY2xlQW5pbUZyYW1lQ2xhbXBWUztcbiAgICAgICAgdnNoYWRlciArPSBzaGFkZXJDaHVua3MucGFydGljbGVBbmltVGV4VlM7XG4gICAgICAgIHJldHVybiB2c2hhZGVyO1xuICAgIH0sXG5cbiAgICBjcmVhdGVTaGFkZXJEZWZpbml0aW9uOiBmdW5jdGlvbiAoZGV2aWNlLCBvcHRpb25zKSB7XG4gICAgICAgIGxldCB2c2hhZGVyID0gXCJcIjtcbiAgICAgICAgbGV0IGZzaGFkZXIgPSBwcmVjaXNpb25Db2RlKGRldmljZSkgKyBcIlxcblwiO1xuICAgICAgICBmc2hhZGVyICs9ICcjZGVmaW5lIFBBUlRJQ0xFXFxuJztcblxuICAgICAgICBpZiAoZGV2aWNlLndlYmdsMikge1xuICAgICAgICAgICAgdnNoYWRlciArPSBcIiNkZWZpbmUgR0wyXFxuXCI7XG4gICAgICAgICAgICBmc2hhZGVyICs9IFwiI2RlZmluZSBHTDJcXG5cIjtcbiAgICAgICAgfVxuICAgICAgICB2c2hhZGVyICs9IFwiI2RlZmluZSBWRVJURVhTSEFERVJcXG5cIjtcbiAgICAgICAgaWYgKG9wdGlvbnMubWVzaCkgdnNoYWRlciArPSBcIiNkZWZpbmUgVVNFX01FU0hcXG5cIjtcbiAgICAgICAgaWYgKG9wdGlvbnMubG9jYWxTcGFjZSkgdnNoYWRlciArPSBcIiNkZWZpbmUgTE9DQUxfU1BBQ0VcXG5cIjtcbiAgICAgICAgaWYgKG9wdGlvbnMuc2NyZWVuU3BhY2UpIHZzaGFkZXIgKz0gXCIjZGVmaW5lIFNDUkVFTl9TUEFDRVxcblwiO1xuXG4gICAgICAgIGlmIChvcHRpb25zLmFuaW1UZXgpIHZzaGFkZXIgKz0gXCJcXG51bmlmb3JtIHZlYzIgYW5pbVRleFRpbGVzUGFyYW1zO1xcblwiO1xuICAgICAgICBpZiAob3B0aW9ucy5hbmltVGV4KSB2c2hhZGVyICs9IFwiXFxudW5pZm9ybSB2ZWM0IGFuaW1UZXhQYXJhbXM7XFxuXCI7XG4gICAgICAgIGlmIChvcHRpb25zLmFuaW1UZXgpIHZzaGFkZXIgKz0gXCJcXG51bmlmb3JtIHZlYzIgYW5pbVRleEluZGV4UGFyYW1zO1xcblwiO1xuICAgICAgICBpZiAob3B0aW9ucy5ub3JtYWwgPT09IDIpIHZzaGFkZXIgKz0gXCJcXG52YXJ5aW5nIG1hdDMgUGFydGljbGVNYXQ7XFxuXCI7XG4gICAgICAgIGlmIChvcHRpb25zLm5vcm1hbCA9PT0gMSkgdnNoYWRlciArPSBcIlxcbnZhcnlpbmcgdmVjMyBOb3JtYWw7XFxuXCI7XG4gICAgICAgIGlmIChvcHRpb25zLnNvZnQpIHZzaGFkZXIgKz0gXCJcXG52YXJ5aW5nIGZsb2F0IHZEZXB0aDtcXG5cIjtcblxuICAgICAgICBjb25zdCBmYWNlVlMgPSBvcHRpb25zLmN1c3RvbUZhY2UgPyBzaGFkZXJDaHVua3MucGFydGljbGVfY3VzdG9tRmFjZVZTIDogc2hhZGVyQ2h1bmtzLnBhcnRpY2xlX2JpbGxib2FyZFZTO1xuXG4gICAgICAgIGlmICghb3B0aW9ucy51c2VDcHUpIHtcbiAgICAgICAgICAgIHZzaGFkZXIgKz0gc2hhZGVyQ2h1bmtzLnBhcnRpY2xlX2luaXRWUztcbiAgICAgICAgICAgIHZzaGFkZXIgKz0gKG9wdGlvbnMucGFjazggPyBzaGFkZXJDaHVua3MucGFydGljbGVJbnB1dFJnYmE4UFMgOiBzaGFkZXJDaHVua3MucGFydGljbGVJbnB1dEZsb2F0UFMpO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuc29mdCA+IDApIHZzaGFkZXIgKz0gc2hhZGVyQ2h1bmtzLnNjcmVlbkRlcHRoUFM7XG4gICAgICAgICAgICB2c2hhZGVyICs9IHNoYWRlckNodW5rcy5wYXJ0aWNsZVZTO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMubG9jYWxTcGFjZSkgdnNoYWRlciArPSBzaGFkZXJDaHVua3MucGFydGljbGVfbG9jYWxTaGlmdFZTO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuYW5pbVRleCkgdnNoYWRlciArPSB0aGlzLl9hbmltVGV4KG9wdGlvbnMpO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMud3JhcCkgdnNoYWRlciArPSBzaGFkZXJDaHVua3MucGFydGljbGVfd3JhcFZTO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuYWxpZ25Ub01vdGlvbikgdnNoYWRlciArPSBzaGFkZXJDaHVua3MucGFydGljbGVfcG9pbnRBbG9uZ1ZTO1xuICAgICAgICAgICAgdnNoYWRlciArPSBvcHRpb25zLm1lc2ggPyBzaGFkZXJDaHVua3MucGFydGljbGVfbWVzaFZTIDogZmFjZVZTO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMubm9ybWFsID09PSAxKSB2c2hhZGVyICs9IHNoYWRlckNodW5rcy5wYXJ0aWNsZV9ub3JtYWxWUztcbiAgICAgICAgICAgIGlmIChvcHRpb25zLm5vcm1hbCA9PT0gMikgdnNoYWRlciArPSBzaGFkZXJDaHVua3MucGFydGljbGVfVEJOVlM7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5zdHJldGNoID4gMC4wKSB2c2hhZGVyICs9IHNoYWRlckNodW5rcy5wYXJ0aWNsZV9zdHJldGNoVlM7XG4gICAgICAgICAgICB2c2hhZGVyICs9IHNoYWRlckNodW5rcy5wYXJ0aWNsZV9lbmRWUztcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnNvZnQgPiAwKSB2c2hhZGVyICs9IHNoYWRlckNodW5rcy5wYXJ0aWNsZV9zb2Z0VlM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5zb2Z0ID4gMCkgdnNoYWRlciArPSBzaGFkZXJDaHVua3Muc2NyZWVuRGVwdGhQUztcbiAgICAgICAgICAgIHZzaGFkZXIgKz0gc2hhZGVyQ2h1bmtzLnBhcnRpY2xlX2NwdVZTO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMubG9jYWxTcGFjZSkgdnNoYWRlciArPSBzaGFkZXJDaHVua3MucGFydGljbGVfbG9jYWxTaGlmdFZTO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuYW5pbVRleCkgdnNoYWRlciArPSB0aGlzLl9hbmltVGV4KG9wdGlvbnMpO1xuICAgICAgICAgICAgLy8gaWYgKG9wdGlvbnMud3JhcCkgdnNoYWRlciArPSBzaGFkZXJDaHVua3MucGFydGljbGVfd3JhcFZTO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuYWxpZ25Ub01vdGlvbikgdnNoYWRlciArPSBzaGFkZXJDaHVua3MucGFydGljbGVfcG9pbnRBbG9uZ1ZTO1xuICAgICAgICAgICAgdnNoYWRlciArPSBvcHRpb25zLm1lc2ggPyBzaGFkZXJDaHVua3MucGFydGljbGVfbWVzaFZTIDogZmFjZVZTO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMubm9ybWFsID09PSAxKSB2c2hhZGVyICs9IHNoYWRlckNodW5rcy5wYXJ0aWNsZV9ub3JtYWxWUztcbiAgICAgICAgICAgIGlmIChvcHRpb25zLm5vcm1hbCA9PT0gMikgdnNoYWRlciArPSBzaGFkZXJDaHVua3MucGFydGljbGVfVEJOVlM7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5zdHJldGNoID4gMC4wKSB2c2hhZGVyICs9IHNoYWRlckNodW5rcy5wYXJ0aWNsZV9zdHJldGNoVlM7XG4gICAgICAgICAgICB2c2hhZGVyICs9IHNoYWRlckNodW5rcy5wYXJ0aWNsZV9jcHVfZW5kVlM7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5zb2Z0ID4gMCkgdnNoYWRlciArPSBzaGFkZXJDaHVua3MucGFydGljbGVfc29mdFZTO1xuICAgICAgICB9XG4gICAgICAgIHZzaGFkZXIgKz0gXCJ9XFxuXCI7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMubm9ybWFsID4gMCkge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMubm9ybWFsID09PSAxKSB7XG4gICAgICAgICAgICAgICAgZnNoYWRlciArPSBcIlxcbnZhcnlpbmcgdmVjMyBOb3JtYWw7XFxuXCI7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMubm9ybWFsID09PSAyKSB7XG4gICAgICAgICAgICAgICAgZnNoYWRlciArPSBcIlxcbnZhcnlpbmcgbWF0MyBQYXJ0aWNsZU1hdDtcXG5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZzaGFkZXIgKz0gXCJcXG51bmlmb3JtIHZlYzMgbGlnaHRDdWJlWzZdO1xcblwiO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLnNvZnQpIGZzaGFkZXIgKz0gXCJcXG52YXJ5aW5nIGZsb2F0IHZEZXB0aDtcXG5cIjtcblxuICAgICAgICBpZiAoKG9wdGlvbnMubm9ybWFsID09PSAwKSAmJiAob3B0aW9ucy5mb2cgPT09IFwibm9uZVwiKSkgb3B0aW9ucy5zcmdiID0gZmFsc2U7IC8vIGRvbid0IGhhdmUgdG8gcGVyZm9ybSBhbGwgZ2FtbWEgY29udmVyc2lvbnMgd2hlbiBubyBsaWdodGluZyBhbmQgZm9nZ2luZyBpcyB1c2VkXG4gICAgICAgIGZzaGFkZXIgKz0gc2hhZGVyQ2h1bmtzLmRlY29kZVBTO1xuICAgICAgICBmc2hhZGVyICs9IGdhbW1hQ29kZShvcHRpb25zLmdhbW1hKTtcbiAgICAgICAgZnNoYWRlciArPSB0b25lbWFwQ29kZShvcHRpb25zLnRvbmVNYXApO1xuXG4gICAgICAgIGlmIChvcHRpb25zLmZvZyA9PT0gJ2xpbmVhcicpIHtcbiAgICAgICAgICAgIGZzaGFkZXIgKz0gc2hhZGVyQ2h1bmtzLmZvZ0xpbmVhclBTO1xuICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuZm9nID09PSAnZXhwJykge1xuICAgICAgICAgICAgZnNoYWRlciArPSBzaGFkZXJDaHVua3MuZm9nRXhwUFM7XG4gICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5mb2cgPT09ICdleHAyJykge1xuICAgICAgICAgICAgZnNoYWRlciArPSBzaGFkZXJDaHVua3MuZm9nRXhwMlBTO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZnNoYWRlciArPSBzaGFkZXJDaHVua3MuZm9nTm9uZVBTO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMubm9ybWFsID09PSAyKSBmc2hhZGVyICs9IFwiXFxudW5pZm9ybSBzYW1wbGVyMkQgbm9ybWFsTWFwO1xcblwiO1xuICAgICAgICBpZiAob3B0aW9ucy5zb2Z0ID4gMCkgZnNoYWRlciArPSBzaGFkZXJDaHVua3Muc2NyZWVuRGVwdGhQUztcbiAgICAgICAgZnNoYWRlciArPSBzaGFkZXJDaHVua3MucGFydGljbGVQUztcbiAgICAgICAgaWYgKG9wdGlvbnMuc29mdCA+IDApIGZzaGFkZXIgKz0gc2hhZGVyQ2h1bmtzLnBhcnRpY2xlX3NvZnRQUztcbiAgICAgICAgaWYgKG9wdGlvbnMubm9ybWFsID09PSAxKSBmc2hhZGVyICs9IFwiXFxudmVjMyBub3JtYWwgPSBOb3JtYWw7XFxuXCI7XG4gICAgICAgIGlmIChvcHRpb25zLm5vcm1hbCA9PT0gMikgZnNoYWRlciArPSBzaGFkZXJDaHVua3MucGFydGljbGVfbm9ybWFsTWFwUFM7XG4gICAgICAgIGlmIChvcHRpb25zLm5vcm1hbCA+IDApIGZzaGFkZXIgKz0gb3B0aW9ucy5oYWxmbGFtYmVydCA/IHNoYWRlckNodW5rcy5wYXJ0aWNsZV9oYWxmbGFtYmVydFBTIDogc2hhZGVyQ2h1bmtzLnBhcnRpY2xlX2xhbWJlcnRQUztcbiAgICAgICAgaWYgKG9wdGlvbnMubm9ybWFsID4gMCkgZnNoYWRlciArPSBzaGFkZXJDaHVua3MucGFydGljbGVfbGlnaHRpbmdQUztcbiAgICAgICAgaWYgKG9wdGlvbnMuYmxlbmQgPT09IEJMRU5EX05PUk1BTCkge1xuICAgICAgICAgICAgZnNoYWRlciArPSBzaGFkZXJDaHVua3MucGFydGljbGVfYmxlbmROb3JtYWxQUztcbiAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zLmJsZW5kID09PSBCTEVORF9BRERJVElWRSkge1xuICAgICAgICAgICAgZnNoYWRlciArPSBzaGFkZXJDaHVua3MucGFydGljbGVfYmxlbmRBZGRQUztcbiAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zLmJsZW5kID09PSBCTEVORF9NVUxUSVBMSUNBVElWRSkge1xuICAgICAgICAgICAgZnNoYWRlciArPSBzaGFkZXJDaHVua3MucGFydGljbGVfYmxlbmRNdWx0aXBseVBTO1xuICAgICAgICB9XG4gICAgICAgIGZzaGFkZXIgKz0gc2hhZGVyQ2h1bmtzLnBhcnRpY2xlX2VuZFBTO1xuXG4gICAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBjb2xsZWN0QXR0cmlicyh2c2hhZGVyKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYXR0cmlidXRlczogYXR0cmlidXRlcyxcbiAgICAgICAgICAgIHZzaGFkZXI6IHZzaGFkZXIsXG4gICAgICAgICAgICBmc2hhZGVyOiBmc2hhZGVyXG4gICAgICAgIH07XG4gICAgfVxufTtcblxuZXhwb3J0IHsgcGFydGljbGUgfTtcbiJdLCJuYW1lcyI6WyJwYXJ0aWNsZSIsImdlbmVyYXRlS2V5Iiwib3B0aW9ucyIsImtleSIsInByb3AiLCJoYXNPd25Qcm9wZXJ0eSIsIl9hbmltVGV4IiwidnNoYWRlciIsImFuaW1UZXhMb29wIiwic2hhZGVyQ2h1bmtzIiwicGFydGljbGVBbmltRnJhbWVMb29wVlMiLCJwYXJ0aWNsZUFuaW1GcmFtZUNsYW1wVlMiLCJwYXJ0aWNsZUFuaW1UZXhWUyIsImNyZWF0ZVNoYWRlckRlZmluaXRpb24iLCJkZXZpY2UiLCJmc2hhZGVyIiwicHJlY2lzaW9uQ29kZSIsIndlYmdsMiIsIm1lc2giLCJsb2NhbFNwYWNlIiwic2NyZWVuU3BhY2UiLCJhbmltVGV4Iiwibm9ybWFsIiwic29mdCIsImZhY2VWUyIsImN1c3RvbUZhY2UiLCJwYXJ0aWNsZV9jdXN0b21GYWNlVlMiLCJwYXJ0aWNsZV9iaWxsYm9hcmRWUyIsInVzZUNwdSIsInBhcnRpY2xlX2luaXRWUyIsInBhY2s4IiwicGFydGljbGVJbnB1dFJnYmE4UFMiLCJwYXJ0aWNsZUlucHV0RmxvYXRQUyIsInNjcmVlbkRlcHRoUFMiLCJwYXJ0aWNsZVZTIiwicGFydGljbGVfbG9jYWxTaGlmdFZTIiwid3JhcCIsInBhcnRpY2xlX3dyYXBWUyIsImFsaWduVG9Nb3Rpb24iLCJwYXJ0aWNsZV9wb2ludEFsb25nVlMiLCJwYXJ0aWNsZV9tZXNoVlMiLCJwYXJ0aWNsZV9ub3JtYWxWUyIsInBhcnRpY2xlX1RCTlZTIiwic3RyZXRjaCIsInBhcnRpY2xlX3N0cmV0Y2hWUyIsInBhcnRpY2xlX2VuZFZTIiwicGFydGljbGVfc29mdFZTIiwicGFydGljbGVfY3B1VlMiLCJwYXJ0aWNsZV9jcHVfZW5kVlMiLCJmb2ciLCJzcmdiIiwiZGVjb2RlUFMiLCJnYW1tYUNvZGUiLCJnYW1tYSIsInRvbmVtYXBDb2RlIiwidG9uZU1hcCIsImZvZ0xpbmVhclBTIiwiZm9nRXhwUFMiLCJmb2dFeHAyUFMiLCJmb2dOb25lUFMiLCJwYXJ0aWNsZVBTIiwicGFydGljbGVfc29mdFBTIiwicGFydGljbGVfbm9ybWFsTWFwUFMiLCJoYWxmbGFtYmVydCIsInBhcnRpY2xlX2hhbGZsYW1iZXJ0UFMiLCJwYXJ0aWNsZV9sYW1iZXJ0UFMiLCJwYXJ0aWNsZV9saWdodGluZ1BTIiwiYmxlbmQiLCJCTEVORF9OT1JNQUwiLCJwYXJ0aWNsZV9ibGVuZE5vcm1hbFBTIiwiQkxFTkRfQURESVRJVkUiLCJwYXJ0aWNsZV9ibGVuZEFkZFBTIiwiQkxFTkRfTVVMVElQTElDQVRJVkUiLCJwYXJ0aWNsZV9ibGVuZE11bHRpcGx5UFMiLCJwYXJ0aWNsZV9lbmRQUyIsImF0dHJpYnV0ZXMiLCJjb2xsZWN0QXR0cmlicyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQU1BLE1BQU1BLFFBQVEsR0FBRztFQUNiQyxXQUFXLEVBQUUsVUFBVUMsT0FBVixFQUFtQjtJQUM1QixJQUFJQyxHQUFHLEdBQUcsVUFBVixDQUFBOztBQUNBLElBQUEsS0FBSyxNQUFNQyxJQUFYLElBQW1CRixPQUFuQixFQUE0QjtBQUN4QixNQUFBLElBQUlBLE9BQU8sQ0FBQ0csY0FBUixDQUF1QkQsSUFBdkIsQ0FBSixFQUFrQztBQUM5QkQsUUFBQUEsR0FBRyxJQUFJRCxPQUFPLENBQUNFLElBQUQsQ0FBZCxDQUFBO0FBQ0gsT0FBQTtBQUNKLEtBQUE7O0FBQ0QsSUFBQSxPQUFPRCxHQUFQLENBQUE7R0FSUztFQVdiRyxRQUFRLEVBQUUsVUFBVUosT0FBVixFQUFtQjtJQUN6QixJQUFJSyxPQUFPLEdBQUcsRUFBZCxDQUFB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
