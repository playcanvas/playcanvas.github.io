/**
 * @license
 * PlayCanvas Engine v1.57.0 revision f1998a31e (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Vec2 } from '../../math/vec2.js';
import { random } from '../../math/random.js';
import { LIGHTTYPE_DIRECTIONAL } from '../constants.js';
import { BakeLight } from './bake-light.js';

const _tempPoint = new Vec2();

class BakeLightSimple extends BakeLight {
  get numVirtualLights() {
    if (this.light.type === LIGHTTYPE_DIRECTIONAL) {
      return this.light.bakeNumSamples;
    }

    return 1;
  }

  prepareVirtualLight(index, numVirtualLights) {
    const light = this.light;

    light._node.setLocalRotation(this.rotation);

    if (index > 0) {
      const directionalSpreadAngle = light.bakeArea;
      random.circlePointDeterministic(_tempPoint, index, numVirtualLights);

      _tempPoint.mulScalar(directionalSpreadAngle * 0.5);

      light._node.rotateLocal(_tempPoint.x, 0, _tempPoint.y);
    }

    light._node.getWorldTransform();

    const gamma = this.scene.gammaCorrection ? 2.2 : 1;
    const linearIntensity = Math.pow(this.intensity, gamma);
    light.intensity = Math.pow(linearIntensity / numVirtualLights, 1 / gamma);
  }

}

export { BakeLightSimple };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFrZS1saWdodC1zaW1wbGUuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9zY2VuZS9saWdodG1hcHBlci9iYWtlLWxpZ2h0LXNpbXBsZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWZWMyIH0gZnJvbSAnLi4vLi4vbWF0aC92ZWMyLmpzJztcbmltcG9ydCB7IHJhbmRvbSB9IGZyb20gJy4uLy4uL21hdGgvcmFuZG9tLmpzJztcbmltcG9ydCB7IExJR0hUVFlQRV9ESVJFQ1RJT05BTCB9IGZyb20gJy4uL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBCYWtlTGlnaHQgfSBmcm9tICcuL2Jha2UtbGlnaHQuanMnO1xuXG5jb25zdCBfdGVtcFBvaW50ID0gbmV3IFZlYzIoKTtcblxuLy8gYSBiYWtlIGxpZ2h0IHJlcHJlc2VudGluZyBhIGRpcmVjdGlvbmFsLCBvbW5pIG9yIHNwb3QgdHlwZSBvZiBsaWdodFxuY2xhc3MgQmFrZUxpZ2h0U2ltcGxlIGV4dGVuZHMgQmFrZUxpZ2h0IHtcbiAgICBnZXQgbnVtVmlydHVhbExpZ2h0cygpIHtcbiAgICAgICAgLy8gb25seSBkaXJlY3Rpb25hbCBsaWdodHMgc3VwcG9ydCBtdWx0aXBsZSBzYW1wbGVzXG4gICAgICAgIGlmICh0aGlzLmxpZ2h0LnR5cGUgPT09IExJR0hUVFlQRV9ESVJFQ1RJT05BTCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGlnaHQuYmFrZU51bVNhbXBsZXM7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gMTtcbiAgICB9XG5cbiAgICBwcmVwYXJlVmlydHVhbExpZ2h0KGluZGV4LCBudW1WaXJ0dWFsTGlnaHRzKSB7XG5cbiAgICAgICAgLy8gc2V0IHRvIG9yaWdpbmFsIHJvdGF0aW9uXG4gICAgICAgIGNvbnN0IGxpZ2h0ID0gdGhpcy5saWdodDtcbiAgICAgICAgbGlnaHQuX25vZGUuc2V0TG9jYWxSb3RhdGlvbih0aGlzLnJvdGF0aW9uKTtcblxuICAgICAgICAvLyByYW5kb20gYWRqdXN0bWVudCB0byB0aGUgZGlyZWN0aW9uYWwgbGlnaHQgZmFjaW5nXG4gICAgICAgIGlmIChpbmRleCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGRpcmVjdGlvbmFsU3ByZWFkQW5nbGUgPSBsaWdodC5iYWtlQXJlYTtcbiAgICAgICAgICAgIHJhbmRvbS5jaXJjbGVQb2ludERldGVybWluaXN0aWMoX3RlbXBQb2ludCwgaW5kZXgsIG51bVZpcnR1YWxMaWdodHMpO1xuICAgICAgICAgICAgX3RlbXBQb2ludC5tdWxTY2FsYXIoZGlyZWN0aW9uYWxTcHJlYWRBbmdsZSAqIDAuNSk7XG4gICAgICAgICAgICBsaWdodC5fbm9kZS5yb3RhdGVMb2NhbChfdGVtcFBvaW50LngsIDAsIF90ZW1wUG9pbnQueSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyB1cGRhdGUgdHJhbnNmb3JtXG4gICAgICAgIGxpZ2h0Ll9ub2RlLmdldFdvcmxkVHJhbnNmb3JtKCk7XG5cbiAgICAgICAgLy8gZGl2aWRlIGludGVuc2l0eSBieSBudW1iZXIgb2YgdmlydHVhbCBsaWdodHMgKGluIGxpbmVhciBzcGFjZSlcbiAgICAgICAgY29uc3QgZ2FtbWEgPSB0aGlzLnNjZW5lLmdhbW1hQ29ycmVjdGlvbiA/IDIuMiA6IDE7XG4gICAgICAgIGNvbnN0IGxpbmVhckludGVuc2l0eSA9IE1hdGgucG93KHRoaXMuaW50ZW5zaXR5LCBnYW1tYSk7XG4gICAgICAgIGxpZ2h0LmludGVuc2l0eSA9IE1hdGgucG93KGxpbmVhckludGVuc2l0eSAvIG51bVZpcnR1YWxMaWdodHMsIDEgLyBnYW1tYSk7XG4gICAgfVxufVxuXG5leHBvcnQgeyBCYWtlTGlnaHRTaW1wbGUgfTtcbiJdLCJuYW1lcyI6WyJfdGVtcFBvaW50IiwiVmVjMiIsIkJha2VMaWdodFNpbXBsZSIsIkJha2VMaWdodCIsIm51bVZpcnR1YWxMaWdodHMiLCJsaWdodCIsInR5cGUiLCJMSUdIVFRZUEVfRElSRUNUSU9OQUwiLCJiYWtlTnVtU2FtcGxlcyIsInByZXBhcmVWaXJ0dWFsTGlnaHQiLCJpbmRleCIsIl9ub2RlIiwic2V0TG9jYWxSb3RhdGlvbiIsInJvdGF0aW9uIiwiZGlyZWN0aW9uYWxTcHJlYWRBbmdsZSIsImJha2VBcmVhIiwicmFuZG9tIiwiY2lyY2xlUG9pbnREZXRlcm1pbmlzdGljIiwibXVsU2NhbGFyIiwicm90YXRlTG9jYWwiLCJ4IiwieSIsImdldFdvcmxkVHJhbnNmb3JtIiwiZ2FtbWEiLCJzY2VuZSIsImdhbW1hQ29ycmVjdGlvbiIsImxpbmVhckludGVuc2l0eSIsIk1hdGgiLCJwb3ciLCJpbnRlbnNpdHkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFLQSxNQUFNQSxVQUFVLEdBQUcsSUFBSUMsSUFBSixFQUFuQixDQUFBOztBQUdBLE1BQU1DLGVBQU4sU0FBOEJDLFNBQTlCLENBQXdDO0FBQ2hCLEVBQUEsSUFBaEJDLGdCQUFnQixHQUFHO0FBRW5CLElBQUEsSUFBSSxLQUFLQyxLQUFMLENBQVdDLElBQVgsS0FBb0JDLHFCQUF4QixFQUErQztNQUMzQyxPQUFPLElBQUEsQ0FBS0YsS0FBTCxDQUFXRyxjQUFsQixDQUFBO0FBQ0gsS0FBQTs7QUFFRCxJQUFBLE9BQU8sQ0FBUCxDQUFBO0FBQ0gsR0FBQTs7QUFFREMsRUFBQUEsbUJBQW1CLENBQUNDLEtBQUQsRUFBUU4sZ0JBQVIsRUFBMEI7SUFHekMsTUFBTUMsS0FBSyxHQUFHLElBQUEsQ0FBS0EsS0FBbkIsQ0FBQTs7QUFDQUEsSUFBQUEsS0FBSyxDQUFDTSxLQUFOLENBQVlDLGdCQUFaLENBQTZCLEtBQUtDLFFBQWxDLENBQUEsQ0FBQTs7SUFHQSxJQUFJSCxLQUFLLEdBQUcsQ0FBWixFQUFlO0FBQ1gsTUFBQSxNQUFNSSxzQkFBc0IsR0FBR1QsS0FBSyxDQUFDVSxRQUFyQyxDQUFBO0FBQ0FDLE1BQUFBLE1BQU0sQ0FBQ0Msd0JBQVAsQ0FBZ0NqQixVQUFoQyxFQUE0Q1UsS0FBNUMsRUFBbUROLGdCQUFuRCxDQUFBLENBQUE7O0FBQ0FKLE1BQUFBLFVBQVUsQ0FBQ2tCLFNBQVgsQ0FBcUJKLHNCQUFzQixHQUFHLEdBQTlDLENBQUEsQ0FBQTs7QUFDQVQsTUFBQUEsS0FBSyxDQUFDTSxLQUFOLENBQVlRLFdBQVosQ0FBd0JuQixVQUFVLENBQUNvQixDQUFuQyxFQUFzQyxDQUF0QyxFQUF5Q3BCLFVBQVUsQ0FBQ3FCLENBQXBELENBQUEsQ0FBQTtBQUNILEtBQUE7O0lBR0RoQixLQUFLLENBQUNNLEtBQU4sQ0FBWVcsaUJBQVosRUFBQSxDQUFBOztJQUdBLE1BQU1DLEtBQUssR0FBRyxJQUFLQyxDQUFBQSxLQUFMLENBQVdDLGVBQVgsR0FBNkIsR0FBN0IsR0FBbUMsQ0FBakQsQ0FBQTtJQUNBLE1BQU1DLGVBQWUsR0FBR0MsSUFBSSxDQUFDQyxHQUFMLENBQVMsSUFBS0MsQ0FBQUEsU0FBZCxFQUF5Qk4sS0FBekIsQ0FBeEIsQ0FBQTtBQUNBbEIsSUFBQUEsS0FBSyxDQUFDd0IsU0FBTixHQUFrQkYsSUFBSSxDQUFDQyxHQUFMLENBQVNGLGVBQWUsR0FBR3RCLGdCQUEzQixFQUE2QyxDQUFBLEdBQUltQixLQUFqRCxDQUFsQixDQUFBO0FBQ0gsR0FBQTs7QUEvQm1DOzs7OyJ9
