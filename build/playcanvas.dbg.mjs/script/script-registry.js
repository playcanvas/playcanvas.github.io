/**
 * @license
 * PlayCanvas Engine v1.58.0-dev revision e102f2b2a (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { EventHandler } from '../core/event-handler.js';
import './script-type.js';

class ScriptRegistry extends EventHandler {
  constructor(app) {
    super();
    this.app = app;
    this._scripts = {};
    this._list = [];
  }

  destroy() {
    this.app = null;
    this.off();
  }

  add(script) {
    const scriptName = script.__name;

    if (this._scripts.hasOwnProperty(scriptName)) {
      setTimeout(() => {
        if (script.prototype.swap) {
          const old = this._scripts[scriptName];

          const ind = this._list.indexOf(old);

          this._list[ind] = script;
          this._scripts[scriptName] = script;
          this.fire('swap', scriptName, script);
          this.fire('swap:' + scriptName, script);
        } else {
          console.warn(`script registry already has '${scriptName}' script, define 'swap' method for new script type to enable code hot swapping`);
        }
      });
      return false;
    }

    this._scripts[scriptName] = script;

    this._list.push(script);

    this.fire('add', scriptName, script);
    this.fire('add:' + scriptName, script);
    setTimeout(() => {
      if (!this._scripts.hasOwnProperty(scriptName)) return;

      if (!this.app || !this.app.systems || !this.app.systems.script) {
        return;
      }

      const components = this.app.systems.script._components;
      let attributes;
      const scriptInstances = [];
      const scriptInstancesInitialized = [];

      for (components.loopIndex = 0; components.loopIndex < components.length; components.loopIndex++) {
        const component = components.items[components.loopIndex];

        if (component._scriptsIndex[scriptName] && component._scriptsIndex[scriptName].awaiting) {
          if (component._scriptsData && component._scriptsData[scriptName]) attributes = component._scriptsData[scriptName].attributes;
          const scriptInstance = component.create(scriptName, {
            preloading: true,
            ind: component._scriptsIndex[scriptName].ind,
            attributes: attributes
          });
          if (scriptInstance) scriptInstances.push(scriptInstance);
        }
      }

      for (let i = 0; i < scriptInstances.length; i++) scriptInstances[i].__initializeAttributes();

      for (let i = 0; i < scriptInstances.length; i++) {
        if (scriptInstances[i].enabled) {
          scriptInstances[i]._initialized = true;
          scriptInstancesInitialized.push(scriptInstances[i]);
          if (scriptInstances[i].initialize) scriptInstances[i].initialize();
        }
      }

      for (let i = 0; i < scriptInstancesInitialized.length; i++) {
        if (!scriptInstancesInitialized[i].enabled || scriptInstancesInitialized[i]._postInitialized) {
          continue;
        }

        scriptInstancesInitialized[i]._postInitialized = true;
        if (scriptInstancesInitialized[i].postInitialize) scriptInstancesInitialized[i].postInitialize();
      }
    });
    return true;
  }

  remove(nameOrType) {
    let scriptType = nameOrType;
    let scriptName = nameOrType;

    if (typeof scriptName !== 'string') {
      scriptName = scriptType.__name;
    } else {
      scriptType = this.get(scriptName);
    }

    if (this.get(scriptName) !== scriptType) return false;
    delete this._scripts[scriptName];

    const ind = this._list.indexOf(scriptType);

    this._list.splice(ind, 1);

    this.fire('remove', scriptName, scriptType);
    this.fire('remove:' + scriptName, scriptType);
    return true;
  }

  get(name) {
    return this._scripts[name] || null;
  }

  has(nameOrType) {
    if (typeof nameOrType === 'string') {
      return this._scripts.hasOwnProperty(nameOrType);
    }

    if (!nameOrType) return false;
    const scriptName = nameOrType.__name;
    return this._scripts[scriptName] === nameOrType;
  }

  list() {
    return this._list;
  }

}

export { ScriptRegistry };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyaXB0LXJlZ2lzdHJ5LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc2NyaXB0L3NjcmlwdC1yZWdpc3RyeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudEhhbmRsZXIgfSBmcm9tICcuLi9jb3JlL2V2ZW50LWhhbmRsZXIuanMnO1xuXG4vKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnMgKi9cbmltcG9ydCB7IFNjcmlwdFR5cGUgfSBmcm9tICcuL3NjcmlwdC10eXBlLmpzJztcblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uL2ZyYW1ld29yay9hcHAtYmFzZS5qcycpLkFwcEJhc2V9IEFwcEJhc2UgKi9cblxuLyoqXG4gKiBDb250YWluZXIgZm9yIGFsbCB7QGxpbmsgU2NyaXB0VHlwZX1zIHRoYXQgYXJlIGF2YWlsYWJsZSB0byB0aGlzIGFwcGxpY2F0aW9uLiBOb3RlIHRoYXRcbiAqIFBsYXlDYW52YXMgc2NyaXB0cyBjYW4gYWNjZXNzIHRoZSBTY3JpcHQgUmVnaXN0cnkgZnJvbSBpbnNpZGUgdGhlIGFwcGxpY2F0aW9uIHdpdGhcbiAqIHtAbGluayBBcHBCYXNlI3NjcmlwdHN9LlxuICpcbiAqIEBhdWdtZW50cyBFdmVudEhhbmRsZXJcbiAqL1xuY2xhc3MgU2NyaXB0UmVnaXN0cnkgZXh0ZW5kcyBFdmVudEhhbmRsZXIge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBTY3JpcHRSZWdpc3RyeSBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7QXBwQmFzZX0gYXBwIC0gQXBwbGljYXRpb24gdG8gYXR0YWNoIHJlZ2lzdHJ5IHRvLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFwcCkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMuYXBwID0gYXBwO1xuICAgICAgICB0aGlzLl9zY3JpcHRzID0geyB9O1xuICAgICAgICB0aGlzLl9saXN0ID0gW107XG4gICAgfVxuXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5hcHAgPSBudWxsO1xuICAgICAgICB0aGlzLm9mZigpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZCB7QGxpbmsgU2NyaXB0VHlwZX0gdG8gcmVnaXN0cnkuIE5vdGU6IHdoZW4ge0BsaW5rIGNyZWF0ZVNjcmlwdH0gaXMgY2FsbGVkLCBpdCB3aWxsIGFkZFxuICAgICAqIHRoZSB7QGxpbmsgU2NyaXB0VHlwZX0gdG8gdGhlIHJlZ2lzdHJ5IGF1dG9tYXRpY2FsbHkuIElmIGEgc2NyaXB0IGFscmVhZHkgZXhpc3RzIGluXG4gICAgICogcmVnaXN0cnksIGFuZCB0aGUgbmV3IHNjcmlwdCBoYXMgYSBgc3dhcGAgbWV0aG9kIGRlZmluZWQsIGl0IHdpbGwgcGVyZm9ybSBjb2RlIGhvdCBzd2FwcGluZ1xuICAgICAqIGF1dG9tYXRpY2FsbHkgaW4gYXN5bmMgbWFubmVyLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtDbGFzczxTY3JpcHRUeXBlPn0gc2NyaXB0IC0gU2NyaXB0IFR5cGUgdGhhdCBpcyBjcmVhdGVkIHVzaW5nIHtAbGluayBjcmVhdGVTY3JpcHR9LlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIGFkZGVkIGZvciB0aGUgZmlyc3QgdGltZSBvciBmYWxzZSBpZiBzY3JpcHQgYWxyZWFkeSBleGlzdHMuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgUGxheWVyQ29udHJvbGxlciA9IHBjLmNyZWF0ZVNjcmlwdCgncGxheWVyQ29udHJvbGxlcicpO1xuICAgICAqIC8vIHBsYXllckNvbnRyb2xsZXIgU2NyaXB0IFR5cGUgd2lsbCBiZSBhZGRlZCB0byBwYy5TY3JpcHRSZWdpc3RyeSBhdXRvbWF0aWNhbGx5XG4gICAgICogY29uc29sZS5sb2coYXBwLnNjcmlwdHMuaGFzKCdwbGF5ZXJDb250cm9sbGVyJykpOyAvLyBvdXRwdXRzIHRydWVcbiAgICAgKi9cbiAgICBhZGQoc2NyaXB0KSB7XG4gICAgICAgIGNvbnN0IHNjcmlwdE5hbWUgPSBzY3JpcHQuX19uYW1lO1xuXG4gICAgICAgIGlmICh0aGlzLl9zY3JpcHRzLmhhc093blByb3BlcnR5KHNjcmlwdE5hbWUpKSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoc2NyaXB0LnByb3RvdHlwZS5zd2FwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHN3YXBwaW5nXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9sZCA9IHRoaXMuX3NjcmlwdHNbc2NyaXB0TmFtZV07XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZCA9IHRoaXMuX2xpc3QuaW5kZXhPZihvbGQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9saXN0W2luZF0gPSBzY3JpcHQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NjcmlwdHNbc2NyaXB0TmFtZV0gPSBzY3JpcHQ7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKCdzd2FwJywgc2NyaXB0TmFtZSwgc2NyaXB0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKCdzd2FwOicgKyBzY3JpcHROYW1lLCBzY3JpcHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2Fybihgc2NyaXB0IHJlZ2lzdHJ5IGFscmVhZHkgaGFzICcke3NjcmlwdE5hbWV9JyBzY3JpcHQsIGRlZmluZSAnc3dhcCcgbWV0aG9kIGZvciBuZXcgc2NyaXB0IHR5cGUgdG8gZW5hYmxlIGNvZGUgaG90IHN3YXBwaW5nYCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9zY3JpcHRzW3NjcmlwdE5hbWVdID0gc2NyaXB0O1xuICAgICAgICB0aGlzLl9saXN0LnB1c2goc2NyaXB0KTtcblxuICAgICAgICB0aGlzLmZpcmUoJ2FkZCcsIHNjcmlwdE5hbWUsIHNjcmlwdCk7XG4gICAgICAgIHRoaXMuZmlyZSgnYWRkOicgKyBzY3JpcHROYW1lLCBzY3JpcHQpO1xuXG4gICAgICAgIC8vIGZvciBhbGwgY29tcG9uZW50cyBhd2FpdGluZyBTY3JpcHQgVHlwZVxuICAgICAgICAvLyBjcmVhdGUgc2NyaXB0IGluc3RhbmNlXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9zY3JpcHRzLmhhc093blByb3BlcnR5KHNjcmlwdE5hbWUpKVxuICAgICAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICAgICAgLy8gdGhpcyBpcyBhIGNoZWNrIGZvciBhIHBvc3NpYmxlIGVycm9yXG4gICAgICAgICAgICAvLyB0aGF0IG1pZ2h0IGhhcHBlbiBpZiB0aGUgYXBwIGhhcyBiZWVuIGRlc3Ryb3llZCBiZWZvcmVcbiAgICAgICAgICAgIC8vIHNldFRpbWVvdXQgaGFzIGZpbmlzaGVkXG4gICAgICAgICAgICBpZiAoIXRoaXMuYXBwIHx8ICF0aGlzLmFwcC5zeXN0ZW1zIHx8ICF0aGlzLmFwcC5zeXN0ZW1zLnNjcmlwdCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgY29tcG9uZW50cyA9IHRoaXMuYXBwLnN5c3RlbXMuc2NyaXB0Ll9jb21wb25lbnRzO1xuICAgICAgICAgICAgbGV0IGF0dHJpYnV0ZXM7XG4gICAgICAgICAgICBjb25zdCBzY3JpcHRJbnN0YW5jZXMgPSBbXTtcbiAgICAgICAgICAgIGNvbnN0IHNjcmlwdEluc3RhbmNlc0luaXRpYWxpemVkID0gW107XG5cbiAgICAgICAgICAgIGZvciAoY29tcG9uZW50cy5sb29wSW5kZXggPSAwOyBjb21wb25lbnRzLmxvb3BJbmRleCA8IGNvbXBvbmVudHMubGVuZ3RoOyBjb21wb25lbnRzLmxvb3BJbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29tcG9uZW50ID0gY29tcG9uZW50cy5pdGVtc1tjb21wb25lbnRzLmxvb3BJbmRleF07XG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgaWYgYXdhaXRpbmcgZm9yIHNjcmlwdFxuICAgICAgICAgICAgICAgIGlmIChjb21wb25lbnQuX3NjcmlwdHNJbmRleFtzY3JpcHROYW1lXSAmJiBjb21wb25lbnQuX3NjcmlwdHNJbmRleFtzY3JpcHROYW1lXS5hd2FpdGluZykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29tcG9uZW50Ll9zY3JpcHRzRGF0YSAmJiBjb21wb25lbnQuX3NjcmlwdHNEYXRhW3NjcmlwdE5hbWVdKVxuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlcyA9IGNvbXBvbmVudC5fc2NyaXB0c0RhdGFbc2NyaXB0TmFtZV0uYXR0cmlidXRlcztcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzY3JpcHRJbnN0YW5jZSA9IGNvbXBvbmVudC5jcmVhdGUoc2NyaXB0TmFtZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJlbG9hZGluZzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZDogY29tcG9uZW50Ll9zY3JpcHRzSW5kZXhbc2NyaXB0TmFtZV0uaW5kLFxuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogYXR0cmlidXRlc1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NyaXB0SW5zdGFuY2UpXG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHRJbnN0YW5jZXMucHVzaChzY3JpcHRJbnN0YW5jZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBpbml0aWFsaXplIGF0dHJpYnV0ZXNcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2NyaXB0SW5zdGFuY2VzLmxlbmd0aDsgaSsrKVxuICAgICAgICAgICAgICAgIHNjcmlwdEluc3RhbmNlc1tpXS5fX2luaXRpYWxpemVBdHRyaWJ1dGVzKCk7XG5cbiAgICAgICAgICAgIC8vIGNhbGwgaW5pdGlhbGl6ZSgpXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNjcmlwdEluc3RhbmNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChzY3JpcHRJbnN0YW5jZXNbaV0uZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICBzY3JpcHRJbnN0YW5jZXNbaV0uX2luaXRpYWxpemVkID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICBzY3JpcHRJbnN0YW5jZXNJbml0aWFsaXplZC5wdXNoKHNjcmlwdEluc3RhbmNlc1tpXSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjcmlwdEluc3RhbmNlc1tpXS5pbml0aWFsaXplKVxuICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0SW5zdGFuY2VzW2ldLmluaXRpYWxpemUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGNhbGwgcG9zdEluaXRpYWxpemUoKVxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzY3JpcHRJbnN0YW5jZXNJbml0aWFsaXplZC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmICghc2NyaXB0SW5zdGFuY2VzSW5pdGlhbGl6ZWRbaV0uZW5hYmxlZCB8fCBzY3JpcHRJbnN0YW5jZXNJbml0aWFsaXplZFtpXS5fcG9zdEluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHNjcmlwdEluc3RhbmNlc0luaXRpYWxpemVkW2ldLl9wb3N0SW5pdGlhbGl6ZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgaWYgKHNjcmlwdEluc3RhbmNlc0luaXRpYWxpemVkW2ldLnBvc3RJbml0aWFsaXplKVxuICAgICAgICAgICAgICAgICAgICBzY3JpcHRJbnN0YW5jZXNJbml0aWFsaXplZFtpXS5wb3N0SW5pdGlhbGl6ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUge0BsaW5rIFNjcmlwdFR5cGV9LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd8Q2xhc3M8U2NyaXB0VHlwZT59IG5hbWVPclR5cGUgLSBUaGUgbmFtZSBvciB0eXBlIG9mIHtAbGluayBTY3JpcHRUeXBlfS5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiByZW1vdmVkIG9yIEZhbHNlIGlmIGFscmVhZHkgbm90IGluIHJlZ2lzdHJ5LlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYXBwLnNjcmlwdHMucmVtb3ZlKCdwbGF5ZXJDb250cm9sbGVyJyk7XG4gICAgICovXG4gICAgcmVtb3ZlKG5hbWVPclR5cGUpIHtcbiAgICAgICAgbGV0IHNjcmlwdFR5cGUgPSBuYW1lT3JUeXBlO1xuICAgICAgICBsZXQgc2NyaXB0TmFtZSA9IG5hbWVPclR5cGU7XG5cbiAgICAgICAgaWYgKHR5cGVvZiBzY3JpcHROYW1lICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgc2NyaXB0TmFtZSA9IHNjcmlwdFR5cGUuX19uYW1lO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2NyaXB0VHlwZSA9IHRoaXMuZ2V0KHNjcmlwdE5hbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZ2V0KHNjcmlwdE5hbWUpICE9PSBzY3JpcHRUeXBlKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgIGRlbGV0ZSB0aGlzLl9zY3JpcHRzW3NjcmlwdE5hbWVdO1xuICAgICAgICBjb25zdCBpbmQgPSB0aGlzLl9saXN0LmluZGV4T2Yoc2NyaXB0VHlwZSk7XG4gICAgICAgIHRoaXMuX2xpc3Quc3BsaWNlKGluZCwgMSk7XG5cbiAgICAgICAgdGhpcy5maXJlKCdyZW1vdmUnLCBzY3JpcHROYW1lLCBzY3JpcHRUeXBlKTtcbiAgICAgICAgdGhpcy5maXJlKCdyZW1vdmU6JyArIHNjcmlwdE5hbWUsIHNjcmlwdFR5cGUpO1xuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB7QGxpbmsgU2NyaXB0VHlwZX0gYnkgbmFtZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gTmFtZSBvZiBhIHtAbGluayBTY3JpcHRUeXBlfS5cbiAgICAgKiBAcmV0dXJucyB7Q2xhc3M8U2NyaXB0VHlwZT59IFRoZSBTY3JpcHQgVHlwZSBpZiBpdCBleGlzdHMgaW4gdGhlIHJlZ2lzdHJ5IG9yIG51bGwgb3RoZXJ3aXNlLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogdmFyIFBsYXllckNvbnRyb2xsZXIgPSBhcHAuc2NyaXB0cy5nZXQoJ3BsYXllckNvbnRyb2xsZXInKTtcbiAgICAgKi9cbiAgICBnZXQobmFtZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2NyaXB0c1tuYW1lXSB8fCBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIGEge0BsaW5rIFNjcmlwdFR5cGV9IHdpdGggdGhlIHNwZWNpZmllZCBuYW1lIGlzIGluIHRoZSByZWdpc3RyeS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfENsYXNzPFNjcmlwdFR5cGU+fSBuYW1lT3JUeXBlIC0gVGhlIG5hbWUgb3IgdHlwZSBvZiB7QGxpbmsgU2NyaXB0VHlwZX0uXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYge0BsaW5rIFNjcmlwdFR5cGV9IGlzIGluIHJlZ2lzdHJ5LlxuICAgICAqIEBleGFtcGxlXG4gICAgICogaWYgKGFwcC5zY3JpcHRzLmhhcygncGxheWVyQ29udHJvbGxlcicpKSB7XG4gICAgICogICAgIC8vIHBsYXllckNvbnRyb2xsZXIgaXMgaW4gcGMuU2NyaXB0UmVnaXN0cnlcbiAgICAgKiB9XG4gICAgICovXG4gICAgaGFzKG5hbWVPclR5cGUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBuYW1lT3JUeXBlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NjcmlwdHMuaGFzT3duUHJvcGVydHkobmFtZU9yVHlwZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIW5hbWVPclR5cGUpIHJldHVybiBmYWxzZTtcbiAgICAgICAgY29uc3Qgc2NyaXB0TmFtZSA9IG5hbWVPclR5cGUuX19uYW1lO1xuICAgICAgICByZXR1cm4gdGhpcy5fc2NyaXB0c1tzY3JpcHROYW1lXSA9PT0gbmFtZU9yVHlwZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgbGlzdCBvZiBhbGwge0BsaW5rIFNjcmlwdFR5cGV9cyBmcm9tIHJlZ2lzdHJ5LlxuICAgICAqXG4gICAgICogQHJldHVybnMge0FycmF5PENsYXNzPFNjcmlwdFR5cGU+Pn0gbGlzdCBvZiBhbGwge0BsaW5rIFNjcmlwdFR5cGV9cyBpbiByZWdpc3RyeS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIC8vIGxvZ3MgYXJyYXkgb2YgYWxsIFNjcmlwdCBUeXBlIG5hbWVzIGF2YWlsYWJsZSBpbiByZWdpc3RyeVxuICAgICAqIGNvbnNvbGUubG9nKGFwcC5zY3JpcHRzLmxpc3QoKS5tYXAoZnVuY3Rpb24gKG8pIHtcbiAgICAgKiAgICAgcmV0dXJuIG8ubmFtZTtcbiAgICAgKiB9KSk7XG4gICAgICovXG4gICAgbGlzdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpc3Q7XG4gICAgfVxufVxuXG5leHBvcnQgeyBTY3JpcHRSZWdpc3RyeSB9O1xuIl0sIm5hbWVzIjpbIlNjcmlwdFJlZ2lzdHJ5IiwiRXZlbnRIYW5kbGVyIiwiY29uc3RydWN0b3IiLCJhcHAiLCJfc2NyaXB0cyIsIl9saXN0IiwiZGVzdHJveSIsIm9mZiIsImFkZCIsInNjcmlwdCIsInNjcmlwdE5hbWUiLCJfX25hbWUiLCJoYXNPd25Qcm9wZXJ0eSIsInNldFRpbWVvdXQiLCJwcm90b3R5cGUiLCJzd2FwIiwib2xkIiwiaW5kIiwiaW5kZXhPZiIsImZpcmUiLCJjb25zb2xlIiwid2FybiIsInB1c2giLCJzeXN0ZW1zIiwiY29tcG9uZW50cyIsIl9jb21wb25lbnRzIiwiYXR0cmlidXRlcyIsInNjcmlwdEluc3RhbmNlcyIsInNjcmlwdEluc3RhbmNlc0luaXRpYWxpemVkIiwibG9vcEluZGV4IiwibGVuZ3RoIiwiY29tcG9uZW50IiwiaXRlbXMiLCJfc2NyaXB0c0luZGV4IiwiYXdhaXRpbmciLCJfc2NyaXB0c0RhdGEiLCJzY3JpcHRJbnN0YW5jZSIsImNyZWF0ZSIsInByZWxvYWRpbmciLCJpIiwiX19pbml0aWFsaXplQXR0cmlidXRlcyIsImVuYWJsZWQiLCJfaW5pdGlhbGl6ZWQiLCJpbml0aWFsaXplIiwiX3Bvc3RJbml0aWFsaXplZCIsInBvc3RJbml0aWFsaXplIiwicmVtb3ZlIiwibmFtZU9yVHlwZSIsInNjcmlwdFR5cGUiLCJnZXQiLCJzcGxpY2UiLCJuYW1lIiwiaGFzIiwibGlzdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFjQSxNQUFNQSxjQUFOLFNBQTZCQyxZQUE3QixDQUEwQztFQU10Q0MsV0FBVyxDQUFDQyxHQUFELEVBQU07QUFDYixJQUFBLEtBQUEsRUFBQSxDQUFBO0lBRUEsSUFBS0EsQ0FBQUEsR0FBTCxHQUFXQSxHQUFYLENBQUE7SUFDQSxJQUFLQyxDQUFBQSxRQUFMLEdBQWdCLEVBQWhCLENBQUE7SUFDQSxJQUFLQyxDQUFBQSxLQUFMLEdBQWEsRUFBYixDQUFBO0FBQ0gsR0FBQTs7QUFFREMsRUFBQUEsT0FBTyxHQUFHO0lBQ04sSUFBS0gsQ0FBQUEsR0FBTCxHQUFXLElBQVgsQ0FBQTtBQUNBLElBQUEsSUFBQSxDQUFLSSxHQUFMLEVBQUEsQ0FBQTtBQUNILEdBQUE7O0VBZURDLEdBQUcsQ0FBQ0Ms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
