/**
 * @license
 * PlayCanvas Engine v1.58.0-preview revision 1fec26519 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../../core/debug.js';
import { Quat } from '../../core/math/quat.js';
import { Vec3 } from '../../core/math/vec3.js';

class InterpolatedKey {
  constructor() {
    this._written = false;
    this._name = '';
    this._keyFrames = [];

    this._quat = new Quat();
    this._pos = new Vec3();
    this._scale = new Vec3();

    this._targetNode = null;
  }
  getTarget() {
    return this._targetNode;
  }
  setTarget(node) {
    this._targetNode = node;
  }
}

class Skeleton {

  constructor(graph) {
    this.looping = true;
    this._animation = null;
    this._time = 0;
    this._interpolatedKeys = [];
    this._interpolatedKeyDict = {};
    this._currKeyIndices = {};
    this.graph = null;
    const addInterpolatedKeys = node => {
      const interpKey = new InterpolatedKey();
      interpKey._name = node.name;
      this._interpolatedKeys.push(interpKey);
      this._interpolatedKeyDict[node.name] = interpKey;
      this._currKeyIndices[node.name] = 0;
      for (let i = 0; i < node._children.length; i++) addInterpolatedKeys(node._children[i]);
    };
    addInterpolatedKeys(graph);
  }

  set animation(value) {
    this._animation = value;
    this.currentTime = 0;
  }
  get animation() {
    return this._animation;
  }

  set currentTime(value) {
    this._time = value;
    const numNodes = this._interpolatedKeys.length;
    for (let i = 0; i < numNodes; i++) {
      const node = this._interpolatedKeys[i];
      const nodeName = node._name;
      this._currKeyIndices[nodeName] = 0;
    }
    this.addTime(0);
    this.updateGraph();
  }
  get currentTime() {
    return this._time;
  }

  get numNodes() {
    return this._interpolatedKeys.length;
  }

  addTime(delta) {
    if (this._animation !== null) {
      const nodes = this._animation._nodes;
      const duration = this._animation.duration;

      if (this._time === duration && !this.looping) {
        return;
      }

      this._time += delta;
      if (this._time > duration) {
        this._time = this.looping ? 0.0 : duration;
        for (let i = 0; i < nodes.length; i++) {
          const node = nodes[i];
          const nodeName = node._name;
          this._currKeyIndices[nodeName] = 0;
        }
      } else if (this._time < 0) {
        this._time = this.looping ? duration : 0.0;
        for (let i = 0; i < nodes.length; i++) {
          const node = nodes[i];
          const nodeName = node._name;
          this._currKeyIndices[nodeName] = node._keys.length - 2;
        }
      }

      const offset = delta >= 0 ? 1 : -1;
      for (let i = 0; i < nodes.length; i++) {
        const node = nodes[i];
        const nodeName = node._name;
        const keys = node._keys;

        const interpKey = this._interpolatedKeyDict[nodeName];
        if (interpKey === undefined) {
          Debug.warn(`Unknown skeleton node name: ${nodeName}`);
          continue;
        }
        let foundKey = false;
        if (keys.length !== 1) {
          for (let currKeyIndex = this._currKeyIndices[nodeName]; currKeyIndex < keys.length - 1 && currKeyIndex >= 0; currKeyIndex += offset) {
            const k1 = keys[currKeyIndex];
            const k2 = keys[currKeyIndex + 1];
            if (k1.time <= this._time && k2.time >= this._time) {
              const alpha = (this._time - k1.time) / (k2.time - k1.time);
              interpKey._pos.lerp(k1.position, k2.position, alpha);
              interpKey._quat.slerp(k1.rotation, k2.rotation, alpha);
              interpKey._scale.lerp(k1.scale, k2.scale, alpha);
              interpKey._written = true;
              this._currKeyIndices[nodeName] = currKeyIndex;
              foundKey = true;
              break;
            }
          }
        }
        if (keys.length === 1 || !foundKey && this._time === 0.0 && this.looping) {
          interpKey._pos.copy(keys[0].position);
          interpKey._quat.copy(keys[0].rotation);
          interpKey._scale.copy(keys[0].scale);
          interpKey._written = true;
        }
      }
    }
  }

  blend(skel1, skel2, alpha) {
    const numNodes = this._interpolatedKeys.length;
    for (let i = 0; i < numNodes; i++) {
      const key1 = skel1._interpolatedKeys[i];
      const key2 = skel2._interpolatedKeys[i];
      const dstKey = this._interpolatedKeys[i];
      if (key1._written && key2._written) {
        dstKey._quat.slerp(key1._quat, skel2._interpolatedKeys[i]._quat, alpha);
        dstKey._pos.lerp(key1._pos, skel2._interpolatedKeys[i]._pos, alpha);
        dstKey._scale.lerp(key1._scale, key2._scale, alpha);
        dstKey._written = true;
      } else if (key1._written) {
        dstKey._quat.copy(key1._quat);
        dstKey._pos.copy(key1._pos);
        dstKey._scale.copy(key1._scale);
        dstKey._written = true;
      } else if (key2._written) {
        dstKey._quat.copy(key2._quat);
        dstKey._pos.copy(key2._pos);
        dstKey._scale.copy(key2._scale);
        dstKey._written = true;
      }
    }
  }

  setGraph(graph) {
    this.graph = graph;
    if (graph) {
      for (let i = 0; i < this._interpolatedKeys.length; i++) {
        const interpKey = this._interpolatedKeys[i];
        const graphNode = graph.findByName(interpKey._name);
        this._interpolatedKeys[i].setTarget(graphNode);
      }
    } else {
      for (let i = 0; i < this._interpolatedKeys.length; i++) {
        this._interpolatedKeys[i].setTarget(null);
      }
    }
  }

  updateGraph() {
    if (this.graph) {
      for (let i = 0; i < this._interpolatedKeys.length; i++) {
        const interpKey = this._interpolatedKeys[i];
        if (interpKey._written) {
          const transform = interpKey.getTarget();
          transform.localPosition.copy(interpKey._pos);
          transform.localRotation.copy(interpKey._quat);
          transform.localScale.copy(interpKey._scale);
          if (!transform._dirtyLocal) transform._dirtifyLocal();
          interpKey._written = false;
        }
      }
    }
  }
}

export { Skeleton };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tlbGV0b24uanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9zY2VuZS9hbmltYXRpb24vc2tlbGV0b24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcgfSBmcm9tICcuLi8uLi9jb3JlL2RlYnVnLmpzJztcbmltcG9ydCB7IFF1YXQgfSBmcm9tICcuLi8uLi9jb3JlL21hdGgvcXVhdC5qcyc7XG5pbXBvcnQgeyBWZWMzIH0gZnJvbSAnLi4vLi4vY29yZS9tYXRoL3ZlYzMuanMnO1xuXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9hbmltYXRpb24uanMnKS5BbmltYXRpb259IEFuaW1hdGlvbiAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uLy4uL3NjZW5lL2dyYXBoLW5vZGUuanMnKS5HcmFwaE5vZGV9IEdyYXBoTm9kZSAqL1xuXG5jbGFzcyBJbnRlcnBvbGF0ZWRLZXkge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLl93cml0dGVuID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX25hbWUgPSAnJztcbiAgICAgICAgdGhpcy5fa2V5RnJhbWVzID0gW107XG5cbiAgICAgICAgLy8gUmVzdWx0IG9mIGludGVycG9sYXRpb25cbiAgICAgICAgdGhpcy5fcXVhdCA9IG5ldyBRdWF0KCk7XG4gICAgICAgIHRoaXMuX3BvcyA9IG5ldyBWZWMzKCk7XG4gICAgICAgIHRoaXMuX3NjYWxlID0gbmV3IFZlYzMoKTtcblxuICAgICAgICAvLyBPcHRpb25hbCBkZXN0aW5hdGlvbiBmb3IgaW50ZXJwb2xhdGVkIGtleWZyYW1lXG4gICAgICAgIHRoaXMuX3RhcmdldE5vZGUgPSBudWxsO1xuICAgIH1cblxuICAgIGdldFRhcmdldCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RhcmdldE5vZGU7XG4gICAgfVxuXG4gICAgc2V0VGFyZ2V0KG5vZGUpIHtcbiAgICAgICAgdGhpcy5fdGFyZ2V0Tm9kZSA9IG5vZGU7XG4gICAgfVxufVxuXG4vKipcbiAqIFJlcHJlc2VudHMgYSBza2VsZXRvbiB1c2VkIHRvIHBsYXkgYW5pbWF0aW9ucy5cbiAqL1xuY2xhc3MgU2tlbGV0b24ge1xuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgd2hldGhlciBza2VsZXRvbiBpcyBsb29waW5nIGl0cyBhbmltYXRpb24uXG4gICAgICpcbiAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBsb29waW5nID0gdHJ1ZTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBTa2VsZXRvbiBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7R3JhcGhOb2RlfSBncmFwaCAtIFRoZSByb290IHtAbGluayBHcmFwaE5vZGV9IG9mIHRoZSBza2VsZXRvbi5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihncmFwaCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogQHR5cGUge0FuaW1hdGlvbn1cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuX2FuaW1hdGlvbiA9IG51bGw7XG4gICAgICAgIHRoaXMuX3RpbWUgPSAwO1xuXG4gICAgICAgIHRoaXMuX2ludGVycG9sYXRlZEtleXMgPSBbXTtcbiAgICAgICAgdGhpcy5faW50ZXJwb2xhdGVkS2V5RGljdCA9IHt9O1xuICAgICAgICB0aGlzLl9jdXJyS2V5SW5kaWNlcyA9IHt9O1xuXG4gICAgICAgIHRoaXMuZ3JhcGggPSBudWxsO1xuXG4gICAgICAgIGNvbnN0IGFkZEludGVycG9sYXRlZEtleXMgPSAobm9kZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaW50ZXJwS2V5ID0gbmV3IEludGVycG9sYXRlZEtleSgpO1xuICAgICAgICAgICAgaW50ZXJwS2V5Ll9uYW1lID0gbm9kZS5uYW1lO1xuICAgICAgICAgICAgdGhpcy5faW50ZXJwb2xhdGVkS2V5cy5wdXNoKGludGVycEtleSk7XG4gICAgICAgICAgICB0aGlzLl9pbnRlcnBvbGF0ZWRLZXlEaWN0W25vZGUubmFtZV0gPSBpbnRlcnBLZXk7XG4gICAgICAgICAgICB0aGlzLl9jdXJyS2V5SW5kaWNlc1tub2RlLm5hbWVdID0gMDtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2RlLl9jaGlsZHJlbi5sZW5ndGg7IGkrKylcbiAgICAgICAgICAgICAgICBhZGRJbnRlcnBvbGF0ZWRLZXlzKG5vZGUuX2NoaWxkcmVuW2ldKTtcbiAgICAgICAgfTtcblxuICAgICAgICBhZGRJbnRlcnBvbGF0ZWRLZXlzKGdyYXBoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBbmltYXRpb24gY3VycmVudGx5IGFzc2lnbmVkIHRvIHNrZWxldG9uLlxuICAgICAqXG4gICAgICogQHR5cGUge0FuaW1hdGlvbn1cbiAgICAgKi9cbiAgICBzZXQgYW5pbWF0aW9uKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX2FuaW1hdGlvbiA9IHZhbHVlO1xuICAgICAgICB0aGlzLmN1cnJlbnRUaW1lID0gMDtcbiAgICB9XG5cbiAgICBnZXQgYW5pbWF0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYW5pbWF0aW9uO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEN1cnJlbnQgdGltZSBvZiBjdXJyZW50bHkgYWN0aXZlIGFuaW1hdGlvbiBpbiBzZWNvbmRzLiBUaGlzIHZhbHVlIGlzIGJldHdlZW4gemVybyBhbmQgdGhlXG4gICAgICogZHVyYXRpb24gb2YgdGhlIGFuaW1hdGlvbi5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICovXG4gICAgc2V0IGN1cnJlbnRUaW1lKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3RpbWUgPSB2YWx1ZTtcbiAgICAgICAgY29uc3QgbnVtTm9kZXMgPSB0aGlzLl9pbnRlcnBvbGF0ZWRLZXlzLmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1Ob2RlczsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBub2RlID0gdGhpcy5faW50ZXJwb2xhdGVkS2V5c1tpXTtcbiAgICAgICAgICAgIGNvbnN0IG5vZGVOYW1lID0gbm9kZS5fbmFtZTtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJLZXlJbmRpY2VzW25vZGVOYW1lXSA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmFkZFRpbWUoMCk7XG4gICAgICAgIHRoaXMudXBkYXRlR3JhcGgoKTtcbiAgICB9XG5cbiAgICBnZXQgY3VycmVudFRpbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90aW1lO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlYWQtb25seSBwcm9wZXJ0eSB0aGF0IHJldHVybnMgbnVtYmVyIG9mIG5vZGVzIG9mIGEgc2tlbGV0b24uXG4gICAgICpcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqL1xuICAgIGdldCBudW1Ob2RlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ludGVycG9sYXRlZEtleXMubGVuZ3RoO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFByb2dyZXNzZXMgdGhlIGFuaW1hdGlvbiBhc3NpZ25lZCB0byB0aGUgc3BlY2lmaWVkIHNrZWxldG9uIGJ5IHRoZSBzdXBwbGllZCB0aW1lIGRlbHRhLiBJZlxuICAgICAqIHRoZSBkZWx0YSB0YWtlcyB0aGUgYW5pbWF0aW9uIHBhc3NlZCBpdHMgZW5kIHBvaW50LCBpZiB0aGUgc2tlbGV0b24gaXMgc2V0IHRvIGxvb3AsIHRoZVxuICAgICAqIGFuaW1hdGlvbiB3aWxsIGNvbnRpbnVlIGZyb20gdGhlIGJlZ2lubmluZy4gT3RoZXJ3aXNlLCB0aGUgYW5pbWF0aW9uJ3MgY3VycmVudCB0aW1lIHdpbGxcbiAgICAgKiByZW1haW4gYXQgaXRzIGR1cmF0aW9uIChpLmUuIHRoZSBlbmQpLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGRlbHRhIC0gVGhlIHRpbWUgaW4gc2Vjb25kcyB0byBwcm9ncmVzcyB0aGUgc2tlbGV0b24ncyBhbmltYXRpb24uXG4gICAgICovXG4gICAgYWRkVGltZShkZWx0YSkge1xuICAgICAgICBpZiAodGhpcy5fYW5pbWF0aW9uICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjb25zdCBub2RlcyA9IHRoaXMuX2FuaW1hdGlvbi5fbm9kZXM7XG4gICAgICAgICAgICBjb25zdCBkdXJhdGlvbiA9IHRoaXMuX2FuaW1hdGlvbi5kdXJhdGlvbjtcblxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgd2UgY2FuIGVhcmx5IG91dFxuICAgICAgICAgICAgaWYgKCh0aGlzLl90aW1lID09PSBkdXJhdGlvbikgJiYgIXRoaXMubG9vcGluZykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gU3RlcCB0aGUgY3VycmVudCB0aW1lIGFuZCB3b3JrIG91dCBpZiB3ZSBuZWVkIHRvIGp1bXAgYWhlYWQsIGNsYW1wIG9yIHdyYXAgYXJvdW5kXG4gICAgICAgICAgICB0aGlzLl90aW1lICs9IGRlbHRhO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5fdGltZSA+IGR1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGltZSA9IHRoaXMubG9vcGluZyA/IDAuMCA6IGR1cmF0aW9uO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlTmFtZSA9IG5vZGUuX25hbWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJLZXlJbmRpY2VzW25vZGVOYW1lXSA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl90aW1lIDwgMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3RpbWUgPSB0aGlzLmxvb3BpbmcgPyBkdXJhdGlvbiA6IDAuMDtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZU5hbWUgPSBub2RlLl9uYW1lO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyS2V5SW5kaWNlc1tub2RlTmFtZV0gPSBub2RlLl9rZXlzLmxlbmd0aCAtIDI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIC8vIEZvciBlYWNoIGFuaW1hdGVkIG5vZGUuLi5cblxuICAgICAgICAgICAgLy8ga2V5cyBpbmRleCBvZmZzZXRcbiAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IChkZWx0YSA+PSAwID8gMSA6IC0xKTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1tpXTtcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlTmFtZSA9IG5vZGUuX25hbWU7XG4gICAgICAgICAgICAgICAgY29uc3Qga2V5cyA9IG5vZGUuX2tleXM7XG5cbiAgICAgICAgICAgICAgICAvLyBEZXRlcm1pbmUgdGhlIGludGVycG9sYXRlZCBrZXlmcmFtZSBmb3IgdGhpcyBhbmltYXRlZCBub2RlXG4gICAgICAgICAgICAgICAgY29uc3QgaW50ZXJwS2V5ID0gdGhpcy5faW50ZXJwb2xhdGVkS2V5RGljdFtub2RlTmFtZV07XG4gICAgICAgICAgICAgICAgaWYgKGludGVycEtleSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIERlYnVnLndhcm4oYFVua25vd24gc2tlbGV0b24gbm9kZSBuYW1lOiAke25vZGVOYW1lfWApO1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUncyBvbmx5IGEgc2luZ2xlIGtleSwganVzdCBjb3B5IHRoZSBrZXkgdG8gdGhlIGludGVycG9sYXRlZCBrZXkuLi5cbiAgICAgICAgICAgICAgICBsZXQgZm91bmRLZXkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAoa2V5cy5sZW5ndGggIT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCBmaW5kIHRoZSBrZXlmcmFtZSBwYWlyIGZvciB0aGlzIG5vZGVcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgY3VycktleUluZGV4ID0gdGhpcy5fY3VycktleUluZGljZXNbbm9kZU5hbWVdOyBjdXJyS2V5SW5kZXggPCBrZXlzLmxlbmd0aCAtIDEgJiYgY3VycktleUluZGV4ID49IDA7IGN1cnJLZXlJbmRleCArPSBvZmZzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGsxID0ga2V5c1tjdXJyS2V5SW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgazIgPSBrZXlzW2N1cnJLZXlJbmRleCArIDFdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGsxLnRpbWUgPD0gdGhpcy5fdGltZSkgJiYgKGsyLnRpbWUgPj0gdGhpcy5fdGltZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhbHBoYSA9ICh0aGlzLl90aW1lIC0gazEudGltZSkgLyAoazIudGltZSAtIGsxLnRpbWUpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJwS2V5Ll9wb3MubGVycChrMS5wb3NpdGlvbiwgazIucG9zaXRpb24sIGFscGhhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnBLZXkuX3F1YXQuc2xlcnAoazEucm90YXRpb24sIGsyLnJvdGF0aW9uLCBhbHBoYSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJwS2V5Ll9zY2FsZS5sZXJwKGsxLnNjYWxlLCBrMi5zY2FsZSwgYWxwaGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVycEtleS5fd3JpdHRlbiA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyS2V5SW5kaWNlc1tub2RlTmFtZV0gPSBjdXJyS2V5SW5kZXg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRLZXkgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChrZXlzLmxlbmd0aCA9PT0gMSB8fCAoIWZvdW5kS2V5ICYmIHRoaXMuX3RpbWUgPT09IDAuMCAmJiB0aGlzLmxvb3BpbmcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGludGVycEtleS5fcG9zLmNvcHkoa2V5c1swXS5wb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIGludGVycEtleS5fcXVhdC5jb3B5KGtleXNbMF0ucm90YXRpb24pO1xuICAgICAgICAgICAgICAgICAgICBpbnRlcnBLZXkuX3NjYWxlLmNvcHkoa2V5c1swXS5zY2FsZSk7XG4gICAgICAgICAgICAgICAgICAgIGludGVycEtleS5fd3JpdHRlbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQmxlbmRzIHR3byBza2VsZXRvbnMgdG9nZXRoZXIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1NrZWxldG9ufSBza2VsMSAtIFNrZWxldG9uIGhvbGRpbmcgdGhlIGZpcnN0IHBvc2UgdG8gYmUgYmxlbmRlZC5cbiAgICAgKiBAcGFyYW0ge1NrZWxldG9ufSBza2VsMiAtIFNrZWxldG9uIGhvbGRpbmcgdGhlIHNlY29uZCBwb3NlIHRvIGJlIGJsZW5kZWQuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gVGhlIHZhbHVlIGNvbnRyb2xsaW5nIHRoZSBpbnRlcnBvbGF0aW9uIGluIHJlbGF0aW9uIHRvIHRoZSB0d28gaW5wdXRcbiAgICAgKiBza2VsZXRvbnMuIFRoZSB2YWx1ZSBpcyBpbiB0aGUgcmFuZ2UgMCB0byAxLCAwIGdlbmVyYXRpbmcgc2tlbDEsIDEgZ2VuZXJhdGluZyBza2VsMiBhbmRcbiAgICAgKiBhbnl0aGluZyBpbiBiZXR3ZWVuIGdlbmVyYXRpbmcgYSBzcGhlcmljYWwgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHRoZSB0d28uXG4gICAgICovXG4gICAgYmxlbmQoc2tlbDEsIHNrZWwyLCBhbHBoYSkge1xuICAgICAgICBjb25zdCBudW1Ob2RlcyA9IHRoaXMuX2ludGVycG9sYXRlZEtleXMubGVuZ3RoO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bU5vZGVzOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGtleTEgPSBza2VsMS5faW50ZXJwb2xhdGVkS2V5c1tpXTtcbiAgICAgICAgICAgIGNvbnN0IGtleTIgPSBza2VsMi5faW50ZXJwb2xhdGVkS2V5c1tpXTtcbiAgICAgICAgICAgIGNvbnN0IGRzdEtleSA9IHRoaXMuX2ludGVycG9sYXRlZEtleXNbaV07XG5cbiAgICAgICAgICAgIGlmIChrZXkxLl93cml0dGVuICYmIGtleTIuX3dyaXR0ZW4pIHtcbiAgICAgICAgICAgICAgICBkc3RLZXkuX3F1YXQuc2xlcnAoa2V5MS5fcXVhdCwgc2tlbDIuX2ludGVycG9sYXRlZEtleXNbaV0uX3F1YXQsIGFscGhhKTtcbiAgICAgICAgICAgICAgICBkc3RLZXkuX3Bvcy5sZXJwKGtleTEuX3Bvcywgc2tlbDIuX2ludGVycG9sYXRlZEtleXNbaV0uX3BvcywgYWxwaGEpO1xuICAgICAgICAgICAgICAgIGRzdEtleS5fc2NhbGUubGVycChrZXkxLl9zY2FsZSwga2V5Mi5fc2NhbGUsIGFscGhhKTtcbiAgICAgICAgICAgICAgICBkc3RLZXkuX3dyaXR0ZW4gPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChrZXkxLl93cml0dGVuKSB7XG4gICAgICAgICAgICAgICAgZHN0S2V5Ll9xdWF0LmNvcHkoa2V5MS5fcXVhdCk7XG4gICAgICAgICAgICAgICAgZHN0S2V5Ll9wb3MuY29weShrZXkxLl9wb3MpO1xuICAgICAgICAgICAgICAgIGRzdEtleS5fc2NhbGUuY29weShrZXkxLl9zY2FsZSk7XG4gICAgICAgICAgICAgICAgZHN0S2V5Ll93cml0dGVuID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5Mi5fd3JpdHRlbikge1xuICAgICAgICAgICAgICAgIGRzdEtleS5fcXVhdC5jb3B5KGtleTIuX3F1YXQpO1xuICAgICAgICAgICAgICAgIGRzdEtleS5fcG9zLmNvcHkoa2V5Mi5fcG9zKTtcbiAgICAgICAgICAgICAgICBkc3RLZXkuX3NjYWxlLmNvcHkoa2V5Mi5fc2NhbGUpO1xuICAgICAgICAgICAgICAgIGRzdEtleS5fd3JpdHRlbiA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMaW5rcyBhIHNrZWxldG9uIHRvIGEgbm9kZSBoaWVyYXJjaHkuIFRoZSBub2RlcyBhbmltYXRlZCBza2VsZXRvbiBhcmUgdGhlbiBzdWJzZXF1ZW50bHkgdXNlZFxuICAgICAqIHRvIGRyaXZlIHRoZSBsb2NhbCB0cmFuc2Zvcm1hdGlvbiBtYXRyaWNlcyBvZiB0aGUgbm9kZSBoaWVyYXJjaHkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0dyYXBoTm9kZX0gZ3JhcGggLSBUaGUgcm9vdCBub2RlIG9mIHRoZSBncmFwaCB0aGF0IHRoZSBza2VsZXRvbiBpcyB0byBkcml2ZS5cbiAgICAgKi9cbiAgICBzZXRHcmFwaChncmFwaCkge1xuICAgICAgICB0aGlzLmdyYXBoID0gZ3JhcGg7XG5cbiAgICAgICAgaWYgKGdyYXBoKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX2ludGVycG9sYXRlZEtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpbnRlcnBLZXkgPSB0aGlzLl9pbnRlcnBvbGF0ZWRLZXlzW2ldO1xuICAgICAgICAgICAgICAgIGNvbnN0IGdyYXBoTm9kZSA9IGdyYXBoLmZpbmRCeU5hbWUoaW50ZXJwS2V5Ll9uYW1lKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9pbnRlcnBvbGF0ZWRLZXlzW2ldLnNldFRhcmdldChncmFwaE5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9pbnRlcnBvbGF0ZWRLZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faW50ZXJwb2xhdGVkS2V5c1tpXS5zZXRUYXJnZXQobnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTeW5jaHJvbml6ZXMgdGhlIGN1cnJlbnRseSBsaW5rZWQgbm9kZSBoaWVyYXJjaHkgd2l0aCB0aGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgc2tlbGV0b24uXG4gICAgICogSW50ZXJuYWxseSwgdGhpcyBmdW5jdGlvbiBjb252ZXJ0cyB0aGUgaW50ZXJwb2xhdGVkIGtleWZyYW1lIGF0IGVhY2ggbm9kZSBpbiB0aGUgc2tlbGV0b25cbiAgICAgKiBpbnRvIHRoZSBsb2NhbCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggYXQgZWFjaCBjb3JyZXNwb25kaW5nIG5vZGUgaW4gdGhlIGxpbmtlZCBub2RlXG4gICAgICogaGllcmFyY2h5LlxuICAgICAqL1xuICAgIHVwZGF0ZUdyYXBoKCkge1xuICAgICAgICBpZiAodGhpcy5ncmFwaCkge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9pbnRlcnBvbGF0ZWRLZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW50ZXJwS2V5ID0gdGhpcy5faW50ZXJwb2xhdGVkS2V5c1tpXTtcbiAgICAgICAgICAgICAgICBpZiAoaW50ZXJwS2V5Ll93cml0dGVuKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zZm9ybSA9IGludGVycEtleS5nZXRUYXJnZXQoKTtcblxuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm0ubG9jYWxQb3NpdGlvbi5jb3B5KGludGVycEtleS5fcG9zKTtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtLmxvY2FsUm90YXRpb24uY29weShpbnRlcnBLZXkuX3F1YXQpO1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm0ubG9jYWxTY2FsZS5jb3B5KGludGVycEtleS5fc2NhbGUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghdHJhbnNmb3JtLl9kaXJ0eUxvY2FsKVxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtLl9kaXJ0aWZ5TG9jYWwoKTtcblxuICAgICAgICAgICAgICAgICAgICBpbnRlcnBLZXkuX3dyaXR0ZW4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCB7IFNrZWxldG9uIH07XG4iXSwibmFtZXMiOlsiSW50ZXJwb2xhdGVkS2V5IiwiY29uc3RydWN0b3IiLCJfd3JpdHRlbiIsIl9uYW1lIiwiX2tleUZyYW1lcyIsIl9xdWF0IiwiUXVhdCIsIl9wb3MiLCJWZWMzIiwiX3NjYWxlIiwiX3RhcmdldE5vZGUiLCJnZXRUYXJnZXQiLCJzZXRUYXJnZXQiLCJub2RlIiwiU2tlbGV0b24iLCJncmFwaCIsImxvb3BpbmciLCJfYW5pbWF0aW9uIiwiX3RpbWUiLCJfaW50ZXJwb2xhdGVkS2V5cyIsIl9pbnRlcnBvbGF0ZWRLZXlEaWN0IiwiX2N1cnJLZXlJbmRpY2VzIiwiYWRkSW50ZXJwb2xhdGVkS2V5cyIsImludGVycEtleSIsIm5hbWUiLCJwdXNoIiwiaSIsIl9jaGlsZHJlbiIsImxlbmd0aCIsImFuaW1hdGlvbiIsInZhbHVlIiwiY3VycmVudFRpbWUiLCJudW1Ob2RlcyIsIm5vZGVOYW1lIiwiYWRkVGltZSIsInVwZGF0ZUdyYXBoIiwiZGVsdGEiLCJub2RlcyIsIl9ub2RlcyIsImR1cmF0aW9uIiwiX2tleXMiLCJvZmZzZXQiLCJrZXlzIiwidW5kZWZpbmVkIiwiRGVidWciLCJ3YXJuIiwiZm91bmRLZXkiLCJjdXJyS2V5SW5kZXgiLCJrMSIsImsyIiwidGltZSIsImFscGhhIiwibGVycCIsInBvc2l0aW9uIiwic2xlcnAiLCJyb3RhdGlvbiIsInNjYWxlIiwiY29weSIsImJsZW5kIiwic2tlbDEiLCJza2VsMiIsImtleTEiLCJrZXkyIiwiZHN0S2V5Iiwic2V0R3JhcGgiLCJncmFwaE5vZGUiLCJmaW5kQnlOYW1lIiwidHJhbnNmb3JtIiwibG9jYWxQb3NpdGlvbiIsImxvY2FsUm90YXRpb24iLCJsb2NhbFNjYWxlIiwiX2RpcnR5TG9jYWwiLCJfZGlydGlmeUxvY2FsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFPQSxNQUFNQSxlQUFlLENBQUM7QUFDbEJDLEVBQUFBLFdBQVcsR0FBRztJQUNWLElBQUksQ0FBQ0MsUUFBUSxHQUFHLEtBQUssQ0FBQTtJQUNyQixJQUFJLENBQUNDLEtBQUssR0FBRyxFQUFFLENBQUE7SUFDZixJQUFJLENBQUNDLFVBQVUsR0FBRyxFQUFFLENBQUE7O0FBR3BCLElBQUEsSUFBSSxDQUFDQyxLQUFLLEdBQUcsSUFBSUMsSUFBSSxFQUFFLENBQUE7QUFDdkIsSUFBQSxJQUFJLENBQUNDLElBQUksR0FBRyxJQUFJQyxJQUFJLEVBQUUsQ0FBQTtBQUN0QixJQUFBLElBQUksQ0FBQ0MsTUFBTSxHQUFHLElBQUlELElBQUksRUFBRSxDQUFBOztJQUd4QixJQUFJLENBQUNFLFdBQVcsR0FBRyxJQUFJLENBQUE7QUFDM0IsR0FBQTtB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
