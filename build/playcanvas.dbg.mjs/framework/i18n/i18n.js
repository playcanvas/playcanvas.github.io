/**
 * @license
 * PlayCanvas Engine v1.58.0-preview revision 1fec26519 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { EventHandler } from '../../core/event-handler.js';
import { Asset } from '../asset/asset.js';
import { I18nParser } from './i18n-parser.js';
import { DEFAULT_LOCALE, DEFAULT_LOCALE_FALLBACKS } from './constants.js';
import { getLang, replaceLang, getPluralFn, findAvailableLocale } from './utils.js';

class I18n extends EventHandler {
  constructor(app) {
    super();
    this.locale = DEFAULT_LOCALE;
    this._translations = {};
    this._availableLangs = {};
    this._app = app;
    this._assets = [];
    this._parser = new I18nParser();
  }

  set assets(value) {
    const index = {};

    for (let _i = 0, len = value.length; _i < len; _i++) {
      const id = value[_i] instanceof Asset ? value[_i].id : value[_i];
      index[id] = true;
    }

    let i = this._assets.length;
    while (i--) {
      const id = this._assets[i];
      if (!index[id]) {
        this._app.assets.off('add:' + id, this._onAssetAdd, this);
        const asset = this._app.assets.get(id);
        if (asset) {
          this._onAssetRemove(asset);
        }
        this._assets.splice(i, 1);
      }
    }

    for (const id in index) {
      const idNum = parseInt(id, 10);
      if (this._assets.indexOf(idNum) !== -1) continue;
      this._assets.push(idNum);
      const asset = this._app.assets.get(idNum);
      if (!asset) {
        this._app.assets.once('add:' + idNum, this._onAssetAdd, this);
      } else {
        this._onAssetAdd(asset);
      }
    }
  }
  get assets() {
    return this._assets;
  }

  set locale(value) {
    if (this._locale === value) {
      return;
    }

    let lang = getLang(value);
    if (lang === 'in') {
      lang = 'id';
      value = replaceLang(value, lang);
      if (this._locale === value) {
        return;
      }
    }
    const old = this._locale;
    this._locale = value;
    this._lang = lang;
    this._pluralFn = getPluralFn(this._lang);

    this.fire('set:locale', value, old);
  }
  get locale() {
    return this._locale;
  }

  static findAvailableLocale(desiredLocale, availableLocales) {
    return findAvailableLocale(desiredLocale, availableLocales);
  }

  findAvailableLocale(desiredLocale) {
    if (this._translations[desiredLocale]) {
      return desiredLocale;
    }
    const lang = getLang(desiredLocale);
    return this._findFallbackLocale(desiredLocale, lang);
  }

  getText(key, locale) {
    let result = key;
    let lang;
    if (!locale) {
      locale = this._locale;
      lang = this._lang;
    }
    let translations = this._translations[locale];
    if (!translations) {
      if (!lang) {
        lang = getLang(locale);
      }
      locale = this._findFallbackLocale(locale, lang);
      translations = this._translations[locale];
    }
    if (translations && translations.hasOwnProperty(key)) {
      result = translations[key];

      if (Array.isArray(result)) {
        result = result[0];
      }

      if (result === null || result === undefined) {
        result = key;
      }
    }
    return result;
  }

  getPluralText(key, n, locale) {
    let result = key;
    let lang;
    let pluralFn;
    if (!locale) {
      locale = this._locale;
      lang = this._lang;
      pluralFn = this._pluralFn;
    } else {
      lang = getLang(locale);
      pluralFn = getPluralFn(lang);
    }
    let translations = this._translations[locale];
    if (!translations) {
      locale = this._findFallbackLocale(locale, lang);
      lang = getLang(locale);
      pluralFn = getPluralFn(lang);
      translations = this._translations[locale];
    }
    if (translations && translations[key] && pluralFn) {
      const index = pluralFn(n);
      result = translations[key][index];

      if (result === null || result === undefined) {
        result = key;
      }
    }
    return result;
  }

  addData(data) {
    let parsed;
    try {
      parsed = this._parser.parse(data);
    } catch (err) {
      console.error(err);
      return;
    }
    for (let i = 0, len = parsed.length; i < len; i++) {
      const entry = parsed[i];
      const locale = entry.info.locale;
      const messages = entry.messages;
      if (!this._translations[locale]) {
        this._translations[locale] = {};
        const lang = getLang(locale);

        if (!this._availableLangs[lang]) {
          this._availableLangs[lang] = locale;
        }
      }
      Object.assign(this._translations[locale], messages);
      this.fire('data:add', locale, messages);
    }
  }

  removeData(data) {
    let parsed;
    try {
      parsed = this._parser.parse(data);
    } catch (err) {
      console.error(err);
      return;
    }
    for (let i = 0, len = parsed.length; i < len; i++) {
      const entry = parsed[i];
      const locale = entry.info.locale;
      const translations = this._translations[locale];
      if (!translations) continue;
      const messages = entry.messages;
      for (const key in messages) {
        delete translations[key];
      }

      if (Object.keys(translations).length === 0) {
        delete this._translations[locale];
        delete this._availableLangs[getLang(locale)];
      }
      this.fire('data:remove', locale, messages);
    }
  }

  destroy() {
    this._translations = null;
    this._availableLangs = null;
    this._assets = null;
    this._parser = null;
    this.off();
  }

  _findFallbackLocale(locale, lang) {
    let result = DEFAULT_LOCALE_FALLBACKS[locale];
    if (result && this._translations[result]) {
      return result;
    }
    result = DEFAULT_LOCALE_FALLBACKS[lang];
    if (result && this._translations[result]) {
      return result;
    }
    result = this._availableLangs[lang];
    if (result && this._translations[result]) {
      return result;
    }
    return DEFAULT_LOCALE;
  }
  _onAssetAdd(asset) {
    asset.on('load', this._onAssetLoad, this);
    asset.on('change', this._onAssetChange, this);
    asset.on('remove', this._onAssetRemove, this);
    asset.on('unload', this._onAssetUnload, this);
    if (asset.resource) {
      this._onAssetLoad(asset);
    }
  }
  _onAssetLoad(asset) {
    this.addData(asset.resource);
  }
  _onAssetChange(asset) {
    if (asset.resource) {
      this.addData(asset.resource);
    }
  }
  _onAssetRemove(asset) {
    asset.off('load', this._onAssetLoad, this);
    asset.off('change', this._onAssetChange, this);
    asset.off('remove', this._onAssetRemove, this);
    asset.off('unload', this._onAssetUnload, this);
    if (asset.resource) {
      this.removeData(asset.resource);
    }
    this._app.assets.once('add:' + asset.id, this._onAssetAdd, this);
  }
  _onAssetUnload(asset) {
    if (asset.resource) {
      this.removeData(asset.resource);
    }
  }
}

export { I18n };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaTE4bi5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay9pMThuL2kxOG4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRIYW5kbGVyIH0gZnJvbSAnLi4vLi4vY29yZS9ldmVudC1oYW5kbGVyLmpzJztcblxuaW1wb3J0IHsgQXNzZXQgfSBmcm9tICcuLi9hc3NldC9hc3NldC5qcyc7XG5cbmltcG9ydCB7IEkxOG5QYXJzZXIgfSBmcm9tICcuL2kxOG4tcGFyc2VyLmpzJztcblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uLy4uL2ZyYW1ld29yay9hcHAtYmFzZS5qcycpLkFwcEJhc2V9IEFwcEJhc2UgKi9cblxuaW1wb3J0IHtcbiAgICBERUZBVUxUX0xPQ0FMRSxcbiAgICBERUZBVUxUX0xPQ0FMRV9GQUxMQkFDS1Ncbn0gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuXG5pbXBvcnQge1xuICAgIHJlcGxhY2VMYW5nLFxuICAgIGdldExhbmcsXG4gICAgZ2V0UGx1cmFsRm4sXG4gICAgZmluZEF2YWlsYWJsZUxvY2FsZVxufSBmcm9tICcuL3V0aWxzLmpzJztcblxuLyoqXG4gKiBIYW5kbGVzIGxvY2FsaXphdGlvbi4gUmVzcG9uc2libGUgZm9yIGxvYWRpbmcgbG9jYWxpemF0aW9uIGFzc2V0cyBhbmQgcmV0dXJuaW5nIHRyYW5zbGF0aW9ucyBmb3JcbiAqIGEgY2VydGFpbiBrZXkuIENhbiBhbHNvIGhhbmRsZSBwbHVyYWwgZm9ybXMuIFRvIG92ZXJyaWRlIGl0cyBkZWZhdWx0IGJlaGF2aW9yIGRlZmluZSBhIGRpZmZlcmVudFxuICogaW1wbGVtZW50YXRpb24gZm9yIHtAbGluayBJMThuI2dldFRleHR9IGFuZCB7QGxpbmsgSTE4biNnZXRQbHVyYWxUZXh0fS5cbiAqXG4gKiBAYXVnbWVudHMgRXZlbnRIYW5kbGVyXG4gKi9cbmNsYXNzIEkxOG4gZXh0ZW5kcyBFdmVudEhhbmRsZXIge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBJMThuIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtBcHBCYXNlfSBhcHAgLSBUaGUgYXBwbGljYXRpb24uXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoYXBwKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5sb2NhbGUgPSBERUZBVUxUX0xPQ0FMRTtcbiAgICAgICAgdGhpcy5fdHJhbnNsYXRpb25zID0ge307XG4gICAgICAgIHRoaXMuX2F2YWlsYWJsZUxhbmdzID0ge307XG4gICAgICAgIHRoaXMuX2FwcCA9IGFwcDtcbiAgICAgICAgdGhpcy5fYXNzZXRzID0gW107XG4gICAgICAgIHRoaXMuX3BhcnNlciA9IG5ldyBJMThuUGFyc2VyKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQW4gYXJyYXkgb2YgYXNzZXQgaWRzIG9yIGFzc2V0cyB0aGF0IGNvbnRhaW4gbG9jYWxpemF0aW9uIGRhdGEgaW4gdGhlIGV4cGVjdGVkIGZvcm1hdC4gSTE4blxuICAgICAqIHdpbGwgYXV0b21hdGljYWxseSBsb2FkIHRyYW5zbGF0aW9ucyBmcm9tIHRoZXNlIGFzc2V0cyBhcyB0aGUgYXNzZXRzIGFyZSBsb2FkZWQgYW5kIGl0IHdpbGxcbiAgICAgKiBhbHNvIGF1dG9tYXRpY2FsbHkgdW5sb2FkIHRyYW5zbGF0aW9ucyBpZiB0aGUgYXNzZXRzIGdldCByZW1vdmVkIG9yIHVubG9hZGVkIGF0IHJ1bnRpbWUuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7bnVtYmVyW118QXNzZXRbXX1cbiAgICAgKi9cbiAgICBzZXQgYXNzZXRzKHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IGluZGV4ID0ge307XG5cbiAgICAgICAgLy8gY29udmVydCBhcnJheSB0byBkaWN0XG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB2YWx1ZS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgY29uc3QgaWQgPSB2YWx1ZVtpXSBpbnN0YW5jZW9mIEFzc2V0ID8gdmFsdWVbaV0uaWQgOiB2YWx1ZVtpXTtcbiAgICAgICAgICAgIGluZGV4W2lkXSA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyByZW1vdmUgYXNzZXRzIG5vdCBpbiB2YWx1ZVxuICAgICAgICBsZXQgaSA9IHRoaXMuX2Fzc2V0cy5sZW5ndGg7XG4gICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgIGNvbnN0IGlkID0gdGhpcy5fYXNzZXRzW2ldO1xuICAgICAgICAgICAgaWYgKCFpbmRleFtpZF0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9hcHAuYXNzZXRzLm9mZignYWRkOicgKyBpZCwgdGhpcy5fb25Bc3NldEFkZCwgdGhpcyk7XG4gICAgICAgICAgICAgICAgY29uc3QgYXNzZXQgPSB0aGlzLl9hcHAuYXNzZXRzLmdldChpZCk7XG4gICAgICAgICAgICAgICAgaWYgKGFzc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX29uQXNzZXRSZW1vdmUoYXNzZXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9hc3NldHMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gYWRkIGFzc2V0cyBpbiB2YWx1ZSB0aGF0IGRvIG5vdCBhbHJlYWR5IGV4aXN0IGhlcmVcbiAgICAgICAgZm9yIChjb25zdCBpZCBpbiBpbmRleCkge1xuICAgICAgICAgICAgY29uc3QgaWROdW0gPSBwYXJzZUludChpZCwgMTApO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2Fzc2V0cy5pbmRleE9mKGlkTnVtKSAhPT0gLTEpIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICB0aGlzLl9hc3NldHMucHVzaChpZE51bSk7XG4gICAgICAgICAgICBjb25zdCBhc3NldCA9IHRoaXMuX2FwcC5hc3NldHMuZ2V0KGlkTnVtKTtcbiAgICAgICAgICAgIGlmICghYXNzZXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9hcHAuYXNzZXRzLm9uY2UoJ2FkZDonICsgaWROdW0sIHRoaXMuX29uQXNzZXRBZGQsIHRoaXMpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9vbkFzc2V0QWRkKGFzc2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBhc3NldHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9hc3NldHM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGN1cnJlbnQgbG9jYWxlIGZvciBleGFtcGxlIFwiZW4tVVNcIi4gQ2hhbmdpbmcgdGhlIGxvY2FsZSB3aWxsIHJhaXNlIGFuIGV2ZW50IHdoaWNoIHdpbGxcbiAgICAgKiBjYXVzZSBsb2NhbGl6ZWQgVGV4dCBFbGVtZW50cyB0byBjaGFuZ2UgbGFuZ3VhZ2UgdG8gdGhlIG5ldyBsb2NhbGUuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAqL1xuICAgIHNldCBsb2NhbGUodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuX2xvY2FsZSA9PT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHJlcGxhY2UgJ2luJyBsYW5ndWFnZSB3aXRoICdpZCdcbiAgICAgICAgLy8gZm9yIEluZG9uZXNpYW4gYmVjYXVzZSBib3RoIGNvZGVzIGFyZSB2YWxpZFxuICAgICAgICAvLyBzbyB0aGF0IHVzZXJzIG9ubHkgbmVlZCB0byB1c2UgdGhlICdpZCcgY29kZVxuICAgICAgICBsZXQgbGFuZyA9IGdldExhbmcodmFsdWUpO1xuICAgICAgICBpZiAobGFuZyA9PT0gJ2luJykge1xuICAgICAgICAgICAgbGFuZyA9ICdpZCc7XG4gICAgICAgICAgICB2YWx1ZSA9IHJlcGxhY2VMYW5nKHZhbHVlLCBsYW5nKTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9sb2NhbGUgPT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgb2xkID0gdGhpcy5fbG9jYWxlO1xuICAgICAgICAvLyBjYWNoZSBsb2NhbGUsIGxhbmcgYW5kIHBsdXJhbCBmdW5jdGlvblxuICAgICAgICB0aGlzLl9sb2NhbGUgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5fbGFuZyA9IGxhbmc7XG4gICAgICAgIHRoaXMuX3BsdXJhbEZuID0gZ2V0UGx1cmFsRm4odGhpcy5fbGFuZyk7XG5cbiAgICAgICAgLy8gcmFpc2UgZXZlbnRcbiAgICAgICAgdGhpcy5maXJlKCdzZXQ6bG9jYWxlJywgdmFsdWUsIG9sZCk7XG4gICAgfVxuXG4gICAgZ2V0IGxvY2FsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xvY2FsZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBmaXJzdCBhdmFpbGFibGUgbG9jYWxlIGJhc2VkIG9uIHRoZSBkZXNpcmVkIGxvY2FsZSBzcGVjaWZpZWQuIEZpcnN0IHRyaWVzIHRvXG4gICAgICogZmluZCB0aGUgZGVzaXJlZCBsb2NhbGUgYW5kIHRoZW4gdHJpZXMgdG8gZmluZCBhbiBhbHRlcm5hdGl2ZSBsb2NhbGUgYmFzZWQgb24gdGhlIGxhbmd1YWdlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGRlc2lyZWRMb2NhbGUgLSBUaGUgZGVzaXJlZCBsb2NhbGUgZS5nLiBlbi1VUy5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gYXZhaWxhYmxlTG9jYWxlcyAtIEEgZGljdGlvbmFyeSB3aGVyZSBlYWNoIGtleSBpcyBhbiBhdmFpbGFibGUgbG9jYWxlLlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBsb2NhbGUgZm91bmQgb3IgaWYgbm8gbG9jYWxlIGlzIGF2YWlsYWJsZSByZXR1cm5zIHRoZSBkZWZhdWx0IGVuLVVTXG4gICAgICogbG9jYWxlLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogLy8gV2l0aCBhIGRlZmluZWQgZGljdGlvbmFyeSBvZiBsb2NhbGVzXG4gICAgICogdmFyIGF2YWlsYWJsZUxvY2FsZXMgPSB7IGVuOiAnZW4tVVMnLCBmcjogJ2ZyLUZSJyB9O1xuICAgICAqIHZhciBsb2NhbGUgPSBwYy5JMThuLmdldFRleHQoJ2VuLVVTJywgYXZhaWxhYmxlTG9jYWxlcyk7XG4gICAgICogLy8gcmV0dXJucyAnZW4nXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIHN0YXRpYyBmaW5kQXZhaWxhYmxlTG9jYWxlKGRlc2lyZWRMb2NhbGUsIGF2YWlsYWJsZUxvY2FsZXMpIHtcbiAgICAgICAgcmV0dXJuIGZpbmRBdmFpbGFibGVMb2NhbGUoZGVzaXJlZExvY2FsZSwgYXZhaWxhYmxlTG9jYWxlcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgZmlyc3QgYXZhaWxhYmxlIGxvY2FsZSBiYXNlZCBvbiB0aGUgZGVzaXJlZCBsb2NhbGUgc3BlY2lmaWVkLiBGaXJzdCB0cmllcyB0b1xuICAgICAqIGZpbmQgdGhlIGRlc2lyZWQgbG9jYWxlIGluIHRoZSBsb2FkZWQgdHJhbnNsYXRpb25zIGFuZCB0aGVuIHRyaWVzIHRvIGZpbmQgYW4gYWx0ZXJuYXRpdmVcbiAgICAgKiBsb2NhbGUgYmFzZWQgb24gdGhlIGxhbmd1YWdlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGRlc2lyZWRMb2NhbGUgLSBUaGUgZGVzaXJlZCBsb2NhbGUgZS5nLiBlbi1VUy5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgbG9jYWxlIGZvdW5kIG9yIGlmIG5vIGxvY2FsZSBpcyBhdmFpbGFibGUgcmV0dXJucyB0aGUgZGVmYXVsdCBlbi1VU1xuICAgICAqIGxvY2FsZS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHZhciBsb2NhbGUgPSB0aGlzLmFwcC5pMThuLmdldFRleHQoJ2VuLVVTJyk7XG4gICAgICovXG4gICAgZmluZEF2YWlsYWJsZUxvY2FsZShkZXNpcmVkTG9jYWxlKSB7XG4gICAgICAgIGlmICh0aGlzLl90cmFuc2xhdGlvbnNbZGVzaXJlZExvY2FsZV0pIHtcbiAgICAgICAgICAgIHJldHVybiBkZXNpcmVkTG9jYWxlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbGFuZyA9IGdldExhbmcoZGVzaXJlZExvY2FsZSk7XG4gICAgICAgIHJldHVybiB0aGlzLl9maW5kRmFsbGJhY2tMb2NhbGUoZGVzaXJlZExvY2FsZSwgbGFuZyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgdHJhbnNsYXRpb24gZm9yIHRoZSBzcGVjaWZpZWQga2V5IGFuZCBsb2NhbGUuIElmIHRoZSBsb2NhbGUgaXMgbm90IHNwZWNpZmllZCBpdFxuICAgICAqIHdpbGwgdXNlIHRoZSBjdXJyZW50IGxvY2FsZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgLSBUaGUgbG9jYWxpemF0aW9uIGtleS5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2xvY2FsZV0gLSBUaGUgZGVzaXJlZCBsb2NhbGUuXG4gICAgICogQHJldHVybnMge3N0cmluZ30gVGhlIHRyYW5zbGF0ZWQgdGV4dC4gSWYgbm8gdHJhbnNsYXRpb25zIGFyZSBmb3VuZCBhdCBhbGwgZm9yIHRoZSBsb2NhbGVcbiAgICAgKiB0aGVuIGl0IHdpbGwgcmV0dXJuIHRoZSBlbi1VUyB0cmFuc2xhdGlvbi4gSWYgbm8gdHJhbnNsYXRpb24gZXhpc3RzIGZvciB0aGF0IGtleSB0aGVuIGl0IHdpbGxcbiAgICAgKiByZXR1cm4gdGhlIGxvY2FsaXphdGlvbiBrZXkuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgbG9jYWxpemVkID0gdGhpcy5hcHAuaTE4bi5nZXRUZXh0KCdsb2NhbGl6YXRpb24ta2V5Jyk7XG4gICAgICogdmFyIGxvY2FsaXplZEZyZW5jaCA9IHRoaXMuYXBwLmkxOG4uZ2V0VGV4dCgnbG9jYWxpemF0aW9uLWtleScsICdmci1GUicpO1xuICAgICAqL1xuICAgIGdldFRleHQoa2V5LCBsb2NhbGUpIHtcbiAgICAgICAgLy8gZGVmYXVsdCB0cmFuc2xhdGlvbiBpcyB0aGUga2V5XG4gICAgICAgIGxldCByZXN1bHQgPSBrZXk7XG5cbiAgICAgICAgbGV0IGxhbmc7XG4gICAgICAgIGlmICghbG9jYWxlKSB7XG4gICAgICAgICAgICBsb2NhbGUgPSB0aGlzLl9sb2NhbGU7XG4gICAgICAgICAgICBsYW5nID0gdGhpcy5fbGFuZztcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB0cmFuc2xhdGlvbnMgPSB0aGlzLl90cmFuc2xhdGlvbnNbbG9jYWxlXTtcbiAgICAgICAgaWYgKCF0cmFuc2xhdGlvbnMpIHtcbiAgICAgICAgICAgIGlmICghbGFuZykge1xuICAgICAgICAgICAgICAgIGxhbmcgPSBnZXRMYW5nKGxvY2FsZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxvY2FsZSA9IHRoaXMuX2ZpbmRGYWxsYmFja0xvY2FsZShsb2NhbGUsIGxhbmcpO1xuICAgICAgICAgICAgdHJhbnNsYXRpb25zID0gdGhpcy5fdHJhbnNsYXRpb25zW2xvY2FsZV07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHJhbnNsYXRpb25zICYmIHRyYW5zbGF0aW9ucy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICByZXN1bHQgPSB0cmFuc2xhdGlvbnNba2V5XTtcblxuICAgICAgICAgICAgLy8gaWYgdGhpcyBpcyBhIHBsdXJhbCBrZXkgdGhlbiByZXR1cm4gdGhlIGZpcnN0IGVudHJ5IGluIHRoZSBhcnJheVxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVzdWx0KSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdFswXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gaWYgbnVsbCBvciB1bmRlZmluZWQgc3dpdGNoIGJhY2sgdG8gdGhlIGtleSAoZW1wdHkgc3RyaW5nIGlzIGFsbG93ZWQpXG4gICAgICAgICAgICBpZiAocmVzdWx0ID09PSBudWxsIHx8IHJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0ga2V5O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBwbHVyYWxpemVkIHRyYW5zbGF0aW9uIGZvciB0aGUgc3BlY2lmaWVkIGtleSwgbnVtYmVyIG4gYW5kIGxvY2FsZS4gSWYgdGhlIGxvY2FsZVxuICAgICAqIGlzIG5vdCBzcGVjaWZpZWQgaXQgd2lsbCB1c2UgdGhlIGN1cnJlbnQgbG9jYWxlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGtleSAtIFRoZSBsb2NhbGl6YXRpb24ga2V5LlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBuIC0gVGhlIG51bWJlciB1c2VkIHRvIGRldGVybWluZSB3aGljaCBwbHVyYWwgZm9ybSB0byB1c2UuIEUuZy4gRm9yIHRoZVxuICAgICAqIHBocmFzZSBcIjUgQXBwbGVzXCIgbiBlcXVhbHMgNS5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2xvY2FsZV0gLSBUaGUgZGVzaXJlZCBsb2NhbGUuXG4gICAgICogQHJldHVybnMge3N0cmluZ30gVGhlIHRyYW5zbGF0ZWQgdGV4dC4gSWYgbm8gdHJhbnNsYXRpb25zIGFyZSBmb3VuZCBhdCBhbGwgZm9yIHRoZSBsb2NhbGVcbiAgICAgKiB0aGVuIGl0IHdpbGwgcmV0dXJuIHRoZSBlbi1VUyB0cmFuc2xhdGlvbi4gSWYgbm8gdHJhbnNsYXRpb24gZXhpc3RzIGZvciB0aGF0IGtleSB0aGVuIGl0XG4gICAgICogd2lsbCByZXR1cm4gdGhlIGxvY2FsaXphdGlvbiBrZXkuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiAvLyBtYW51YWxseSByZXBsYWNlIHtudW1iZXJ9IGluIHRoZSByZXN1bHRpbmcgdHJhbnNsYXRpb24gd2l0aCBvdXIgbnVtYmVyXG4gICAgICogdmFyIGxvY2FsaXplZCA9IHRoaXMuYXBwLmkxOG4uZ2V0UGx1cmFsVGV4dCgne251bWJlcn0gYXBwbGVzJywgbnVtYmVyKS5yZXBsYWNlKFwie251bWJlcn1cIiwgbnVtYmVyKTtcbiAgICAgKi9cbiAgICBnZXRQbHVyYWxUZXh0KGtleSwgbiwgbG9jYWxlKSB7XG4gICAgICAgIC8vIGRlZmF1bHQgdHJhbnNsYXRpb24gaXMgdGhlIGtleVxuICAgICAgICBsZXQgcmVzdWx0ID0ga2V5O1xuXG4gICAgICAgIGxldCBsYW5nO1xuICAgICAgICBsZXQgcGx1cmFsRm47XG5cbiAgICAgICAgaWYgKCFsb2NhbGUpIHtcbiAgICAgICAgICAgIGxvY2FsZSA9IHRoaXMuX2xvY2FsZTtcbiAgICAgICAgICAgIGxhbmcgPSB0aGlzLl9sYW5nO1xuICAgICAgICAgICAgcGx1cmFsRm4gPSB0aGlzLl9wbHVyYWxGbjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxhbmcgPSBnZXRMYW5nKGxvY2FsZSk7XG4gICAgICAgICAgICBwbHVyYWxGbiA9IGdldFBsdXJhbEZuKGxhbmcpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRyYW5zbGF0aW9ucyA9IHRoaXMuX3RyYW5zbGF0aW9uc1tsb2NhbGVdO1xuICAgICAgICBpZiAoIXRyYW5zbGF0aW9ucykge1xuICAgICAgICAgICAgbG9jYWxlID0gdGhpcy5fZmluZEZhbGxiYWNrTG9jYWxlKGxvY2FsZSwgbGFuZyk7XG4gICAgICAgICAgICBsYW5nID0gZ2V0TGFuZyhsb2NhbGUpO1xuICAgICAgICAgICAgcGx1cmFsRm4gPSBnZXRQbHVyYWxGbihsYW5nKTtcbiAgICAgICAgICAgIHRyYW5zbGF0aW9ucyA9IHRoaXMuX3RyYW5zbGF0aW9uc1tsb2NhbGVdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRyYW5zbGF0aW9ucyAmJiB0cmFuc2xhdGlvbnNba2V5XSAmJiBwbHVyYWxGbikge1xuICAgICAgICAgICAgY29uc3QgaW5kZXggPSBwbHVyYWxGbihuKTtcbiAgICAgICAgICAgIHJlc3VsdCA9IHRyYW5zbGF0aW9uc1trZXldW2luZGV4XTtcblxuICAgICAgICAgICAgLy8gaWYgbnVsbCBvciB1bmRlZmluZWQgc3dpdGNoIGJhY2sgdG8gdGhlIGtleSAoZW1wdHkgc3RyaW5nIGlzIGFsbG93ZWQpXG4gICAgICAgICAgICBpZiAocmVzdWx0ID09PSBudWxsIHx8IHJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0ga2V5O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGRzIGxvY2FsaXphdGlvbiBkYXRhLiBJZiB0aGUgbG9jYWxlIGFuZCBrZXkgZm9yIGEgdHJhbnNsYXRpb24gYWxyZWFkeSBleGlzdHMgaXQgd2lsbCBiZVxuICAgICAqIG92ZXJ3cml0dGVuLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSBUaGUgbG9jYWxpemF0aW9uIGRhdGEuIFNlZSBleGFtcGxlIGZvciB0aGUgZXhwZWN0ZWQgZm9ybWF0IG9mIHRoZVxuICAgICAqIGRhdGEuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB0aGlzLmFwcC5pMThuLmFkZERhdGEoe1xuICAgICAqICAgICBoZWFkZXI6IHtcbiAgICAgKiAgICAgICAgIHZlcnNpb246IDFcbiAgICAgKiAgICAgfSxcbiAgICAgKiAgICAgZGF0YTogW3tcbiAgICAgKiAgICAgICAgIGluZm86IHtcbiAgICAgKiAgICAgICAgICAgICBsb2NhbGU6ICdlbi1VUydcbiAgICAgKiAgICAgICAgIH0sXG4gICAgICogICAgICAgICBtZXNzYWdlczoge1xuICAgICAqICAgICAgICAgICAgIFwia2V5XCI6IFwidHJhbnNsYXRpb25cIixcbiAgICAgKiAgICAgICAgICAgICAvLyBUaGUgbnVtYmVyIG9mIHBsdXJhbCBmb3JtcyBkZXBlbmRzIG9uIHRoZSBsb2NhbGUuIFNlZSB0aGUgbWFudWFsIGZvciBtb3JlIGluZm9ybWF0aW9uLlxuICAgICAqICAgICAgICAgICAgIFwicGx1cmFsX2tleVwiOiBbXCJvbmUgaXRlbVwiLCBcIm1vcmUgdGhhbiBvbmUgaXRlbXNcIl1cbiAgICAgKiAgICAgICAgIH1cbiAgICAgKiAgICAgfSwge1xuICAgICAqICAgICAgICAgaW5mbzoge1xuICAgICAqICAgICAgICAgICAgIGxvY2FsZTogJ2ZyLUZSJ1xuICAgICAqICAgICAgICAgfSxcbiAgICAgKiAgICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICogICAgICAgICAgICAgLy8gLi4uXG4gICAgICogICAgICAgICB9XG4gICAgICogICAgIH1dXG4gICAgICogfSk7XG4gICAgICovXG4gICAgYWRkRGF0YShkYXRhKSB7XG4gICAgICAgIGxldCBwYXJzZWQ7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBwYXJzZWQgPSB0aGlzLl9wYXJzZXIucGFyc2UoZGF0YSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHBhcnNlZC5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgY29uc3QgZW50cnkgPSBwYXJzZWRbaV07XG4gICAgICAgICAgICBjb25zdCBsb2NhbGUgPSBlbnRyeS5pbmZvLmxvY2FsZTtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gZW50cnkubWVzc2FnZXM7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX3RyYW5zbGF0aW9uc1tsb2NhbGVdKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdHJhbnNsYXRpb25zW2xvY2FsZV0gPSB7fTtcbiAgICAgICAgICAgICAgICBjb25zdCBsYW5nID0gZ2V0TGFuZyhsb2NhbGUpO1xuXG4gICAgICAgICAgICAgICAgLy8gcmVtZW1iZXIgdGhlIGZpcnN0IGxvY2FsZSB3ZSd2ZSBmb3VuZCBmb3IgdGhhdCBsYW5ndWFnZVxuICAgICAgICAgICAgICAgIC8vIGluIGNhc2Ugd2UgbmVlZCB0byBmYWxsIGJhY2sgdG8gaXRcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2F2YWlsYWJsZUxhbmdzW2xhbmddKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2F2YWlsYWJsZUxhbmdzW2xhbmddID0gbG9jYWxlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLl90cmFuc2xhdGlvbnNbbG9jYWxlXSwgbWVzc2FnZXMpO1xuXG4gICAgICAgICAgICB0aGlzLmZpcmUoJ2RhdGE6YWRkJywgbG9jYWxlLCBtZXNzYWdlcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGxvY2FsaXphdGlvbiBkYXRhLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSBUaGUgbG9jYWxpemF0aW9uIGRhdGEuIFRoZSBkYXRhIGlzIGV4cGVjdGVkIHRvIGJlIGluIHRoZSBzYW1lIGZvcm1hdFxuICAgICAqIGFzIHtAbGluayBJMThuI2FkZERhdGF9LlxuICAgICAqL1xuICAgIHJlbW92ZURhdGEoZGF0YSkge1xuICAgICAgICBsZXQgcGFyc2VkO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcGFyc2VkID0gdGhpcy5fcGFyc2VyLnBhcnNlKGRhdGEpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwYXJzZWQubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGVudHJ5ID0gcGFyc2VkW2ldO1xuICAgICAgICAgICAgY29uc3QgbG9jYWxlID0gZW50cnkuaW5mby5sb2NhbGU7XG4gICAgICAgICAgICBjb25zdCB0cmFuc2xhdGlvbnMgPSB0aGlzLl90cmFuc2xhdGlvbnNbbG9jYWxlXTtcbiAgICAgICAgICAgIGlmICghdHJhbnNsYXRpb25zKSBjb250aW51ZTtcblxuICAgICAgICAgICAgY29uc3QgbWVzc2FnZXMgPSBlbnRyeS5tZXNzYWdlcztcbiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIG1lc3NhZ2VzKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRyYW5zbGF0aW9uc1trZXldO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBpZiBubyBtb3JlIGVudHJpZXMgZm9yIHRoYXQgbG9jYWxlIHRoZW5cbiAgICAgICAgICAgIC8vIGRlbGV0ZSB0aGUgbG9jYWxlXG4gICAgICAgICAgICBpZiAoT2JqZWN0LmtleXModHJhbnNsYXRpb25zKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fdHJhbnNsYXRpb25zW2xvY2FsZV07XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2F2YWlsYWJsZUxhbmdzW2dldExhbmcobG9jYWxlKV07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZmlyZSgnZGF0YTpyZW1vdmUnLCBsb2NhbGUsIG1lc3NhZ2VzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZyZWVzIHVwIG1lbW9yeS5cbiAgICAgKi9cbiAgICBkZXN0cm95KCkge1xuICAgICAgICB0aGlzLl90cmFuc2xhdGlvbnMgPSBudWxsO1xuICAgICAgICB0aGlzLl9hdmFpbGFibGVMYW5ncyA9IG51bGw7XG4gICAgICAgIHRoaXMuX2Fzc2V0cyA9IG51bGw7XG4gICAgICAgIHRoaXMuX3BhcnNlciA9IG51bGw7XG4gICAgICAgIHRoaXMub2ZmKCk7XG4gICAgfVxuXG4gICAgLy8gRmluZHMgYSBmYWxsYmFjayBsb2NhbGUgZm9yIHRoZSBzcGVjaWZpZWQgbG9jYWxlIGFuZCBsYW5ndWFnZS5cbiAgICAvLyAxKSBGaXJzdCB0cmllcyBERUZBVUxUX0xPQ0FMRV9GQUxMQkFDS1NcbiAgICAvLyAyKSBJZiBubyB0cmFuc2xhdGlvbiBleGlzdHMgZm9yIHRoYXQgbG9jYWxlIHJldHVybiB0aGUgZmlyc3QgbG9jYWxlIGF2YWlsYWJsZSBmb3IgdGhhdCBsYW5ndWFnZS5cbiAgICAvLyAzKSBJZiBubyB0cmFuc2xhdGlvbiBleGlzdHMgZm9yIHRoYXQgZWl0aGVyIHRoZW4gcmV0dXJuIHRoZSBERUZBVUxUX0xPQ0FMRVxuICAgIF9maW5kRmFsbGJhY2tMb2NhbGUobG9jYWxlLCBsYW5nKSB7XG4gICAgICAgIGxldCByZXN1bHQgPSBERUZBVUxUX0xPQ0FMRV9GQUxMQkFDS1NbbG9jYWxlXTtcbiAgICAgICAgaWYgKHJlc3VsdCAmJiB0aGlzLl90cmFuc2xhdGlvbnNbcmVzdWx0XSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlc3VsdCA9IERFRkFVTFRfTE9DQUxFX0ZBTExCQUNLU1tsYW5nXTtcbiAgICAgICAgaWYgKHJlc3VsdCAmJiB0aGlzLl90cmFuc2xhdGlvbnNbcmVzdWx0XSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlc3VsdCA9IHRoaXMuX2F2YWlsYWJsZUxhbmdzW2xhbmddO1xuICAgICAgICBpZiAocmVzdWx0ICYmIHRoaXMuX3RyYW5zbGF0aW9uc1tyZXN1bHRdKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIERFRkFVTFRfTE9DQUxFO1xuICAgIH1cblxuICAgIF9vbkFzc2V0QWRkKGFzc2V0KSB7XG4gICAgICAgIGFzc2V0Lm9uKCdsb2FkJywgdGhpcy5fb25Bc3NldExvYWQsIHRoaXMpO1xuICAgICAgICBhc3NldC5vbignY2hhbmdlJywgdGhpcy5fb25Bc3NldENoYW5nZSwgdGhpcyk7XG4gICAgICAgIGFzc2V0Lm9uKCdyZW1vdmUnLCB0aGlzLl9vbkFzc2V0UmVtb3ZlLCB0aGlzKTtcbiAgICAgICAgYXNzZXQub24oJ3VubG9hZCcsIHRoaXMuX29uQXNzZXRVbmxvYWQsIHRoaXMpO1xuXG4gICAgICAgIGlmIChhc3NldC5yZXNvdXJjZSkge1xuICAgICAgICAgICAgdGhpcy5fb25Bc3NldExvYWQoYXNzZXQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX29uQXNzZXRMb2FkKGFzc2V0KSB7XG4gICAgICAgIHRoaXMuYWRkRGF0YShhc3NldC5yZXNvdXJjZSk7XG4gICAgfVxuXG4gICAgX29uQXNzZXRDaGFuZ2UoYXNzZXQpIHtcbiAgICAgICAgaWYgKGFzc2V0LnJlc291cmNlKSB7XG4gICAgICAgICAgICB0aGlzLmFkZERhdGEoYXNzZXQucmVzb3VyY2UpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX29uQXNzZXRSZW1vdmUoYXNzZXQpIHtcbiAgICAgICAgYXNzZXQub2ZmKCdsb2FkJywgdGhpcy5fb25Bc3NldExvYWQsIHRoaXMpO1xuICAgICAgICBhc3NldC5vZmYoJ2NoYW5nZScsIHRoaXMuX29uQXNzZXRDaGFuZ2UsIHRoaXMpO1xuICAgICAgICBhc3NldC5vZmYoJ3JlbW92ZScsIHRoaXMuX29uQXNzZXRSZW1vdmUsIHRoaXMpO1xuICAgICAgICBhc3NldC5vZmYoJ3VubG9hZCcsIHRoaXMuX29uQXNzZXRVbmxvYWQsIHRoaXMpO1xuXG4gICAgICAgIGlmIChhc3NldC5yZXNvdXJjZSkge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVEYXRhKGFzc2V0LnJlc291cmNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2FwcC5hc3NldHMub25jZSgnYWRkOicgKyBhc3NldC5pZCwgdGhpcy5fb25Bc3NldEFkZCwgdGhpcyk7XG4gICAgfVxuXG4gICAgX29uQXNzZXRVbmxvYWQoYXNzZXQpIHtcbiAgICAgICAgaWYgKGFzc2V0LnJlc291cmNlKSB7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZURhdGEoYXNzZXQucmVzb3VyY2UpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgeyBJMThuIH07XG4iXSwibmFtZXMiOlsiSTE4biIsIkV2ZW50SGFuZGxlciIsImNvbnN0cnVjdG9yIiwiYXBwIiwibG9jYWxlIiwiREVGQVVMVF9MT0NBTEUiLCJfdHJhbnNsYXRpb25zIiwiX2F2YWlsYWJsZUxhbmdzIiwiX2FwcCIsIl9hc3NldHMiLCJfcGFyc2VyIiwiSTE4blBhcnNlciIsImFzc2V0cyIsInZhbHVlIiwiaW5kZXgiLCJpIiwibGVuIiwibGVuZ3RoIiwiaWQiLCJBc3NldCIsIm9mZiIsIl9vbkFzc2V0QWRkIiwiYXNzZXQiLCJnZXQiLCJfb25Bc3NldFJlbW92ZSIsInNwbGljZSIsImlkTnVtIiwicGFyc2VJbnQiLCJpbmRleE9mIiwicHVzaCIsIm9uY2UiLCJfbG9jYWxlIiwibGFuZyIsImdldExhbmciLCJyZXBsYWNlTGFuZyIsIm9sZCIsIl9sYW5nIiwiX3BsdXJhbEZuIiwiZ2V0UGx1cmFsRm4iLCJmaXJlIiwiZmluZEF2YWlsYWJsZUxvY2FsZSIsImRlc2lyZWRMb2NhbGUiLCJhdmFpbGFibGVMb2NhbGVzIiwiX2ZpbmRGYWxsYmFja0xvY2FsZSIsImdldFRleHQiLCJrZXkiLCJyZXN1bHQiLCJ0cmFuc2xhdGlvbnMiLCJoYXNPd25Qcm9wZXJ0eSIsIkFycmF5IiwiaXNBcnJheSIsInVuZGVmaW5lZCIsImdldFBsdXJhbFRleHQiLCJuIiwicGx1cmFsRm4iLCJhZGREYXRhIiwiZGF0YSIsInBhcnNlZCIsInBhcnNlIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiZW50cnkiLCJpbmZvIiwibWVzc2FnZXMiLCJPYmplY3QiLCJhc3NpZ24iLCJyZW1vdmVEYXRhIiwia2V5cyIsImRlc3Ryb3kiLCJERUZBVUxUX0xPQ0FMRV9GQUxMQkFDS1MiLCJvbiIsIl9vbkFzc2V0TG9hZCIsIl9vbkFz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
