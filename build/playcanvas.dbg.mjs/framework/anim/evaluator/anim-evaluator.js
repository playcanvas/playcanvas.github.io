/**
 * @license
 * PlayCanvas Engine v1.62.0 revision 818511d2b (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { AnimTargetValue } from './anim-target-value.js';
import { AnimBlend } from './anim-blend.js';

/**
 * AnimEvaluator blends multiple sets of animation clips together.
 *
 * @ignore
 */
class AnimEvaluator {
  /**
   * Create a new animation evaluator.
   *
   * @param {import('../binder/anim-binder.js').AnimBinder} binder - interface resolves curve
   * paths to instances of {@link AnimTarget}.
   */
  constructor(binder) {
    this._binder = binder;
    this._clips = [];
    this._inputs = [];
    this._outputs = [];
    this._targets = {};
  }

  /**
   * The list of animation clips.
   *
   * @type {import('./anim-clip.js').AnimClip[]}
   */
  get clips() {
    return this._clips;
  }

  /**
   * Add a clip to the evaluator.
   *
   * @param {import('./anim-clip.js').AnimClip} clip - The clip to add to the evaluator.
   */
  addClip(clip) {
    const targets = this._targets;
    const binder = this._binder;

    // store list of input/output arrays
    const curves = clip.track.curves;
    const snapshot = clip.snapshot;
    const inputs = [];
    const outputs = [];
    for (let i = 0; i < curves.length; ++i) {
      const curve = curves[i];
      const paths = curve.paths;
      for (let j = 0; j < paths.length; ++j) {
        const path = paths[j];
        const resolved = binder.resolve(path);
        let target = targets[resolved && resolved.targetPath || null];

        // create new target if it doesn't exist yet
        if (!target && resolved) {
          target = {
            target: resolved,
            // resolved target instance
            value: [],
            // storage for calculated value
            curves: 0,
            // number of curves driving this target
            blendCounter: 0 // per-frame number of blends (used to identify first blend)
          };

          for (let k = 0; k < target.target.components; ++k) {
            target.value.push(0);
          }
          targets[resolved.targetPath] = target;
          if (binder.animComponent) {
            if (!binder.animComponent.targets[resolved.targetPath]) {
              let type;
              if (resolved.targetPath.substring(resolved.targetPath.length - 13) === 'localRotation') {
                type = AnimTargetValue.TYPE_QUAT;
              } else {
                type = AnimTargetValue.TYPE_VEC3;
              }
              binder.animComponent.targets[resolved.targetPath] = new AnimTargetValue(binder.animComponent, type);
            }
            binder.animComponent.targets[resolved.targetPath].layerCounter++;
            binder.animComponent.targets[resolved.targetPath].setMask(binder.layerIndex, 1);
          }
        }

        // binding may have failed
        // TODO: it may be worth storing quaternions and vector targets in separate
        // lists. this way the update code won't be forced to check target type before
        // setting/blending each target.
        if (target) {
          target.curves++;
          inputs.push(snapshot._results[i]);
          outputs.push(target);
        }
      }
    }
    this._clips.push(clip);
    this._inputs.push(inputs);
    this._outputs.push(outputs);
  }

  /**
   * Remove a clip from the evaluator.
   *
   * @param {number} index - Index of the clip to remove.
   */
  removeClip(index) {
    const targets = this._targets;
    const binder = this._binder;
    const clips = this._clips;
    const clip = clips[index];
    const curves = clip.track.curves;
    for (let i = 0; i < curves.length; ++i) {
      const curve = curves[i];
      const paths = curve.paths;
      for (let j = 0; j < paths.length; ++j) {
        const path = paths[j];
        const target = this._binder.resolve(path);
        if (target) {
          target.curves--;
          if (target.curves === 0) {
            binder.unresolve(path);
            delete targets[target.targetPath];
            if (binder.animComponent) {
              binder.animComponent.targets[target.targetPath].layerCounter--;
            }
          }
        }
      }
    }
    clips.splice(index, 1);
    this._inputs.splice(index, 1);
    this._outputs.splice(index, 1);
  }

  /**
   * Remove all clips from the evaluator.
   */
  removeClips() {
    while (this._clips.length > 0) {
      this.removeClip(0);
    }
  }
  updateClipTrack(name, animTrack) {
    this._clips.forEach(clip => {
      if (clip.name.includes(name)) {
        clip.track = animTrack;
      }
    });
    this.rebind();
  }

  /**
   * Returns the first clip which matches the given name, or null if no such clip was found.
   *
   * @param {string} name - Name of the clip to find.
   * @returns {import('./anim-clip.js').AnimClip|null} - The clip with the given name or null if no such clip was found.
   */
  findClip(name) {
    const clips = this._clips;
    for (let i = 0; i < clips.length; ++i) {
      const clip = clips[i];
      if (clip.name === name) {
        return clip;
      }
    }
    return null;
  }
  rebind() {
    this._binder.rebind();
    this._targets = {};
    const clips = [...this.clips];
    this.removeClips();
    clips.forEach(clip => {
      this.addClip(clip);
    });
  }
  assignMask(mask) {
    return this._binder.assignMask(mask);
  }

  /**
   * Evaluator frame update function. All the attached {@link AnimClip}s are evaluated, blended
   * and the results set on the {@link AnimTarget}.
   *
   * @param {number} deltaTime - The amount of time that has passed since the last update, in
   * seconds.
   * @param {number} outputAnimation - Whether the evaluator should output the results of the update to the bound animation targets.
   */
  update(deltaTime, outputAnimation = true) {
    // copy clips
    const clips = this._clips;

    // stable sort order
    const order = clips.map(function (c, i) {
      return i;
    });
    AnimBlend.stableSort(order, function (a, b) {
      return clips[a].blendOrder < clips[b].blendOrder;
    });
    for (let i = 0; i < order.length; ++i) {
      const index = order[i];
      const clip = clips[index];
      const inputs = this._inputs[index];
      const outputs = this._outputs[index];
      const blendWeight = clip.blendWeight;

      // update clip
      if (blendWeight > 0.0) {
        clip._update(deltaTime);
      }
      if (!outputAnimation) break;
      let input;
      let output;
      let value;
      if (blendWeight >= 1.0) {
        for (let j = 0; j < inputs.length; ++j) {
          input = inputs[j];
          output = outputs[j];
          value = output.value;
          AnimBlend.set(value, input, output.target.type);
          output.blendCounter++;
        }
      } else if (blendWeight > 0.0) {
        for (let j = 0; j < inputs.length; ++j) {
          input = inputs[j];
          output = outputs[j];
          value = output.value;
          if (output.blendCounter === 0) {
            AnimBlend.set(value, input, output.target.type);
          } else {
            AnimBlend.blend(value, input, blendWeight, output.target.type);
          }
          output.blendCounter++;
        }
      }
    }

    // apply result to anim targets
    const targets = this._targets;
    const binder = this._binder;
    for (const path in targets) {
      if (targets.hasOwnProperty(path)) {
        const target = targets[path];
        // if this evaluator is associated with an anim component then we should blend the result of this evaluator with all other anim layer's evaluators
        if (binder.animComponent && target.target.isTransform) {
          const animTarget = binder.animComponent.targets[path];
          if (animTarget.counter === animTarget.layerCounter) {
            animTarget.counter = 0;
          }
          if (!animTarget.path) {
            animTarget.path = path;
            animTarget.baseValue = target.target.get();
            animTarget.setter = target.target.set;
          }
          // Add this layer's value onto the target value
          animTarget.updateValue(binder.layerIndex, target.value);
          animTarget.counter++;
        } else {
          target.target.set(target.value);
        }
        target.blendCounter = 0;
      }
    }
    // give the binder an opportunity to update itself
    // TODO: is this even necessary? binder could know when to update
    // itself without our help.
    this._binder.update(deltaTime);
  }
}

export { AnimEvaluator };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5pbS1ldmFsdWF0b3IuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9mcmFtZXdvcmsvYW5pbS9ldmFsdWF0b3IvYW5pbS1ldmFsdWF0b3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQW5pbVRhcmdldFZhbHVlIH0gZnJvbSAnLi9hbmltLXRhcmdldC12YWx1ZS5qcyc7XG5pbXBvcnQgeyBBbmltQmxlbmQgfSBmcm9tICcuL2FuaW0tYmxlbmQuanMnO1xuXG4vKipcbiAqIEFuaW1FdmFsdWF0b3IgYmxlbmRzIG11bHRpcGxlIHNldHMgb2YgYW5pbWF0aW9uIGNsaXBzIHRvZ2V0aGVyLlxuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgQW5pbUV2YWx1YXRvciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IGFuaW1hdGlvbiBldmFsdWF0b3IuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vYmluZGVyL2FuaW0tYmluZGVyLmpzJykuQW5pbUJpbmRlcn0gYmluZGVyIC0gaW50ZXJmYWNlIHJlc29sdmVzIGN1cnZlXG4gICAgICogcGF0aHMgdG8gaW5zdGFuY2VzIG9mIHtAbGluayBBbmltVGFyZ2V0fS5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihiaW5kZXIpIHtcbiAgICAgICAgdGhpcy5fYmluZGVyID0gYmluZGVyO1xuICAgICAgICB0aGlzLl9jbGlwcyA9IFtdO1xuICAgICAgICB0aGlzLl9pbnB1dHMgPSBbXTtcbiAgICAgICAgdGhpcy5fb3V0cHV0cyA9IFtdO1xuICAgICAgICB0aGlzLl90YXJnZXRzID0ge307XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGxpc3Qgb2YgYW5pbWF0aW9uIGNsaXBzLlxuICAgICAqXG4gICAgICogQHR5cGUge2ltcG9ydCgnLi9hbmltLWNsaXAuanMnKS5BbmltQ2xpcFtdfVxuICAgICAqL1xuICAgIGdldCBjbGlwcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NsaXBzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZCBhIGNsaXAgdG8gdGhlIGV2YWx1YXRvci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuL2FuaW0tY2xpcC5qcycpLkFuaW1DbGlwfSBjbGlwIC0gVGhlIGNsaXAgdG8gYWRkIHRvIHRoZSBldmFsdWF0b3IuXG4gICAgICovXG4gICAgYWRkQ2xpcChjbGlwKSB7XG4gICAgICAgIGNvbnN0IHRhcmdldHMgPSB0aGlzLl90YXJnZXRzO1xuICAgICAgICBjb25zdCBiaW5kZXIgPSB0aGlzLl9iaW5kZXI7XG5cbiAgICAgICAgLy8gc3RvcmUgbGlzdCBvZiBpbnB1dC9vdXRwdXQgYXJyYXlzXG4gICAgICAgIGNvbnN0IGN1cnZlcyA9IGNsaXAudHJhY2suY3VydmVzO1xuICAgICAgICBjb25zdCBzbmFwc2hvdCA9IGNsaXAuc25hcHNob3Q7XG4gICAgICAgIGNvbnN0IGlucHV0cyA9IFtdO1xuICAgICAgICBjb25zdCBvdXRwdXRzID0gW107XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY3VydmVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBjb25zdCBjdXJ2ZSA9IGN1cnZlc1tpXTtcbiAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gY3VydmUucGF0aHM7XG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHBhdGhzLmxlbmd0aDsgKytqKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGF0aCA9IHBhdGhzW2pdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc29sdmVkID0gYmluZGVyLnJlc29sdmUocGF0aCk7XG4gICAgICAgICAgICAgICAgbGV0IHRhcmdldCA9IHRhcmdldHNbcmVzb2x2ZWQgJiYgcmVzb2x2ZWQudGFyZ2V0UGF0aCB8fCBudWxsXTtcblxuICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBuZXcgdGFyZ2V0IGlmIGl0IGRvZXNuJ3QgZXhpc3QgeWV0XG4gICAgICAgICAgICAgICAgaWYgKCF0YXJnZXQgJiYgcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiByZXNvbHZlZCwgICAgICAgICAgIC8vIHJlc29sdmVkIHRhcmdldCBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFtdLCAgICAgICAgICAgICAgICAgIC8vIHN0b3JhZ2UgZm9yIGNhbGN1bGF0ZWQgdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnZlczogMCwgICAgICAgICAgICAgICAgICAvLyBudW1iZXIgb2YgY3VydmVzIGRyaXZpbmcgdGhpcyB0YXJnZXRcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsZW5kQ291bnRlcjogMCAgICAgICAgICAgICAvLyBwZXItZnJhbWUgbnVtYmVyIG9mIGJsZW5kcyAodXNlZCB0byBpZGVudGlmeSBmaXJzdCBibGVuZClcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IHRhcmdldC50YXJnZXQuY29tcG9uZW50czsgKytrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQudmFsdWUucHVzaCgwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldHNbcmVzb2x2ZWQudGFyZ2V0UGF0aF0gPSB0YXJnZXQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChiaW5kZXIuYW5pbUNvbXBvbmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFiaW5kZXIuYW5pbUNvbXBvbmVudC50YXJnZXRzW3Jlc29sdmVkLnRhcmdldFBhdGhdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHR5cGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc29sdmVkLnRhcmdldFBhdGguc3Vic3RyaW5nKHJlc29sdmVkLnRhcmdldFBhdGgubGVuZ3RoIC0gMTMpID09PSAnbG9jYWxSb3RhdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9IEFuaW1UYXJnZXRWYWx1ZS5UWVBFX1FVQVQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9IEFuaW1UYXJnZXRWYWx1ZS5UWVBFX1ZFQzM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRlci5hbmltQ29tcG9uZW50LnRhcmdldHNbcmVzb2x2ZWQudGFyZ2V0UGF0aF0gPSBuZXcgQW5pbVRhcmdldFZhbHVlKGJpbmRlci5hbmltQ29tcG9uZW50LCB0eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRlci5hbmltQ29tcG9uZW50LnRhcmdldHNbcmVzb2x2ZWQudGFyZ2V0UGF0aF0ubGF5ZXJDb3VudGVyKys7XG4gICAgICAgICAgICAgICAgICAgICAgICBiaW5kZXIuYW5pbUNvbXBvbmVudC50YXJnZXRzW3Jlc29sdmVkLnRhcmdldFBhdGhdLnNldE1hc2soYmluZGVyLmxheWVySW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gYmluZGluZyBtYXkgaGF2ZSBmYWlsZWRcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBpdCBtYXkgYmUgd29ydGggc3RvcmluZyBxdWF0ZXJuaW9ucyBhbmQgdmVjdG9yIHRhcmdldHMgaW4gc2VwYXJhdGVcbiAgICAgICAgICAgICAgICAvLyBsaXN0cy4gdGhpcyB3YXkgdGhlIHVwZGF0ZSBjb2RlIHdvbid0IGJlIGZvcmNlZCB0byBjaGVjayB0YXJnZXQgdHlwZSBiZWZvcmVcbiAgICAgICAgICAgICAgICAvLyBzZXR0aW5nL2JsZW5kaW5nIGVhY2ggdGFyZ2V0LlxuICAgICAgICAgICAgICAgIGlmICh0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmN1cnZlcysrO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dHMucHVzaChzbmFwc2hvdC5fcmVzdWx0c1tpXSk7XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dHMucHVzaCh0YXJnZXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2NsaXBzLnB1c2goY2xpcCk7XG4gICAgICAgIHRoaXMuX2lucHV0cy5wdXNoKGlucHV0cyk7XG4gICAgICAgIHRoaXMuX291dHB1dHMucHVzaChvdXRwdXRzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgYSBjbGlwIGZyb20gdGhlIGV2YWx1YXRvci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIEluZGV4IG9mIHRoZSBjbGlwIHRvIHJlbW92ZS5cbiAgICAgKi9cbiAgICByZW1vdmVDbGlwKGluZGV4KSB7XG4gICAgICAgIGNvbnN0IHRhcmdldHMgPSB0aGlzLl90YXJnZXRzO1xuICAgICAgICBjb25zdCBiaW5kZXIgPSB0aGlzLl9iaW5kZXI7XG5cbiAgICAgICAgY29uc3QgY2xpcHMgPSB0aGlzLl9jbGlwcztcbiAgICAgICAgY29uc3QgY2xpcCA9IGNsaXBzW2luZGV4XTtcbiAgICAgICAgY29uc3QgY3VydmVzID0gY2xpcC50cmFjay5jdXJ2ZXM7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjdXJ2ZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGNvbnN0IGN1cnZlID0gY3VydmVzW2ldO1xuICAgICAgICAgICAgY29uc3QgcGF0aHMgPSBjdXJ2ZS5wYXRocztcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgcGF0aHMubGVuZ3RoOyArK2opIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwYXRoID0gcGF0aHNbal07XG5cbiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLl9iaW5kZXIucmVzb2x2ZShwYXRoKTtcblxuICAgICAgICAgICAgICAgIGlmICh0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmN1cnZlcy0tO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LmN1cnZlcyA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYmluZGVyLnVucmVzb2x2ZShwYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0YXJnZXRzW3RhcmdldC50YXJnZXRQYXRoXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiaW5kZXIuYW5pbUNvbXBvbmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRlci5hbmltQ29tcG9uZW50LnRhcmdldHNbdGFyZ2V0LnRhcmdldFBhdGhdLmxheWVyQ291bnRlci0tO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY2xpcHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgdGhpcy5faW5wdXRzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIHRoaXMuX291dHB1dHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgYWxsIGNsaXBzIGZyb20gdGhlIGV2YWx1YXRvci5cbiAgICAgKi9cbiAgICByZW1vdmVDbGlwcygpIHtcbiAgICAgICAgd2hpbGUgKHRoaXMuX2NsaXBzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2xpcCgwKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHVwZGF0ZUNsaXBUcmFjayhuYW1lLCBhbmltVHJhY2spIHtcbiAgICAgICAgdGhpcy5fY2xpcHMuZm9yRWFjaCgoY2xpcCkgPT4ge1xuICAgICAgICAgICAgaWYgKGNsaXAubmFtZS5pbmNsdWRlcyhuYW1lKSkge1xuICAgICAgICAgICAgICAgIGNsaXAudHJhY2sgPSBhbmltVHJhY2s7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlYmluZCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIGZpcnN0IGNsaXAgd2hpY2ggbWF0Y2hlcyB0aGUgZ2l2ZW4gbmFtZSwgb3IgbnVsbCBpZiBubyBzdWNoIGNsaXAgd2FzIGZvdW5kLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBOYW1lIG9mIHRoZSBjbGlwIHRvIGZpbmQuXG4gICAgICogQHJldHVybnMge2ltcG9ydCgnLi9hbmltLWNsaXAuanMnKS5BbmltQ2xpcHxudWxsfSAtIFRoZSBjbGlwIHdpdGggdGhlIGdpdmVuIG5hbWUgb3IgbnVsbCBpZiBubyBzdWNoIGNsaXAgd2FzIGZvdW5kLlxuICAgICAqL1xuICAgIGZpbmRDbGlwKG5hbWUpIHtcbiAgICAgICAgY29uc3QgY2xpcHMgPSB0aGlzLl9jbGlwcztcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjbGlwcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgY29uc3QgY2xpcCA9IGNsaXBzW2ldO1xuICAgICAgICAgICAgaWYgKGNsaXAubmFtZSA9PT0gbmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjbGlwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJlYmluZCgpIHtcbiAgICAgICAgdGhpcy5fYmluZGVyLnJlYmluZCgpO1xuICAgICAgICB0aGlzLl90YXJnZXRzID0ge307XG4gICAgICAgIGNvbnN0IGNsaXBzID0gWy4uLnRoaXMuY2xpcHNdO1xuICAgICAgICB0aGlzLnJlbW92ZUNsaXBzKCk7XG4gICAgICAgIGNsaXBzLmZvckVhY2goKGNsaXApID0+IHtcbiAgICAgICAgICAgIHRoaXMuYWRkQ2xpcChjbGlwKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXNzaWduTWFzayhtYXNrKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9iaW5kZXIuYXNzaWduTWFzayhtYXNrKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFdmFsdWF0b3IgZnJhbWUgdXBkYXRlIGZ1bmN0aW9uLiBBbGwgdGhlIGF0dGFjaGVkIHtAbGluayBBbmltQ2xpcH1zIGFyZSBldmFsdWF0ZWQsIGJsZW5kZWRcbiAgICAgKiBhbmQgdGhlIHJlc3VsdHMgc2V0IG9uIHRoZSB7QGxpbmsgQW5pbVRhcmdldH0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gZGVsdGFUaW1lIC0gVGhlIGFtb3VudCBvZiB0aW1lIHRoYXQgaGFzIHBhc3NlZCBzaW5jZSB0aGUgbGFzdCB1cGRhdGUsIGluXG4gICAgICogc2Vjb25kcy5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gb3V0cHV0QW5pbWF0aW9uIC0gV2hldGhlciB0aGUgZXZhbHVhdG9yIHNob3VsZCBvdXRwdXQgdGhlIHJlc3VsdHMgb2YgdGhlIHVwZGF0ZSB0byB0aGUgYm91bmQgYW5pbWF0aW9uIHRhcmdldHMuXG4gICAgICovXG4gICAgdXBkYXRlKGRlbHRhVGltZSwgb3V0cHV0QW5pbWF0aW9uID0gdHJ1ZSkge1xuICAgICAgICAvLyBjb3B5IGNsaXBzXG4gICAgICAgIGNvbnN0IGNsaXBzID0gdGhpcy5fY2xpcHM7XG5cbiAgICAgICAgLy8gc3RhYmxlIHNvcnQgb3JkZXJcbiAgICAgICAgY29uc3Qgb3JkZXIgPSBjbGlwcy5tYXAoZnVuY3Rpb24gKGMsIGkpIHtcbiAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICB9KTtcbiAgICAgICAgQW5pbUJsZW5kLnN0YWJsZVNvcnQob3JkZXIsIGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gY2xpcHNbYV0uYmxlbmRPcmRlciA8IGNsaXBzW2JdLmJsZW5kT3JkZXI7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3JkZXIubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gb3JkZXJbaV07XG4gICAgICAgICAgICBjb25zdCBjbGlwID0gY2xpcHNbaW5kZXhdO1xuICAgICAgICAgICAgY29uc3QgaW5wdXRzID0gdGhpcy5faW5wdXRzW2luZGV4XTtcbiAgICAgICAgICAgIGNvbnN0IG91dHB1dHMgPSB0aGlzLl9vdXRwdXRzW2luZGV4XTtcbiAgICAgICAgICAgIGNvbnN0IGJsZW5kV2VpZ2h0ID0gY2xpcC5ibGVuZFdlaWdodDtcblxuICAgICAgICAgICAgLy8gdXBkYXRlIGNsaXBcbiAgICAgICAgICAgIGlmIChibGVuZFdlaWdodCA+IDAuMCkge1xuICAgICAgICAgICAgICAgIGNsaXAuX3VwZGF0ZShkZWx0YVRpbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFvdXRwdXRBbmltYXRpb24pIGJyZWFrO1xuXG4gICAgICAgICAgICBsZXQgaW5wdXQ7XG4gICAgICAgICAgICBsZXQgb3V0cHV0O1xuICAgICAgICAgICAgbGV0IHZhbHVlO1xuXG4gICAgICAgICAgICBpZiAoYmxlbmRXZWlnaHQgPj0gMS4wKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBpbnB1dHMubGVuZ3RoOyArK2opIHtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSBpbnB1dHNbal07XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IG91dHB1dHNbal07XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gb3V0cHV0LnZhbHVlO1xuXG4gICAgICAgICAgICAgICAgICAgIEFuaW1CbGVuZC5zZXQodmFsdWUsIGlucHV0LCBvdXRwdXQudGFyZ2V0LnR5cGUpO1xuXG4gICAgICAgICAgICAgICAgICAgIG91dHB1dC5ibGVuZENvdW50ZXIrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGJsZW5kV2VpZ2h0ID4gMC4wKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBpbnB1dHMubGVuZ3RoOyArK2opIHtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSBpbnB1dHNbal07XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IG91dHB1dHNbal07XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gb3V0cHV0LnZhbHVlO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChvdXRwdXQuYmxlbmRDb3VudGVyID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBBbmltQmxlbmQuc2V0KHZhbHVlLCBpbnB1dCwgb3V0cHV0LnRhcmdldC50eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEFuaW1CbGVuZC5ibGVuZCh2YWx1ZSwgaW5wdXQsIGJsZW5kV2VpZ2h0LCBvdXRwdXQudGFyZ2V0LnR5cGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0LmJsZW5kQ291bnRlcisrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFwcGx5IHJlc3VsdCB0byBhbmltIHRhcmdldHNcbiAgICAgICAgY29uc3QgdGFyZ2V0cyA9IHRoaXMuX3RhcmdldHM7XG4gICAgICAgIGNvbnN0IGJpbmRlciA9IHRoaXMuX2JpbmRlcjtcbiAgICAgICAgZm9yIChjb25zdCBwYXRoIGluIHRhcmdldHMpIHtcbiAgICAgICAgICAgIGlmICh0YXJnZXRzLmhhc093blByb3BlcnR5KHBhdGgpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gdGFyZ2V0c1twYXRoXTtcbiAgICAgICAgICAgICAgICAvLyBpZiB0aGlzIGV2YWx1YXRvciBpcyBhc3NvY2lhdGVkIHdpdGggYW4gYW5pbSBjb21wb25lbnQgdGhlbiB3ZSBzaG91bGQgYmxlbmQgdGhlIHJlc3VsdCBvZiB0aGlzIGV2YWx1YXRvciB3aXRoIGFsbCBvdGhlciBhbmltIGxheWVyJ3MgZXZhbHVhdG9yc1xuICAgICAgICAgICAgICAgIGlmIChiaW5kZXIuYW5pbUNvbXBvbmVudCAmJiB0YXJnZXQudGFyZ2V0LmlzVHJhbnNmb3JtKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFuaW1UYXJnZXQgPSBiaW5kZXIuYW5pbUNvbXBvbmVudC50YXJnZXRzW3BhdGhdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYW5pbVRhcmdldC5jb3VudGVyID09PSBhbmltVGFyZ2V0LmxheWVyQ291bnRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5pbVRhcmdldC5jb3VudGVyID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIWFuaW1UYXJnZXQucGF0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5pbVRhcmdldC5wYXRoID0gcGF0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1UYXJnZXQuYmFzZVZhbHVlID0gdGFyZ2V0LnRhcmdldC5nZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1UYXJnZXQuc2V0dGVyID0gdGFyZ2V0LnRhcmdldC5zZXQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHRoaXMgbGF5ZXIncyB2YWx1ZSBvbnRvIHRoZSB0YXJnZXQgdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgYW5pbVRhcmdldC51cGRhdGVWYWx1ZShiaW5kZXIubGF5ZXJJbmRleCwgdGFyZ2V0LnZhbHVlKTtcblxuICAgICAgICAgICAgICAgICAgICBhbmltVGFyZ2V0LmNvdW50ZXIrKztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXQudGFyZ2V0LnNldCh0YXJnZXQudmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0YXJnZXQuYmxlbmRDb3VudGVyID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBnaXZlIHRoZSBiaW5kZXIgYW4gb3Bwb3J0dW5pdHkgdG8gdXBkYXRlIGl0c2VsZlxuICAgICAgICAvLyBUT0RPOiBpcyB0aGlzIGV2ZW4gbmVjZXNzYXJ5PyBiaW5kZXIgY291bGQga25vdyB3aGVuIHRvIHVwZGF0ZVxuICAgICAgICAvLyBpdHNlbGYgd2l0aG91dCBvdXIgaGVscC5cbiAgICAgICAgdGhpcy5fYmluZGVyLnVwZGF0ZShkZWx0YVRpbWUpO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgQW5pbUV2YWx1YXRvciB9O1xuIl0sIm5hbWVzIjpbIkFuaW1FdmFsdWF0b3IiLCJjb25zdHJ1Y3RvciIsImJpbmRlciIsIl9iaW5kZXIiLCJfY2xpcHMiLCJfaW5wdXRzIiwiX291dHB1dHMiLCJfdGFyZ2V0cyIsImNsaXBzIiwiYWRkQ2xpcCIsImNsaXAiLCJ0YXJnZXRzIiwiY3VydmVzIiwidHJhY2siLCJzbmFwc2hvdCIsImlucHV0cyIsIm91dHB1dHMiLCJpIiwibGVuZ3RoIiwiY3VydmUiLCJwYXRocyIsImoiLCJwYXRoIiwicmVzb2x2ZWQiLCJyZXNvbHZlIiwidGFyZ2V0IiwidGFyZ2V0UGF0aCIsInZhbHVlIiwiYmxlbmRDb3VudGVyIiwiayIsImNvbXBvbmVudHMiLCJwdXNoIiwiYW5pbUNvbXBvbmVudCIsInR5cGUiLCJzdWJzdHJpbmciLCJBbmltVGFyZ2V0VmFsdWUiLCJUWVBFX1FVQVQiLCJUWVBFX1ZFQzMiLCJsYXllckNvdW50ZXIiLCJzZXRNYXNrIiwibGF5ZXJJbmRleCIsIl9yZXN1bHRzIiwicmVtb3ZlQ2xpcCIsImluZGV4IiwidW5yZXNvbHZlIiwic3BsaWNlIiwicmVtb3ZlQ2xpcHMiLCJ1cGRhdGVDbGlwVHJhY2siLCJuYW1lIiwiYW5pbVRyYWNrIiwiZm9yRWFjaCIsImluY2x1ZGVzIiwicmViaW5kIiwiZmluZENsaXAiLCJhc3NpZ25NYXNrIiwibWFzayIsInVwZGF0ZSIsImRlbHRhVGltZSIsIm91dHB1dEFuaW1hdGlvbiIsIm9yZGVyIiwibWFwIiwiYyIsIkFuaW1CbGVuZCIsInN0YWJsZVNvcnQiLCJhIiwiYiIsImJsZW5kT3JkZXIiLCJibGVuZFdlaWdodCIsIl91cGRhdGUiLCJpbnB1dCIsIm91dHB1dCIsInNldCIsImJsZW5kIiwiaGFzT3duUHJvcGVydHkiLCJpc1RyYW5zZm9ybSIsImFuaW1UYXJnZXQiLCJjb3VudGVyIiwiYmFzZVZhbHVlIiwiZ2V0Iiwic2V0dGVyIiwidXBkYXRlVmFsdWUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1BLGFBQWEsQ0FBQztBQUNoQjtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDSUMsV0FBVyxDQUFDQyxNQUFNLEVBQUU7SUFDaEIsSUFBSSxDQUFDQyxPQUFPLEdBQUdELE1BQU0sQ0FBQTtJQUNyQixJQUFJLENBQUNFLE1BQU0sR0FBRyxFQUFFLENBQUE7SUFDaEIsSUFBSSxDQUFDQyxPQUFPLEdBQUcsRUFBRSxDQUFBO0lBQ2pCLElBQUksQ0FBQ0MsUUFBUSxHQUFHLEVBQUUsQ0FBQTtBQUNsQixJQUFBLElBQUksQ0FBQ0MsUUFBUSxHQUFHLEVBQUUsQ0FBQTtBQUN0QixHQUFBOztBQUVBO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDSSxFQUFBLElBQUlDLEtBQUssR0FBRztJQUNSLE9BQU8sSUFBSSxDQUFDSixNQUFNLENBQUE7QUFDdEIsR0FBQTs7QUFFQTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0VBQ0lLLE9BQU8sQ0FBQ0MsSUFBSSxFQUFFO0FBQ1YsSUFBQSxNQUFNQyxPQUFPLEdBQUcsSUFBSSxD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
