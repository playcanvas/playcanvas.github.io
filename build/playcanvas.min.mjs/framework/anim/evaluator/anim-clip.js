import{extends as t}from"../../../_virtual/_rollupPluginBabelHelpers.js";import{AnimSnapshot as e}from"./anim-snapshot.js";class s{constructor(t,s,i,r,h,n){this._name=t.name,this._track=t,this._snapshot=new e(t),this._playing=r,this._time=s,this._speed=i,this._loop=h,this._blendWeight=1,this._blendOrder=0,this._eventHandler=n,this.alignCursorToCurrentTime()}set name(t){this._name=t}get name(){return this._name}set track(t){this._track=t,this._snapshot=new e(t)}get track(){return this._track}get snapshot(){return this._snapshot}set time(t){this._time=t,this.alignCursorToCurrentTime()}get time(){return this._time}set speed(t){this._speed=t}get speed(){return this._speed}set loop(t){this._loop=t}get loop(){return this._loop}set blendWeight(t){this._blendWeight=t}get blendWeight(){return this._blendWeight}set blendOrder(t){this._blendOrder=t}get blendOrder(){return this._blendOrder}set eventCursor(t){this._eventCursor=t}get eventCursor(){return this._eventCursor}alignCursorToCurrentTime(){for(this._eventCursor=0;this._track.events[this._eventCursor]&&this._track.events[this._eventCursor].time<this.time;)this._eventCursor++}activeEventsForFrame(e,s){let i;for(0===e&&(this.eventCursor=0),s>this.track.duration&&(i=s-this.track.duration,s=this.track.duration);this.track.events[this.eventCursor]&&this.track.events[this.eventCursor].time>=e&&(s===this.track.duration?this.track.events[this.eventCursor].time<=s:this.track.events[this.eventCursor].time<s);){const e=this.track.events[this.eventCursor];this._eventHandler.fire(e.name,t({track:this.track},e)),this.eventCursor++}Number.isFinite(i)&&this.activeEventsForFrame(0,i)}progressForTime(t){return t*this._speed/this._track.duration}_update(t){if(this._playing){let e=this._time;const s=this._track.duration,i=this._speed,r=this._loop;this._track.events.length>0&&s>0&&this.activeEventsForFrame(e,e+i*t),e+=i*t,i>=0?e>s&&(r?e=e%s||0:(e=this._track.duration,this.pause())):e<0&&(r?e=s+(e%s||0):(e=0,this.pause())),this._time=e}this._time!==this._snapshot._time&&this._track.eval(this._time,this._snapshot)}play(){this._playing=!0,this._time=0}stop(){this._playing=!1,this._time=0}pause(){this._playing=!1}resume(){this._playing=!0}reset(){this._time=0}}export{s as AnimClip};
